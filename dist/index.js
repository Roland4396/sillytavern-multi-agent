var X2=Object.create;var Rf=Object.defineProperty;var Y2=Object.getOwnPropertyDescriptor;var Q2=Object.getOwnPropertyNames;var eF=Object.getPrototypeOf,tF=Object.prototype.hasOwnProperty;var rF=(t,e,r)=>e in t?Rf(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var le=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),hi=(t,e)=>{for(var r in e)Rf(t,r,{get:e[r],enumerable:!0})},nF=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Q2(e))!tF.call(t,i)&&i!==r&&Rf(t,i,{get:()=>e[i],enumerable:!(n=Y2(e,i))||n.enumerable});return t};var Wo=(t,e,r)=>(r=t!=null?X2(eF(t)):{},nF(e||!t||!t.__esModule?Rf(r,"default",{value:t,enumerable:!0}):r,t));var d=(t,e,r)=>rF(t,typeof e!="symbol"?e+"":e,r);var p$=le((y7,l$)=>{"use strict";l$.exports=function(t,e){if(typeof t!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,t.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}});var y$=le((v7,tv)=>{"use strict";var oF=/[\p{Lu}]/u,aF=/[\p{Ll}]/u,d$=/^[\p{Lu}](?![\p{Lu}])/gu,h$=/([\p{Alpha}\p{N}_]|$)/u,g$=/[_.\- ]+/,sF=new RegExp("^"+g$.source),f$=new RegExp(g$.source+h$.source,"gu"),m$=new RegExp("\\d+"+h$.source,"gu"),cF=(t,e,r)=>{let n=!1,i=!1,o=!1;for(let a=0;a<t.length;a++){let s=t[a];n&&oF.test(s)?(t=t.slice(0,a)+"-"+t.slice(a),n=!1,o=i,i=!0,a++):i&&o&&aF.test(s)?(t=t.slice(0,a-1)+"-"+t.slice(a-1),o=i,i=!1,n=!0):(n=e(s)===s&&r(s)!==s,o=i,i=r(s)===s&&e(s)!==s)}return t},uF=(t,e)=>(d$.lastIndex=0,t.replace(d$,r=>e(r))),lF=(t,e)=>(f$.lastIndex=0,m$.lastIndex=0,t.replace(f$,(r,n)=>e(n)).replace(m$,r=>e(r))),_$=(t,e)=>{if(!(typeof t=="string"||Array.isArray(t)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(t)?t=t.map(o=>o.trim()).filter(o=>o.length).join("-"):t=t.trim(),t.length===0)return"";let r=e.locale===!1?o=>o.toLowerCase():o=>o.toLocaleLowerCase(e.locale),n=e.locale===!1?o=>o.toUpperCase():o=>o.toLocaleUpperCase(e.locale);return t.length===1?e.pascalCase?n(t):r(t):(t!==r(t)&&(t=cF(t,r,n)),t=t.replace(sF,""),e.preserveConsecutiveUppercase?t=uF(t,r):t=r(t),e.pascalCase&&(t=n(t.charAt(0))+t.slice(1)),lF(t,n))};tv.exports=_$;tv.exports.default=_$});var lC=le((ZQ,Vv)=>{"use strict";var y6=Object.prototype.hasOwnProperty,yr="~";function lp(){}Object.create&&(lp.prototype=Object.create(null),new lp().__proto__||(yr=!1));function v6(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function uC(t,e,r,n,i){if(typeof r!="function")throw new TypeError("The listener must be a function");var o=new v6(r,n||t,i),a=yr?yr+e:e;return t._events[a]?t._events[a].fn?t._events[a]=[t._events[a],o]:t._events[a].push(o):(t._events[a]=o,t._eventsCount++),t}function pm(t,e){--t._eventsCount===0?t._events=new lp:delete t._events[e]}function ir(){this._events=new lp,this._eventsCount=0}ir.prototype.eventNames=function(){var e=[],r,n;if(this._eventsCount===0)return e;for(n in r=this._events)y6.call(r,n)&&e.push(yr?n.slice(1):n);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(r)):e};ir.prototype.listeners=function(e){var r=yr?yr+e:e,n=this._events[r];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,a=new Array(o);i<o;i++)a[i]=n[i].fn;return a};ir.prototype.listenerCount=function(e){var r=yr?yr+e:e,n=this._events[r];return n?n.fn?1:n.length:0};ir.prototype.emit=function(e,r,n,i,o,a){var s=yr?yr+e:e;if(!this._events[s])return!1;var c=this._events[s],u=arguments.length,l,p;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,r),!0;case 3:return c.fn.call(c.context,r,n),!0;case 4:return c.fn.call(c.context,r,n,i),!0;case 5:return c.fn.call(c.context,r,n,i,o),!0;case 6:return c.fn.call(c.context,r,n,i,o,a),!0}for(p=1,l=new Array(u-1);p<u;p++)l[p-1]=arguments[p];c.fn.apply(c.context,l)}else{var f=c.length,m;for(p=0;p<f;p++)switch(c[p].once&&this.removeListener(e,c[p].fn,void 0,!0),u){case 1:c[p].fn.call(c[p].context);break;case 2:c[p].fn.call(c[p].context,r);break;case 3:c[p].fn.call(c[p].context,r,n);break;case 4:c[p].fn.call(c[p].context,r,n,i);break;default:if(!l)for(m=1,l=new Array(u-1);m<u;m++)l[m-1]=arguments[m];c[p].fn.apply(c[p].context,l)}}return!0};ir.prototype.on=function(e,r,n){return uC(this,e,r,n,!1)};ir.prototype.once=function(e,r,n){return uC(this,e,r,n,!0)};ir.prototype.removeListener=function(e,r,n,i){var o=yr?yr+e:e;if(!this._events[o])return this;if(!r)return pm(this,o),this;var a=this._events[o];if(a.fn)a.fn===r&&(!i||a.once)&&(!n||a.context===n)&&pm(this,o);else{for(var s=0,c=[],u=a.length;s<u;s++)(a[s].fn!==r||i&&!a[s].once||n&&a[s].context!==n)&&c.push(a[s]);c.length?this._events[o]=c.length===1?c[0]:c:pm(this,o)}return this};ir.prototype.removeAllListeners=function(e){var r;return e?(r=yr?yr+e:e,this._events[r]&&pm(this,r)):(this._events=new lp,this._eventsCount=0),this};ir.prototype.off=ir.prototype.removeListener;ir.prototype.addListener=ir.prototype.on;ir.prefixed=yr;ir.EventEmitter=ir;typeof Vv<"u"&&(Vv.exports=ir)});var dC=le((GQ,pC)=>{"use strict";pC.exports=(t,e)=>(e=e||(()=>{}),t.then(r=>new Promise(n=>{n(e())}).then(()=>r),r=>new Promise(n=>{n(e())}).then(()=>{throw r})))});var mC=le((HQ,fm)=>{"use strict";var b6=dC(),dm=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},fC=(t,e,r)=>new Promise((n,i)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){n(t);return}let o=setTimeout(()=>{if(typeof r=="function"){try{n(r())}catch(c){i(c)}return}let a=typeof r=="string"?r:`Promise timed out after ${e} milliseconds`,s=r instanceof Error?r:new dm(a);typeof t.cancel=="function"&&t.cancel(),i(s)},e);b6(t.then(n,i),()=>{clearTimeout(o)})});fm.exports=fC;fm.exports.default=fC;fm.exports.TimeoutError=dm});var hC=le(Zv=>{"use strict";Object.defineProperty(Zv,"__esModule",{value:!0});function w6(t,e,r){let n=0,i=t.length;for(;i>0;){let o=i/2|0,a=n+o;r(t[a],e)<=0?(n=++a,i-=o+1):i=o}return n}Zv.default=w6});var gC=le(Hv=>{"use strict";Object.defineProperty(Hv,"__esModule",{value:!0});var x6=hC(),Gv=class{constructor(){this._queue=[]}enqueue(e,r){r=Object.assign({priority:0},r);let n={priority:r.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=r.priority){this._queue.push(n);return}let i=x6.default(this._queue,n,(o,a)=>a.priority-o.priority);this._queue.splice(i,0,n)}dequeue(){let e=this._queue.shift();return e?.run}filter(e){return this._queue.filter(r=>r.priority===e.priority).map(r=>r.run)}get size(){return this._queue.length}};Hv.default=Gv});var hm=le(Kv=>{"use strict";Object.defineProperty(Kv,"__esModule",{value:!0});var S6=lC(),_C=mC(),I6=gC(),mm=()=>{},k6=new _C.TimeoutError,qv=class extends S6{constructor(e){var r,n,i,o;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=mm,this._resolveIdle=mm,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:I6.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(n=(r=e.intervalCap)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(o=(i=e.interval)===null||i===void 0?void 0:i.toString())!==null&&o!==void 0?o:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=mm,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=mm,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(this._intervalId===void 0){let r=this._intervalEnd-e;if(r<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},r)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let r=this._queue.dequeue();return r?(this.emit("active"),r(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,r={}){return new Promise((n,i)=>{let o=async()=>{this._pendingCount++,this._intervalCount++;try{let a=this._timeout===void 0&&r.timeout===void 0?e():_C.default(Promise.resolve(e()),r.timeout===void 0?this._timeout:r.timeout,()=>{(r.throwOnTimeout===void 0?this._throwOnTimeout:r.throwOnTimeout)&&i(k6)});n(await a)}catch(a){i(a)}this._next()};this._queue.enqueue(o,r),this._tryToStartAnother(),this.emit("add")})}async addAll(e,r){return Promise.all(e.map(async n=>this.add(n,r)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{let r=this._resolveEmpty;this._resolveEmpty=()=>{r(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{let r=this._resolveIdle;this._resolveIdle=()=>{r(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}};Kv.default=qv});var dp=le((QQ,yC)=>{"use strict";var A6="2.0.0",T6=Number.MAX_SAFE_INTEGER||9007199254740991,$6=16,O6=250,C6=["major","premajor","minor","preminor","patch","prepatch","prerelease"];yC.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:$6,MAX_SAFE_BUILD_LENGTH:O6,MAX_SAFE_INTEGER:T6,RELEASE_TYPES:C6,SEMVER_SPEC_VERSION:A6,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var fp=le((eee,vC)=>{"use strict";var P6=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{};vC.exports=P6});var jc=le((yi,bC)=>{"use strict";var{MAX_SAFE_COMPONENT_LENGTH:Xv,MAX_SAFE_BUILD_LENGTH:N6,MAX_LENGTH:R6}=dp(),M6=fp();yi=bC.exports={};var z6=yi.re=[],j6=yi.safeRe=[],te=yi.src=[],D6=yi.safeSrc=[],re=yi.t={},L6=0,Yv="[a-zA-Z0-9-]",U6=[["\\s",1],["\\d",R6],[Yv,N6]],F6=t=>{for(let[e,r]of U6)t=t.split(`${e}*`).join(`${e}{0,${r}}`).split(`${e}+`).join(`${e}{1,${r}}`);return t},ke=(t,e,r)=>{let n=F6(e),i=L6++;M6(t,i,e),re[t]=i,te[i]=e,D6[i]=n,z6[i]=new RegExp(e,r?"g":void 0),j6[i]=new RegExp(n,r?"g":void 0)};ke("NUMERICIDENTIFIER","0|[1-9]\\d*");ke("NUMERICIDENTIFIERLOOSE","\\d+");ke("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${Yv}*`);ke("MAINVERSION",`(${te[re.NUMERICIDENTIFIER]})\\.(${te[re.NUMERICIDENTIFIER]})\\.(${te[re.NUMERICIDENTIFIER]})`);ke("MAINVERSIONLOOSE",`(${te[re.NUMERICIDENTIFIERLOOSE]})\\.(${te[re.NUMERICIDENTIFIERLOOSE]})\\.(${te[re.NUMERICIDENTIFIERLOOSE]})`);ke("PRERELEASEIDENTIFIER",`(?:${te[re.NONNUMERICIDENTIFIER]}|${te[re.NUMERICIDENTIFIER]})`);ke("PRERELEASEIDENTIFIERLOOSE",`(?:${te[re.NONNUMERICIDENTIFIER]}|${te[re.NUMERICIDENTIFIERLOOSE]})`);ke("PRERELEASE",`(?:-(${te[re.PRERELEASEIDENTIFIER]}(?:\\.${te[re.PRERELEASEIDENTIFIER]})*))`);ke("PRERELEASELOOSE",`(?:-?(${te[re.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${te[re.PRERELEASEIDENTIFIERLOOSE]})*))`);ke("BUILDIDENTIFIER",`${Yv}+`);ke("BUILD",`(?:\\+(${te[re.BUILDIDENTIFIER]}(?:\\.${te[re.BUILDIDENTIFIER]})*))`);ke("FULLPLAIN",`v?${te[re.MAINVERSION]}${te[re.PRERELEASE]}?${te[re.BUILD]}?`);ke("FULL",`^${te[re.FULLPLAIN]}$`);ke("LOOSEPLAIN",`[v=\\s]*${te[re.MAINVERSIONLOOSE]}${te[re.PRERELEASELOOSE]}?${te[re.BUILD]}?`);ke("LOOSE",`^${te[re.LOOSEPLAIN]}$`);ke("GTLT","((?:<|>)?=?)");ke("XRANGEIDENTIFIERLOOSE",`${te[re.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);ke("XRANGEIDENTIFIER",`${te[re.NUMERICIDENTIFIER]}|x|X|\\*`);ke("XRANGEPLAIN",`[v=\\s]*(${te[re.XRANGEIDENTIFIER]})(?:\\.(${te[re.XRANGEIDENTIFIER]})(?:\\.(${te[re.XRANGEIDENTIFIER]})(?:${te[re.PRERELEASE]})?${te[re.BUILD]}?)?)?`);ke("XRANGEPLAINLOOSE",`[v=\\s]*(${te[re.XRANGEIDENTIFIERLOOSE]})(?:\\.(${te[re.XRANGEIDENTIFIERLOOSE]})(?:\\.(${te[re.XRANGEIDENTIFIERLOOSE]})(?:${te[re.PRERELEASELOOSE]})?${te[re.BUILD]}?)?)?`);ke("XRANGE",`^${te[re.GTLT]}\\s*${te[re.XRANGEPLAIN]}$`);ke("XRANGELOOSE",`^${te[re.GTLT]}\\s*${te[re.XRANGEPLAINLOOSE]}$`);ke("COERCEPLAIN",`(^|[^\\d])(\\d{1,${Xv}})(?:\\.(\\d{1,${Xv}}))?(?:\\.(\\d{1,${Xv}}))?`);ke("COERCE",`${te[re.COERCEPLAIN]}(?:$|[^\\d])`);ke("COERCEFULL",te[re.COERCEPLAIN]+`(?:${te[re.PRERELEASE]})?(?:${te[re.BUILD]})?(?:$|[^\\d])`);ke("COERCERTL",te[re.COERCE],!0);ke("COERCERTLFULL",te[re.COERCEFULL],!0);ke("LONETILDE","(?:~>?)");ke("TILDETRIM",`(\\s*)${te[re.LONETILDE]}\\s+`,!0);yi.tildeTrimReplace="$1~";ke("TILDE",`^${te[re.LONETILDE]}${te[re.XRANGEPLAIN]}$`);ke("TILDELOOSE",`^${te[re.LONETILDE]}${te[re.XRANGEPLAINLOOSE]}$`);ke("LONECARET","(?:\\^)");ke("CARETTRIM",`(\\s*)${te[re.LONECARET]}\\s+`,!0);yi.caretTrimReplace="$1^";ke("CARET",`^${te[re.LONECARET]}${te[re.XRANGEPLAIN]}$`);ke("CARETLOOSE",`^${te[re.LONECARET]}${te[re.XRANGEPLAINLOOSE]}$`);ke("COMPARATORLOOSE",`^${te[re.GTLT]}\\s*(${te[re.LOOSEPLAIN]})$|^$`);ke("COMPARATOR",`^${te[re.GTLT]}\\s*(${te[re.FULLPLAIN]})$|^$`);ke("COMPARATORTRIM",`(\\s*)${te[re.GTLT]}\\s*(${te[re.LOOSEPLAIN]}|${te[re.XRANGEPLAIN]})`,!0);yi.comparatorTrimReplace="$1$2$3";ke("HYPHENRANGE",`^\\s*(${te[re.XRANGEPLAIN]})\\s+-\\s+(${te[re.XRANGEPLAIN]})\\s*$`);ke("HYPHENRANGELOOSE",`^\\s*(${te[re.XRANGEPLAINLOOSE]})\\s+-\\s+(${te[re.XRANGEPLAINLOOSE]})\\s*$`);ke("STAR","(<|>)?=?\\s*\\*");ke("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");ke("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var _m=le((tee,wC)=>{"use strict";var B6=Object.freeze({loose:!0}),V6=Object.freeze({}),Z6=t=>t?typeof t!="object"?B6:t:V6;wC.exports=Z6});var Qv=le((ree,IC)=>{"use strict";var xC=/^[0-9]+$/,SC=(t,e)=>{if(typeof t=="number"&&typeof e=="number")return t===e?0:t<e?-1:1;let r=xC.test(t),n=xC.test(e);return r&&n&&(t=+t,e=+e),t===e?0:r&&!n?-1:n&&!r?1:t<e?-1:1},G6=(t,e)=>SC(e,t);IC.exports={compareIdentifiers:SC,rcompareIdentifiers:G6}});var or=le((nee,EC)=>{"use strict";var ym=fp(),{MAX_LENGTH:kC,MAX_SAFE_INTEGER:vm}=dp(),{safeRe:bm,t:wm}=jc(),H6=_m(),{compareIdentifiers:eb}=Qv(),tb=class t{constructor(e,r){if(r=H6(r),e instanceof t){if(e.loose===!!r.loose&&e.includePrerelease===!!r.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>kC)throw new TypeError(`version is longer than ${kC} characters`);ym("SemVer",e,r),this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease;let n=e.trim().match(r.loose?bm[wm.LOOSE]:bm[wm.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>vm||this.major<0)throw new TypeError("Invalid major version");if(this.minor>vm||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>vm||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){let o=+i;if(o>=0&&o<vm)return o}return i}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(ym("SemVer.compare",this.version,this.options,e),!(e instanceof t)){if(typeof e=="string"&&e===this.version)return 0;e=new t(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof t||(e=new t(e,this.options)),this.major<e.major?-1:this.major>e.major?1:this.minor<e.minor?-1:this.minor>e.minor?1:this.patch<e.patch?-1:this.patch>e.patch?1:0}comparePre(e){if(e instanceof t||(e=new t(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let r=0;do{let n=this.prerelease[r],i=e.prerelease[r];if(ym("prerelease compare",r,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return eb(n,i)}while(++r)}compareBuild(e){e instanceof t||(e=new t(e,this.options));let r=0;do{let n=this.build[r],i=e.build[r];if(ym("build compare",r,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return eb(n,i)}while(++r)}inc(e,r,n){if(e.startsWith("pre")){if(!r&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(r){let i=`-${r}`.match(this.options.loose?bm[wm.PRERELEASELOOSE]:bm[wm.PRERELEASE]);if(!i||i[1]!==r)throw new Error(`invalid identifier: ${r}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",r,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",r,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",r,n),this.inc("pre",r,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",r,n),this.inc("pre",r,n);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let i=Number(n)?1:0;if(this.prerelease.length===0)this.prerelease=[i];else{let o=this.prerelease.length;for(;--o>=0;)typeof this.prerelease[o]=="number"&&(this.prerelease[o]++,o=-2);if(o===-1){if(r===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(i)}}if(r){let o=[r,i];n===!1&&(o=[r]),eb(this.prerelease[0],r)===0?isNaN(this.prerelease[1])&&(this.prerelease=o):this.prerelease=o}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};EC.exports=tb});var os=le((iee,TC)=>{"use strict";var AC=or(),q6=(t,e,r=!1)=>{if(t instanceof AC)return t;try{return new AC(t,e)}catch(n){if(!r)return null;throw n}};TC.exports=q6});var OC=le((oee,$C)=>{"use strict";var K6=os(),W6=(t,e)=>{let r=K6(t,e);return r?r.version:null};$C.exports=W6});var PC=le((aee,CC)=>{"use strict";var J6=os(),X6=(t,e)=>{let r=J6(t.trim().replace(/^[=v]+/,""),e);return r?r.version:null};CC.exports=X6});var MC=le((see,RC)=>{"use strict";var NC=or(),Y6=(t,e,r,n,i)=>{typeof r=="string"&&(i=n,n=r,r=void 0);try{return new NC(t instanceof NC?t.version:t,r).inc(e,n,i).version}catch{return null}};RC.exports=Y6});var DC=le((cee,jC)=>{"use strict";var zC=os(),Q6=(t,e)=>{let r=zC(t,null,!0),n=zC(e,null,!0),i=r.compare(n);if(i===0)return null;let o=i>0,a=o?r:n,s=o?n:r,c=!!a.prerelease.length;if(!!s.prerelease.length&&!c){if(!s.patch&&!s.minor)return"major";if(s.compareMain(a)===0)return s.minor&&!s.patch?"minor":"patch"}let l=c?"pre":"";return r.major!==n.major?l+"major":r.minor!==n.minor?l+"minor":r.patch!==n.patch?l+"patch":"prerelease"};jC.exports=Q6});var UC=le((uee,LC)=>{"use strict";var eB=or(),tB=(t,e)=>new eB(t,e).major;LC.exports=tB});var BC=le((lee,FC)=>{"use strict";var rB=or(),nB=(t,e)=>new rB(t,e).minor;FC.exports=nB});var ZC=le((pee,VC)=>{"use strict";var iB=or(),oB=(t,e)=>new iB(t,e).patch;VC.exports=oB});var HC=le((dee,GC)=>{"use strict";var aB=os(),sB=(t,e)=>{let r=aB(t,e);return r&&r.prerelease.length?r.prerelease:null};GC.exports=sB});var bn=le((fee,KC)=>{"use strict";var qC=or(),cB=(t,e,r)=>new qC(t,r).compare(new qC(e,r));KC.exports=cB});var JC=le((mee,WC)=>{"use strict";var uB=bn(),lB=(t,e,r)=>uB(e,t,r);WC.exports=lB});var YC=le((hee,XC)=>{"use strict";var pB=bn(),dB=(t,e)=>pB(t,e,!0);XC.exports=dB});var xm=le((gee,eP)=>{"use strict";var QC=or(),fB=(t,e,r)=>{let n=new QC(t,r),i=new QC(e,r);return n.compare(i)||n.compareBuild(i)};eP.exports=fB});var rP=le((_ee,tP)=>{"use strict";var mB=xm(),hB=(t,e)=>t.sort((r,n)=>mB(r,n,e));tP.exports=hB});var iP=le((yee,nP)=>{"use strict";var gB=xm(),_B=(t,e)=>t.sort((r,n)=>gB(n,r,e));nP.exports=_B});var mp=le((vee,oP)=>{"use strict";var yB=bn(),vB=(t,e,r)=>yB(t,e,r)>0;oP.exports=vB});var Sm=le((bee,aP)=>{"use strict";var bB=bn(),wB=(t,e,r)=>bB(t,e,r)<0;aP.exports=wB});var rb=le((wee,sP)=>{"use strict";var xB=bn(),SB=(t,e,r)=>xB(t,e,r)===0;sP.exports=SB});var nb=le((xee,cP)=>{"use strict";var IB=bn(),kB=(t,e,r)=>IB(t,e,r)!==0;cP.exports=kB});var Im=le((See,uP)=>{"use strict";var EB=bn(),AB=(t,e,r)=>EB(t,e,r)>=0;uP.exports=AB});var km=le((Iee,lP)=>{"use strict";var TB=bn(),$B=(t,e,r)=>TB(t,e,r)<=0;lP.exports=$B});var ib=le((kee,pP)=>{"use strict";var OB=rb(),CB=nb(),PB=mp(),NB=Im(),RB=Sm(),MB=km(),zB=(t,e,r,n)=>{switch(e){case"===":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t===r;case"!==":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t!==r;case"":case"=":case"==":return OB(t,r,n);case"!=":return CB(t,r,n);case">":return PB(t,r,n);case">=":return NB(t,r,n);case"<":return RB(t,r,n);case"<=":return MB(t,r,n);default:throw new TypeError(`Invalid operator: ${e}`)}};pP.exports=zB});var fP=le((Eee,dP)=>{"use strict";var jB=or(),DB=os(),{safeRe:Em,t:Am}=jc(),LB=(t,e)=>{if(t instanceof jB)return t;if(typeof t=="number"&&(t=String(t)),typeof t!="string")return null;e=e||{};let r=null;if(!e.rtl)r=t.match(e.includePrerelease?Em[Am.COERCEFULL]:Em[Am.COERCE]);else{let c=e.includePrerelease?Em[Am.COERCERTLFULL]:Em[Am.COERCERTL],u;for(;(u=c.exec(t))&&(!r||r.index+r[0].length!==t.length);)(!r||u.index+u[0].length!==r.index+r[0].length)&&(r=u),c.lastIndex=u.index+u[1].length+u[2].length;c.lastIndex=-1}if(r===null)return null;let n=r[2],i=r[3]||"0",o=r[4]||"0",a=e.includePrerelease&&r[5]?`-${r[5]}`:"",s=e.includePrerelease&&r[6]?`+${r[6]}`:"";return DB(`${n}.${i}.${o}${a}${s}`,e)};dP.exports=LB});var hP=le((Aee,mP)=>{"use strict";var ob=class{constructor(){this.max=1e3,this.map=new Map}get(e){let r=this.map.get(e);if(r!==void 0)return this.map.delete(e),this.map.set(e,r),r}delete(e){return this.map.delete(e)}set(e,r){if(!this.delete(e)&&r!==void 0){if(this.map.size>=this.max){let i=this.map.keys().next().value;this.delete(i)}this.map.set(e,r)}return this}};mP.exports=ob});var wn=le((Tee,vP)=>{"use strict";var UB=/\s+/g,ab=class t{constructor(e,r){if(r=BB(r),e instanceof t)return e.loose===!!r.loose&&e.includePrerelease===!!r.includePrerelease?e:new t(e.raw,r);if(e instanceof sb)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease,this.raw=e.trim().replace(UB," "),this.set=this.raw.split("||").map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let n=this.set[0];if(this.set=this.set.filter(i=>!_P(i[0])),this.set.length===0)this.set=[n];else if(this.set.length>1){for(let i of this.set)if(i.length===1&&WB(i[0])){this.set=[i];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let r=this.set[e];for(let n=0;n<r.length;n++)n>0&&(this.formatted+=" "),this.formatted+=r[n].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let n=((this.options.includePrerelease&&qB)|(this.options.loose&&KB))+":"+e,i=gP.get(n);if(i)return i;let o=this.options.loose,a=o?vr[ar.HYPHENRANGELOOSE]:vr[ar.HYPHENRANGE];e=e.replace(a,o5(this.options.includePrerelease)),ct("hyphen replace",e),e=e.replace(vr[ar.COMPARATORTRIM],ZB),ct("comparator trim",e),e=e.replace(vr[ar.TILDETRIM],GB),ct("tilde trim",e),e=e.replace(vr[ar.CARETTRIM],HB),ct("caret trim",e);let s=e.split(" ").map(p=>JB(p,this.options)).join(" ").split(/\s+/).map(p=>i5(p,this.options));o&&(s=s.filter(p=>(ct("loose invalid filter",p,this.options),!!p.match(vr[ar.COMPARATORLOOSE])))),ct("range list",s);let c=new Map,u=s.map(p=>new sb(p,this.options));for(let p of u){if(_P(p))return[p];c.set(p.value,p)}c.size>1&&c.has("")&&c.delete("");let l=[...c.values()];return gP.set(n,l),l}intersects(e,r){if(!(e instanceof t))throw new TypeError("a Range is required");return this.set.some(n=>yP(n,r)&&e.set.some(i=>yP(i,r)&&n.every(o=>i.every(a=>o.intersects(a,r)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new VB(e,this.options)}catch{return!1}for(let r=0;r<this.set.length;r++)if(a5(this.set[r],e,this.options))return!0;return!1}};vP.exports=ab;var FB=hP(),gP=new FB,BB=_m(),sb=hp(),ct=fp(),VB=or(),{safeRe:vr,t:ar,comparatorTrimReplace:ZB,tildeTrimReplace:GB,caretTrimReplace:HB}=jc(),{FLAG_INCLUDE_PRERELEASE:qB,FLAG_LOOSE:KB}=dp(),_P=t=>t.value==="<0.0.0-0",WB=t=>t.value==="",yP=(t,e)=>{let r=!0,n=t.slice(),i=n.pop();for(;r&&n.length;)r=n.every(o=>i.intersects(o,e)),i=n.pop();return r},JB=(t,e)=>(t=t.replace(vr[ar.BUILD],""),ct("comp",t,e),t=QB(t,e),ct("caret",t),t=XB(t,e),ct("tildes",t),t=t5(t,e),ct("xrange",t),t=n5(t,e),ct("stars",t),t),br=t=>!t||t.toLowerCase()==="x"||t==="*",XB=(t,e)=>t.trim().split(/\s+/).map(r=>YB(r,e)).join(" "),YB=(t,e)=>{let r=e.loose?vr[ar.TILDELOOSE]:vr[ar.TILDE];return t.replace(r,(n,i,o,a,s)=>{ct("tilde",t,n,i,o,a,s);let c;return br(i)?c="":br(o)?c=`>=${i}.0.0 <${+i+1}.0.0-0`:br(a)?c=`>=${i}.${o}.0 <${i}.${+o+1}.0-0`:s?(ct("replaceTilde pr",s),c=`>=${i}.${o}.${a}-${s} <${i}.${+o+1}.0-0`):c=`>=${i}.${o}.${a} <${i}.${+o+1}.0-0`,ct("tilde return",c),c})},QB=(t,e)=>t.trim().split(/\s+/).map(r=>e5(r,e)).join(" "),e5=(t,e)=>{ct("caret",t,e);let r=e.loose?vr[ar.CARETLOOSE]:vr[ar.CARET],n=e.includePrerelease?"-0":"";return t.replace(r,(i,o,a,s,c)=>{ct("caret",t,i,o,a,s,c);let u;return br(o)?u="":br(a)?u=`>=${o}.0.0${n} <${+o+1}.0.0-0`:br(s)?o==="0"?u=`>=${o}.${a}.0${n} <${o}.${+a+1}.0-0`:u=`>=${o}.${a}.0${n} <${+o+1}.0.0-0`:c?(ct("replaceCaret pr",c),o==="0"?a==="0"?u=`>=${o}.${a}.${s}-${c} <${o}.${a}.${+s+1}-0`:u=`>=${o}.${a}.${s}-${c} <${o}.${+a+1}.0-0`:u=`>=${o}.${a}.${s}-${c} <${+o+1}.0.0-0`):(ct("no pr"),o==="0"?a==="0"?u=`>=${o}.${a}.${s}${n} <${o}.${a}.${+s+1}-0`:u=`>=${o}.${a}.${s}${n} <${o}.${+a+1}.0-0`:u=`>=${o}.${a}.${s} <${+o+1}.0.0-0`),ct("caret return",u),u})},t5=(t,e)=>(ct("replaceXRanges",t,e),t.split(/\s+/).map(r=>r5(r,e)).join(" ")),r5=(t,e)=>{t=t.trim();let r=e.loose?vr[ar.XRANGELOOSE]:vr[ar.XRANGE];return t.replace(r,(n,i,o,a,s,c)=>{ct("xRange",t,n,i,o,a,s,c);let u=br(o),l=u||br(a),p=l||br(s),f=p;return i==="="&&f&&(i=""),c=e.includePrerelease?"-0":"",u?i===">"||i==="<"?n="<0.0.0-0":n="*":i&&f?(l&&(a=0),s=0,i===">"?(i=">=",l?(o=+o+1,a=0,s=0):(a=+a+1,s=0)):i==="<="&&(i="<",l?o=+o+1:a=+a+1),i==="<"&&(c="-0"),n=`${i+o}.${a}.${s}${c}`):l?n=`>=${o}.0.0${c} <${+o+1}.0.0-0`:p&&(n=`>=${o}.${a}.0${c} <${o}.${+a+1}.0-0`),ct("xRange return",n),n})},n5=(t,e)=>(ct("replaceStars",t,e),t.trim().replace(vr[ar.STAR],"")),i5=(t,e)=>(ct("replaceGTE0",t,e),t.trim().replace(vr[e.includePrerelease?ar.GTE0PRE:ar.GTE0],"")),o5=t=>(e,r,n,i,o,a,s,c,u,l,p,f)=>(br(n)?r="":br(i)?r=`>=${n}.0.0${t?"-0":""}`:br(o)?r=`>=${n}.${i}.0${t?"-0":""}`:a?r=`>=${r}`:r=`>=${r}${t?"-0":""}`,br(u)?c="":br(l)?c=`<${+u+1}.0.0-0`:br(p)?c=`<${u}.${+l+1}.0-0`:f?c=`<=${u}.${l}.${p}-${f}`:t?c=`<${u}.${l}.${+p+1}-0`:c=`<=${c}`,`${r} ${c}`.trim()),a5=(t,e,r)=>{for(let n=0;n<t.length;n++)if(!t[n].test(e))return!1;if(e.prerelease.length&&!r.includePrerelease){for(let n=0;n<t.length;n++)if(ct(t[n].semver),t[n].semver!==sb.ANY&&t[n].semver.prerelease.length>0){let i=t[n].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0}});var hp=le(($ee,kP)=>{"use strict";var gp=Symbol("SemVer ANY"),lb=class t{static get ANY(){return gp}constructor(e,r){if(r=bP(r),e instanceof t){if(e.loose===!!r.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),ub("comparator",e,r),this.options=r,this.loose=!!r.loose,this.parse(e),this.semver===gp?this.value="":this.value=this.operator+this.semver.version,ub("comp",this)}parse(e){let r=this.options.loose?wP[xP.COMPARATORLOOSE]:wP[xP.COMPARATOR],n=e.match(r);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new SP(n[2],this.options.loose):this.semver=gp}toString(){return this.value}test(e){if(ub("Comparator.test",e,this.options.loose),this.semver===gp||e===gp)return!0;if(typeof e=="string")try{e=new SP(e,this.options)}catch{return!1}return cb(e,this.operator,this.semver,this.options)}intersects(e,r){if(!(e instanceof t))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new IP(e.value,r).test(this.value):e.operator===""?e.value===""?!0:new IP(this.value,r).test(e.semver):(r=bP(r),r.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!r.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||cb(this.semver,"<",e.semver,r)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||cb(this.semver,">",e.semver,r)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};kP.exports=lb;var bP=_m(),{safeRe:wP,t:xP}=jc(),cb=ib(),ub=fp(),SP=or(),IP=wn()});var _p=le((Oee,EP)=>{"use strict";var s5=wn(),c5=(t,e,r)=>{try{e=new s5(e,r)}catch{return!1}return e.test(t)};EP.exports=c5});var TP=le((Cee,AP)=>{"use strict";var u5=wn(),l5=(t,e)=>new u5(t,e).set.map(r=>r.map(n=>n.value).join(" ").trim().split(" "));AP.exports=l5});var OP=le((Pee,$P)=>{"use strict";var p5=or(),d5=wn(),f5=(t,e,r)=>{let n=null,i=null,o=null;try{o=new d5(e,r)}catch{return null}return t.forEach(a=>{o.test(a)&&(!n||i.compare(a)===-1)&&(n=a,i=new p5(n,r))}),n};$P.exports=f5});var PP=le((Nee,CP)=>{"use strict";var m5=or(),h5=wn(),g5=(t,e,r)=>{let n=null,i=null,o=null;try{o=new h5(e,r)}catch{return null}return t.forEach(a=>{o.test(a)&&(!n||i.compare(a)===1)&&(n=a,i=new m5(n,r))}),n};CP.exports=g5});var MP=le((Ree,RP)=>{"use strict";var pb=or(),_5=wn(),NP=mp(),y5=(t,e)=>{t=new _5(t,e);let r=new pb("0.0.0");if(t.test(r)||(r=new pb("0.0.0-0"),t.test(r)))return r;r=null;for(let n=0;n<t.set.length;++n){let i=t.set[n],o=null;i.forEach(a=>{let s=new pb(a.semver.version);switch(a.operator){case">":s.prerelease.length===0?s.patch++:s.prerelease.push(0),s.raw=s.format();case"":case">=":(!o||NP(s,o))&&(o=s);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${a.operator}`)}}),o&&(!r||NP(r,o))&&(r=o)}return r&&t.test(r)?r:null};RP.exports=y5});var jP=le((Mee,zP)=>{"use strict";var v5=wn(),b5=(t,e)=>{try{return new v5(t,e).range||"*"}catch{return null}};zP.exports=b5});var Tm=le((zee,FP)=>{"use strict";var w5=or(),UP=hp(),{ANY:x5}=UP,S5=wn(),I5=_p(),DP=mp(),LP=Sm(),k5=km(),E5=Im(),A5=(t,e,r,n)=>{t=new w5(t,n),e=new S5(e,n);let i,o,a,s,c;switch(r){case">":i=DP,o=k5,a=LP,s=">",c=">=";break;case"<":i=LP,o=E5,a=DP,s="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(I5(t,e,n))return!1;for(let u=0;u<e.set.length;++u){let l=e.set[u],p=null,f=null;if(l.forEach(m=>{m.semver===x5&&(m=new UP(">=0.0.0")),p=p||m,f=f||m,i(m.semver,p.semver,n)?p=m:a(m.semver,f.semver,n)&&(f=m)}),p.operator===s||p.operator===c||(!f.operator||f.operator===s)&&o(t,f.semver))return!1;if(f.operator===c&&a(t,f.semver))return!1}return!0};FP.exports=A5});var VP=le((jee,BP)=>{"use strict";var T5=Tm(),$5=(t,e,r)=>T5(t,e,">",r);BP.exports=$5});var GP=le((Dee,ZP)=>{"use strict";var O5=Tm(),C5=(t,e,r)=>O5(t,e,"<",r);ZP.exports=C5});var KP=le((Lee,qP)=>{"use strict";var HP=wn(),P5=(t,e,r)=>(t=new HP(t,r),e=new HP(e,r),t.intersects(e,r));qP.exports=P5});var JP=le((Uee,WP)=>{"use strict";var N5=_p(),R5=bn();WP.exports=(t,e,r)=>{let n=[],i=null,o=null,a=t.sort((l,p)=>R5(l,p,r));for(let l of a)N5(l,e,r)?(o=l,i||(i=l)):(o&&n.push([i,o]),o=null,i=null);i&&n.push([i,null]);let s=[];for(let[l,p]of n)l===p?s.push(l):!p&&l===a[0]?s.push("*"):p?l===a[0]?s.push(`<=${p}`):s.push(`${l} - ${p}`):s.push(`>=${l}`);let c=s.join(" || "),u=typeof e.raw=="string"?e.raw:String(e);return c.length<u.length?c:e}});var rN=le((Fee,tN)=>{"use strict";var XP=wn(),fb=hp(),{ANY:db}=fb,yp=_p(),mb=bn(),M5=(t,e,r={})=>{if(t===e)return!0;t=new XP(t,r),e=new XP(e,r);let n=!1;e:for(let i of t.set){for(let o of e.set){let a=j5(i,o,r);if(n=n||a!==null,a)continue e}if(n)return!1}return!0},z5=[new fb(">=0.0.0-0")],YP=[new fb(">=0.0.0")],j5=(t,e,r)=>{if(t===e)return!0;if(t.length===1&&t[0].semver===db){if(e.length===1&&e[0].semver===db)return!0;r.includePrerelease?t=z5:t=YP}if(e.length===1&&e[0].semver===db){if(r.includePrerelease)return!0;e=YP}let n=new Set,i,o;for(let m of t)m.operator===">"||m.operator===">="?i=QP(i,m,r):m.operator==="<"||m.operator==="<="?o=eN(o,m,r):n.add(m.semver);if(n.size>1)return null;let a;if(i&&o){if(a=mb(i.semver,o.semver,r),a>0)return null;if(a===0&&(i.operator!==">="||o.operator!=="<="))return null}for(let m of n){if(i&&!yp(m,String(i),r)||o&&!yp(m,String(o),r))return null;for(let h of e)if(!yp(m,String(h),r))return!1;return!0}let s,c,u,l,p=o&&!r.includePrerelease&&o.semver.prerelease.length?o.semver:!1,f=i&&!r.includePrerelease&&i.semver.prerelease.length?i.semver:!1;p&&p.prerelease.length===1&&o.operator==="<"&&p.prerelease[0]===0&&(p=!1);for(let m of e){if(l=l||m.operator===">"||m.operator===">=",u=u||m.operator==="<"||m.operator==="<=",i){if(f&&m.semver.prerelease&&m.semver.prerelease.length&&m.semver.major===f.major&&m.semver.minor===f.minor&&m.semver.patch===f.patch&&(f=!1),m.operator===">"||m.operator===">="){if(s=QP(i,m,r),s===m&&s!==i)return!1}else if(i.operator===">="&&!yp(i.semver,String(m),r))return!1}if(o){if(p&&m.semver.prerelease&&m.semver.prerelease.length&&m.semver.major===p.major&&m.semver.minor===p.minor&&m.semver.patch===p.patch&&(p=!1),m.operator==="<"||m.operator==="<="){if(c=eN(o,m,r),c===m&&c!==o)return!1}else if(o.operator==="<="&&!yp(o.semver,String(m),r))return!1}if(!m.operator&&(o||i)&&a!==0)return!1}return!(i&&u&&!o&&a!==0||o&&l&&!i&&a!==0||f||p)},QP=(t,e,r)=>{if(!t)return e;let n=mb(t.semver,e.semver,r);return n>0?t:n<0||e.operator===">"&&t.operator===">="?e:t},eN=(t,e,r)=>{if(!t)return e;let n=mb(t.semver,e.semver,r);return n<0?t:n>0||e.operator==="<"&&t.operator==="<="?e:t};tN.exports=M5});var aN=le((Bee,oN)=>{"use strict";var hb=jc(),nN=dp(),D5=or(),iN=Qv(),L5=os(),U5=OC(),F5=PC(),B5=MC(),V5=DC(),Z5=UC(),G5=BC(),H5=ZC(),q5=HC(),K5=bn(),W5=JC(),J5=YC(),X5=xm(),Y5=rP(),Q5=iP(),eV=mp(),tV=Sm(),rV=rb(),nV=nb(),iV=Im(),oV=km(),aV=ib(),sV=fP(),cV=hp(),uV=wn(),lV=_p(),pV=TP(),dV=OP(),fV=PP(),mV=MP(),hV=jP(),gV=Tm(),_V=VP(),yV=GP(),vV=KP(),bV=JP(),wV=rN();oN.exports={parse:L5,valid:U5,clean:F5,inc:B5,diff:V5,major:Z5,minor:G5,patch:H5,prerelease:q5,compare:K5,rcompare:W5,compareLoose:J5,compareBuild:X5,sort:Y5,rsort:Q5,gt:eV,lt:tV,eq:rV,neq:nV,gte:iV,lte:oV,cmp:aV,coerce:sV,Comparator:cV,Range:uV,satisfies:lV,toComparators:pV,maxSatisfying:dV,minSatisfying:fV,minVersion:mV,validRange:hV,outside:gV,gtr:_V,ltr:yV,intersects:vV,simplifyRange:bV,subset:wV,SemVer:D5,re:hb.re,src:hb.src,tokens:hb.t,SEMVER_SPEC_VERSION:nN.SEMVER_SPEC_VERSION,RELEASE_TYPES:nN.RELEASE_TYPES,compareIdentifiers:iN.compareIdentifiers,rcompareIdentifiers:iN.rcompareIdentifiers}});var EN=le((Nte,kN)=>{"use strict";var SN=(t=0)=>e=>`\x1B[${38+t};5;${e}m`,IN=(t=0)=>(e,r,n)=>`\x1B[${38+t};2;${e};${r};${n}m`;function ZV(){let t=new Map,e={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};e.color.gray=e.color.blackBright,e.bgColor.bgGray=e.bgColor.bgBlackBright,e.color.grey=e.color.blackBright,e.bgColor.bgGrey=e.bgColor.bgBlackBright;for(let[r,n]of Object.entries(e)){for(let[i,o]of Object.entries(n))e[i]={open:`\x1B[${o[0]}m`,close:`\x1B[${o[1]}m`},n[i]=e[i],t.set(o[0],o[1]);Object.defineProperty(e,r,{value:n,enumerable:!1})}return Object.defineProperty(e,"codes",{value:t,enumerable:!1}),e.color.close="\x1B[39m",e.bgColor.close="\x1B[49m",e.color.ansi256=SN(),e.color.ansi16m=IN(),e.bgColor.ansi256=SN(10),e.bgColor.ansi16m=IN(10),Object.defineProperties(e,{rgbToAnsi256:{value:(r,n,i)=>r===n&&n===i?r<8?16:r>248?231:Math.round((r-8)/247*24)+232:16+36*Math.round(r/255*5)+6*Math.round(n/255*5)+Math.round(i/255*5),enumerable:!1},hexToRgb:{value:r=>{let n=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(r.toString(16));if(!n)return[0,0,0];let{colorString:i}=n.groups;i.length===3&&(i=i.split("").map(a=>a+a).join(""));let o=Number.parseInt(i,16);return[o>>16&255,o>>8&255,o&255]},enumerable:!1},hexToAnsi256:{value:r=>e.rgbToAnsi256(...e.hexToRgb(r)),enumerable:!1}}),e}Object.defineProperty(kN,"exports",{enumerable:!0,get:ZV})});var _z=le(jg=>{"use strict";jg.byteLength=sq;jg.toByteArray=uq;jg.fromByteArray=dq;var Ri=[],Cn=[],aq=typeof Uint8Array<"u"?Uint8Array:Array,MI="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(Ls=0,hz=MI.length;Ls<hz;++Ls)Ri[Ls]=MI[Ls],Cn[MI.charCodeAt(Ls)]=Ls;var Ls,hz;Cn[45]=62;Cn[95]=63;function gz(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");r===-1&&(r=e);var n=r===e?0:4-r%4;return[r,n]}function sq(t){var e=gz(t),r=e[0],n=e[1];return(r+n)*3/4-n}function cq(t,e,r){return(e+r)*3/4-r}function uq(t){var e,r=gz(t),n=r[0],i=r[1],o=new aq(cq(t,n,i)),a=0,s=i>0?n-4:n,c;for(c=0;c<s;c+=4)e=Cn[t.charCodeAt(c)]<<18|Cn[t.charCodeAt(c+1)]<<12|Cn[t.charCodeAt(c+2)]<<6|Cn[t.charCodeAt(c+3)],o[a++]=e>>16&255,o[a++]=e>>8&255,o[a++]=e&255;return i===2&&(e=Cn[t.charCodeAt(c)]<<2|Cn[t.charCodeAt(c+1)]>>4,o[a++]=e&255),i===1&&(e=Cn[t.charCodeAt(c)]<<10|Cn[t.charCodeAt(c+1)]<<4|Cn[t.charCodeAt(c+2)]>>2,o[a++]=e>>8&255,o[a++]=e&255),o}function lq(t){return Ri[t>>18&63]+Ri[t>>12&63]+Ri[t>>6&63]+Ri[t&63]}function pq(t,e,r){for(var n,i=[],o=e;o<r;o+=3)n=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(t[o+2]&255),i.push(lq(n));return i.join("")}function dq(t){for(var e,r=t.length,n=r%3,i=[],o=16383,a=0,s=r-n;a<s;a+=o)i.push(pq(t,a,a+o>s?s:a+o));return n===1?(e=t[r-1],i.push(Ri[e>>2]+Ri[e<<4&63]+"==")):n===2&&(e=(t[r-2]<<8)+t[r-1],i.push(Ri[e>>10]+Ri[e>>4&63]+Ri[e<<2&63]+"=")),i.join("")}});var iF=Object.defineProperty,z=(t,e)=>{for(var r in e)iF(t,r,{get:e[r],enumerable:!0})};var c$=Symbol.for("ls:tracing_async_local_storage"),Jo=Symbol.for("lc:context_variables"),u$=t=>{globalThis[c$]=t},Xo=()=>globalThis[c$];var v$=Wo(p$(),1),b$=Wo(y$(),1);function w$(t,e){return e?.[t]||(0,v$.default)(t)}function x$(t,e){return e?.[t]||(0,b$.default)(t)}function Mf(t,e,r){let n={};for(let i in t)Object.hasOwn(t,i)&&(n[e(i,r)]=t[i]);return n}var Df="__lc_escaped__";function pF(t){return"lc"in t||Object.keys(t).length===1&&Df in t}function dF(t){return{[Df]:t}}function rv(t){return Object.keys(t).length===1&&Df in t}function fF(t){return t!==null&&typeof t=="object"&&"lc_serializable"in t&&typeof t.toJSON=="function"}function mF(t){let e;return t!==null&&typeof t=="object"?"lc_id"in t&&Array.isArray(t.lc_id)?e=t.lc_id:e=[t.constructor?.name??"Object"]:e=[typeof t],{lc:1,type:"not_implemented",id:e}}function zf(t,e=new WeakSet){if(t!==null&&typeof t=="object"&&!Array.isArray(t)){if(e.has(t))return mF(t);if(fF(t))return t;e.add(t);let r=t;if(pF(r))return e.delete(t),dF(r);let n={};for(let[i,o]of Object.entries(r))n[i]=zf(o,e);return e.delete(t),n}return Array.isArray(t)?t.map(r=>zf(r,e)):t}function jf(t){if(t!==null&&typeof t=="object"&&!Array.isArray(t)){let e=t;if(rv(e))return e[Df];let r={};for(let[n,i]of Object.entries(e))r[n]=jf(i);return r}return Array.isArray(t)?t.map(e=>jf(e)):t}var nv={};z(nv,{Serializable:()=>It,get_lc_unique_name:()=>Oc});function S$(t){return Array.isArray(t)?[...t]:{...t}}function hF(t,e){let r=S$(t);for(let[n,i]of Object.entries(e)){let[o,...a]=n.split(".").reverse(),s=r;for(let c of a.reverse()){if(s[c]===void 0)break;s[c]=S$(s[c]),s=s[c]}s[o]!==void 0&&(s[o]={lc:1,type:"secret",id:[i]})}return r}function Oc(t){let e=Object.getPrototypeOf(t);return typeof t.lc_name=="function"&&(typeof e.lc_name!="function"||t.lc_name()!==e.lc_name())?t.lc_name():t.name}var It=class I${constructor(e,...r){d(this,"lc_serializable",!1);d(this,"lc_kwargs");this.lc_serializable_keys!==void 0?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([n])=>this.lc_serializable_keys?.includes(n))):this.lc_kwargs=e??{}}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Oc(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof I$||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let e={},r={},n=Object.keys(this.lc_kwargs).reduce((c,u)=>(c[u]=u in this?this[u]:this.lc_kwargs[u],c),{});for(let c=Object.getPrototypeOf(this);c;c=Object.getPrototypeOf(c))Object.assign(e,Reflect.get(c,"lc_aliases",this)),Object.assign(r,Reflect.get(c,"lc_secrets",this)),Object.assign(n,Reflect.get(c,"lc_attributes",this));Object.keys(r).forEach(c=>{let u=this,l=n,[p,...f]=c.split(".").reverse();for(let m of f.reverse()){if(!(m in u)||u[m]===void 0)return;(!(m in l)||l[m]===void 0)&&(typeof u[m]=="object"&&u[m]!=null?l[m]={}:Array.isArray(u[m])&&(l[m]=[])),u=u[m],l=l[m]}p in u&&u[p]!==void 0&&(l[p]=l[p]||u[p])});let i={},o=new WeakSet;o.add(this);for(let[c,u]of Object.entries(n))i[c]=zf(u,o);let a=Object.keys(r).length?hF(i,r):i,s=Mf(a,w$,e);return{lc:1,type:"constructor",id:this.lc_id,kwargs:s}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}};function jr(t){return typeof t=="object"&&t!==null&&"type"in t&&typeof t.type=="string"&&"source_type"in t&&(t.source_type==="url"||t.source_type==="base64"||t.source_type==="text"||t.source_type==="id")}function Cc(t){return jr(t)&&t.source_type==="url"&&"url"in t&&typeof t.url=="string"}function Pc(t){return jr(t)&&t.source_type==="base64"&&"data"in t&&typeof t.data=="string"}function k$(t){return jr(t)&&t.source_type==="text"&&"text"in t&&typeof t.text=="string"}function Lf(t){return jr(t)&&t.source_type==="id"&&"id"in t&&typeof t.id=="string"}function Uf(t){if(jr(t)){if(t.source_type==="url")return{type:"image_url",image_url:{url:t.url}};if(t.source_type==="base64"){if(!t.mime_type)throw new Error("mime_type key is required for base64 data.");return{type:"image_url",image_url:{url:`data:${t.mime_type};base64,${t.data}`}}}}throw new Error("Unsupported source type. Only 'url' and 'base64' are supported.")}function Ql(t){let e=t.split(";")[0].split("/");if(e.length!==2)throw new Error(`Invalid mime type: "${t}" - does not match type/subtype format.`);let r=e[0].trim(),n=e[1].trim();if(r===""||n==="")throw new Error(`Invalid mime type: "${t}" - type or subtype is empty.`);let i={};for(let o of t.split(";").slice(1)){let a=o.split("=");if(a.length!==2)throw new Error(`Invalid parameter syntax in mime type: "${t}".`);let s=a[0].trim(),c=a[1].trim();if(s==="")throw new Error(`Invalid parameter syntax in mime type: "${t}".`);i[s]=c}return{type:r,subtype:n,parameters:i}}function Yo({dataUrl:t,asTypedArray:e=!1}){let r=t.match(/^data:(\w+\/\w+);base64,([A-Za-z0-9+/]+=*)$/),n;if(r){n=r[1].toLowerCase();let i=e?Uint8Array.from(atob(r[2]),o=>o.charCodeAt(0)):r[2];return{mime_type:n,data:i}}}function Nc(t,e){if(t.type==="text"){if(!e.fromStandardTextBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardTextBlock\` method.`);return e.fromStandardTextBlock(t)}if(t.type==="image"){if(!e.fromStandardImageBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardImageBlock\` method.`);return e.fromStandardImageBlock(t)}if(t.type==="audio"){if(!e.fromStandardAudioBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardAudioBlock\` method.`);return e.fromStandardAudioBlock(t)}if(t.type==="file"){if(!e.fromStandardFileBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardFileBlock\` method.`);return e.fromStandardFileBlock(t)}throw new Error(`Unable to convert content block type '${t.type}' to provider-specific format: not recognized.`)}function oe(t,e){return de(t)&&t.type===e}function de(t){return typeof t=="object"&&t!==null}function er(t){return Array.isArray(t)}function q(t){return typeof t=="string"}function Xr(t){return typeof t=="number"}function Ff(t){return t instanceof Uint8Array}function iv(t){try{return JSON.parse(t)}catch{return}}var no=t=>t();function gF(t){if(t.type==="char_location"&&q(t.document_title)&&Xr(t.start_char_index)&&Xr(t.end_char_index)&&q(t.cited_text)){let{document_title:e,start_char_index:r,end_char_index:n,cited_text:i,...o}=t;return{...o,type:"citation",source:"char",title:e??void 0,startIndex:r,endIndex:n,citedText:i}}if(t.type==="page_location"&&q(t.document_title)&&Xr(t.start_page_number)&&Xr(t.end_page_number)&&q(t.cited_text)){let{document_title:e,start_page_number:r,end_page_number:n,cited_text:i,...o}=t;return{...o,type:"citation",source:"page",title:e??void 0,startIndex:r,endIndex:n,citedText:i}}if(t.type==="content_block_location"&&q(t.document_title)&&Xr(t.start_block_index)&&Xr(t.end_block_index)&&q(t.cited_text)){let{document_title:e,start_block_index:r,end_block_index:n,cited_text:i,...o}=t;return{...o,type:"citation",source:"block",title:e??void 0,startIndex:r,endIndex:n,citedText:i}}if(t.type==="web_search_result_location"&&q(t.url)&&q(t.title)&&q(t.encrypted_index)&&q(t.cited_text)){let{url:e,title:r,encrypted_index:n,cited_text:i,...o}=t;return{...o,type:"citation",source:"url",url:e,title:r,startIndex:Number(n),endIndex:Number(n),citedText:i}}if(t.type==="search_result_location"&&q(t.source)&&q(t.title)&&Xr(t.start_block_index)&&Xr(t.end_block_index)&&q(t.cited_text)){let{source:e,title:r,start_block_index:n,end_block_index:i,cited_text:o,...a}=t;return{...a,type:"citation",source:"search",url:e,title:r??void 0,startIndex:n,endIndex:i,citedText:o}}}function A$(t){if(oe(t,"document")&&de(t.source)&&"type"in t.source){if(t.source.type==="base64"&&q(t.source.media_type)&&q(t.source.data))return{type:"file",mimeType:t.source.media_type,data:t.source.data};if(t.source.type==="url"&&q(t.source.url))return{type:"file",url:t.source.url};if(t.source.type==="file"&&q(t.source.file_id))return{type:"file",fileId:t.source.file_id};if(t.source.type==="text"&&q(t.source.data))return{type:"file",mimeType:String(t.source.media_type??"text/plain"),data:t.source.data}}else if(oe(t,"image")&&de(t.source)&&"type"in t.source){if(t.source.type==="base64"&&q(t.source.media_type)&&q(t.source.data))return{type:"image",mimeType:t.source.media_type,data:t.source.data};if(t.source.type==="url"&&q(t.source.url))return{type:"image",url:t.source.url};if(t.source.type==="file"&&q(t.source.file_id))return{type:"image",fileId:t.source.file_id}}}function T$(t){function*e(){for(let r of t){let n=A$(r);n?yield n:yield r}}return Array.from(e())}function E$(t){function*e(){let r=typeof t.content=="string"?[{type:"text",text:t.content}]:t.content;for(let n of r){if(oe(n,"text")&&q(n.text)){let{text:i,citations:o,...a}=n;if(er(o)&&o.length){let s=o.reduce((c,u)=>{let l=gF(u);return l?[...c,l]:c},[]);yield{...a,type:"text",text:i,annotations:s};continue}else{yield{...a,type:"text",text:i};continue}}else if(oe(n,"thinking")&&q(n.thinking)){let{thinking:i,signature:o,...a}=n;yield{...a,type:"reasoning",reasoning:i,signature:o};continue}else if(oe(n,"redacted_thinking")){yield{type:"non_standard",value:n};continue}else if(oe(n,"tool_use")&&q(n.name)&&q(n.id)){yield{type:"tool_call",id:n.id,name:n.name,args:n.input};continue}else if(oe(n,"input_json_delta")){if(_F(t)&&t.tool_call_chunks?.length){let i=t.tool_call_chunks[0];yield{type:"tool_call_chunk",id:i.id,name:i.name,args:i.args,index:i.index};continue}}else if(oe(n,"server_tool_use")&&q(n.name)&&q(n.id)){let{name:i,id:o}=n;if(i==="web_search"){let a=no(()=>{if(typeof n.input=="string")return n.input;if(de(n.input)&&q(n.input.query))return n.input.query;if(q(n.partial_json)){let s=iv(n.partial_json);if(s?.query)return s.query}return""});yield{id:o,type:"server_tool_call",name:"web_search",args:{query:a}};continue}else if(n.name==="code_execution"){let a=no(()=>{if(typeof n.input=="string")return n.input;if(de(n.input)&&q(n.input.code))return n.input.code;if(q(n.partial_json)){let s=iv(n.partial_json);if(s?.code)return s.code}return""});yield{id:o,type:"server_tool_call",name:"code_execution",args:{code:a}};continue}}else if(oe(n,"web_search_tool_result")&&q(n.tool_use_id)&&er(n.content)){let{content:i,tool_use_id:o}=n,a=i.reduce((s,c)=>oe(c,"web_search_result")?[...s,c.url]:s,[]);yield{type:"server_tool_call_result",name:"web_search",toolCallId:o,status:"success",output:{urls:a}};continue}else if(oe(n,"code_execution_tool_result")&&q(n.tool_use_id)&&de(n.content)){yield{type:"server_tool_call_result",name:"code_execution",toolCallId:n.tool_use_id,status:"success",output:n.content};continue}else if(oe(n,"mcp_tool_use")){yield{id:n.id,type:"server_tool_call",name:"mcp_tool_use",args:n.input};continue}else if(oe(n,"mcp_tool_result")&&q(n.tool_use_id)&&de(n.content)){yield{type:"server_tool_call_result",name:"mcp_tool_use",toolCallId:n.tool_use_id,status:"success",output:n.content};continue}else if(oe(n,"container_upload")){yield{type:"server_tool_call",name:"container_upload",args:n.input};continue}else if(oe(n,"search_result")){yield{id:n.id,type:"non_standard",value:n};continue}else if(oe(n,"tool_result")){yield{id:n.id,type:"non_standard",value:n};continue}else{let i=A$(n);if(i){yield i;continue}}yield{type:"non_standard",value:n}}}return Array.from(e())}var $$={translateContent:E$,translateContentChunk:E$};function _F(t){return typeof t?._getType=="function"&&typeof t.concat=="function"&&t._getType()==="ai"}function yF(t){return Cc(t)?{type:t.type,mimeType:t.mime_type,url:t.url,metadata:t.metadata}:Pc(t)?{type:t.type,mimeType:t.mime_type??"application/octet-stream",data:t.data,metadata:t.metadata}:Lf(t)?{type:t.type,mimeType:t.mime_type,fileId:t.id,metadata:t.metadata}:t}function O$(t){return t.map(yF)}function C$(t){return!!(oe(t,"image_url")&&de(t.image_url)||oe(t,"input_audio")&&de(t.input_audio)||oe(t,"file")&&de(t.file))}function P$(t){if(oe(t,"image_url")&&de(t.image_url)&&q(t.image_url.url)){let e=Yo({dataUrl:t.image_url.url});return e?{type:"image",mimeType:e.mime_type,data:e.data}:{type:"image",url:t.image_url.url}}else{if(oe(t,"input_audio")&&de(t.input_audio)&&q(t.input_audio.data)&&q(t.input_audio.format))return{type:"audio",data:t.input_audio.data,mimeType:`audio/${t.input_audio.format}`};if(oe(t,"file")&&de(t.file)&&q(t.file.data)){let e=Yo({dataUrl:t.file.data});if(e)return{type:"file",data:e.data,mimeType:e.mime_type};if(q(t.file.file_id))return{type:"file",fileId:t.file.file_id}}}return t}function vF(t){let e=[];typeof t.content=="string"?e.push({type:"text",text:t.content}):e.push(...Bf(t.content));for(let r of t.tool_calls??[])e.push({type:"tool_call",id:r.id,name:r.name,args:r.args});return e}function bF(t){let e=[];typeof t.content=="string"?e.push({type:"text",text:t.content}):e.push(...Bf(t.content));for(let r of t.tool_calls??[])e.push({type:"tool_call",id:r.id,name:r.name,args:r.args});return e}function Bf(t){let e=[];for(let r of t)C$(r)?e.push(P$(r)):e.push(r);return e}function wF(t){if(t.type==="url_citation"){let{url:e,title:r,start_index:n,end_index:i}=t;return{type:"citation",url:e,title:r,startIndex:n,endIndex:i}}if(t.type==="file_citation"){let{file_id:e,filename:r,index:n}=t;return{type:"citation",title:r,startIndex:n,endIndex:n,fileId:e}}return t}function N$(t){function*e(){de(t.additional_kwargs?.reasoning)&&er(t.additional_kwargs.reasoning.summary)&&(yield{type:"reasoning",reasoning:t.additional_kwargs.reasoning.summary.reduce((i,o)=>de(o)&&q(o.text)?`${i}${o.text}`:i,"")});let r=typeof t.content=="string"?[{type:"text",text:t.content}]:t.content;for(let n of r)if(oe(n,"text")){let{text:i,annotations:o,...a}=n;Array.isArray(o)?yield{...a,type:"text",text:String(i),annotations:o.map(wF)}:yield{...a,type:"text",text:String(i)}}for(let n of t.tool_calls??[])yield{type:"tool_call",id:n.id,name:n.name,args:n.args};if(de(t.additional_kwargs)&&er(t.additional_kwargs.tool_outputs))for(let n of t.additional_kwargs.tool_outputs){if(oe(n,"web_search_call")){yield{id:n.id,type:"server_tool_call",name:"web_search",args:{query:n.query}};continue}else if(oe(n,"file_search_call")){yield{id:n.id,type:"server_tool_call",name:"file_search",args:{query:n.query}};continue}else if(oe(n,"computer_call")){yield{type:"non_standard",value:n};continue}else if(oe(n,"code_interpreter_call")){if(q(n.code)&&(yield{id:n.id,type:"server_tool_call",name:"code_interpreter",args:{code:n.code}}),er(n.outputs)){let i=no(()=>{if(n.status!=="in_progress"){if(n.status==="completed")return 0;if(n.status==="incomplete")return 127;if(n.status!=="interpreting"&&n.status==="failed")return 1}});for(let o of n.outputs)if(oe(o,"logs")){yield{type:"server_tool_call_result",toolCallId:n.id??"",status:"success",output:{type:"code_interpreter_output",returnCode:i??0,stderr:[0,void 0].includes(i)?void 0:String(o.logs),stdout:[0,void 0].includes(i)?String(o.logs):void 0}};continue}}continue}else if(oe(n,"mcp_call")){yield{id:n.id,type:"server_tool_call",name:"mcp_call",args:n.input};continue}else if(oe(n,"mcp_list_tools")){yield{id:n.id,type:"server_tool_call",name:"mcp_list_tools",args:n.input};continue}else if(oe(n,"mcp_approval_request")){yield{type:"non_standard",value:n};continue}else if(oe(n,"image_generation_call")){yield{type:"non_standard",value:n};continue}de(n)&&(yield{type:"non_standard",value:n})}}return Array.from(e())}function xF(t){function*e(){yield*N$(t);for(let r of t.tool_call_chunks??[])yield{type:"tool_call_chunk",id:r.id,name:r.name,args:r.args}}return Array.from(e())}var R$={translateContent:t=>typeof t.content=="string"?vF(t):N$(t),translateContentChunk:t=>typeof t.content=="string"?bF(t):xF(t)};function Vf(t){return typeof t=="object"&&t!==null&&"type"in t&&"content"in t&&(typeof t.content=="string"||Array.isArray(t.content))}function M$(t,e="pretty"){return e==="pretty"?SF(t):JSON.stringify(t)}function SF(t){let e=[],r=` ${t.type.charAt(0).toUpperCase()+t.type.slice(1)} Message `,n=Math.floor((80-r.length)/2),i="=".repeat(n),o=r.length%2===0?i:`${i}=`;if(e.push(`${i}${r}${o}`),t.type==="ai"){let a=t;if(a.tool_calls&&a.tool_calls.length>0){e.push("Tool Calls:");for(let s of a.tool_calls){e.push(`  ${s.name} (${s.id})`),e.push(` Call ID: ${s.id}`),e.push("  Args:");for(let[c,u]of Object.entries(s.args))e.push(`    ${c}: ${typeof u=="object"?JSON.stringify(u):u}`)}}}if(t.type==="tool"){let a=t;a.name&&e.push(`Name: ${a.name}`)}return typeof t.content=="string"&&t.content.trim()&&(e.length>1&&e.push(""),e.push(t.content)),e.join(`
`)}var ov=Symbol.for("langchain.message");function tr(t,e){return typeof t=="string"?t===""?e:typeof e=="string"?t+e:Array.isArray(e)&&e.length===0?t:Array.isArray(e)&&e.some(r=>jr(r))?[{type:"text",source_type:"text",text:t},...e]:[{type:"text",text:t},...e]:Array.isArray(e)?ts(t,e)??[...t,...e]:e===""?t:Array.isArray(t)&&t.some(r=>jr(r))?[...t,{type:"file",source_type:"text",text:e}]:[...t,{type:"text",text:e}]}function Zf(t,e){return t==="error"||e==="error"?"error":"success"}function IF(t,e){function r(n,i){if(typeof n!="object"||n===null||n===void 0)return n;if(i>=e)return Array.isArray(n)?"[Array]":"[Object]";if(Array.isArray(n))return n.map(a=>r(a,i+1));let o={};for(let a of Object.keys(n))o[a]=r(n[a],i+1);return o}return JSON.stringify(r(t,0),null,2)}var z$,kt=class extends It{constructor(e){let r=typeof e=="string"||Array.isArray(e)?{content:e}:e;r.additional_kwargs||(r.additional_kwargs={}),r.response_metadata||(r.response_metadata={});super(r);d(this,"lc_namespace",["langchain_core","messages"]);d(this,"lc_serializable",!0);d(this,z$,!0);d(this,"id");d(this,"name");d(this,"content");d(this,"additional_kwargs");d(this,"response_metadata");this.name=r.name,r.content===void 0&&r.contentBlocks!==void 0?(this.content=r.contentBlocks,this.response_metadata={output_version:"v1",...r.response_metadata}):r.content!==void 0?(this.content=r.content??[],this.response_metadata=r.response_metadata):(this.content=[],this.response_metadata=r.response_metadata),this.additional_kwargs=r.additional_kwargs,this.id=r.id}get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}_getType(){return this.type}getType(){return this._getType()}get text(){return typeof this.content=="string"?this.content:Array.isArray(this.content)?this.content.map(e=>typeof e=="string"?e:e.type==="text"?e.text:"").join(""):""}get contentBlocks(){let e=typeof this.content=="string"?[{type:"text",text:this.content}]:this.content;return[O$,Bf,T$].reduce((i,o)=>o(i),e)}toDict(){return{type:this.getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}static isInstance(e){return typeof e=="object"&&e!==null&&ov in e&&e[ov]===!0&&Vf(e)}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[(z$=ov,Symbol.toStringTag)](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;let r=IF(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${r}`}toFormattedString(e="pretty"){return M$(this,e)}};function j$(t){return Array.isArray(t)&&t.every(e=>typeof e.index=="number")}var av=["index","created","timestamp"];function pt(t,e,r){let n=r?.ignoreKeys??av;if(t===void 0&&e===void 0)return;if(t===void 0||e===void 0)return t??e;let i={...t};for(let[o,a]of Object.entries(e))if(i[o]==null)i[o]=a;else{if(a==null)continue;if(typeof i[o]!=typeof a||Array.isArray(i[o])!==Array.isArray(a))throw new Error(`field[${o}] already exists in the message chunk, but with a different type.`);if(typeof i[o]=="string"){if(o==="type")continue;if(["id","name","output_version","model_provider"].includes(o))a&&(i[o]=a);else{if(n.includes(o))continue;i[o]+=a}}else if(typeof i[o]=="number"){if(n.includes(o))continue;i[o]=i[o]+a}else if(typeof i[o]=="object"&&!Array.isArray(i[o]))i[o]=pt(i[o],a,r);else if(Array.isArray(i[o]))i[o]=ts(i[o],a,r);else{if(i[o]===a)continue;console.warn(`field[${o}] already exists in this message chunk and value has unsupported type.`)}}return i}function ts(t,e,r){if(!(t===void 0&&e===void 0)){if(t===void 0||e===void 0)return t||e;{let n=[...t];for(let i of e)if(typeof i=="object"&&i!==null&&"index"in i&&typeof i.index=="number"){let o=n.findIndex(a=>{let s=typeof a=="object",c="index"in a&&a.index===i.index,u="id"in a&&"id"in i&&a?.id===i?.id,l=!("id"in a)||!a?.id||!("id"in i)||!i?.id;return s&&c&&(u||l)});o!==-1&&typeof n[o]=="object"&&n[o]!==null?n[o]=pt(n[o],i,r):n.push(i)}else{if(typeof i=="object"&&i!==null&&"text"in i&&i.text==="")continue;n.push(i)}return n}}}function Gf(t,e,r){if(!(t===void 0&&e===void 0)){if(t===void 0||e===void 0)return t??e;if(typeof t!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof t}
Right ${typeof e}`);if(typeof t=="string"&&typeof e=="string")return t+e;if(Array.isArray(t)&&Array.isArray(e))return ts(t,e,r);if(typeof t=="object"&&typeof e=="object")return pt(t,e,r);if(t===e)return t;throw new Error(`Can not merge objects of different types.
Left ${t}
Right ${e}`)}}var gr=class D$ extends kt{static isInstance(e){if(!super.isInstance(e))return!1;let r=Object.getPrototypeOf(e);for(;r!==null;){if(r===D$.prototype)return!0;r=Object.getPrototypeOf(r)}return!1}};function Hf(t){return typeof t.role=="string"}function dt(t){return typeof t?._getType=="function"}function io(t){return gr.isInstance(t)}var sv={};z(sv,{ToolMessage:()=>rr,ToolMessageChunk:()=>Qo,defaultToolCallParser:()=>tp,isDirectToolOutput:()=>ep,isToolMessage:()=>rp,isToolMessageChunk:()=>cv});function ep(t){return t!=null&&typeof t=="object"&&"lc_direct_tool_output"in t&&t.lc_direct_tool_output===!0}var rr=class extends kt{constructor(e,r,n){let i=typeof e=="string"||Array.isArray(e)?{content:e,name:n,tool_call_id:r}:e;super(i);d(this,"lc_direct_tool_output",!0);d(this,"type","tool");d(this,"status");d(this,"tool_call_id");d(this,"metadata");d(this,"artifact");this.tool_call_id=i.tool_call_id,this.artifact=i.artifact,this.status=i.status,this.metadata=i.metadata}static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}static isInstance(e){return super.isInstance(e)&&e.type==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}},Qo=class extends gr{constructor(e){super(e);d(this,"type","tool");d(this,"tool_call_id");d(this,"status");d(this,"artifact");this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}concat(e){let r=this.constructor;return new r({content:tr(this.content,e.content),additional_kwargs:pt(this.additional_kwargs,e.additional_kwargs),response_metadata:pt(this.response_metadata,e.response_metadata),artifact:Gf(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:Zf(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}};function tp(t){let e=[],r=[];for(let n of t)if(n.function){let i=n.function.name;try{let o=JSON.parse(n.function.arguments);e.push({name:i||"",args:o||{},id:n.id})}catch{r.push({name:i,args:n.function.arguments,id:n.id,error:"Malformed args."})}}else continue;return[e,r]}function rp(t){return typeof t=="object"&&t!==null&&"getType"in t&&typeof t.getType=="function"&&t.getType()==="tool"}function cv(t){return t._getType()==="tool"}function ea(t,e){return t.lc_error_code=e,t.message=`${t.message}

Troubleshooting URL: https://docs.langchain.com/oss/javascript/langchain/errors/${e}/
`,t}function ta(t){return!!(t&&typeof t=="object"&&"type"in t&&t.type==="tool_call")}function L$(t){return!!(t&&typeof t=="object"&&"toolCall"in t&&t.toolCall!=null&&typeof t.toolCall=="object"&&"id"in t.toolCall&&typeof t.toolCall.id=="string")}var Rc=class extends Error{constructor(e,r){super(e);d(this,"output");this.output=r}};function np(t,e=gi){t=t.trim();let r=t.indexOf("```");if(r===-1)return e(t);let n=t.substring(r+3);n.startsWith(`json
`)?n=n.substring(5):n.startsWith("json")?n=n.substring(4):n.startsWith(`
`)&&(n=n.substring(1));let i=n.indexOf("```"),o=n;return i!==-1&&(o=n.substring(0,i)),e(o.trim())}function kF(t){try{return JSON.parse(t)}catch{}let e=t.trim();if(e.length===0)throw new Error("Unexpected end of JSON input");let r=0;function n(){for(;r<e.length&&/\s/.test(e[r]);)r+=1}function i(){if(e[r]!=='"')throw new Error(`Expected '"' at position ${r}, got '${e[r]}'`);r+=1;let l="",p=!1;for(;r<e.length;){let f=e[r];if(p){if(f==="n")l+=`
`;else if(f==="t")l+="	";else if(f==="r")l+="\r";else if(f==="\\")l+="\\";else if(f==='"')l+='"';else if(f==="b")l+="\b";else if(f==="f")l+="\f";else if(f==="/")l+="/";else if(f==="u"){let m=e.substring(r+1,r+5);if(/^[0-9A-Fa-f]{0,4}$/.test(m))m.length===4?l+=String.fromCharCode(Number.parseInt(m,16)):l+=`u${m}`,r+=m.length;else throw new Error(`Invalid unicode escape sequence '\\u${m}' at position ${r}`)}else throw new Error(`Invalid escape sequence '\\${f}' at position ${r}`);p=!1}else if(f==="\\")p=!0;else{if(f==='"')return r+=1,l;l+=f}r+=1}return p&&(l+="\\"),l}function o(){let l=r,p="";if(e[r]==="-"&&(p+="-",r+=1),r<e.length&&e[r]==="0"&&(p+="0",r+=1,e[r]>="0"&&e[r]<="9"))throw new Error(`Invalid number at position ${l}`);if(r<e.length&&e[r]>="1"&&e[r]<="9")for(;r<e.length&&e[r]>="0"&&e[r]<="9";)p+=e[r],r+=1;if(r<e.length&&e[r]===".")for(p+=".",r+=1;r<e.length&&e[r]>="0"&&e[r]<="9";)p+=e[r],r+=1;if(r<e.length&&(e[r]==="e"||e[r]==="E"))for(p+=e[r],r+=1,r<e.length&&(e[r]==="+"||e[r]==="-")&&(p+=e[r],r+=1);r<e.length&&e[r]>="0"&&e[r]<="9";)p+=e[r],r+=1;if(p==="-")return-0;let f=Number.parseFloat(p);if(Number.isNaN(f))throw r=l,new Error(`Invalid number '${p}' at position ${l}`);return f}function a(){if(n(),r>=e.length)throw new Error(`Unexpected end of input at position ${r}`);let l=e[r];if(l==="{")return c();if(l==="[")return s();if(l==='"')return i();if("null".startsWith(e.substring(r,r+4)))return r+=Math.min(4,e.length-r),null;if("true".startsWith(e.substring(r,r+4)))return r+=Math.min(4,e.length-r),!0;if("false".startsWith(e.substring(r,r+5)))return r+=Math.min(5,e.length-r),!1;if(l==="-"||l>="0"&&l<="9")return o();throw new Error(`Unexpected character '${l}' at position ${r}`)}function s(){if(e[r]!=="[")throw new Error(`Expected '[' at position ${r}, got '${e[r]}'`);let l=[];if(r+=1,n(),r>=e.length)return l;if(e[r]==="]")return r+=1,l;for(;r<e.length;){if(n(),r>=e.length||(l.push(a()),n(),r>=e.length))return l;if(e[r]==="]")return r+=1,l;if(e[r]===","){r+=1;continue}throw new Error(`Expected ',' or ']' at position ${r}, got '${e[r]}'`)}return l}function c(){if(e[r]!=="{")throw new Error(`Expected '{' at position ${r}, got '${e[r]}'`);let l={};if(r+=1,n(),r>=e.length)return l;if(e[r]==="}")return r+=1,l;for(;r<e.length;){if(n(),r>=e.length)return l;let p=i();if(n(),r>=e.length)return l;if(e[r]!==":")throw new Error(`Expected ':' at position ${r}, got '${e[r]}'`);if(r+=1,n(),r>=e.length||(l[p]=a(),n(),r>=e.length))return l;if(e[r]==="}")return r+=1,l;if(e[r]===","){r+=1;continue}throw new Error(`Expected ',' or '}' at position ${r}, got '${e[r]}'`)}return l}let u=a();if(n(),r<e.length)throw new Error(`Unexpected character '${e[r]}' at position ${r}`);return u}function gi(t){try{return typeof t>"u"?null:kF(t)}catch{return null}}var _r=class U$ extends kt{constructor(r,n){(typeof r=="string"||Array.isArray(r))&&(r={content:r,role:n});super(r);d(this,"type","generic");d(this,"role");this.role=r.role}static lc_name(){return"ChatMessage"}static _chatMessageClass(){return U$}static isInstance(r){return super.isInstance(r)&&r.type==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}},oo=class extends gr{constructor(e,r){(typeof e=="string"||Array.isArray(e))&&(e={content:e,role:r});super(e);d(this,"type","generic");d(this,"role");this.role=e.role}static lc_name(){return"ChatMessageChunk"}concat(e){let r=this.constructor;return new r({content:tr(this.content,e.content),additional_kwargs:pt(this.additional_kwargs,e.additional_kwargs),response_metadata:pt(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}static isInstance(e){return super.isInstance(e)&&e.type==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}};function F$(t){return t._getType()==="generic"}function B$(t){return t._getType()==="generic"}var rs=class extends kt{constructor(e){super(e);d(this,"type","function");d(this,"name");this.name=e.name}static lc_name(){return"FunctionMessage"}},ao=class extends gr{constructor(){super(...arguments);d(this,"type","function")}static lc_name(){return"FunctionMessageChunk"}concat(e){let r=this.constructor;return new r({content:tr(this.content,e.content),additional_kwargs:pt(this.additional_kwargs,e.additional_kwargs),response_metadata:pt(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}};function V$(t){return t._getType()==="function"}function Z$(t){return t._getType()==="function"}var $t=class extends kt{constructor(e){super(e);d(this,"type","human")}static lc_name(){return"HumanMessage"}static isInstance(e){return super.isInstance(e)&&e.type==="human"}},so=class extends gr{constructor(e){super(e);d(this,"type","human")}static lc_name(){return"HumanMessageChunk"}concat(e){let r=this.constructor;return new r({content:tr(this.content,e.content),additional_kwargs:pt(this.additional_kwargs,e.additional_kwargs),response_metadata:pt(this.response_metadata,e.response_metadata),id:this.id??e.id})}static isInstance(e){return super.isInstance(e)&&e.type==="human"}};function G$(t){return t.getType()==="human"}function H$(t){return t.getType()==="human"}var Ln=class extends kt{constructor(e){super({...e,content:[]});d(this,"type","remove");d(this,"id");this.id=e.id}get _printableFields(){return{...super._printableFields,id:this.id}}static isInstance(e){return super.isInstance(e)&&e.type==="remove"}};var Yr=class qf extends kt{constructor(r){super(r);d(this,"type","system")}static lc_name(){return"SystemMessage"}concat(r){if(typeof r=="string")return new qf({...this,content:tr(this.content,r)});if(qf.isInstance(r))return new qf({...this,additional_kwargs:{...this.additional_kwargs,...r.additional_kwargs},response_metadata:{...this.response_metadata,...r.response_metadata},content:tr(this.content,r.content)});throw new Error("Unexpected chunk type for system message")}static isInstance(r){return super.isInstance(r)&&r.type==="system"}},gn=class extends gr{constructor(e){super(e);d(this,"type","system")}static lc_name(){return"SystemMessageChunk"}concat(e){let r=this.constructor;return new r({content:tr(this.content,e.content),additional_kwargs:pt(this.additional_kwargs,e.additional_kwargs),response_metadata:pt(this.response_metadata,e.response_metadata),id:this.id??e.id})}static isInstance(e){return super.isInstance(e)&&e.type==="system"}};function q$(t){return t._getType()==="system"}function K$(t){return t._getType()==="system"}function uv(t){switch(t){case"csv":return"text/csv";case"doc":return"application/vnd.openxmlformats-officedocument.wordprocessingml.document";case"docx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.document";case"html":return"text/html";case"md":return"text/markdown";case"pdf":return"application/pdf";case"txt":return"text/plain";case"xls":return"application/vnd.ms-excel";case"xlsx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"gif":return"image/gif";case"jpeg":return"image/jpeg";case"jpg":return"image/jpeg";case"png":return"image/png";case"webp":return"image/webp";case"flv":return"video/flv";case"mkv":return"video/mkv";case"mov":return"video/mov";case"mp4":return"video/mp4";case"mpeg":return"video/mpeg";case"mpg":return"video/mpg";case"three_gp":return"video/three_gp";case"webm":return"video/webm";case"wmv":return"video/wmv";default:return"application/octet-stream"}}function EF(t){if(de(t.document)&&de(t.document.source)){let e=de(t.document)&&q(t.document.format)?t.document.format:"",r=uv(e);if(de(t.document.source)){if(de(t.document.source.s3Location)&&q(t.document.source.s3Location.uri))return{type:"file",mimeType:r,fileId:t.document.source.s3Location.uri};if(Ff(t.document.source.bytes))return{type:"file",mimeType:r,data:t.document.source.bytes};if(q(t.document.source.text))return{type:"file",mimeType:r,data:Buffer.from(t.document.source.text).toString("base64")};if(er(t.document.source.content)){let n=t.document.source.content.reduce((i,o)=>de(o)&&q(o.text)?i+o.text:i,"");return{type:"file",mimeType:r,data:n}}}}return{type:"non_standard",value:t}}function AF(t){if(oe(t,"image")&&de(t.image)){let e=de(t.image)&&q(t.image.format)?t.image.format:"",r=uv(e);if(de(t.image.source)){if(de(t.image.source.s3Location)&&q(t.image.source.s3Location.uri))return{type:"image",mimeType:r,fileId:t.image.source.s3Location.uri};if(Ff(t.image.source.bytes))return{type:"image",mimeType:r,data:t.image.source.bytes}}}return{type:"non_standard",value:t}}function TF(t){if(oe(t,"video")&&de(t.video)){let e=de(t.video)&&q(t.video.format)?t.video.format:"",r=uv(e);if(de(t.video.source)){if(de(t.video.source.s3Location)&&q(t.video.source.s3Location.uri))return{type:"video",mimeType:r,fileId:t.video.source.s3Location.uri};if(Ff(t.video.source.bytes))return{type:"video",mimeType:r,data:t.video.source.bytes}}}return{type:"non_standard",value:t}}function W$(t){function*e(){let r=typeof t.content=="string"?[{type:"text",text:t.content}]:t.content;for(let n of r){if(oe(n,"cache_point")){yield{type:"non_standard",value:n};continue}else if(oe(n,"citations_content")&&de(n.citationsContent)){let i=er(n.citationsContent.content)?n.citationsContent.content.reduce((a,s)=>de(s)&&q(s.text)?a+s.text:a,""):"",o=er(n.citationsContent.citations)?n.citationsContent.citations.reduce((a,s)=>{if(de(s)){let c=er(s.sourceContent)?s.sourceContent.reduce((l,p)=>de(p)&&q(p.text)?l+p.text:l,""):"",u=no(()=>{if(de(s.location)){let l=s.location.documentChar||s.location.documentPage||s.location.documentChunk;if(de(l))return{source:Xr(l.documentIndex)?l.documentIndex.toString():void 0,startIndex:Xr(l.start)?l.start:void 0,endIndex:Xr(l.end)?l.end:void 0}}return{}});a.push({type:"citation",citedText:c,...u})}return a},[]):[];yield{type:"text",text:i,annotations:o};continue}else if(oe(n,"document")&&de(n.document)){yield EF(n);continue}else if(oe(n,"guard_content")){yield{type:"non_standard",value:n};continue}else if(oe(n,"image")&&de(n.image)){yield AF(n);continue}else if(oe(n,"reasoning_content")&&q(n.reasoningText)){yield{type:"reasoning",reasoning:n.reasoningText};continue}else if(oe(n,"text")&&q(n.text)){yield{type:"text",text:n.text};continue}else if(oe(n,"tool_result")){yield{type:"non_standard",value:n};continue}else{if(oe(n,"tool_call"))continue;if(oe(n,"video")&&de(n.video)){yield TF(n);continue}}yield{type:"non_standard",value:n}}}return Array.from(e())}var J$={translateContent:W$,translateContentChunk:W$};function X$(t){let e=[],r=t.additional_kwargs?.reasoning_content;if(q(r)&&r.length>0&&e.push({type:"reasoning",reasoning:r}),typeof t.content=="string")t.content.length>0&&e.push({type:"text",text:t.content});else for(let n of t.content)typeof n=="object"&&"type"in n&&n.type==="text"&&"text"in n&&q(n.text)&&e.push({type:"text",text:n.text});for(let n of t.tool_calls??[])e.push({type:"tool_call",id:n.id,name:n.name,args:n.args});return e}var Y$={translateContent:X$,translateContentChunk:X$};function Q$(t){function*e(){let r=typeof t.content=="string"?[{type:"text",text:t.content}]:t.content;for(let n of r){if(oe(n,"text")&&q(n.text)){yield{type:"text",text:n.text};continue}else if(oe(n,"thinking")&&q(n.thinking)){yield{type:"reasoning",reasoning:n.thinking,...n.signature?{signature:n.signature}:{}};continue}else if(oe(n,"inlineData")&&de(n.inlineData)&&q(n.inlineData.mimeType)&&q(n.inlineData.data)){yield{type:"file",mimeType:n.inlineData.mimeType,data:n.inlineData.data};continue}else if(oe(n,"functionCall")&&de(n.functionCall)&&q(n.functionCall.name)&&de(n.functionCall.args)){yield{type:"tool_call",id:t.id,name:n.functionCall.name,args:n.functionCall.args};continue}else if(oe(n,"functionResponse")){yield{type:"non_standard",value:n};continue}else if(oe(n,"fileData")&&de(n.fileData)&&q(n.fileData.mimeType)&&q(n.fileData.fileUri)){yield{type:"file",mimeType:n.fileData.mimeType,fileId:n.fileData.fileUri};continue}else if(oe(n,"executableCode")){yield{type:"non_standard",value:n};continue}else if(oe(n,"codeExecutionResult")){yield{type:"non_standard",value:n};continue}yield{type:"non_standard",value:n}}}return Array.from(e())}var eO={translateContent:Q$,translateContentChunk:Q$};function tO(t){function*e(){let r=typeof t.content=="string"?[{type:"text",text:t.content}]:t.content;for(let n of r){if(oe(n,"reasoning")&&q(n.reasoning)){let i=no(()=>{let o=r.indexOf(n);if(er(t.additional_kwargs?.signatures)&&o>=0)return t.additional_kwargs.signatures.at(o)});q(i)?yield{type:"reasoning",reasoning:n.reasoning,signature:i}:yield{type:"reasoning",reasoning:n.reasoning};continue}else if(oe(n,"thinking")&&q(n.thinking)){yield{type:"reasoning",reasoning:n.thinking,...n.signature?{signature:n.signature}:{}};continue}else if(oe(n,"text")&&q(n.text)){yield{type:"text",text:n.text};continue}else if(oe(n,"image_url")){if(q(n.image_url))if(n.image_url.startsWith("data:")){let i=/^data:([^;]+);base64,(.+)$/,o=n.image_url.match(i);o?yield{type:"image",data:o[2],mimeType:o[1]}:yield{type:"image",url:n.image_url}}else yield{type:"image",url:n.image_url};continue}else if(oe(n,"media")&&q(n.mimeType)&&q(n.data)){yield{type:"file",mimeType:n.mimeType,data:n.data};continue}yield{type:"non_standard",value:n}}}return Array.from(e())}var rO={translateContent:tO,translateContentChunk:tO};function nO(t){let e=[],r=t.additional_kwargs?.reasoning;if(q(r)&&r.length>0&&e.push({type:"reasoning",reasoning:r}),typeof t.content=="string"){let n=t.content,i=n.match(/<think>([\s\S]*?)<\/think>/);if(i){let o=i[1].trim();o.length>0&&e.push({type:"reasoning",reasoning:o}),n=n.replace(/<think>[\s\S]*?<\/think>/,"").trim()}n.length>0&&e.push({type:"text",text:n})}else for(let n of t.content)if(typeof n=="object"&&"type"in n&&n.type==="text"&&"text"in n&&q(n.text)){let i=n.text,o=i.match(/<think>([\s\S]*?)<\/think>/);if(o){let a=o[1].trim();a.length>0&&e.push({type:"reasoning",reasoning:a}),i=i.replace(/<think>[\s\S]*?<\/think>/,"").trim()}i.length>0&&e.push({type:"text",text:i})}for(let n of t.tool_calls??[])e.push({type:"tool_call",id:n.id,name:n.name,args:n.args});return e}var iO={translateContent:nO,translateContentChunk:nO};function oO(t){let e=[],r=t.additional_kwargs?.reasoning_content;if(q(r)&&r.length>0&&e.push({type:"reasoning",reasoning:r}),typeof t.content=="string")t.content.length>0&&e.push({type:"text",text:t.content});else for(let n of t.content)typeof n=="object"&&"type"in n&&n.type==="text"&&"text"in n&&q(n.text)&&e.push({type:"text",text:n.text});for(let n of t.tool_calls??[])e.push({type:"tool_call",id:n.id,name:n.name,args:n.args});return e}var aO={translateContent:oO,translateContentChunk:oO};function sO(t){let e=[];if(de(t.additional_kwargs?.reasoning)){let n=t.additional_kwargs.reasoning;if(er(n.summary)){let i=n.summary.reduce((o,a)=>de(a)&&q(a.text)?`${o}${a.text}`:o,"");i.length>0&&e.push({type:"reasoning",reasoning:i})}}let r=t.additional_kwargs?.reasoning_content;if(q(r)&&r.length>0&&e.push({type:"reasoning",reasoning:r}),typeof t.content=="string")t.content.length>0&&e.push({type:"text",text:t.content});else for(let n of t.content)typeof n=="object"&&"type"in n&&n.type==="text"&&"text"in n&&q(n.text)&&e.push({type:"text",text:n.text});for(let n of t.tool_calls??[])e.push({type:"tool_call",id:n.id,name:n.name,args:n.args});return e}var cO={translateContent:sO,translateContentChunk:sO};globalThis.lc_block_translators_registry??(globalThis.lc_block_translators_registry=new Map([["anthropic",$$],["bedrock-converse",J$],["deepseek",Y$],["google-genai",eO],["google-vertexai",rO],["groq",iO],["ollama",aO],["openai",R$],["xai",cO]]));function lv(t){return globalThis.lc_block_translators_registry.get(t)}function Kf(t,e){return pt(t,e)??{}}function uO(t,e){let r={};return(t?.audio!==void 0||e?.audio!==void 0)&&(r.audio=(t?.audio??0)+(e?.audio??0)),(t?.image!==void 0||e?.image!==void 0)&&(r.image=(t?.image??0)+(e?.image??0)),(t?.video!==void 0||e?.video!==void 0)&&(r.video=(t?.video??0)+(e?.video??0)),(t?.document!==void 0||e?.document!==void 0)&&(r.document=(t?.document??0)+(e?.document??0)),(t?.text!==void 0||e?.text!==void 0)&&(r.text=(t?.text??0)+(e?.text??0)),r}function $F(t,e){let r={...uO(t,e)};return(t?.cache_read!==void 0||e?.cache_read!==void 0)&&(r.cache_read=(t?.cache_read??0)+(e?.cache_read??0)),(t?.cache_creation!==void 0||e?.cache_creation!==void 0)&&(r.cache_creation=(t?.cache_creation??0)+(e?.cache_creation??0)),r}function OF(t,e){let r={...uO(t,e)};return(t?.reasoning!==void 0||e?.reasoning!==void 0)&&(r.reasoning=(t?.reasoning??0)+(e?.reasoning??0)),r}function Mc(t,e){return{input_tokens:(t?.input_tokens??0)+(e?.input_tokens??0),output_tokens:(t?.output_tokens??0)+(e?.output_tokens??0),total_tokens:(t?.total_tokens??0)+(e?.total_tokens??0),input_token_details:$F(t?.input_token_details,e?.input_token_details),output_token_details:OF(t?.output_token_details,e?.output_token_details)}}var Ue=class extends kt{constructor(e){let r;if(typeof e=="string"||Array.isArray(e))r={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:{}};else{r=e;let n=r.additional_kwargs?.tool_calls,i=r.tool_calls;n!=null&&n.length>0&&(i===void 0||i.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `pnpm install @langchain/anthropic`,","pnpm install @langchain/openai`, etc."].join(" "));try{if(n!=null&&i===void 0){let[o,a]=tp(n);r.tool_calls=o??[],r.invalid_tool_calls=a??[]}else r.tool_calls=r.tool_calls??[],r.invalid_tool_calls=r.invalid_tool_calls??[]}catch{r.tool_calls=[],r.invalid_tool_calls=[]}if(r.response_metadata!==void 0&&"output_version"in r.response_metadata&&r.response_metadata.output_version==="v1"&&(r.contentBlocks=r.content,r.content=void 0),r.contentBlocks!==void 0){r.tool_calls&&r.contentBlocks.push(...r.tool_calls.map(a=>({type:"tool_call",id:a.id,name:a.name,args:a.args})));let o=r.contentBlocks.filter(a=>a.type==="tool_call").filter(a=>!r.tool_calls?.some(s=>s.id===a.id&&s.name===a.name));o.length>0&&(r.tool_calls=o.map(a=>({type:"tool_call",id:a.id,name:a.name,args:a.args})))}}super(r);d(this,"type","ai");d(this,"tool_calls",[]);d(this,"invalid_tool_calls",[]);d(this,"usage_metadata");typeof r!="string"&&(this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=r.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}static lc_name(){return"AIMessage"}get contentBlocks(){if(this.response_metadata&&"output_version"in this.response_metadata&&this.response_metadata.output_version==="v1")return this.content;if(this.response_metadata&&"model_provider"in this.response_metadata&&typeof this.response_metadata.model_provider=="string"){let r=lv(this.response_metadata.model_provider);if(r)return r.translateContent(this)}let e=super.contentBlocks;if(this.tool_calls){let r=this.tool_calls.filter(n=>!e.some(i=>i.id===n.id&&i.name===n.name));e.push(...r.map(n=>({type:"tool_call",id:n.id,name:n.name,args:n.args})))}return e}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}static isInstance(e){return super.isInstance(e)&&e.type==="ai"}};function ra(t){return t._getType()==="ai"}function ip(t){return t._getType()==="ai"}var st=class extends gr{constructor(e){let r;if(typeof e=="string"||Array.isArray(e))r={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0||e.tool_call_chunks.length===0)r={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0};else{let n=Wf(e.tool_call_chunks??[]);r={...e,tool_call_chunks:n.tool_call_chunks,tool_calls:n.tool_calls,invalid_tool_calls:n.invalid_tool_calls,usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0}}super(r);d(this,"type","ai");d(this,"tool_calls",[]);d(this,"invalid_tool_calls",[]);d(this,"tool_call_chunks",[]);d(this,"usage_metadata");this.tool_call_chunks=r.tool_call_chunks??this.tool_call_chunks,this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=r.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}get contentBlocks(){if(this.response_metadata&&"output_version"in this.response_metadata&&this.response_metadata.output_version==="v1")return this.content;if(this.response_metadata&&"model_provider"in this.response_metadata&&typeof this.response_metadata.model_provider=="string"){let r=lv(this.response_metadata.model_provider);if(r)return r.translateContent(this)}let e=super.contentBlocks;if(this.tool_calls&&typeof this.content!="string"){let r=this.content.filter(n=>n.type==="tool_call").map(n=>n.id);for(let n of this.tool_calls)n.id&&!r.includes(n.id)&&e.push({...n,type:"tool_call",id:n.id,name:n.name,args:n.args})}return e}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){let r={content:tr(this.content,e.content),additional_kwargs:pt(this.additional_kwargs,e.additional_kwargs),response_metadata:Kf(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){let i=ts(this.tool_call_chunks,e.tool_call_chunks);i!==void 0&&i.length>0&&(r.tool_call_chunks=i)}(this.usage_metadata!==void 0||e.usage_metadata!==void 0)&&(r.usage_metadata=Mc(this.usage_metadata,e.usage_metadata));let n=this.constructor;return new n(r)}static isInstance(e){return super.isInstance(e)&&e.type==="ai"}};var Jf=t=>t();function CF(t){return ta(t)?t:typeof t.id=="string"&&t.type==="function"&&typeof t.function=="object"&&t.function!==null&&"arguments"in t.function&&typeof t.function.arguments=="string"&&"name"in t.function&&typeof t.function.name=="string"?{id:t.id,args:JSON.parse(t.function.arguments),name:t.function.name,type:"tool_call"}:t}function PF(t){return typeof t=="object"&&t!=null&&t.lc===1&&Array.isArray(t.id)&&t.kwargs!=null&&typeof t.kwargs=="object"}function pv(t){let e,r;if(PF(t)){let n=t.id.at(-1);n==="HumanMessage"||n==="HumanMessageChunk"?e="user":n==="AIMessage"||n==="AIMessageChunk"?e="assistant":n==="SystemMessage"||n==="SystemMessageChunk"?e="system":n==="FunctionMessage"||n==="FunctionMessageChunk"?e="function":n==="ToolMessage"||n==="ToolMessageChunk"?e="tool":e="unknown",r=t.kwargs}else{let{type:n,...i}=t;e=n,r=i}if(e==="human"||e==="user")return new $t(r);if(e==="ai"||e==="assistant"){let{tool_calls:n,...i}=r;if(!Array.isArray(n))return new Ue(r);let o=n.map(CF);return new Ue({...i,tool_calls:o})}else{if(e==="system")return new Yr(r);if(e==="developer")return new Yr({...r,additional_kwargs:{...r.additional_kwargs,__openai_role__:"developer"}});if(e==="tool"&&"tool_call_id"in r)return new rr({...r,content:r.content,tool_call_id:r.tool_call_id,name:r.name});if(e==="remove"&&"id"in r&&typeof r.id=="string")return new Ln({...r,id:r.id});throw ea(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(t,null,2)}`),"MESSAGE_COERCION_FAILURE")}}function nr(t){if(typeof t=="string")return new $t(t);if(dt(t))return t;if(Array.isArray(t)){let[e,r]=t;return pv({type:e,content:r})}else if(Hf(t)){let{role:e,...r}=t;return pv({...r,type:e})}else return pv(t)}function zc(t,e="Human",r="AI"){let n=[];for(let i of t){let o;if(i.type==="human")o=e;else if(i.type==="ai")o=r;else if(i.type==="system")o="System";else if(i.type==="tool")o="Tool";else if(i.type==="generic")o=i.role;else throw new Error(`Got unsupported message type: ${i.type}`);let a=i.name?`${i.name}, `:"",s=i.text,c=`${o}: ${a}${s}`;if(i.type==="ai"){let u=i;u.tool_calls&&u.tool_calls.length>0?c+=JSON.stringify(u.tool_calls):u.additional_kwargs&&"function_call"in u.additional_kwargs&&(c+=JSON.stringify(u.additional_kwargs.function_call))}n.push(c)}return n.join(`
`)}function NF(t){if(t.data!==void 0)return t;{let e=t;return{type:e.type,data:{content:e.text,role:e.role,name:void 0,tool_call_id:void 0}}}}function op(t){let e=NF(t);switch(e.type){case"human":return new $t(e.data);case"ai":return new Ue(e.data);case"system":return new Yr(e.data);case"function":if(e.data.name===void 0)throw new Error("Name must be defined for function messages");return new rs(e.data);case"tool":if(e.data.tool_call_id===void 0)throw new Error("Tool call ID must be defined for tool messages");return new rr(e.data);case"generic":if(e.data.role===void 0)throw new Error("Role must be defined for chat messages");return new _r(e.data);default:throw new Error(`Got unexpected type: ${e.type}`)}}function lO(t){return t.map(op)}function pO(t){return t.map(e=>e.toDict())}function ns(t){let e=t._getType();if(e==="human")return new so({...t});if(e==="ai"){let r={...t};return"tool_calls"in r&&(r={...r,tool_call_chunks:r.tool_calls?.map(n=>({...n,type:"tool_call_chunk",index:void 0,args:JSON.stringify(n.args)}))}),new st({...r})}else{if(e==="system")return new gn({...t});if(e==="function")return new ao({...t});if(_r.isInstance(t))return new oo({...t});throw new Error("Unknown message type.")}}function Wf(t){let e=t.reduce((i,o)=>{let a=i.findIndex(([s])=>"id"in o&&o.id&&"index"in o&&o.index!==void 0?o.id===s.id&&o.index===s.index:"id"in o&&o.id?o.id===s.id:"index"in o&&o.index!==void 0?o.index===s.index:!1);return a!==-1?i[a].push(o):i.push([o]),i},[]),r=[],n=[];for(let i of e){let o=null,a=i[0]?.name??"",s=i.map(l=>l.args||"").join("").trim(),c=s.length?s:"{}",u=i[0]?.id;try{if(o=gi(c),!u||o===null||typeof o!="object"||Array.isArray(o))throw new Error("Malformed tool call chunk args.");r.push({name:a,args:o,id:u,type:"tool_call"})}catch{n.push({name:a,args:c,id:u,error:"Malformed args.",type:"invalid_tool_call"})}}return{tool_call_chunks:t,tool_calls:r,invalid_tool_calls:n}}var fv={};z(fv,{getEnv:()=>Yf,getEnvironmentVariable:()=>ft,getRuntimeEnvironment:()=>mv,isBrowser:()=>dO,isDeno:()=>Xf,isJsDom:()=>mO,isNode:()=>hO,isWebWorker:()=>fO});var dO=()=>typeof window<"u"&&typeof window.document<"u",fO=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",mO=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),Xf=()=>typeof Deno<"u",hO=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Xf(),Yf=()=>{let t;return dO()?t="browser":hO()?t="node":fO()?t="webworker":mO()?t="jsdom":Xf()?t="deno":t="other",t},dv;function mv(){return dv===void 0&&(dv={library:"langchain-js",runtime:Yf()}),dv}function ft(t){try{return typeof process<"u"?process.env?.[t]:Xf()?Deno?.env.get(t):void 0}catch{return}}var gO=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function RF(t){return typeof t=="string"&&gO.test(t)}var Un=RF;function MF(t){if(!Un(t))throw TypeError("Invalid UUID");var e,r=new Uint8Array(16);return r[0]=(e=parseInt(t.slice(0,8),16))>>>24,r[1]=e>>>16&255,r[2]=e>>>8&255,r[3]=e&255,r[4]=(e=parseInt(t.slice(9,13),16))>>>8,r[5]=e&255,r[6]=(e=parseInt(t.slice(14,18),16))>>>8,r[7]=e&255,r[8]=(e=parseInt(t.slice(19,23),16))>>>8,r[9]=e&255,r[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,r[11]=e/4294967296&255,r[12]=e>>>24&255,r[13]=e>>>16&255,r[14]=e>>>8&255,r[15]=e&255,r}var Qf=MF;var Wt=[];for(em=0;em<256;++em)Wt.push((em+256).toString(16).slice(1));var em;function _n(t,e=0){return(Wt[t[e+0]]+Wt[t[e+1]]+Wt[t[e+2]]+Wt[t[e+3]]+"-"+Wt[t[e+4]]+Wt[t[e+5]]+"-"+Wt[t[e+6]]+Wt[t[e+7]]+"-"+Wt[t[e+8]]+Wt[t[e+9]]+"-"+Wt[t[e+10]]+Wt[t[e+11]]+Wt[t[e+12]]+Wt[t[e+13]]+Wt[t[e+14]]+Wt[t[e+15]]).toLowerCase()}var tm,zF=new Uint8Array(16);function is(){if(!tm&&(tm=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!tm))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return tm(zF)}var hv,rm,gv=0,_v=0;function jF(t,e,r){var n=e&&r||0,i=e||new Array(16);t=t||{};var o=t.node,a=t.clockseq;if(t._v6||(o||(o=hv),a==null&&(a=rm)),o==null||a==null){var s=t.random||(t.rng||is)();o==null&&(o=[s[0],s[1],s[2],s[3],s[4],s[5]],!hv&&!t._v6&&(o[0]|=1,hv=o)),a==null&&(a=(s[6]<<8|s[7])&16383,rm===void 0&&!t._v6&&(rm=a))}var c=t.msecs!==void 0?t.msecs:Date.now(),u=t.nsecs!==void 0?t.nsecs:_v+1,l=c-gv+(u-_v)/1e4;if(l<0&&t.clockseq===void 0&&(a=a+1&16383),(l<0||c>gv)&&t.nsecs===void 0&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");gv=c,_v=u,rm=a,c+=122192928e5;var p=((c&268435455)*1e4+u)%4294967296;i[n++]=p>>>24&255,i[n++]=p>>>16&255,i[n++]=p>>>8&255,i[n++]=p&255;var f=c/4294967296*1e4&268435455;i[n++]=f>>>8&255,i[n++]=f&255,i[n++]=f>>>24&15|16,i[n++]=f>>>16&255,i[n++]=a>>>8|128,i[n++]=a&255;for(var m=0;m<6;++m)i[n+m]=o[m];return e||_n(i)}var _O=jF;function yv(t){var e=typeof t=="string"?Qf(t):t,r=DF(e);return typeof t=="string"?_n(r):r}function DF(t,e=!1){return Uint8Array.of((t[6]&15)<<4|t[7]>>4&15,(t[7]&15)<<4|(t[4]&240)>>4,(t[4]&15)<<4|(t[5]&240)>>4,(t[5]&15)<<4|(t[0]&240)>>4,(t[0]&15)<<4|(t[1]&240)>>4,(t[1]&15)<<4|(t[2]&240)>>4,96|t[2]&15,t[3],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function LF(t){t=unescape(encodeURIComponent(t));for(var e=[],r=0;r<t.length;++r)e.push(t.charCodeAt(r));return e}var UF="6ba7b810-9dad-11d1-80b4-00c04fd430c8",FF="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function vv(t,e,r){function n(i,o,a,s){var c;if(typeof i=="string"&&(i=LF(i)),typeof o=="string"&&(o=Qf(o)),((c=o)===null||c===void 0?void 0:c.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var u=new Uint8Array(16+i.length);if(u.set(o),u.set(i,o.length),u=r(u),u[6]=u[6]&15|e,u[8]=u[8]&63|128,a){s=s||0;for(var l=0;l<16;++l)a[s+l]=u[l];return a}return _n(u)}try{n.name=t}catch{}return n.DNS=UF,n.URL=FF,n}var BF=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),bv={randomUUID:BF};function VF(t,e,r){if(bv.randomUUID&&!e&&!t)return bv.randomUUID();t=t||{};var n=t.random||(t.rng||is)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){r=r||0;for(var i=0;i<16;++i)e[r+i]=n[i];return e}return _n(n)}var Dr=VF;function ZF(t,e,r,n){switch(t){case 0:return e&r^~e&n;case 1:return e^r^n;case 2:return e&r^e&n^r&n;case 3:return e^r^n}}function wv(t,e){return t<<e|t>>>32-e}function GF(t){var e=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof t=="string"){var n=unescape(encodeURIComponent(t));t=[];for(var i=0;i<n.length;++i)t.push(n.charCodeAt(i))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);for(var o=t.length/4+2,a=Math.ceil(o/16),s=new Array(a),c=0;c<a;++c){for(var u=new Uint32Array(16),l=0;l<16;++l)u[l]=t[c*64+l*4]<<24|t[c*64+l*4+1]<<16|t[c*64+l*4+2]<<8|t[c*64+l*4+3];s[c]=u}s[a-1][14]=(t.length-1)*8/Math.pow(2,32),s[a-1][14]=Math.floor(s[a-1][14]),s[a-1][15]=(t.length-1)*8&4294967295;for(var p=0;p<a;++p){for(var f=new Uint32Array(80),m=0;m<16;++m)f[m]=s[p][m];for(var h=16;h<80;++h)f[h]=wv(f[h-3]^f[h-8]^f[h-14]^f[h-16],1);for(var g=r[0],x=r[1],y=r[2],v=r[3],S=r[4],k=0;k<80;++k){var T=Math.floor(k/20),N=wv(g,5)+ZF(T,x,y,v)+S+e[T]+f[k]>>>0;S=v,v=y,y=wv(x,30)>>>0,x=g,g=N}r[0]=r[0]+g>>>0,r[1]=r[1]+x>>>0,r[2]=r[2]+y>>>0,r[3]=r[3]+v>>>0,r[4]=r[4]+S>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,r[0]&255,r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,r[1]&255,r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,r[2]&255,r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,r[3]&255,r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,r[4]&255]}var yO=GF;var HF=vv("v5",80,yO),yn=HF;function vO(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function bO(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?vO(Object(r),!0).forEach(function(n){qF(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):vO(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function qF(t,e,r){return(e=KF(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function KF(t){var e=WF(t,"string");return typeof e=="symbol"?e:e+""}function WF(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function nm(t={},e,r=0){var n=_O(bO(bO({},t),{},{_v6:!0}),new Uint8Array(16));if(n=yv(n),e){for(var i=0;i<16;i++)e[r+i]=n[i];return e}return _n(n)}var wO=null,xO=null,Fn=0;function JF(t,e,r){t=t||{};var n=e&&r||0,i=e||new Uint8Array(16),o=t.random||(t.rng||is)(),a=t.msecs!==void 0?t.msecs:Date.now(),s=t.seq!==void 0?t.seq:null,c=xO,u=wO;return a>Fn&&t.msecs===void 0&&(Fn=a,s!==null&&(c=null,u=null)),s!==null&&(s>2147483647&&(s=2147483647),c=s>>>19&4095,u=s&524287),(c===null||u===null)&&(c=o[6]&127,c=c<<8|o[7],u=o[8]&63,u=u<<8|o[9],u=u<<5|o[10]>>>3),a+1e4>Fn&&s===null?++u>524287&&(u=0,++c>4095&&(c=0,Fn++)):Fn=a,xO=c,wO=u,i[n++]=Fn/1099511627776&255,i[n++]=Fn/4294967296&255,i[n++]=Fn/16777216&255,i[n++]=Fn/65536&255,i[n++]=Fn/256&255,i[n++]=Fn&255,i[n++]=c>>>4&15|112,i[n++]=c&255,i[n++]=u>>>13&63|128,i[n++]=u>>>5&255,i[n++]=u<<3&255|o[10]&7,i[n++]=o[11],i[n++]=o[12],i[n++]=o[13],i[n++]=o[14],i[n++]=o[15],e||_n(i)}var vn=JF;var xv={};z(xv,{BaseCallbackHandler:()=>co,callbackHandlerPrefersStreaming:()=>ap,isBaseCallbackHandler:()=>Sv});var XF=class{};function ap(t){return"lc_prefer_streaming"in t&&t.lc_prefer_streaming}var co=class extends XF{constructor(e){super();d(this,"lc_serializable",!1);d(this,"lc_kwargs");d(this,"ignoreLLM",!1);d(this,"ignoreChain",!1);d(this,"ignoreAgent",!1);d(this,"ignoreRetriever",!1);d(this,"ignoreCustomEvent",!1);d(this,"raiseError",!1);d(this,"awaitHandlers",ft("LANGCHAIN_CALLBACKS_BACKGROUND")==="false");this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Oc(this.constructor)]}copy(){return new this.constructor(this)}toJSON(){return It.prototype.toJSON.call(this)}toJSONNotImplemented(){return It.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class r extends co{constructor(){super();d(this,"name",vn());Object.assign(this,e)}}return new r}},Sv=t=>{let e=t;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"};var IO="gen_ai.operation.name",kO="gen_ai.system",Iv="gen_ai.request.model",EO="gen_ai.response.model",kv="gen_ai.usage.input_tokens",Ev="gen_ai.usage.output_tokens",Av="gen_ai.usage.total_tokens",AO="gen_ai.request.max_tokens",TO="gen_ai.request.temperature",$O="gen_ai.request.top_p",OO="gen_ai.request.frequency_penalty",CO="gen_ai.request.presence_penalty",PO="gen_ai.response.finish_reasons",NO="gen_ai.prompt",RO="gen_ai.completion",MO="gen_ai.request.extra_query",zO="gen_ai.request.extra_body",jO="gen_ai.serialized.name",DO="gen_ai.serialized.signature",LO="gen_ai.serialized.doc",UO="gen_ai.response.id",FO="gen_ai.response.service_tier",BO="gen_ai.response.system_fingerprint",VO="gen_ai.usage.input_token_details",ZO="gen_ai.usage.output_token_details",GO="langsmith.trace.session_id",HO="langsmith.trace.session_name",qO="langsmith.span.kind",KO="langsmith.trace.name",WO="langsmith.metadata",Tv="langsmith.span.tags";var JO="langsmith.request.streaming",XO="langsmith.request.headers";var QF=(...t)=>fetch(...t),YO=Symbol.for("ls:fetch_implementation");var QO=()=>{let t=globalThis[YO];return t?typeof t=="function"&&"Headers"in t&&"Request"in t&&"Response"in t:!1},eC=t=>async(...e)=>{if(t||Ot("DEBUG")==="true"){let[n,i]=e;console.log(`\u2192 ${i?.method||"GET"} ${n}`)}let r=await(globalThis[YO]??QF)(...e);return(t||Ot("DEBUG")==="true")&&console.log(`\u2190 ${r.status} ${r.statusText} ${r.url}`),r};var sp=()=>Ot("PROJECT")??Qr("LANGCHAIN_SESSION")??"default";var tC={};function cp(t){tC[t]||(console.warn(t),tC[t]=!0)}var e6=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function Se(t,e){if(!e6.test(t)){let r=e!==void 0?`Invalid UUID for ${e}: ${t}`:`Invalid UUID: ${t}`;throw new Error(r)}return t}function im(t){let e=typeof t=="string"?Date.parse(t):t;return vn({msecs:e,seq:0})}function rC(t,e){throw new Error("dump() is not supported in browser environments.")}function nC(t){throw new Error("load() is not supported in browser environments.")}function t6(t,e){return e===null?!1:Date.now()-t.createdAt>e*1e3}var up=class{constructor(e={}){Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ttlSeconds",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"refreshIntervalSeconds",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchFunc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"refreshTimer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_metrics",{enumerable:!0,configurable:!0,writable:!0,value:{hits:0,misses:0,refreshes:0,refreshErrors:0}}),this.maxSize=e.maxSize??100,this.ttlSeconds=e.ttlSeconds??3600,this.refreshIntervalSeconds=e.refreshIntervalSeconds??60,this.fetchFunc=e.fetchFunc,this.fetchFunc&&this.ttlSeconds!==null&&this.startRefreshLoop()}get metrics(){return{...this._metrics}}get totalRequests(){return this._metrics.hits+this._metrics.misses}get hitRate(){let e=this.totalRequests;return e>0?this._metrics.hits/e:0}resetMetrics(){this._metrics={hits:0,misses:0,refreshes:0,refreshErrors:0}}get(e){let r=this.cache.get(e);if(!r){this._metrics.misses+=1;return}return this.cache.delete(e),this.cache.set(e,r),this._metrics.hits+=1,r.value}set(e,r){if(!this.cache.has(e)&&this.cache.size>=this.maxSize){let i=this.cache.keys().next().value;i!==void 0&&this.cache.delete(i)}let n={value:r,createdAt:Date.now()};this.cache.delete(e),this.cache.set(e,n)}invalidate(e){this.cache.delete(e)}clear(){this.cache.clear()}get size(){return this.cache.size}stop(){this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=void 0)}dump(e){let r={};for(let[n,i]of this.cache.entries())r[n]=i.value;rC(e,r)}load(e){let r=nC(e);if(!r)return 0;let n=0,i=Date.now();for(let[o,a]of Object.entries(r)){if(this.cache.size>=this.maxSize)break;let s={value:a,createdAt:i};this.cache.set(o,s),n+=1}return n}startRefreshLoop(){this.refreshTimer=setInterval(()=>{this.refreshStaleEntries().catch(e=>{console.warn("Unexpected error in cache refresh loop:",e)})},this.refreshIntervalSeconds*1e3),this.refreshTimer.unref&&this.refreshTimer.unref()}getStaleKeys(){let e=[];for(let[r,n]of this.cache.entries())t6(n,this.ttlSeconds)&&e.push(r);return e}async refreshStaleEntries(){if(!this.fetchFunc)return;let e=this.getStaleKeys();if(e.length!==0)for(let r of e)try{let n=await this.fetchFunc(r);this.set(r,n),this._metrics.refreshes+=1}catch(n){this._metrics.refreshErrors+=1,console.warn(`Failed to refresh cache entry ${r}:`,n)}}};var om="0.4.7";var _i,r6=()=>typeof window<"u"&&typeof window.document<"u",n6=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",i6=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),iC=()=>typeof Deno<"u",o6=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!iC(),Cv=()=>_i||(typeof Bun<"u"?_i="bun":r6()?_i="browser":o6()?_i="node":n6()?_i="webworker":i6()?_i="jsdom":iC()?_i="deno":_i="other",_i),$v;function am(){if($v===void 0){let t=Cv(),e=s6();$v={library:"langsmith",runtime:t,sdk:"langsmith-js",sdk_version:om,...e}}return $v}function Pv(){let t=a6(),e={},r=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(let[n,i]of Object.entries(t))typeof i=="string"&&!r.includes(n)&&!n.toLowerCase().includes("key")&&!n.toLowerCase().includes("secret")&&!n.toLowerCase().includes("token")&&(n==="LANGCHAIN_REVISION_ID"?e.revision_id=i:e[n]=i);return e}function a6(){let t={};try{if(typeof process<"u"&&process.env)for(let[e,r]of Object.entries(process.env))(e.startsWith("LANGCHAIN_")||e.startsWith("LANGSMITH_"))&&r!=null&&((e.toLowerCase().includes("key")||e.toLowerCase().includes("secret")||e.toLowerCase().includes("token"))&&typeof r=="string"?t[e]=r.slice(0,2)+"*".repeat(r.length-4)+r.slice(-2):t[e]=r)}catch{}return t}function Qr(t){try{return typeof process<"u"?process.env?.[t]:void 0}catch{return}}function Ot(t){return Qr(`LANGSMITH_${t}`)||Qr(`LANGCHAIN_${t}`)}var Ov;function s6(){if(Ov!==void 0)return Ov;let t=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(let r of t){let n=Qr(r);n!==void 0&&(e[r]=n)}return Ov=e,e}function sm(){return Qr("OTEL_ENABLED")==="true"||Ot("OTEL_ENABLED")==="true"}var Mv=class{constructor(){Object.defineProperty(this,"hasWarned",{enumerable:!0,configurable:!0,writable:!0,value:!1})}startActiveSpan(e,...r){!this.hasWarned&&sm()&&(console.warn('You have enabled OTEL export via the `OTEL_ENABLED` or `LANGSMITH_OTEL_ENABLED` environment variable, but have not initialized the required OTEL instances. Please add:\n```\nimport { initializeOTEL } from "langsmith/experimental/otel/setup";\ninitializeOTEL();\n```\nat the beginning of your code.'),this.hasWarned=!0);let n;if(r.length===1&&typeof r[0]=="function"?n=r[0]:r.length===2&&typeof r[1]=="function"?n=r[1]:r.length===3&&typeof r[2]=="function"&&(n=r[2]),typeof n=="function")return n()}},zv=class{constructor(){Object.defineProperty(this,"mockTracer",{enumerable:!0,configurable:!0,writable:!0,value:new Mv})}getTracer(e,r){return this.mockTracer}getActiveSpan(){}setSpan(e,r){return e}getSpan(e){}setSpanContext(e,r){return e}getTracerProvider(){}setGlobalTracerProvider(e){return!1}},jv=class{active(){return{}}with(e,r){return r()}},Nv=Symbol.for("ls:otel_trace"),Rv=Symbol.for("ls:otel_context"),oC=Symbol.for("ls:otel_get_default_otlp_tracer_provider"),c6=new zv,u6=new jv,Dv=class{getTraceInstance(){return globalThis[Nv]??c6}getContextInstance(){return globalThis[Rv]??u6}initializeGlobalInstances(e){globalThis[Nv]===void 0&&(globalThis[Nv]=e.trace),globalThis[Rv]===void 0&&(globalThis[Rv]=e.context)}setDefaultOTLPTracerComponents(e){globalThis[oC]=e}getDefaultOTLPTracerComponents(){return globalThis[oC]??void 0}},Lv=new Dv;function cm(){return Lv.getTraceInstance()}function aC(){return Lv.getContextInstance()}function sC(){return Lv.getDefaultOTLPTracerComponents()}var l6={llm:"chat",tool:"execute_tool",retriever:"embeddings",embedding:"embeddings",prompt:"chat"};function p6(t){return l6[t]||t}var um=class{constructor(){Object.defineProperty(this,"spans",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}exportBatch(e,r){for(let n of e)try{if(!n.run)continue;if(n.operation==="post"){let i=this.createSpanForRun(n,n.run,r.get(n.id));i&&!n.run.end_time&&this.spans.set(n.id,i)}else this.updateSpanForRun(n,n.run)}catch(i){console.error(`Error processing operation ${n.id}:`,i)}}createSpanForRun(e,r,n){let i=n&&cm().getSpan(n);if(i)try{return this.finishSpanSetup(i,r,e)}catch(o){console.error(`Failed to create span for run ${e.id}:`,o);return}}finishSpanSetup(e,r,n){return this.setSpanAttributes(e,r,n),r.error?(e.setStatus({code:2}),e.recordException(new Error(r.error))):e.setStatus({code:1}),r.end_time&&e.end(new Date(r.end_time)),e}updateSpanForRun(e,r){try{let n=this.spans.get(e.id);if(!n){console.debug(`No span found for run ${e.id} during update`);return}this.setSpanAttributes(n,r,e),r.error?(n.setStatus({code:2}),n.recordException(new Error(r.error))):n.setStatus({code:1});let i=r.end_time;i&&(n.end(new Date(i)),this.spans.delete(e.id))}catch(n){console.error(`Failed to update span for run ${e.id}:`,n)}}extractModelName(e){if(e.extra?.metadata){let r=e.extra.metadata;if(r.ls_model_name)return r.ls_model_name;if(r.invocation_params){let n=r.invocation_params;if(n.model)return n.model;if(n.model_name)return n.model_name}}}setSpanAttributes(e,r,n){if("run_type"in r&&r.run_type){e.setAttribute(qO,r.run_type);let s=p6(r.run_type||"chain");e.setAttribute(IO,s)}"name"in r&&r.name&&e.setAttribute(KO,r.name),"session_id"in r&&r.session_id&&e.setAttribute(GO,r.session_id),"session_name"in r&&r.session_name&&e.setAttribute(HO,r.session_name),this.setGenAiSystem(e,r);let i=this.extractModelName(r);i&&e.setAttribute(Iv,i),"prompt_tokens"in r&&typeof r.prompt_tokens=="number"&&e.setAttribute(kv,r.prompt_tokens),"completion_tokens"in r&&typeof r.completion_tokens=="number"&&e.setAttribute(Ev,r.completion_tokens),"total_tokens"in r&&typeof r.total_tokens=="number"&&e.setAttribute(Av,r.total_tokens),this.setInvocationParameters(e,r);let o=r.extra?.metadata||{};for(let[s,c]of Object.entries(o))c!=null&&e.setAttribute(`${WO}.${s}`,String(c));let a=r.tags;if(a&&Array.isArray(a)?e.setAttribute(Tv,a.join(", ")):a&&e.setAttribute(Tv,String(a)),"serialized"in r&&typeof r.serialized=="object"){let s=r.serialized;s.name&&e.setAttribute(jO,String(s.name)),s.signature&&e.setAttribute(DO,String(s.signature)),s.doc&&e.setAttribute(LO,String(s.doc))}this.setIOAttributes(e,n)}setGenAiSystem(e,r){let n="langchain",i=this.extractModelName(r);if(i){let o=i.toLowerCase();o.includes("anthropic")||o.startsWith("claude")?n="anthropic":o.includes("bedrock")?n="aws.bedrock":o.includes("azure")&&o.includes("openai")?n="az.ai.openai":o.includes("azure")&&o.includes("inference")?n="az.ai.inference":o.includes("cohere")?n="cohere":o.includes("deepseek")?n="deepseek":o.includes("gemini")?n="gemini":o.includes("groq")?n="groq":o.includes("watson")||o.includes("ibm")?n="ibm.watsonx.ai":o.includes("mistral")?n="mistral_ai":o.includes("gpt")||o.includes("openai")?n="openai":o.includes("perplexity")||o.includes("sonar")?n="perplexity":o.includes("vertex")?n="vertex_ai":(o.includes("xai")||o.includes("grok"))&&(n="xai")}e.setAttribute(kO,n)}setInvocationParameters(e,r){if(!r.extra?.metadata?.invocation_params)return;let n=r.extra.metadata.invocation_params;n.max_tokens!==void 0&&e.setAttribute(AO,n.max_tokens),n.temperature!==void 0&&e.setAttribute(TO,n.temperature),n.top_p!==void 0&&e.setAttribute($O,n.top_p),n.frequency_penalty!==void 0&&e.setAttribute(OO,n.frequency_penalty),n.presence_penalty!==void 0&&e.setAttribute(CO,n.presence_penalty)}setIOAttributes(e,r){if(r.run.inputs)try{let n=r.run.inputs;typeof n=="object"&&n!==null&&(n.model&&Array.isArray(n.messages)&&e.setAttribute(Iv,n.model),n.stream!==void 0&&e.setAttribute(JO,n.stream),n.extra_headers&&e.setAttribute(XO,JSON.stringify(n.extra_headers)),n.extra_query&&e.setAttribute(MO,JSON.stringify(n.extra_query)),n.extra_body&&e.setAttribute(zO,JSON.stringify(n.extra_body))),e.setAttribute(NO,JSON.stringify(n))}catch(n){console.debug(`Failed to process inputs for run ${r.id}`,n)}if(r.run.outputs)try{let n=r.run.outputs,i=this.getUnifiedRunTokens(n);if(i&&(e.setAttribute(kv,i[0]),e.setAttribute(Ev,i[1]),e.setAttribute(Av,i[0]+i[1])),n&&typeof n=="object"){if(n.model&&e.setAttribute(EO,String(n.model)),n.id&&e.setAttribute(UO,n.id),n.choices&&Array.isArray(n.choices)){let o=n.choices.map(a=>a.finish_reason).filter(a=>a).map(String);o.length>0&&e.setAttribute(PO,o.join(", "))}if(n.service_tier&&e.setAttribute(FO,n.service_tier),n.system_fingerprint&&e.setAttribute(BO,n.system_fingerprint),n.usage_metadata&&typeof n.usage_metadata=="object"){let o=n.usage_metadata;o.input_token_details&&e.setAttribute(VO,JSON.stringify(o.input_token_details)),o.output_token_details&&e.setAttribute(ZO,JSON.stringify(o.output_token_details))}}e.setAttribute(RO,JSON.stringify(n))}catch(n){console.debug(`Failed to process outputs for run ${r.id}`,n)}}getUnifiedRunTokens(e){if(!e)return null;let r=this.extractUnifiedRunTokens(e.usage_metadata);if(r)return r;let n=Object.keys(e);for(let a of n){let s=e[a];if(!(!s||typeof s!="object")&&(r=this.extractUnifiedRunTokens(s.usage_metadata),r||s.lc===1&&s.kwargs&&typeof s.kwargs=="object"&&(r=this.extractUnifiedRunTokens(s.kwargs.usage_metadata),r)))return r}let i=e.generations||[];if(!Array.isArray(i))return null;let o=Array.isArray(i[0])?i.flat():i;for(let a of o)if(typeof a=="object"&&a.message&&typeof a.message=="object"&&a.message.kwargs&&typeof a.message.kwargs=="object"&&(r=this.extractUnifiedRunTokens(a.message.kwargs.usage_metadata),r))return r;return null}extractUnifiedRunTokens(e){return!e||typeof e!="object"||typeof e.input_tokens!="number"||typeof e.output_tokens!="number"?null:[e.input_tokens,e.output_tokens]}};var d6=Object.prototype.toString,f6=t=>d6.call(t)==="[object Error]",m6=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred.","Network connection lost"]);function Uv(t){if(!(t&&f6(t)&&t.name==="TypeError"&&typeof t.message=="string"))return!1;let{message:r,stack:n}=t;return r==="Load failed"?n===void 0||"__sentry_captured__"in t:r.startsWith("error sending request for url")?!0:m6.has(r)}function h6(t){if(typeof t=="number"){if(t<0)throw new TypeError("Expected `retries` to be a non-negative number.");if(Number.isNaN(t))throw new TypeError("Expected `retries` to be a valid number or Infinity, got NaN.")}else if(t!==void 0)throw new TypeError("Expected `retries` to be a number or Infinity.")}function lm(t,e,{min:r=0,allowInfinity:n=!1}={}){if(e!==void 0){if(typeof e!="number"||Number.isNaN(e))throw new TypeError(`Expected \`${t}\` to be a number${n?" or Infinity":""}.`);if(!n&&!Number.isFinite(e))throw new TypeError(`Expected \`${t}\` to be a finite number.`);if(e<r)throw new TypeError(`Expected \`${t}\` to be \u2265 ${r}.`)}}var Fv=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}};function g6(t,e){let r=Math.max(1,t+1),n=e.randomize?Math.random()+1:1,i=Math.round(n*e.minTimeout*e.factor**(r-1));return i=Math.min(i,e.maxTimeout),i}function cC(t,e){return Number.isFinite(e)?e-(performance.now()-t):e}async function _6({error:t,attemptNumber:e,retriesConsumed:r,startTime:n,options:i}){let o=t instanceof Error?t:new TypeError(`Non-error was thrown: "${t}". You should only throw errors.`);if(o instanceof Fv)throw o.originalError;let a=Number.isFinite(i.retries)?Math.max(0,i.retries-r):i.retries,s=i.maxRetryTime??Number.POSITIVE_INFINITY,c=Object.freeze({error:o,attemptNumber:e,retriesLeft:a,retriesConsumed:r});if(await i.onFailedAttempt(c),cC(n,s)<=0)throw o;let u=await i.shouldConsumeRetry(c),l=cC(n,s);if(l<=0||a<=0)throw o;if(o instanceof TypeError&&!Uv(o)){if(u)throw o;return i.signal?.throwIfAborted(),!1}if(!await i.shouldRetry(c))throw o;if(!u)return i.signal?.throwIfAborted(),!1;let p=g6(r,i),f=Math.min(p,l);return f>0&&await new Promise((m,h)=>{let g=()=>{clearTimeout(x),i.signal?.removeEventListener("abort",g),h(i.signal.reason)},x=setTimeout(()=>{i.signal?.removeEventListener("abort",g),m()},f);i.unref&&x.unref?.(),i.signal?.addEventListener("abort",g,{once:!0})}),i.signal?.throwIfAborted(),!0}async function Bv(t,e={}){if(e={...e},h6(e.retries),Object.hasOwn(e,"forever"))throw new Error("The `forever` option is no longer supported. For many use-cases, you can set `retries: Infinity` instead.");e.retries??(e.retries=10),e.factor??(e.factor=2),e.minTimeout??(e.minTimeout=1e3),e.maxTimeout??(e.maxTimeout=Number.POSITIVE_INFINITY),e.maxRetryTime??(e.maxRetryTime=Number.POSITIVE_INFINITY),e.randomize??(e.randomize=!1),e.onFailedAttempt??(e.onFailedAttempt=()=>{}),e.shouldRetry??(e.shouldRetry=()=>!0),e.shouldConsumeRetry??(e.shouldConsumeRetry=()=>!0),lm("factor",e.factor,{min:0,allowInfinity:!1}),lm("minTimeout",e.minTimeout,{min:0,allowInfinity:!1}),lm("maxTimeout",e.maxTimeout,{min:0,allowInfinity:!0}),lm("maxRetryTime",e.maxRetryTime,{min:0,allowInfinity:!0}),e.factor>0||(e.factor=1),e.signal?.throwIfAborted();let r=0,n=0,i=performance.now();for(;!Number.isFinite(e.retries)||n<=e.retries;){r++;try{e.signal?.throwIfAborted();let o=await t(r);return e.signal?.throwIfAborted(),o}catch(o){await _6({error:o,attemptNumber:r,retriesConsumed:n,startTime:i,options:e})&&n++}}throw new Error("Retry attempts exhausted without throwing an error.")}var gm=Wo(hm(),1),E6=[408,425,429,500,502,503,504],pp=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxQueueSizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queueSizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.maxQueueSizeBytes=e.maxQueueSizeBytes,"default"in gm.default?this.queue=new gm.default.default({concurrency:this.maxConcurrency}):this.queue=new gm.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...r){return this.callWithOptions({},e,...r)}callWithOptions(e,r,...n){let i=e.sizeBytes??0;if(this.maxQueueSizeBytes!==void 0&&i>0&&this.queueSizeBytes+i>this.maxQueueSizeBytes)return Promise.reject(new Error(`Queue size limit (${this.maxQueueSizeBytes} bytes) exceeded. Current queue size: ${this.queueSizeBytes} bytes, attempted addition: ${i} bytes.`));i>0&&(this.queueSizeBytes+=i);let o=this.onFailedResponseHook,a=this.queue.add(()=>Bv(()=>r(...n).catch(s=>{throw s instanceof Error?s:new Error(s)}),{async onFailedAttempt({error:s}){if(typeof s!="object"||s==null)throw s;let c="message"in s&&typeof s.message=="string"?s.message:void 0;if(c?.startsWith("Cancel")||c?.startsWith("TimeoutError")||c?.startsWith("AbortError")||"name"in s&&s.name==="TimeoutError"||"code"in s&&s.code==="ECONNABORTED")throw s;let u="response"in s?s.response:void 0;if(o&&await o(u))return;let l=u?.status??("status"in s?s.status:void 0);if(l!=null&&(typeof l=="number"||typeof l=="string")&&!E6.includes(+l))throw s},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0});return i>0&&(a=a.finally(()=>{this.queueSizeBytes-=i})),e.signal?Promise.race([a,new Promise((s,c)=>{e.signal?.addEventListener("abort",()=>{c(new Error("AbortError"))})})]):a}};function Wv(t){return typeof t?._getType=="function"}function Jv(t){let e={type:t._getType(),data:{content:t.content}};return t?.additional_kwargs&&Object.keys(t.additional_kwargs).length>0&&(e.data.additional_kwargs={...t.additional_kwargs}),e}var xV=Wo(aN(),1);function lo(t){if(!t||t.split("/").length>2||t.startsWith("/")||t.endsWith("/")||t.split(":").length>2)throw new Error(`Invalid identifier format: ${t}`);let[e,r]=t.split(":"),n=r||"latest";if(e.includes("/")){let[i,o]=e.split("/",2);if(!i||!o)throw new Error(`Invalid identifier format: ${t}`);return[i,o,n]}else{if(!e)throw new Error(`Invalid identifier format: ${t}`);return["-",e,n]}}var gb=class extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}},_b=class extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithNotFoundError",this.status=404}};function yb(t){return t!=null&&typeof t=="object"&&"name"in t&&t?.name==="LangSmithNotFoundError"}async function se(t,e,r){let n;if(t.ok){r&&(n=await t.text());return}if(t.status===403)try{(await t.json())?.error==="org_scoped_key_requires_workspace"&&(n="This API key is org-scoped and requires workspace specification. Please provide 'workspaceId' parameter, or set LANGSMITH_WORKSPACE_ID environment variable.")}catch{let s=new Error(`${t.status} ${t.statusText}`);throw s.status=t?.status,s}if(n===void 0)try{n=await t.text()}catch{n=""}let i=`Failed to ${e}. Received status [${t.status}]: ${t.statusText}. Message: ${n}`;if(t.status===404)throw new _b(i);if(t.status===409)throw new gb(i);let o=new Error(i);throw o.status=t.status,o}var sN="ERR_CONFLICTING_ENDPOINTS",$m=class extends Error{constructor(){super("You cannot provide both LANGSMITH_ENDPOINT / LANGCHAIN_ENDPOINT and LANGSMITH_RUNS_ENDPOINTS."),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:sN}),this.name="ConflictingEndpointsError"}};function cN(t){return typeof t=="object"&&t!==null&&t.code===sN}var uN="[...]",SV={result:"[Circular]"},Cm=[],Dc=[],IV=new TextEncoder;function kV(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function Om(t){return IV.encode(t)}function lN(t){if(t&&typeof t=="object"&&t!==null){if(t instanceof Map)return Object.fromEntries(t);if(t instanceof Set)return Array.from(t);if(t instanceof Date)return t.toISOString();if(t instanceof RegExp)return t.toString();if(t instanceof Error)return{name:t.name,message:t.message}}else if(typeof t=="bigint")return t.toString();return t}function EV(t){return function(e,r){if(t){let n=t.call(this,e,r);if(n!==void 0)return n}return lN(r)}}function Lr(t,e,r,n,i){try{let o=JSON.stringify(t,EV(r),n);return Om(o)}catch(o){if(!o.message?.includes("Converting circular structure to JSON"))return console.warn(`[WARNING]: LangSmith received unserializable value.${e?`
Context: ${e}`:""}`),Om("[Unserializable]");Ot("SUPPRESS_CIRCULAR_JSON_WARNINGS")!=="true"&&console.warn(`[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. ${e?`
Context: ${e}`:""}`),typeof i>"u"&&(i=kV()),bb(t,"",0,[],void 0,0,i);let a;try{Dc.length===0?a=JSON.stringify(t,r,n):a=JSON.stringify(t,AV(r),n)}catch{return Om("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;Cm.length!==0;){let s=Cm.pop();s.length===4?Object.defineProperty(s[0],s[1],s[3]):s[0][s[1]]=s[2]}}return Om(a)}}function vb(t,e,r,n){var i=Object.getOwnPropertyDescriptor(n,r);i.get!==void 0?i.configurable?(Object.defineProperty(n,r,{value:t}),Cm.push([n,r,e,i])):Dc.push([e,r,t]):(n[r]=t,Cm.push([n,r,e]))}function bb(t,e,r,n,i,o,a){o+=1;var s;if(typeof t=="object"&&t!==null){for(s=0;s<n.length;s++)if(n[s]===t){vb(SV,t,e,i);return}if(typeof a.depthLimit<"u"&&o>a.depthLimit){vb(uN,t,e,i);return}if(typeof a.edgesLimit<"u"&&r+1>a.edgesLimit){vb(uN,t,e,i);return}if(n.push(t),Array.isArray(t))for(s=0;s<t.length;s++)bb(t[s],s,s,n,t,o,a);else{t=lN(t);var c=Object.keys(t);for(s=0;s<c.length;s++){var u=c[s];bb(t[u],u,s,n,t,o,a)}}n.pop()}}function AV(t){return t=typeof t<"u"?t:function(e,r){return r},function(e,r){if(Dc.length>0)for(var n=0;n<Dc.length;n++){var i=Dc[n];if(i[1]===e&&i[0]===r){r=i[2],Dc.splice(n,1);break}}return t.call(this,e,r)}}function pN(t,e,r){if(r)return t;let n=am(),i=e??Pv(),o=t.extra??{},a=o.metadata;return t.extra={...o,runtime:{...n,...o?.runtime},metadata:{...i,...i.revision_id||"revision_id"in t&&t.revision_id?{revision_id:("revision_id"in t?t.revision_id:void 0)??i.revision_id}:{},...a}},t}var TV=t=>{let e=t?.toString()??Ot("TRACING_SAMPLING_RATE");if(e===void 0)return;let r=parseFloat(e);if(r<0||r>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${r}`);return r},$V=t=>{let r=t.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return r==="localhost"||r==="127.0.0.1"||r==="::1"};async function OV(t){let e=[];for await(let r of t)e.push(r);return e}function Pm(t){if(t!==void 0)return t.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}var CV=async t=>{if(t?.status===429){let e=parseInt(t.headers.get("retry-after")??"10",10)*1e3;if(e>0)return await new Promise(r=>setTimeout(r,e)),!0}return!1};function dN(t){return typeof t=="number"?Number(t.toFixed(4)):t}var PV=24*1024*1024,hN=1024*1024*1024,NV=1e4,RV=100,fN="https://api.smith.langchain.com",wb=class{constructor(e){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"maxSizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSizeBytes=e??hN}peek(){return this.items[0]}push(e){let r,n=new Promise(o=>{r=o}),i=Lr(e.item,`Serializing run with id: ${e.item.id}`).length;return this.sizeBytes+i>this.maxSizeBytes&&this.items.length>0?(console.warn(`AutoBatchQueue size limit (${this.maxSizeBytes} bytes) exceeded. Dropping run with id: ${e.item.id}. Current queue size: ${this.sizeBytes} bytes, attempted addition: ${i} bytes.`),r(),n):(this.items.push({action:e.action,payload:e.item,otelContext:e.otelContext,apiKey:e.apiKey,apiUrl:e.apiUrl,itemPromiseResolve:r,itemPromise:n,size:i}),this.sizeBytes+=i,n)}pop({upToSizeBytes:e,upToSize:r}){if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");let n=[],i=0;for(;i+(this.peek()?.size??0)<e&&this.items.length>0&&n.length<r;){let o=this.items.shift();o&&(n.push(o),i+=o.size,this.sizeBytes-=o.size)}if(n.length===0&&this.items.length>0){let o=this.items.shift();n.push(o),i+=o.size,this.sizeBytes-=o.size}return[n.map(o=>({action:o.action,item:o.payload,otelContext:o.otelContext,apiKey:o.apiKey,apiUrl:o.apiUrl,size:o.size})),()=>n.forEach(o=>o.itemPromiseResolve())]}},uo=class t{get _fetch(){return this.fetchImplementation||eC(this.debug)}constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"workspaceId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitTracedRuntimeInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchSizeLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:Qr("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"langSmithToOTELTranslator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchImplementation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cachedLSEnvVarsForMetadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multipartStreamingDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_multipartDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:Qr("LANGSMITH_DEBUG")==="true"});let r=t.getDefaultClientConfig();if(this.tracingSampleRate=TV(e.tracingSamplingRate),this.apiUrl=Pm(e.apiUrl??r.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=Pm(e.apiKey??r.apiKey),this.webUrl=Pm(e.webUrl??r.webUrl),this.webUrl?.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.workspaceId=Pm(e.workspaceId??Ot("WORKSPACE_ID")),this.timeout_ms=e.timeout_ms??9e4,this.caller=new pp({...e.callerOptions??{},maxRetries:4,debug:e.debug??this.debug}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.debug=e.debug??this.debug,this.fetchImplementation=e.fetchImplementation;let n=e.maxIngestMemoryBytes??hN;this.batchIngestCaller=new pp({maxRetries:4,maxConcurrency:this.traceBatchConcurrency,maxQueueSizeBytes:n,...e.callerOptions??{},onFailedResponseHook:CV,debug:e.debug??this.debug}),this.hideInputs=e.hideInputs??e.anonymizer??r.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??r.hideOutputs,this.omitTracedRuntimeInfo=e.omitTracedRuntimeInfo??!1,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.autoBatchQueue=new wb(n),this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.batchSizeLimit=e.batchSizeLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode,sm()&&(this.langSmithToOTELTranslator=new um),this.cachedLSEnvVarsForMetadata=Pv(),e.cache===!0?this._cache=new up:e.cache&&typeof e.cache=="object"?this._cache=e.cache:this._cache=void 0}static getDefaultClientConfig(){let e=Ot("API_KEY"),r=Ot("ENDPOINT")??fN,n=Ot("HIDE_INPUTS")==="true",i=Ot("HIDE_OUTPUTS")==="true";return{apiUrl:r,apiKey:e,webUrl:void 0,hideInputs:n,hideOutputs:i}}getHostUrl(){return this.webUrl?this.webUrl:$V(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){let e={"User-Agent":`langsmith-js/${om}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),this.workspaceId&&(e["x-tenant-id"]=this.workspaceId),e}_getPlatformEndpointPath(e){return this.apiUrl.slice(-3)!=="/v1"&&this.apiUrl.slice(-4)!=="/v1/"?`/v1/platform/${e}`:`/platform/${e}`}async processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}async processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}async prepareRunCreateOrUpdateInputs(e){let r={...e};return r.inputs!==void 0&&(r.inputs=await this.processInputs(r.inputs)),r.outputs!==void 0&&(r.outputs=await this.processOutputs(r.outputs)),r}async _getResponse(e,r){let n=r?.toString()??"",i=`${this.apiUrl}${e}?${n}`;return await this.caller.call(async()=>{let a=await this._fetch(i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await se(a,`fetch ${e}`),a})}async _get(e,r){return(await this._getResponse(e,r)).json()}async*_getPaginated(e,r=new URLSearchParams,n){let i=Number(r.get("offset"))||0,o=Number(r.get("limit"))||100;for(;;){r.set("offset",String(i)),r.set("limit",String(o));let a=`${this.apiUrl}${e}?${r}`,s=await this.caller.call(async()=>{let u=await this._fetch(a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await se(u,`fetch ${e}`),u}),c=n?n(await s.json()):await s.json();if(c.length===0||(yield c,c.length<o))break;i+=c.length}}async*_getCursorPaginatedList(e,r=null,n="POST",i="runs"){let o=r?{...r}:{};for(;;){let a=JSON.stringify(o),c=await(await this.caller.call(async()=>{let l=await this._fetch(`${this.apiUrl}${e}`,{method:n,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await se(l,`fetch ${e}`),l})).json();if(!c||!c[i])break;yield c[i];let u=c.cursors;if(!u||!u.next)break;o.cursor=u.next}}_shouldSample(){return this.tracingSampleRate===void 0?!0:Math.random()<this.tracingSampleRate}_filterForSampling(e,r=!1){if(this.tracingSampleRate===void 0)return e;if(r){let n=[];for(let i of e)this.filteredPostUuids.has(i.trace_id)?i.id===i.trace_id&&this.filteredPostUuids.delete(i.trace_id):n.push(i);return n}else{let n=[];for(let i of e){let o=i.trace_id??i.id;this.filteredPostUuids.has(o)||(i.id===o?this._shouldSample()?n.push(i):this.filteredPostUuids.add(o):n.push(i))}return n}}async _getBatchSizeLimitBytes(){let e=await this._ensureServerInfo();return this.batchSizeBytesLimit??e?.batch_ingest_config?.size_limit_bytes??PV}async _getBatchSizeLimit(){let e=await this._ensureServerInfo();return this.batchSizeLimit??e?.batch_ingest_config?.size_limit??RV}async _getDatasetExamplesMultiPartSupport(){return(await this._ensureServerInfo()).instance_flags?.dataset_examples_multipart_enabled??!1}drainAutoBatchQueue({batchSizeLimitBytes:e,batchSizeLimit:r}){let n=[];for(;this.autoBatchQueue.items.length>0;){let[i,o]=this.autoBatchQueue.pop({upToSizeBytes:e,upToSize:r});if(!i.length){o();break}let a=i.reduce((u,l)=>{let p=l.apiUrl??this.apiUrl,f=l.apiKey??this.apiKey,h=l.apiKey===this.apiKey&&l.apiUrl===this.apiUrl?"default":`${p}|${f}`;return u[h]||(u[h]=[]),u[h].push(l),u},{}),s=[];for(let[u,l]of Object.entries(a)){let p=this._processBatch(l,{apiUrl:u==="default"?void 0:u.split("|")[0],apiKey:u==="default"?void 0:u.split("|")[1]});s.push(p)}let c=Promise.all(s).finally(o);n.push(c)}return Promise.all(n)}async _processBatch(e,r){if(!e.length)return;let n=e.reduce((i,o)=>i+(o.size??0),0);try{if(this.langSmithToOTELTranslator!==void 0)this._sendBatchToOTELTranslator(e);else{let i={runCreates:e.filter(s=>s.action==="create").map(s=>s.item),runUpdates:e.filter(s=>s.action==="update").map(s=>s.item)},o=await this._ensureServerInfo();if(!this._multipartDisabled&&(o?.batch_ingest_config?.use_multipart_endpoint??!0)){let s=o?.instance_flags?.gzip_body_enabled;try{await this.multipartIngestRuns(i,{...r,useGzip:s,sizeBytes:n})}catch(c){if(yb(c))this._multipartDisabled=!0,await this.batchIngestRuns(i,{...r,sizeBytes:n});else throw c}}else await this.batchIngestRuns(i,{...r,sizeBytes:n})}}catch(i){console.error("Error exporting batch:",i)}}_sendBatchToOTELTranslator(e){if(this.langSmithToOTELTranslator!==void 0){let r=new Map,n=[];for(let i of e)i.item.id&&i.otelContext&&(r.set(i.item.id,i.otelContext),i.action==="create"?n.push({operation:"post",id:i.item.id,trace_id:i.item.trace_id??i.item.id,run:i.item}):n.push({operation:"patch",id:i.item.id,trace_id:i.item.trace_id??i.item.id,run:i.item}));this.langSmithToOTELTranslator.exportBatch(n,r)}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.item=pN(e.item,this.cachedLSEnvVarsForMetadata,this.omitTracedRuntimeInfo);let r=this.autoBatchQueue.push(e);if(this.manualFlushMode)return r;let n=await this._getBatchSizeLimitBytes(),i=await this._getBatchSizeLimit();return(this.autoBatchQueue.sizeBytes>n||this.autoBatchQueue.items.length>i)&&this.drainAutoBatchQueue({batchSizeLimitBytes:n,batchSizeLimit:i}),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue({batchSizeLimitBytes:n,batchSizeLimit:i})},this.autoBatchAggregationDelayMs)),r}async _getServerInfo(){let r=await(await this.caller.call(async()=>{let n=await this._fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(NV),...this.fetchOptions});return await se(n,"get server info"),n})).json();return this.debug&&console.log(`
=== LangSmith Server Configuration ===
`+JSON.stringify(r,null,2)+`
`),r}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch(e){console.warn(`[LANGSMITH]: Failed to fetch info on supported operations. Falling back to batch operations and default limits. Info: ${e.status??"Unspecified status code"} ${e.message}`)}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){let e=await this._getBatchSizeLimitBytes(),r=await this._getBatchSizeLimit();await this.drainAutoBatchQueue({batchSizeLimitBytes:e,batchSizeLimit:r})}_cloneCurrentOTELContext(){let e=cm(),r=aC();if(this.langSmithToOTELTranslator!==void 0){let n=e.getActiveSpan();if(n)return e.setSpan(r.active(),n)}}async createRun(e,r){if(!this._filterForSampling([e]).length)return;let n={...this.headers,"Content-Type":"application/json"},i=e.project_name;delete e.project_name;let o=await this.prepareRunCreateOrUpdateInputs({session_name:i,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&o.trace_id!==void 0&&o.dotted_order!==void 0){let c=this._cloneCurrentOTELContext();this.processRunOperation({action:"create",item:o,otelContext:c,apiKey:r?.apiKey,apiUrl:r?.apiUrl}).catch(console.error);return}let a=pN(o,this.cachedLSEnvVarsForMetadata,this.omitTracedRuntimeInfo);r?.apiKey!==void 0&&(n["x-api-key"]=r.apiKey),r?.workspaceId!==void 0&&(n["x-tenant-id"]=r.workspaceId);let s=Lr(a,`Creating run with id: ${a.id}`);await this.caller.call(async()=>{let c=await this._fetch(`${r?.apiUrl??this.apiUrl}/runs`,{method:"POST",headers:n,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await se(c,"create run",!0),c})}async batchIngestRuns({runCreates:e,runUpdates:r},n){if(e===void 0&&r===void 0)return;let i=await Promise.all(e?.map(c=>this.prepareRunCreateOrUpdateInputs(c))??[]),o=await Promise.all(r?.map(c=>this.prepareRunCreateOrUpdateInputs(c))??[]);if(i.length>0&&o.length>0){let c=i.reduce((l,p)=>(p.id&&(l[p.id]=p),l),{}),u=[];for(let l of o)l.id!==void 0&&c[l.id]?c[l.id]={...c[l.id],...l}:u.push(l);i=Object.values(c),o=u}let a={post:i,patch:o};if(!a.post.length&&!a.patch.length)return;let s={post:[],patch:[]};for(let c of["post","patch"]){let u=c,l=a[u].reverse(),p=l.pop();for(;p!==void 0;)s[u].push(p),p=l.pop()}if(s.post.length>0||s.patch.length>0){let c=s.post.map(u=>u.id).concat(s.patch.map(u=>u.id)).join(",");await this._postBatchIngestRuns(Lr(s,`Ingesting runs with ids: ${c}`),n)}}async _postBatchIngestRuns(e,r){let n={...this.headers,"Content-Type":"application/json",Accept:"application/json"};r?.apiKey!==void 0&&(n["x-api-key"]=r.apiKey),await this.batchIngestCaller.callWithOptions({sizeBytes:r?.sizeBytes},async()=>{let i=await this._fetch(`${r?.apiUrl??this.apiUrl}/runs/batch`,{method:"POST",headers:n,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:e});return await se(i,"batch create run",!0),i})}async multipartIngestRuns({runCreates:e,runUpdates:r},n){if(e===void 0&&r===void 0)return;let i={},o=[];for(let p of e??[]){let f=await this.prepareRunCreateOrUpdateInputs(p);f.id!==void 0&&f.attachments!==void 0&&(i[f.id]=f.attachments),delete f.attachments,o.push(f)}let a=[];for(let p of r??[])a.push(await this.prepareRunCreateOrUpdateInputs(p));if(o.find(p=>p.trace_id===void 0||p.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(a.find(p=>p.trace_id===void 0||p.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(o.length>0&&a.length>0){let p=o.reduce((m,h)=>(h.id&&(m[h.id]=h),m),{}),f=[];for(let m of a)m.id!==void 0&&p[m.id]?p[m.id]={...p[m.id],...m}:f.push(m);o=Object.values(p),a=f}if(o.length===0&&a.length===0)return;let u=[],l=[];for(let[p,f]of[["post",o],["patch",a]])for(let m of f){let{inputs:h,outputs:g,events:x,extra:y,error:v,serialized:S,attachments:k,...T}=m,N={inputs:h,outputs:g,events:x,extra:y,error:v,serialized:S},U=Lr(T,`Serializing for multipart ingestion of run with id: ${T.id}`);l.push({name:`${p}.${T.id}`,payload:new Blob([U],{type:`application/json; length=${U.length}`})});for(let[w,V]of Object.entries(N)){if(V===void 0)continue;let F=Lr(V,`Serializing ${w} for multipart ingestion of run with id: ${T.id}`);l.push({name:`${p}.${T.id}.${w}`,payload:new Blob([F],{type:`application/json; length=${F.length}`})})}if(T.id!==void 0){let w=i[T.id];if(w){delete i[T.id];for(let[V,F]of Object.entries(w)){let R,ve;if(Array.isArray(F)?[R,ve]=F:(R=F.mimeType,ve=F.data),V.includes(".")){console.warn(`Skipping attachment '${V}' for run ${T.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}l.push({name:`attachment.${T.id}.${V}`,payload:new Blob([ve],{type:`${R}; length=${ve.byteLength}`})})}}}u.push(`trace=${T.trace_id},id=${T.id}`)}await this._sendMultipartRequest(l,u.join("; "),n)}async _createNodeFetchBody(e,r){let n=[];for(let a of e)n.push(new Blob([`--${r}\r
`])),n.push(new Blob([`Content-Disposition: form-data; name="${a.name}"\r
`,`Content-Type: ${a.payload.type}\r
\r
`])),n.push(a.payload),n.push(new Blob([`\r
`]));return n.push(new Blob([`--${r}--\r
`])),await new Blob(n).arrayBuffer()}async _createMultipartStream(e,r){let n=new TextEncoder;return new ReadableStream({async start(o){let a=async s=>{typeof s=="string"?o.enqueue(n.encode(s)):o.enqueue(s)};for(let s of e){await a(`--${r}\r
`),await a(`Content-Disposition: form-data; name="${s.name}"\r
`),await a(`Content-Type: ${s.payload.type}\r
\r
`);let u=s.payload.stream().getReader();try{let l;for(;!(l=await u.read()).done;)o.enqueue(l.value)}finally{u.releaseLock()}await a(`\r
`)}await a(`--${r}--\r
`),o.close()}})}async _sendMultipartRequest(e,r,n){let i="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),o=QO(),a=()=>this._createNodeFetchBody(e,i),s=()=>this._createMultipartStream(e,i),c=async u=>this.batchIngestCaller.callWithOptions({sizeBytes:n?.sizeBytes},async()=>{let l=await u(),p={...this.headers,"Content-Type":`multipart/form-data; boundary=${i}`};n?.apiKey!==void 0&&(p["x-api-key"]=n.apiKey);let f=l;n?.useGzip&&typeof l=="object"&&"pipeThrough"in l&&(f=l.pipeThrough(new CompressionStream("gzip")),p["Content-Encoding"]="gzip");let m=await this._fetch(`${n?.apiUrl??this.apiUrl}/runs/multipart`,{method:"POST",headers:p,body:f,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await se(m,"Failed to send multipart request",!0),m});try{let u,l=!1;!o&&!this.multipartStreamingDisabled&&Cv()!=="bun"?(l=!0,u=await c(s)):u=await c(a),(!this.multipartStreamingDisabled||l)&&u.status===422&&(n?.apiUrl??this.apiUrl)!==fN&&(console.warn(`Streaming multipart upload to ${n?.apiUrl??this.apiUrl}/runs/multipart failed. This usually means the host does not support chunked uploads. Retrying with a buffered upload for operation "${r}".`),this.multipartStreamingDisabled=!0,u=await c(a))}catch(u){if(yb(u))throw u;console.warn(`${u.message.trim()}

Context: ${r}`)}}async updateRun(e,r,n){Se(e),r.inputs&&(r.inputs=await this.processInputs(r.inputs)),r.outputs&&(r.outputs=await this.processOutputs(r.outputs));let i={...r,id:e};if(!this._filterForSampling([i],!0).length)return;if(this.autoBatchTracing&&i.trace_id!==void 0&&i.dotted_order!==void 0){let s=this._cloneCurrentOTELContext();if(r.end_time!==void 0&&i.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:i,otelContext:s,apiKey:n?.apiKey,apiUrl:n?.apiUrl}).catch(console.error);return}else this.processRunOperation({action:"update",item:i,otelContext:s,apiKey:n?.apiKey,apiUrl:n?.apiUrl}).catch(console.error);return}let o={...this.headers,"Content-Type":"application/json"};n?.apiKey!==void 0&&(o["x-api-key"]=n.apiKey),n?.workspaceId!==void 0&&(o["x-tenant-id"]=n.workspaceId);let a=Lr(r,`Serializing payload to update run with id: ${e}`);await this.caller.call(async()=>{let s=await this._fetch(`${n?.apiUrl??this.apiUrl}/runs/${e}`,{method:"PATCH",headers:o,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await se(s,"update run",!0),s})}async readRun(e,{loadChildRuns:r}={loadChildRuns:!1}){Se(e);let n=await this._get(`/runs/${e}`);return r&&(n=await this._loadChildRuns(n)),n}async getRunUrl({runId:e,run:r,projectOpts:n}){if(r!==void 0){let i;r.session_id?i=r.session_id:n?.projectName?i=(await this.readProject({projectName:n?.projectName})).id:n?.projectId?i=n?.projectId:i=(await this.readProject({projectName:Ot("PROJECT")||"default"})).id;let o=await this._getTenantId();return`${this.getHostUrl()}/o/${o}/projects/p/${i}/r/${r.id}?poll=true`}else if(e!==void 0){let i=await this.readRun(e);if(!i.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${i.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){let r=await OV(this.listRuns({isRoot:!1,projectId:e.session_id,traceId:e.trace_id})),n={},i={};r.sort((o,a)=>(o?.dotted_order??"").localeCompare(a?.dotted_order??""));for(let o of r){if(o.parent_run_id===null||o.parent_run_id===void 0)throw new Error(`Child run ${o.id} has no parent`);o.dotted_order?.startsWith(e.dotted_order??"")&&o.id!==e.id&&(o.parent_run_id in n||(n[o.parent_run_id]=[]),n[o.parent_run_id].push(o),i[o.id]=o)}e.child_runs=n[e.id]||[];for(let o in n)o!==e.id&&(i[o].child_runs=n[o]);return e}async*listRuns(e){let{projectId:r,projectName:n,parentRunId:i,traceId:o,referenceExampleId:a,startTime:s,executionOrder:c,isRoot:u,runType:l,error:p,id:f,query:m,filter:h,traceFilter:g,treeFilter:x,limit:y,select:v,order:S}=e,k=[];if(r&&(k=Array.isArray(r)?r:[r]),n){let w=Array.isArray(n)?n:[n],V=await Promise.all(w.map(F=>this.readProject({projectName:F}).then(R=>R.id)));k.push(...V)}let T=["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],N={session:k.length?k:null,run_type:l,reference_example:a,query:m,filter:h,trace_filter:g,tree_filter:x,execution_order:c,parent_run:i,start_time:s?s.toISOString():null,error:p,id:f,limit:y,trace:o,select:v||T,is_root:u,order:S};N.select.includes("child_run_ids")&&cp("Deprecated: 'child_run_ids' in the listRuns select parameter is deprecated and will be removed in a future version.");let U=0;for await(let w of this._getCursorPaginatedList("/runs/query",N))if(y){if(U>=y)break;if(w.length+U>y){yield*w.slice(0,y-U);break}U+=w.length,yield*w}else yield*w}async*listGroupRuns(e){let{projectId:r,projectName:n,groupBy:i,filter:o,startTime:a,endTime:s,limit:c,offset:u}=e,p={session_id:r||(await this.readProject({projectName:n})).id,group_by:i,filter:o,start_time:a?a.toISOString():null,end_time:s?s.toISOString():null,limit:Number(c)||100},f=Number(u)||0,m="/runs/group",h=`${this.apiUrl}${m}`;for(;;){let g={...p,offset:f},x=Object.fromEntries(Object.entries(g).filter(([N,U])=>U!==void 0)),y=JSON.stringify(x),S=await(await this.caller.call(async()=>{let N=await this._fetch(h,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:y});return await se(N,`Failed to fetch ${m}`),N})).json(),{groups:k,total:T}=S;if(k.length===0)break;for(let N of k)yield N;if(f+=k.length,f>=T)break}}async getRunStats({id:e,trace:r,parentRun:n,runType:i,projectNames:o,projectIds:a,referenceExampleIds:s,startTime:c,endTime:u,error:l,query:p,filter:f,traceFilter:m,treeFilter:h,isRoot:g,dataSourceType:x}){let y=a||[];o&&(y=[...a||[],...await Promise.all(o.map(U=>this.readProject({projectName:U}).then(w=>w.id)))]);let S=Object.fromEntries(Object.entries({id:e,trace:r,parent_run:n,run_type:i,session:y,reference_example:s,start_time:c,end_time:u,error:l,query:p,filter:f,trace_filter:m,tree_filter:h,is_root:g,data_source_type:x}).filter(([U,w])=>w!==void 0)),k=JSON.stringify(S);return await(await this.caller.call(async()=>{let U=await this._fetch(`${this.apiUrl}/runs/stats`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:k});return await se(U,"get run stats"),U})).json()}async shareRun(e,{shareId:r}={}){let n={run_id:e,share_token:r||Dr()};Se(e);let i=JSON.stringify(n),a=await(await this.caller.call(async()=>{let s=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await se(s,"share run"),s})).json();if(a===null||!("share_token"in a))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){Se(e),await this.caller.call(async()=>{let r=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await se(r,"unshare run",!0),r})}async readRunSharedLink(e){Se(e);let n=await(await this.caller.call(async()=>{let i=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await se(i,"read run shared link"),i})).json();if(!(n===null||!("share_token"in n)))return`${this.getHostUrl()}/public/${n.share_token}/r`}async listSharedRuns(e,{runIds:r}={}){let n=new URLSearchParams({share_token:e});if(r!==void 0)for(let a of r)n.append("id",a);return Se(e),await(await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/public/${e}/runs${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await se(a,"list shared runs"),a})).json()}async readDatasetSharedSchema(e,r){if(!e&&!r)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:r})).id),Se(e);let i=await(await this.caller.call(async()=>{let o=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await se(o,"read dataset shared schema"),o})).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async shareDataset(e,r){if(!e&&!r)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:r})).id);let n={dataset_id:e};Se(e);let i=JSON.stringify(n),a=await(await this.caller.call(async()=>{let s=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await se(s,"share dataset"),s})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(e){Se(e),await this.caller.call(async()=>{let r=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await se(r,"unshare dataset",!0),r})}async readSharedDataset(e){return Se(e),await(await this.caller.call(async()=>{let i=await this._fetch(`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await se(i,"read shared dataset"),i})).json()}async listSharedExamples(e,r){let n={};r?.exampleIds&&(n.id=r.exampleIds);let i=new URLSearchParams;Object.entries(n).forEach(([s,c])=>{Array.isArray(c)?c.forEach(u=>i.append(s,u)):i.append(s,c)});let o=await this.caller.call(async()=>{let s=await this._fetch(`${this.apiUrl}/public/${e}/examples?${i.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await se(s,"list shared examples"),s}),a=await o.json();if(!o.ok)throw"detail"in a?new Error(`Failed to list shared examples.
Status: ${o.status}
Message: ${Array.isArray(a.detail)?a.detail.join(`
`):"Unspecified error"}`):new Error(`Failed to list shared examples: ${o.status} ${o.statusText}`);return a.map(s=>({...s,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:r=null,metadata:n=null,upsert:i=!1,projectExtra:o=null,referenceDatasetId:a=null}){let s=i?"?upsert=true":"",c=`${this.apiUrl}/sessions${s}`,u=o||{};n&&(u.metadata=n);let l={name:e,extra:u,description:r};a!==null&&(l.reference_dataset_id=a);let p=JSON.stringify(l);return await(await this.caller.call(async()=>{let h=await this._fetch(c,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:p});return await se(h,"create project"),h})).json()}async updateProject(e,{name:r=null,description:n=null,metadata:i=null,projectExtra:o=null,endTime:a=null}){let s=`${this.apiUrl}/sessions/${e}`,c=o;i&&(c={...c||{},metadata:i});let u=JSON.stringify({name:r,extra:c,description:n,end_time:a?new Date(a).toISOString():null});return await(await this.caller.call(async()=>{let f=await this._fetch(s,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await se(f,"update project"),f})).json()}async hasProject({projectId:e,projectName:r}){let n="/sessions",i=new URLSearchParams;if(e!==void 0&&r!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)Se(e),n+=`/${e}`;else if(r!==void 0)i.append("name",r);else throw new Error("Must provide projectName or projectId");let o=await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}${n}?${i}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await se(a,"has project"),a});try{let a=await o.json();return o.ok?Array.isArray(a)?a.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:r,includeStats:n}){let i="/sessions",o=new URLSearchParams;if(e!==void 0&&r!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)Se(e),i+=`/${e}`;else if(r!==void 0)o.append("name",r);else throw new Error("Must provide projectName or projectId");n!==void 0&&o.append("include_stats",n.toString());let a=await this._get(i,o),s;if(Array.isArray(a)){if(a.length===0)throw new Error(`Project[id=${e}, name=${r}] not found`);s=a[0]}else s=a;return s}async getProjectUrl({projectId:e,projectName:r}){if(e===void 0&&r===void 0)throw new Error("Must provide either projectName or projectId");let n=await this.readProject({projectId:e,projectName:r}),i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${n.id}`}async getDatasetUrl({datasetId:e,datasetName:r}){if(e===void 0&&r===void 0)throw new Error("Must provide either datasetName or datasetId");let n=await this.readDataset({datasetId:e,datasetName:r}),i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/datasets/${n.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;let e=new URLSearchParams({limit:"1"});for await(let r of this._getPaginated("/sessions",e))return this._tenantId=r[0].tenant_id,r[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:r,nameContains:n,referenceDatasetId:i,referenceDatasetName:o,includeStats:a,datasetVersion:s,referenceFree:c,metadata:u}={}){let l=new URLSearchParams;if(e!==void 0)for(let p of e)l.append("id",p);if(r!==void 0&&l.append("name",r),n!==void 0&&l.append("name_contains",n),i!==void 0)l.append("reference_dataset",i);else if(o!==void 0){let p=await this.readDataset({datasetName:o});l.append("reference_dataset",p.id)}a!==void 0&&l.append("include_stats",a.toString()),s!==void 0&&l.append("dataset_version",s),c!==void 0&&l.append("reference_free",c.toString()),u!==void 0&&l.append("metadata",JSON.stringify(u));for await(let p of this._getPaginated("/sessions",l))yield*p}async deleteProject({projectId:e,projectName:r}){let n;if(e===void 0&&r===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&r!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?n=(await this.readProject({projectName:r})).id:n=e,Se(n),await this.caller.call(async()=>{let i=await this._fetch(`${this.apiUrl}/sessions/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await se(i,`delete session ${n} (${r})`,!0),i})}async uploadCsv({csvFile:e,fileName:r,inputKeys:n,outputKeys:i,description:o,dataType:a,name:s}){let c=`${this.apiUrl}/datasets/upload`,u=new FormData;return u.append("file",e,r),n.forEach(f=>{u.append("input_keys",f)}),i.forEach(f=>{u.append("output_keys",f)}),o&&u.append("description",o),a&&u.append("data_type",a),s&&u.append("name",s),await(await this.caller.call(async()=>{let f=await this._fetch(c,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await se(f,"upload CSV"),f})).json()}async createDataset(e,{description:r,dataType:n,inputsSchema:i,outputsSchema:o,metadata:a}={}){let s={name:e,description:r,extra:a?{metadata:a}:void 0};n&&(s.data_type=n),i&&(s.inputs_schema_definition=i),o&&(s.outputs_schema_definition=o);let c=JSON.stringify(s);return await(await this.caller.call(async()=>{let p=await this._fetch(`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:c});return await se(p,"create dataset"),p})).json()}async readDataset({datasetId:e,datasetName:r}){let n="/datasets",i=new URLSearchParams({limit:"1"});if(e&&r)throw new Error("Must provide either datasetName or datasetId, not both");if(e)Se(e),n+=`/${e}`;else if(r)i.append("name",r);else throw new Error("Must provide datasetName or datasetId");let o=await this._get(n,i),a;if(Array.isArray(o)){if(o.length===0)throw new Error(`Dataset[id=${e}, name=${r}] not found`);a=o[0]}else a=o;return a}async hasDataset({datasetId:e,datasetName:r}){try{return await this.readDataset({datasetId:e,datasetName:r}),!0}catch(n){if(n instanceof Error&&n.message.toLocaleLowerCase().includes("not found"))return!1;throw n}}async diffDatasetVersions({datasetId:e,datasetName:r,fromVersion:n,toVersion:i}){let o=e;if(o===void 0&&r===void 0)throw new Error("Must provide either datasetName or datasetId");if(o!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");o===void 0&&(o=(await this.readDataset({datasetName:r})).id);let a=new URLSearchParams({from_version:typeof n=="string"?n:n.toISOString(),to_version:typeof i=="string"?i:i.toISOString()});return await this._get(`/datasets/${o}/versions/diff`,a)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:r}){let n="/datasets";if(e===void 0)if(r!==void 0)e=(await this.readDataset({datasetName:r})).id;else throw new Error("Must provide either datasetName or datasetId");return(await(await this._getResponse(`${n}/${e}/openai_ft`)).text()).trim().split(`
`).map(s=>JSON.parse(s))}async*listDatasets({limit:e=100,offset:r=0,datasetIds:n,datasetName:i,datasetNameContains:o,metadata:a}={}){let s="/datasets",c=new URLSearchParams({limit:e.toString(),offset:r.toString()});if(n!==void 0)for(let u of n)c.append("id",u);i!==void 0&&c.append("name",i),o!==void 0&&c.append("name_contains",o),a!==void 0&&c.append("metadata",JSON.stringify(a));for await(let u of this._getPaginated(s,c))yield*u}async updateDataset(e){let{datasetId:r,datasetName:n,...i}=e;if(!r&&!n)throw new Error("Must provide either datasetName or datasetId");let o=r??(await this.readDataset({datasetName:n})).id;Se(o);let a=JSON.stringify(i);return await(await this.caller.call(async()=>{let c=await this._fetch(`${this.apiUrl}/datasets/${o}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await se(c,"update dataset"),c})).json()}async updateDatasetTag(e){let{datasetId:r,datasetName:n,asOf:i,tag:o}=e;if(!r&&!n)throw new Error("Must provide either datasetName or datasetId");let a=r??(await this.readDataset({datasetName:n})).id;Se(a);let s=JSON.stringify({as_of:typeof i=="string"?i:i.toISOString(),tag:o});await this.caller.call(async()=>{let c=await this._fetch(`${this.apiUrl}/datasets/${a}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await se(c,"update dataset tags",!0),c})}async deleteDataset({datasetId:e,datasetName:r}){let n="/datasets",i=e;if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(r!==void 0&&(i=(await this.readDataset({datasetName:r})).id),i!==void 0)Se(i),n+=`/${i}`;else throw new Error("Must provide datasetName or datasetId");await this.caller.call(async()=>{let o=await this._fetch(this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await se(o,`delete ${n}`,!0),o})}async indexDataset({datasetId:e,datasetName:r,tag:n}){let i=e;if(!i&&!r)throw new Error("Must provide either datasetName or datasetId");if(i&&r)throw new Error("Must provide either datasetName or datasetId, not both");i||(i=(await this.readDataset({datasetName:r})).id),Se(i);let a=JSON.stringify({tag:n});await(await this.caller.call(async()=>{let c=await this._fetch(`${this.apiUrl}/datasets/${i}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await se(c,"index dataset"),c})).json()}async similarExamples(e,r,n,{filter:i}={}){let o={limit:n,inputs:e};i!==void 0&&(o.filter=i),Se(r);let a=JSON.stringify(o);return(await(await this.caller.call(async()=>{let u=await this._fetch(`${this.apiUrl}/datasets/${r}/search`,{headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,method:"POST",body:a});return await se(u,"fetch similar examples"),u})).json()).examples}async createExample(e,r,n){if(mN(e)&&(r!==void 0||n!==void 0))throw new Error("Cannot provide outputs or options when using ExampleCreate object");let i=r?n?.datasetId:e.dataset_id,o=r?n?.datasetName:e.dataset_name;if(i===void 0&&o===void 0)throw new Error("Must provide either datasetName or datasetId");if(i!==void 0&&o!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");i===void 0&&(i=(await this.readDataset({datasetName:o})).id);let a=(r?n?.createdAt:e.created_at)||new Date,s;mN(e)?s=e:s={inputs:e,outputs:r,created_at:a?.toISOString(),id:n?.exampleId,metadata:n?.metadata,split:n?.split,source_run_id:n?.sourceRunId,use_source_run_io:n?.useSourceRunIO,use_source_run_attachments:n?.useSourceRunAttachments,attachments:n?.attachments};let c=await this._uploadExamplesMultipart(i,[s]);return await this.readExample(c.example_ids?.[0]??Dr())}async createExamples(e){if(Array.isArray(e)){if(e.length===0)return[];let v=e,S=v[0].dataset_id,k=v[0].dataset_name;if(S===void 0&&k===void 0)throw new Error("Must provide either datasetName or datasetId");if(S!==void 0&&k!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");S===void 0&&(S=(await this.readDataset({datasetName:k})).id);let T=await this._uploadExamplesMultipart(S,v);return await Promise.all(T.example_ids.map(U=>this.readExample(U)))}let{inputs:r,outputs:n,metadata:i,splits:o,sourceRunIds:a,useSourceRunIOs:s,useSourceRunAttachments:c,attachments:u,exampleIds:l,datasetId:p,datasetName:f}=e;if(r===void 0)throw new Error("Must provide inputs when using legacy parameters");let m=p,h=f;if(m===void 0&&h===void 0)throw new Error("Must provide either datasetName or datasetId");if(m!==void 0&&h!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");m===void 0&&(m=(await this.readDataset({datasetName:h})).id);let g=r.map((v,S)=>({dataset_id:m,inputs:v,outputs:n?.[S],metadata:i?.[S],split:o?.[S],id:l?.[S],attachments:u?.[S],source_run_id:a?.[S],use_source_run_io:s?.[S],use_source_run_attachments:c?.[S]})),x=await this._uploadExamplesMultipart(m,g);return await Promise.all(x.example_ids.map(v=>this.readExample(v)))}async createLLMExample(e,r,n){return this.createExample({input:e},{output:r},n)}async createChatExample(e,r,n){let i=e.map(a=>Wv(a)?Jv(a):a),o=Wv(r)?Jv(r):r;return this.createExample({input:i},{output:o},n)}async readExample(e){Se(e);let r=`/examples/${e}`,n=await this._get(r),{attachment_urls:i,...o}=n,a=o;return i&&(a.attachments=Object.entries(i).reduce((s,[c,u])=>(s[c.slice(11)]={presigned_url:u.presigned_url,mime_type:u.mime_type},s),{})),a}async*listExamples({datasetId:e,datasetName:r,exampleIds:n,asOf:i,splits:o,inlineS3Urls:a,metadata:s,limit:c,offset:u,filter:l,includeAttachments:p}={}){let f;if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)f=e;else if(r!==void 0)f=(await this.readDataset({datasetName:r})).id;else throw new Error("Must provide a datasetName or datasetId");let m=new URLSearchParams({dataset:f}),h=i?typeof i=="string"?i:i?.toISOString():void 0;h&&m.append("as_of",h);let g=a??!0;if(m.append("inline_s3_urls",g.toString()),n!==void 0)for(let y of n)m.append("id",y);if(o!==void 0)for(let y of o)m.append("splits",y);if(s!==void 0){let y=JSON.stringify(s);m.append("metadata",y)}c!==void 0&&m.append("limit",c.toString()),u!==void 0&&m.append("offset",u.toString()),l!==void 0&&m.append("filter",l),p===!0&&["attachment_urls","outputs","metadata"].forEach(y=>m.append("select",y));let x=0;for await(let y of this._getPaginated("/examples",m)){for(let v of y){let{attachment_urls:S,...k}=v,T=k;S&&(T.attachments=Object.entries(S).reduce((N,[U,w])=>(N[U.slice(11)]={presigned_url:w.presigned_url,mime_type:w.mime_type||void 0},N),{})),yield T,x++}if(c!==void 0&&x>=c)break}}async deleteExample(e){Se(e);let r=`/examples/${e}`;await this.caller.call(async()=>{let n=await this._fetch(this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await se(n,`delete ${r}`,!0),n})}async deleteExamples(e,r){if(e.forEach(n=>Se(n)),r?.hardDelete){let n=this._getPlatformEndpointPath("datasets/examples/delete");await this.caller.call(async()=>{let i=await this._fetch(`${this.apiUrl}${n}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({example_ids:e,hard_delete:!0}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await se(i,"hard delete examples",!0),i})}else{let n=new URLSearchParams;e.forEach(i=>n.append("example_ids",i)),await this.caller.call(async()=>{let i=await this._fetch(`${this.apiUrl}/examples?${n.toString()}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await se(i,"delete examples",!0),i})}}async updateExample(e,r){let n;r?n=e:n=e.id,Se(n);let i;r?i={id:n,...r}:i=e;let o;return i.dataset_id!==void 0?o=i.dataset_id:o=(await this.readExample(n)).dataset_id,this._updateExamplesMultipart(o,[i])}async updateExamples(e){let r;return e[0].dataset_id===void 0?r=(await this.readExample(e[0].id)).dataset_id:r=e[0].dataset_id,this._updateExamplesMultipart(r,e)}async readDatasetVersion({datasetId:e,datasetName:r,asOf:n,tag:i}){let o;if(e?o=e:o=(await this.readDataset({datasetName:r})).id,Se(o),n&&i||!n&&!i)throw new Error("Exactly one of asOf and tag must be specified.");let a=new URLSearchParams;return n!==void 0&&a.append("as_of",typeof n=="string"?n:n.toISOString()),i!==void 0&&a.append("tag",i),await(await this.caller.call(async()=>{let c=await this._fetch(`${this.apiUrl}/datasets/${o}/version?${a.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await se(c,"read dataset version"),c})).json()}async listDatasetSplits({datasetId:e,datasetName:r,asOf:n}){let i;if(e===void 0&&r===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?i=(await this.readDataset({datasetName:r})).id:i=e,Se(i);let o=new URLSearchParams,a=n?typeof n=="string"?n:n?.toISOString():void 0;return a&&o.append("as_of",a),await this._get(`/datasets/${i}/splits`,o)}async updateDatasetSplits({datasetId:e,datasetName:r,splitName:n,exampleIds:i,remove:o=!1}){let a;if(e===void 0&&r===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&r!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?a=(await this.readDataset({datasetName:r})).id:a=e,Se(a);let s={split_name:n,examples:i.map(u=>(Se(u),u)),remove:o},c=JSON.stringify(s);await this.caller.call(async()=>{let u=await this._fetch(`${this.apiUrl}/datasets/${a}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:c});return await se(u,"update dataset splits",!0),u})}async createFeedback(e,r,{score:n,value:i,correction:o,comment:a,sourceInfo:s,feedbackSourceType:c="api",sourceRunId:u,feedbackId:l,feedbackConfig:p,projectId:f,comparativeExperimentId:m}){if(!e&&!f)throw new Error("One of runId or projectId must be provided");if(e&&f)throw new Error("Only one of runId or projectId can be provided");let h={type:c??"api",metadata:s??{}};u!==void 0&&h?.metadata!==void 0&&!h.metadata.__run&&(h.metadata.__run={run_id:u}),h?.metadata!==void 0&&h.metadata.__run?.run_id!==void 0&&Se(h.metadata.__run.run_id);let g={id:l??Dr(),run_id:e,key:r,score:dN(n),value:i,correction:o,comment:a,feedback_source:h,comparative_experiment_id:m,feedbackConfig:p,session_id:f},x=JSON.stringify(g),y=`${this.apiUrl}/feedback`;return await this.caller.call(async()=>{let v=await this._fetch(y,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:x});return await se(v,"create feedback",!0),v}),g}async updateFeedback(e,{score:r,value:n,correction:i,comment:o}){let a={};r!=null&&(a.score=dN(r)),n!=null&&(a.value=n),i!=null&&(a.correction=i),o!=null&&(a.comment=o),Se(e);let s=JSON.stringify(a);await this.caller.call(async()=>{let c=await this._fetch(`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await se(c,"update feedback",!0),c})}async readFeedback(e){Se(e);let r=`/feedback/${e}`;return await this._get(r)}async deleteFeedback(e){Se(e);let r=`/feedback/${e}`;await this.caller.call(async()=>{let n=await this._fetch(this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await se(n,`delete ${r}`,!0),n})}async*listFeedback({runIds:e,feedbackKeys:r,feedbackSourceTypes:n}={}){let i=new URLSearchParams;if(e)for(let o of e)Se(o),i.append("run",o);if(r)for(let o of r)i.append("key",o);if(n)for(let o of n)i.append("source",o);for await(let o of this._getPaginated("/feedback",i))yield*o}async createPresignedFeedbackToken(e,r,{expiration:n,feedbackConfig:i}={}){let o={run_id:e,feedback_key:r,feedback_config:i};n?typeof n=="string"?o.expires_at=n:(n?.hours||n?.minutes||n?.days)&&(o.expires_in=n):o.expires_in={hours:3};let a=JSON.stringify(o);return await(await this.caller.call(async()=>{let c=await this._fetch(`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await se(c,"create presigned feedback token"),c})).json()}async createComparativeExperiment({name:e,experimentIds:r,referenceDatasetId:n,createdAt:i,description:o,metadata:a,id:s}){if(r.length===0)throw new Error("At least one experiment is required");if(n||(n=(await this.readProject({projectId:r[0]})).reference_dataset_id),!n==null)throw new Error("A reference dataset is required");let c={id:s,name:e,experiment_ids:r,reference_dataset_id:n,description:o,created_at:(i??new Date)?.toISOString(),extra:{}};a&&(c.extra.metadata=a);let u=JSON.stringify(c);return(await this.caller.call(async()=>{let p=await this._fetch(`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await se(p,"create comparative experiment"),p})).json()}async*listPresignedFeedbackTokens(e){Se(e);let r=new URLSearchParams({run_id:e});for await(let n of this._getPaginated("/feedback/tokens",r))yield*n}_selectEvalResults(e){let r;return"results"in e?r=e.results:Array.isArray(e)?r=e:r=[e],r}async _logEvaluationFeedback(e,r,n){let i=this._selectEvalResults(e),o=[];for(let a of i){let s=n||{};a.evaluatorInfo&&(s={...a.evaluatorInfo,...s});let c=null;a.targetRunId?c=a.targetRunId:r&&(c=r.id),o.push(await this.createFeedback(c,a.key,{score:a.score,value:a.value,comment:a.comment,correction:a.correction,sourceInfo:s,sourceRunId:a.sourceRunId,feedbackConfig:a.feedbackConfig,feedbackSourceType:"model"}))}return[i,o]}async logEvaluationFeedback(e,r,n){let[i]=await this._logEvaluationFeedback(e,r,n);return i}async*listAnnotationQueues(e={}){let{queueIds:r,name:n,nameContains:i,limit:o}=e,a=new URLSearchParams;r&&r.forEach((c,u)=>{Se(c,`queueIds[${u}]`),a.append("ids",c)}),n&&a.append("name",n),i&&a.append("name_contains",i),a.append("limit",(o!==void 0?Math.min(o,100):100).toString());let s=0;for await(let c of this._getPaginated("/annotation-queues",a))if(yield*c,s++,o!==void 0&&s>=o)break}async createAnnotationQueue(e){let{name:r,description:n,queueId:i,rubricInstructions:o}=e,a={name:r,description:n,id:i||Dr(),rubric_instructions:o},s=JSON.stringify(Object.fromEntries(Object.entries(a).filter(([u,l])=>l!==void 0)));return(await this.caller.call(async()=>{let u=await this._fetch(`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await se(u,"create annotation queue"),u})).json()}async readAnnotationQueue(e){return(await this.caller.call(async()=>{let n=await this._fetch(`${this.apiUrl}/annotation-queues/${Se(e,"queueId")}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await se(n,"read annotation queue"),n})).json()}async updateAnnotationQueue(e,r){let{name:n,description:i,rubricInstructions:o}=r,a=JSON.stringify({name:n,description:i,rubric_instructions:o});await this.caller.call(async()=>{let s=await this._fetch(`${this.apiUrl}/annotation-queues/${Se(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await se(s,"update annotation queue",!0),s})}async deleteAnnotationQueue(e){await this.caller.call(async()=>{let r=await this._fetch(`${this.apiUrl}/annotation-queues/${Se(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await se(r,"delete annotation queue",!0),r})}async addRunsToAnnotationQueue(e,r){let n=JSON.stringify(r.map((i,o)=>Se(i,`runIds[${o}]`).toString()));await this.caller.call(async()=>{let i=await this._fetch(`${this.apiUrl}/annotation-queues/${Se(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await se(i,"add runs to annotation queue",!0),i})}async getRunFromAnnotationQueue(e,r){let n=`/annotation-queues/${Se(e,"queueId")}/run`;return(await this.caller.call(async()=>{let o=await this._fetch(`${this.apiUrl}${n}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await se(o,"get run from annotation queue"),o})).json()}async deleteRunFromAnnotationQueue(e,r){await this.caller.call(async()=>{let n=await this._fetch(`${this.apiUrl}/annotation-queues/${Se(e,"queueId")}/runs/${Se(r,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await se(n,"delete run from annotation queue",!0),n})}async getSizeFromAnnotationQueue(e){return(await this.caller.call(async()=>{let n=await this._fetch(`${this.apiUrl}/annotation-queues/${Se(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await se(n,"get size from annotation queue"),n})).json()}async _currentTenantIsOwner(e){let r=await this._getSettings();return e=="-"||r.tenant_handle===e}async _ownerConflictError(e,r){let n=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${n.tenant_handle}

      Requested tenant: ${r}`)}async _getLatestCommitHash(e){let n=await(await this.caller.call(async()=>{let i=await this._fetch(`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await se(i,"get latest commit hash"),i})).json();if(n.commits.length!==0)return n.commits[0].commit_hash}async _likeOrUnlikePrompt(e,r){let[n,i,o]=lo(e),a=JSON.stringify({like:r});return(await this.caller.call(async()=>{let c=await this._fetch(`${this.apiUrl}/likes/${n}/${i}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await se(c,`${r?"like":"unlike"} prompt`),c})).json()}async _getPromptUrl(e){let[r,n,i]=lo(e);if(await this._currentTenantIsOwner(r)){let o=await this._getSettings();return i!=="latest"?`${this.getHostUrl()}/prompts/${n}/${i.substring(0,8)}?organizationId=${o.id}`:`${this.getHostUrl()}/prompts/${n}?organizationId=${o.id}`}else return i!=="latest"?`${this.getHostUrl()}/hub/${r}/${n}/${i.substring(0,8)}`:`${this.getHostUrl()}/hub/${r}/${n}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(let r of this._getPaginated(`/commits/${e}/`,new URLSearchParams,n=>n.commits))yield*r}async*listPrompts(e){let r=new URLSearchParams;r.append("sort_field",e?.sortField??"updated_at"),r.append("sort_direction","desc"),r.append("is_archived",(!!e?.isArchived).toString()),e?.isPublic!==void 0&&r.append("is_public",e.isPublic.toString()),e?.query&&r.append("query",e.query);for await(let n of this._getPaginated("/repos",r,i=>i.repos))yield*n}async getPrompt(e){let[r,n,i]=lo(e),a=await(await this.caller.call(async()=>{let s=await this._fetch(`${this.apiUrl}/repos/${r}/${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return s?.status===404?null:(await se(s,"get prompt"),s)}))?.json();return a?.repo?a.repo:null}async createPrompt(e,r){let n=await this._getSettings();if(r?.isPublic&&!n.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle.
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);let[i,o,a]=lo(e);if(!await this._currentTenantIsOwner(i))throw await this._ownerConflictError("create a prompt",i);let s={repo_handle:o,...r?.description&&{description:r.description},...r?.readme&&{readme:r.readme},...r?.tags&&{tags:r.tags},is_public:!!r?.isPublic},c=JSON.stringify(s),u=await this.caller.call(async()=>{let p=await this._fetch(`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:c});return await se(p,"create prompt"),p}),{repo:l}=await u.json();return l}async createCommit(e,r,n){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");let[i,o,a]=lo(e),s=n?.parentCommitHash==="latest"||!n?.parentCommitHash?await this._getLatestCommitHash(`${i}/${o}`):n?.parentCommitHash,c={manifest:JSON.parse(JSON.stringify(r)),parent_commit:s},u=JSON.stringify(c),p=await(await this.caller.call(async()=>{let f=await this._fetch(`${this.apiUrl}/commits/${i}/${o}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await se(f,"create commit"),f})).json();return this._getPromptUrl(`${i}/${o}${p.commit_hash?`:${p.commit_hash}`:""}`)}async updateExamplesMultipart(e,r=[]){return this._updateExamplesMultipart(e,r)}async _updateExamplesMultipart(e,r=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let n=new FormData;for(let a of r){let s=a.id,c={...a.metadata&&{metadata:a.metadata},...a.split&&{split:a.split}},u=Lr(c,`Serializing body for example with id: ${s}`),l=new Blob([u],{type:"application/json"});if(n.append(s,l),a.inputs){let p=Lr(a.inputs,`Serializing inputs for example with id: ${s}`),f=new Blob([p],{type:"application/json"});n.append(`${s}.inputs`,f)}if(a.outputs){let p=Lr(a.outputs,`Serializing outputs whle updating example with id: ${s}`),f=new Blob([p],{type:"application/json"});n.append(`${s}.outputs`,f)}if(a.attachments)for(let[p,f]of Object.entries(a.attachments)){let m,h;Array.isArray(f)?[m,h]=f:(m=f.mimeType,h=f.data);let g=new Blob([h],{type:`${m}; length=${h.byteLength}`});n.append(`${s}.attachment.${p}`,g)}if(a.attachments_operations){let p=Lr(a.attachments_operations,`Serializing attachments while updating example with id: ${s}`),f=new Blob([p],{type:"application/json"});n.append(`${s}.attachments_operations`,f)}}let i=e??r[0]?.dataset_id;return(await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${i}/examples`)}`,{method:"PATCH",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await se(a,"update examples"),a})).json()}async uploadExamplesMultipart(e,r=[]){return this._uploadExamplesMultipart(e,r)}async _uploadExamplesMultipart(e,r=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let n=new FormData;for(let o of r){let a=(o.id??Dr()).toString(),s={created_at:o.created_at,...o.metadata&&{metadata:o.metadata},...o.split&&{split:o.split},...o.source_run_id&&{source_run_id:o.source_run_id},...o.use_source_run_io&&{use_source_run_io:o.use_source_run_io},...o.use_source_run_attachments&&{use_source_run_attachments:o.use_source_run_attachments}},c=Lr(s,`Serializing body for uploaded example with id: ${a}`),u=new Blob([c],{type:"application/json"});if(n.append(a,u),o.inputs){let l=Lr(o.inputs,`Serializing inputs for uploaded example with id: ${a}`),p=new Blob([l],{type:"application/json"});n.append(`${a}.inputs`,p)}if(o.outputs){let l=Lr(o.outputs,`Serializing outputs for uploaded example with id: ${a}`),p=new Blob([l],{type:"application/json"});n.append(`${a}.outputs`,p)}if(o.attachments)for(let[l,p]of Object.entries(o.attachments)){let f,m;Array.isArray(p)?[f,m]=p:(f=p.mimeType,m=p.data);let h=new Blob([m],{type:`${f}; length=${m.byteLength}`});n.append(`${a}.attachment.${l}`,h)}}return(await this.caller.call(async()=>{let o=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${e}/examples`)}`,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await se(o,"upload examples"),o})).json()}async updatePrompt(e,r){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");let[n,i]=lo(e);if(!await this._currentTenantIsOwner(n))throw await this._ownerConflictError("update a prompt",n);let o={};if(r?.description!==void 0&&(o.description=r.description),r?.readme!==void 0&&(o.readme=r.readme),r?.tags!==void 0&&(o.tags=r.tags),r?.isPublic!==void 0&&(o.is_public=r.isPublic),r?.isArchived!==void 0&&(o.is_archived=r.isArchived),Object.keys(o).length===0)throw new Error("No valid update options provided");let a=JSON.stringify(o);return(await this.caller.call(async()=>{let c=await this._fetch(`${this.apiUrl}/repos/${n}/${i}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await se(c,"update prompt"),c})).json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");let[r,n,i]=lo(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("delete a prompt",r);return(await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/repos/${r}/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await se(a,"delete prompt"),a})).json()}_getPromptCacheKey(e,r){return`${e}${r?":with_model":""}`}async _fetchPromptFromApi(e,r){let[n,i,o]=lo(e),s=await(await this.caller.call(async()=>{let c=await this._fetch(`${this.apiUrl}/commits/${n}/${i}/${o}${r?.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await se(c,"pull prompt commit"),c})).json();return{owner:n,repo:i,commit_hash:s.commit_hash,manifest:s.manifest,examples:s.examples}}async pullPromptCommit(e,r){if(!r?.skipCache&&this._cache){let n=this._getPromptCacheKey(e,r?.includeModel),i=this._cache.get(n);if(i)return i;let o=await this._fetchPromptFromApi(e,r);return this._cache.set(n,o),o}return this._fetchPromptFromApi(e,r)}async _pullPrompt(e,r){let n=await this.pullPromptCommit(e,{includeModel:r?.includeModel,skipCache:r?.skipCache});return JSON.stringify(n.manifest)}async pushPrompt(e,r){return await this.promptExists(e)?r&&Object.keys(r).some(i=>i!=="object")&&await this.updatePrompt(e,{description:r?.description,readme:r?.readme,tags:r?.tags,isPublic:r?.isPublic}):await this.createPrompt(e,{description:r?.description,readme:r?.readme,tags:r?.tags,isPublic:r?.isPublic}),r?.object?await this.createCommit(e,r?.object,{parentCommitHash:r?.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,r={}){let{sourceApiUrl:n=this.apiUrl,datasetName:i}=r,[o,a]=this.parseTokenOrUrl(e,n),s=new t({apiUrl:o,apiKey:"placeholder"}),c=await s.readSharedDataset(a),u=i||c.name;try{if(await this.hasDataset({datasetId:u})){console.log(`Dataset ${u} already exists in your tenant. Skipping.`);return}}catch{}let l=await s.listSharedExamples(a),p=await this.createDataset(u,{description:c.description,dataType:c.data_type||"kv",inputsSchema:c.inputs_schema_definition??void 0,outputsSchema:c.outputs_schema_definition??void 0});try{await this.createExamples({inputs:l.map(f=>f.inputs),outputs:l.flatMap(f=>f.outputs?[f.outputs]:[]),datasetId:p.id})}catch(f){throw console.error(`An error occurred while creating dataset ${u}. You should delete it manually.`),f}}parseTokenOrUrl(e,r,n=2,i="dataset"){try{return Se(e),[r,e]}catch{}try{let a=new URL(e).pathname.split("/").filter(s=>s!=="");if(a.length>=n){let s=a[a.length-n];return[r,s]}else throw new Error(`Invalid public ${i} URL: ${e}`)}catch{throw new Error(`Invalid public ${i} URL or token: ${e}`)}}get cache(){return this._cache}cleanup(){this._cache&&this._cache.stop()}async awaitPendingTraceBatches(){if(this.manualFlushMode)return console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve();await new Promise(e=>setTimeout(e,1)),await Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()]),this.langSmithToOTELTranslator!==void 0&&await sC()?.DEFAULT_LANGSMITH_SPAN_PROCESSOR?.forceFlush()}};function mN(t){return"dataset_id"in t||"dataset_name"in t}var gN=t=>t!==void 0?t:!!["TRACING_V2","TRACING"].find(r=>Ot(r)==="true");var vi=Symbol.for("lc:context_variables");var Nm=Symbol.for("langsmith:replica_trace_roots");function xb(t,e){if(vi in t)return t[vi][e]}function _N(t,e,r){let n=vi in t?t[vi]:{};n[e]=r,t[vi]=n}var vp=36,bp="6ba7b810-9dad-11d1-80b4-00c04fd430c8";function yN(t){let r=Object.keys(t).sort().map(n=>`${n}:${t[n]??""}`).join("|");return yn(r,bp)}function MV(t){return t.replace(/[-:.]/g,"")}function bN(t,e=1){let r=e.toFixed(0).slice(0,3).padStart(3,"0");return`${new Date(t).toISOString().slice(0,-1)}${r}Z`}function Sb(t,e,r=1){let n=bN(t,r);return{dottedOrder:MV(n)+e,microsecondPrecisionDatestring:n}}var zV=new Set(["projectName","updates","reroot"]);function jV(t){let e={};for(let r of Object.keys(t))zV.has(r)&&(e[r]=t[r]);return e}var Rm=class t{constructor(e,r,n,i){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=r,this.project_name=n,this.replicas=i}static fromHeader(e){let r=e.split(","),n={},i=[],o,a;for(let s of r){let[c,u]=s.split("="),l=decodeURIComponent(u);c==="langsmith-metadata"?n=JSON.parse(l):c==="langsmith-tags"?i=l.split(","):c==="langsmith-project"?o=l:c==="langsmith-replicas"&&(a=JSON.parse(l).map(f=>Array.isArray(f)?f:jV(f)))}return new t(n,i,o,a)}toHeader(){let e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}},Bn=class t{constructor(e){if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"distributedParentId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_serialized_start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_awaitInputsOnPost",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),wN(e)){Object.assign(this,{...e});return}let r=t.getDefaultConfig(),{metadata:n,...i}=e,o=i.client??t.getSharedClient(),a={...n,...i?.extra?.metadata};if(i.extra={...i.extra,metadata:a},"id"in i&&i.id==null&&delete i.id,Object.assign(this,{...r,...i,client:o}),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),this.dotted_order||(this._serialized_start_time=bN(this.start_time,this.execution_order)),this.id||(this.id=im(this._serialized_start_time??this.start_time)),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.replicas=FV(this.replicas),!this.dotted_order){let{dottedOrder:s}=Sb(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+s:this.dotted_order=s}}set metadata(e){this.extra={...this.extra,metadata:{...this.extra?.metadata,...e}}}get metadata(){return this.extra?.metadata}static getDefaultConfig(){let e=Date.now();return{run_type:"chain",project_name:sp(),child_runs:[],api_url:Qr("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:Qr("LANGCHAIN_API_KEY"),caller_options:{},start_time:e,serialized:{},inputs:{},extra:{}}}static getSharedClient(){return t.sharedClient||(t.sharedClient=new uo),t.sharedClient}createChild(e){let r=this.child_execution_order+1,n=this.replicas?.map(l=>{let{reroot:p,...f}=l;return f}),i=e.replicas??n,o=new t({...e,parent_run:this,project_name:this.project_name,replicas:i,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:r,child_execution_order:r});vi in this&&(o[vi]=this[vi]);let a=Symbol.for("lc:child_config"),s=e.extra?.[a]??this.extra[a];if(LV(s)){let l={...s},p=DV(l.callbacks)?l.callbacks.copy?.():void 0;p&&(Object.assign(p,{_parentRunId:o.id}),p.handlers?.find(xN)?.updateFromRunTree?.(o),l.callbacks=p),o.extra[a]=l}let c=new Set,u=this;for(;u!=null&&!c.has(u.id);)c.add(u.id),u.child_execution_order=Math.max(u.child_execution_order,r),u=u.parent_run;return this.child_runs.push(o),o}async end(e,r,n=Date.now(),i){this.outputs=this.outputs??e,this.error=this.error??r,this.end_time=this.end_time??n,i&&Object.keys(i).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...i}}:{metadata:i})}_convertToCreate(e,r,n=!0){let i=e.extra??{};if(i?.runtime?.library===void 0&&(i.runtime||(i.runtime={}),r))for(let[s,c]of Object.entries(r))i.runtime[s]||(i.runtime[s]=c);let o,a;return n?(a=e.parent_run?.id??e.parent_run_id,o=[]):(o=e.child_runs.map(s=>this._convertToCreate(s,r,n)),a=void 0),{id:e.id,name:e.name,start_time:e._serialized_start_time??e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:i,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:o,parent_run_id:a,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments,events:e.events}}_sliceParentId(e,r){if(r.dotted_order){let n=r.dotted_order.split("."),i=null;for(let o=0;o<n.length;o++)if(n[o].slice(-vp)===e){i=o;break}if(i!==null){let o=n.slice(i+1);r.dotted_order=o.join("."),o.length>0?r.trace_id=o[0].slice(-vp):r.trace_id=r.id}}r.parent_run_id===e&&(r.parent_run_id=void 0)}_setReplicaTraceRoot(e,r){let n=xb(this,Nm)??{};n[e]=r,_N(this,Nm,n);for(let i of this.child_runs)i._setReplicaTraceRoot(e,r)}_remapForProject(e){let{projectName:r,runtimeEnv:n,excludeChildRuns:i=!0,reroot:o=!1,distributedParentId:a,apiUrl:s,apiKey:c,workspaceId:u}=e,l=this._convertToCreate(this,n,i);if(r===this.project_name)return{...l,session_name:r};if(o){if(a)this._sliceParentId(a,l);else if(l.parent_run_id=void 0,l.dotted_order){let v=l.dotted_order.split(".");v.length>0&&(l.dotted_order=v[v.length-1],l.trace_id=l.id)}let y=yN({projectName:r,apiUrl:s,apiKey:c,workspaceId:u});this._setReplicaTraceRoot(y,l.id)}let p;if(!o){let y=xb(this,Nm)??{},v=yN({projectName:r,apiUrl:s,apiKey:c,workspaceId:u});if(p=y[v],p&&(l.trace_id=p,l.dotted_order)){let S=l.dotted_order.split("."),k=null;for(let T=0;T<S.length;T++)if(S[T].slice(-vp)===p){k=T;break}if(k!==null){let T=S.slice(k);l.dotted_order=T.join(".")}}}let f=l.id,m=yn(`${f}:${r}`,bp),h;l.trace_id?h=yn(`${l.trace_id}:${r}`,bp):h=m;let g;l.parent_run_id&&(g=yn(`${l.parent_run_id}:${r}`,bp));let x;return l.dotted_order&&(x=l.dotted_order.split(".").map(S=>{let k=S.slice(-vp),T=yn(`${k}:${r}`,bp);return S.slice(0,-vp)+T}).join(".")),{...l,id:m,trace_id:h,parent_run_id:g,dotted_order:x,session_name:r}}async postRun(e=!0){this._awaitInputsOnPost&&(this.inputs=await this.inputs);try{let r=am();if(this.replicas&&this.replicas.length>0)for(let{projectName:n,apiKey:i,apiUrl:o,workspaceId:a,reroot:s}of this.replicas){let c=this._remapForProject({projectName:n??this.project_name,runtimeEnv:r,excludeChildRuns:!0,reroot:s,distributedParentId:this.distributedParentId,apiUrl:o,apiKey:i,workspaceId:a});await this.client.createRun(c,{apiKey:i,apiUrl:o,workspaceId:a})}else{let n=this._convertToCreate(this,r,e);await this.client.createRun(n)}if(!e){cp("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(let n of this.child_runs)await n.postRun(!1)}this.child_runs=[]}catch(r){console.error(`Error in postRun for run ${this.id}:`,r)}}async patchRun(e){if(this.replicas&&this.replicas.length>0)for(let{projectName:r,apiKey:n,apiUrl:i,workspaceId:o,updates:a,reroot:s}of this.replicas){let c=this._remapForProject({projectName:r??this.project_name,runtimeEnv:void 0,excludeChildRuns:!0,reroot:s,distributedParentId:this.distributedParentId,apiUrl:i,apiKey:n,workspaceId:o}),u={id:c.id,name:c.name,run_type:c.run_type,start_time:c.start_time,outputs:c.outputs,error:c.error,parent_run_id:c.parent_run_id,session_name:c.session_name,reference_example_id:c.reference_example_id,end_time:c.end_time,dotted_order:c.dotted_order,trace_id:c.trace_id,events:c.events,tags:c.tags,extra:c.extra,attachments:this.attachments,...a};e?.excludeInputs||(u.inputs=c.inputs),await this.client.updateRun(c.id,u,{apiKey:n,apiUrl:i,workspaceId:o})}else try{let r={name:this.name,run_type:this.run_type,start_time:this._serialized_start_time??this.start_time,end_time:this.end_time,error:this.error,outputs:this.outputs,parent_run_id:this.parent_run?.id??this.parent_run_id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};e?.excludeInputs||(r.inputs=this.inputs),await this.client.updateRun(this.id,r)}catch(r){console.error(`Error in patchRun for run ${this.id}`,r)}this.child_runs=[]}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),typeof e=="string"?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,r){let n=e?.callbacks,i,o,a,s=gN();if(n){let u=n?.getParentRunId?.()??"",l=n?.handlers?.find(p=>p?.name=="langchain_tracer");i=l?.getRun?.(u),o=l?.projectName,a=l?.client,s=s||!!l}return i?new t({name:i.name,id:i.id,trace_id:i.trace_id,dotted_order:i.dotted_order,client:a,tracingEnabled:s,project_name:o,tags:[...new Set((i?.tags??[]).concat(e?.tags??[]))],extra:{metadata:{...i?.extra?.metadata,...e?.metadata}}}).createChild(r):new t({...r,client:a,tracingEnabled:s,project_name:o})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,r){let n="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,i=n["langsmith-trace"];if(!i||typeof i!="string")return;let o=i.trim(),a=o.split(".").map(l=>{let[p,f]=l.split("Z");return{strTime:p,time:Date.parse(p+"Z"),uuid:f}}),s=a[0].uuid,c={...r,name:r?.name??"parent",run_type:r?.run_type??"chain",start_time:r?.start_time??Date.now(),id:a.at(-1)?.uuid,trace_id:s,dotted_order:o};if(n.baggage&&typeof n.baggage=="string"){let l=Rm.fromHeader(n.baggage);c.metadata=l.metadata,c.tags=l.tags,c.project_name=l.project_name,c.replicas=l.replicas}let u=new t(c);return u.distributedParentId=u.id,u}toHeaders(e){let r={"langsmith-trace":this.dotted_order,baggage:new Rm(this.extra?.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(e)for(let[n,i]of Object.entries(r))e.set(n,i);return r}};Object.defineProperty(Bn,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function wN(t){return t!=null&&typeof t.createChild=="function"&&typeof t.postRun=="function"}function xN(t){return typeof t=="object"&&t!=null&&typeof t.name=="string"&&t.name==="langchain_tracer"}function vN(t){return Array.isArray(t)&&t.some(e=>xN(e))}function DV(t){return typeof t=="object"&&t!=null&&Array.isArray(t.handlers)}function LV(t){let e=t?.callbacks;return t!=null&&typeof e=="object"&&(vN(e?.handlers)||vN(e))}function UV(){let t=Qr("LANGSMITH_RUNS_ENDPOINTS");if(!t)return[];try{let e=JSON.parse(t);if(Array.isArray(e)){let r=[];for(let n of e){if(typeof n!="object"||n===null){console.warn(`Invalid item type in LANGSMITH_RUNS_ENDPOINTS: expected object, got ${typeof n}`);continue}if(typeof n.api_url!="string"){console.warn(`Invalid api_url type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof n.api_url}`);continue}if(typeof n.api_key!="string"){console.warn(`Invalid api_key type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof n.api_key}`);continue}r.push({apiUrl:n.api_url.replace(/\/$/,""),apiKey:n.api_key})}return r}else if(typeof e=="object"&&e!==null){BV(e);let r=[];for(let[n,i]of Object.entries(e)){let o=n.replace(/\/$/,"");if(typeof i=="string")r.push({apiUrl:o,apiKey:i});else{console.warn(`Invalid value type in LANGSMITH_RUNS_ENDPOINTS for URL ${n}: expected string, got ${typeof i}`);continue}}return r}else return console.warn(`Invalid LANGSMITH_RUNS_ENDPOINTS \u2013 must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey, got ${typeof e}`),[]}catch(e){if(cN(e))throw e;return console.warn("Invalid LANGSMITH_RUNS_ENDPOINTS \u2013 must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey"),[]}}function FV(t){return t?t.map(e=>Array.isArray(e)?{projectName:e[0],updates:e[1]}:e):UV()}function BV(t){if(Object.keys(t).length>0&&Ot("ENDPOINT"))throw new $m}var Eb={};z(Eb,{BaseTracer:()=>Jt,isBaseTracer:()=>as});var VV=t=>{if(t)return t.events=t.events??[],t.child_runs=t.child_runs??[],t};function kb(t,e){if(t)return new Bn({...t,start_time:t._serialized_start_time??t.start_time,parent_run:kb(e),child_runs:t.child_runs.map(r=>kb(r)).filter(r=>r!==void 0),extra:{...t.extra,runtime:mv()},tracingEnabled:!1})}function Ib(t,e){return t&&!Array.isArray(t)&&typeof t=="object"?t:{[e]:t}}function as(t){return typeof t._addRunToRunMap=="function"}var Jt=class extends co{constructor(e){super(...arguments);d(this,"runMap",new Map);d(this,"runTreeMap",new Map);d(this,"usesRunTreeMap",!1)}copy(){return this}getRunById(e){if(e!==void 0)return this.usesRunTreeMap?VV(this.runTreeMap.get(e)):this.runMap.get(e)}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,r){e.child_runs.push(r)}_addRunToRunMap(e){let{dottedOrder:r,microsecondPrecisionDatestring:n}=Sb(new Date(e.start_time).getTime(),e.id,e.execution_order),i={...e},o=this.getRunById(i.parent_run_id);if(i.parent_run_id!==void 0?o?(this._addChildRun(o,i),o.child_execution_order=Math.max(o.child_execution_order,i.child_execution_order),i.trace_id=o.trace_id,o.dotted_order!==void 0&&(i.dotted_order=[o.dotted_order,r].join("."),i._serialized_start_time=n)):i.parent_run_id=void 0:(i.trace_id=i.id,i.dotted_order=r,i._serialized_start_time=n),this.usesRunTreeMap){let a=kb(i,o);a!==void 0&&this.runTreeMap.set(i.id,a)}else this.runMap.set(i.id,i);return i}async _endTrace(e){let r=e.parent_run_id!==void 0&&this.getRunById(e.parent_run_id);r?r.child_execution_order=Math.max(r.child_execution_order,e.child_execution_order):await this.persistRun(e),await this.onRunUpdate?.(e),this.usesRunTreeMap?this.runTreeMap.delete(e.id):this.runMap.delete(e.id)}_getExecutionOrder(e){let r=e!==void 0&&this.getRunById(e);return r?r.child_execution_order+1:1}_createRunForLLMStart(e,r,n,i,o,a,s,c){let u=this._getExecutionOrder(i),l=Date.now(),p=s?{...o,metadata:s}:o,f={id:n,name:c??e.id[e.id.length-1],parent_run_id:i,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{prompts:r},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:p??{},tags:a||[]};return this._addRunToRunMap(f)}async handleLLMStart(e,r,n,i,o,a,s,c){let u=this.getRunById(n)??this._createRunForLLMStart(e,r,n,i,o,a,s,c);return await this.onRunCreate?.(u),await this.onLLMStart?.(u),u}_createRunForChatModelStart(e,r,n,i,o,a,s,c){let u=this._getExecutionOrder(i),l=Date.now(),p=s?{...o,metadata:s}:o,f={id:n,name:c??e.id[e.id.length-1],parent_run_id:i,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{messages:r},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:p??{},tags:a||[]};return this._addRunToRunMap(f)}async handleChatModelStart(e,r,n,i,o,a,s,c){let u=this.getRunById(n)??this._createRunForChatModelStart(e,r,n,i,o,a,s,c);return await this.onRunCreate?.(u),await this.onLLMStart?.(u),u}async handleLLMEnd(e,r,n,i,o){let a=this.getRunById(r);if(!a||a?.run_type!=="llm")throw new Error("No LLM run to end.");return a.end_time=Date.now(),a.outputs=e,a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),a.extra={...a.extra,...o},await this.onLLMEnd?.(a),await this._endTrace(a),a}async handleLLMError(e,r,n,i,o){let a=this.getRunById(r);if(!a||a?.run_type!=="llm")throw new Error("No LLM run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),a.extra={...a.extra,...o},await this.onLLMError?.(a),await this._endTrace(a),a}_createRunForChainStart(e,r,n,i,o,a,s,c,u){let l=this._getExecutionOrder(i),p=Date.now(),f={id:n,name:c??e.id[e.id.length-1],parent_run_id:i,start_time:p,serialized:e,events:[{name:"start",time:new Date(p).toISOString()}],inputs:r,execution_order:l,child_execution_order:l,run_type:s??"chain",child_runs:[],extra:a?{...u,metadata:a}:{...u},tags:o||[]};return this._addRunToRunMap(f)}async handleChainStart(e,r,n,i,o,a,s,c){let u=this.getRunById(n)??this._createRunForChainStart(e,r,n,i,o,a,s,c);return await this.onRunCreate?.(u),await this.onChainStart?.(u),u}async handleChainEnd(e,r,n,i,o){let a=this.getRunById(r);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.outputs=Ib(e,"output"),a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),o?.inputs!==void 0&&(a.inputs=Ib(o.inputs,"input")),await this.onChainEnd?.(a),await this._endTrace(a),a}async handleChainError(e,r,n,i,o){let a=this.getRunById(r);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),o?.inputs!==void 0&&(a.inputs=Ib(o.inputs,"input")),await this.onChainError?.(a),await this._endTrace(a),a}_createRunForToolStart(e,r,n,i,o,a,s){let c=this._getExecutionOrder(i),u=Date.now(),l={id:n,name:s??e.id[e.id.length-1],parent_run_id:i,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{input:r},execution_order:c,child_execution_order:c,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:o||[]};return this._addRunToRunMap(l)}async handleToolStart(e,r,n,i,o,a,s){let c=this.getRunById(n)??this._createRunForToolStart(e,r,n,i,o,a,s);return await this.onRunCreate?.(c),await this.onToolStart?.(c),c}async handleToolEnd(e,r){let n=this.getRunById(r);if(!n||n?.run_type!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await this.onToolEnd?.(n),await this._endTrace(n),n}async handleToolError(e,r){let n=this.getRunById(r);if(!n||n?.run_type!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await this.onToolError?.(n),await this._endTrace(n),n}async handleAgentAction(e,r){let n=this.getRunById(r);if(!n||n?.run_type!=="chain")return;let i=n;i.actions=i.actions||[],i.actions.push(e),i.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentAction?.(n)}async handleAgentEnd(e,r){let n=this.getRunById(r);!n||n?.run_type!=="chain"||(n.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentEnd?.(n))}_createRunForRetrieverStart(e,r,n,i,o,a,s){let c=this._getExecutionOrder(i),u=Date.now(),l={id:n,name:s??e.id[e.id.length-1],parent_run_id:i,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{query:r},execution_order:c,child_execution_order:c,run_type:"retriever",child_runs:[],extra:a?{metadata:a}:{},tags:o||[]};return this._addRunToRunMap(l)}async handleRetrieverStart(e,r,n,i,o,a,s){let c=this.getRunById(n)??this._createRunForRetrieverStart(e,r,n,i,o,a,s);return await this.onRunCreate?.(c),await this.onRetrieverStart?.(c),c}async handleRetrieverEnd(e,r){let n=this.getRunById(r);if(!n||n?.run_type!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await this.onRetrieverEnd?.(n),await this._endTrace(n),n}async handleRetrieverError(e,r){let n=this.getRunById(r);if(!n||n?.run_type!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await this.onRetrieverError?.(n),await this._endTrace(n),n}async handleText(e,r){let n=this.getRunById(r);!n||n?.run_type!=="chain"||(n.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await this.onText?.(n))}async handleLLMNewToken(e,r,n,i,o,a){let s=this.getRunById(n);if(!s||s?.run_type!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return s.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:r,chunk:a?.chunk}}),await this.onLLMNewToken?.(s,e,{chunk:a?.chunk}),s}};var Ab=Wo(EN(),1);var Tb={};z(Tb,{ConsoleCallbackHandler:()=>Mm});function wr(t,e){return`${t.open}${e}${t.close}`}function xn(t,e){try{return JSON.stringify(t,null,2)}catch{return e}}function AN(t){return typeof t=="string"?t.trim():t==null?t:xn(t,t.toString())}function na(t){if(!t.end_time)return"";let e=t.end_time-t.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}var{color:Ur}=Ab.default,Mm=class extends Jt{constructor(){super(...arguments);d(this,"name","console_callback_handler")}persistRun(e){return Promise.resolve()}getParents(e){let r=[],n=e;for(;n.parent_run_id;){let i=this.runMap.get(n.parent_run_id);if(i)r.push(i),n=i;else break}return r}getBreadcrumbs(e){let n=[...this.getParents(e).reverse(),e].map((i,o,a)=>{let s=`${i.execution_order}:${i.run_type}:${i.name}`;return o===a.length-1?wr(Ab.default.bold,s):s}).join(" > ");return wr(Ur.grey,n)}onChainStart(e){let r=this.getBreadcrumbs(e);console.log(`${wr(Ur.green,"[chain/start]")} [${r}] Entering Chain run with input: ${xn(e.inputs,"[inputs]")}`)}onChainEnd(e){let r=this.getBreadcrumbs(e);console.log(`${wr(Ur.cyan,"[chain/end]")} [${r}] [${na(e)}] Exiting Chain run with output: ${xn(e.outputs,"[outputs]")}`)}onChainError(e){let r=this.getBreadcrumbs(e);console.log(`${wr(Ur.red,"[chain/error]")} [${r}] [${na(e)}] Chain run errored with error: ${xn(e.error,"[error]")}`)}onLLMStart(e){let r=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map(i=>i.trim())}:e.inputs;console.log(`${wr(Ur.green,"[llm/start]")} [${r}] Entering LLM run with input: ${xn(n,"[inputs]")}`)}onLLMEnd(e){let r=this.getBreadcrumbs(e);console.log(`${wr(Ur.cyan,"[llm/end]")} [${r}] [${na(e)}] Exiting LLM run with output: ${xn(e.outputs,"[response]")}`)}onLLMError(e){let r=this.getBreadcrumbs(e);console.log(`${wr(Ur.red,"[llm/error]")} [${r}] [${na(e)}] LLM run errored with error: ${xn(e.error,"[error]")}`)}onToolStart(e){let r=this.getBreadcrumbs(e);console.log(`${wr(Ur.green,"[tool/start]")} [${r}] Entering Tool run with input: "${AN(e.inputs.input)}"`)}onToolEnd(e){let r=this.getBreadcrumbs(e);console.log(`${wr(Ur.cyan,"[tool/end]")} [${r}] [${na(e)}] Exiting Tool run with output: "${AN(e.outputs?.output)}"`)}onToolError(e){let r=this.getBreadcrumbs(e);console.log(`${wr(Ur.red,"[tool/error]")} [${r}] [${na(e)}] Tool run errored with error: ${xn(e.error,"[error]")}`)}onRetrieverStart(e){let r=this.getBreadcrumbs(e);console.log(`${wr(Ur.green,"[retriever/start]")} [${r}] Entering Retriever run with input: ${xn(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){let r=this.getBreadcrumbs(e);console.log(`${wr(Ur.cyan,"[retriever/end]")} [${r}] [${na(e)}] Exiting Retriever run with output: ${xn(e.outputs,"[outputs]")}`)}onRetrieverError(e){let r=this.getBreadcrumbs(e);console.log(`${wr(Ur.red,"[retriever/error]")} [${r}] [${na(e)}] Retriever run errored with error: ${xn(e.error,"[error]")}`)}onAgentAction(e){let r=e,n=this.getBreadcrumbs(e);console.log(`${wr(Ur.blue,"[agent/action]")} [${n}] Agent selected action: ${xn(r.actions[r.actions.length-1],"[action]")}`)}};var $b,zm=()=>{if($b===void 0){let t=ft("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};$b=new uo(t)}return $b};var Cb=class{getStore(){}run(e,r){return r()}},Ob=Symbol.for("ls:tracing_async_local_storage"),GV=new Cb,Pb=class{getInstance(){return globalThis[Ob]??GV}initializeGlobalInstance(e){globalThis[Ob]===void 0&&(globalThis[Ob]=e)}},HV=new Pb;function TN(t=!1){let e=HV.getInstance().getStore();if(!t&&e===void 0)throw new Error(`Could not get the current run tree.

Please make sure you are calling this method within a traceable function and that tracing is enabled.`);return e}function jm(t){return typeof t=="function"&&"langsmith:traceable"in t}var Nb={};z(Nb,{LangChainTracer:()=>wp});function qV(t){let e;for(let r of t)for(let n of r)Ue.isInstance(n.message)&&n.message.usage_metadata!==void 0&&(e=Mc(e,n.message.usage_metadata));return e}var wp=class $N extends Jt{constructor(r={}){super(r);d(this,"name","langchain_tracer");d(this,"projectName");d(this,"exampleId");d(this,"client");d(this,"replicas");d(this,"usesRunTreeMap",!0);let{exampleId:n,projectName:i,client:o,replicas:a}=r;this.projectName=i??sp(),this.replicas=a,this.exampleId=n,this.client=o??zm();let s=$N.getTraceableRunTree();s&&this.updateFromRunTree(s)}async persistRun(r){}async onRunCreate(r){r.extra?.lc_defers_inputs||await this.getRunTreeWithTracingConfig(r.id)?.postRun()}async onRunUpdate(r){let n=this.getRunTreeWithTracingConfig(r.id);r.extra?.lc_defers_inputs?await n?.postRun():await n?.patchRun()}onLLMEnd(r){let n=r.outputs;if(n?.generations){let i=qV(n.generations);if(i!==void 0){r.extra=r.extra??{};let o=r.extra.metadata??{};o.usage_metadata=i,r.extra.metadata=o}}}getRun(r){return this.runTreeMap.get(r)}updateFromRunTree(r){this.runTreeMap.set(r.id,r);let n=r,i=new Set;for(;n.parent_run&&!(i.has(n.id)||(i.add(n.id),!n.parent_run));)n=n.parent_run;i.clear();let o=[n];for(;o.length>0;){let a=o.shift();!a||i.has(a.id)||(i.add(a.id),this.runTreeMap.set(a.id,a),a.child_runs&&o.push(...a.child_runs))}this.client=r.client??this.client,this.replicas=r.replicas??this.replicas,this.projectName=r.project_name??this.projectName,this.exampleId=r.reference_example_id??this.exampleId}getRunTreeWithTracingConfig(r){let n=this.runTreeMap.get(r);if(n)return new Bn({...n,client:this.client,project_name:this.projectName,replicas:this.replicas,reference_example_id:this.exampleId,tracingEnabled:!0})}static getTraceableRunTree(){try{return TN(!0)}catch{return}}};var Dm=Wo(hm(),1),ss;function KV(){let t="default"in Dm.default?Dm.default.default:Dm.default;return new t({autoStart:!0,concurrency:1})}function WV(){return typeof ss>"u"&&(ss=KV()),ss}async function yt(t,e){if(e===!0){let r=Xo();r!==void 0?await r.run(void 0,async()=>t()):await t()}else ss=WV(),ss.add(async()=>{let r=Xo();r!==void 0?await r.run(void 0,async()=>t()):await t()})}async function ON(){let t=zm();await Promise.allSettled([typeof ss<"u"?ss.onIdle():Promise.resolve(),t.awaitPendingTraceBatches()])}var Rb={};z(Rb,{awaitAllCallbacks:()=>ON,consumeCallback:()=>yt});var CN=t=>t!==void 0?t:!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(r=>ft(r)==="true");function Mb(t){let e=Xo();return e===void 0?void 0:e.getStore()?.[Jo]?.[t]}var JV=Symbol("lc:configure_hooks"),PN=()=>Mb(JV)||[];var jb={};z(jb,{BaseCallbackManager:()=>NN,BaseRunManager:()=>Sp,CallbackManager:()=>Et,CallbackManagerForChainRun:()=>MN,CallbackManagerForLLMRun:()=>zb,CallbackManagerForRetrieverRun:()=>RN,CallbackManagerForToolRun:()=>zN,ensureHandler:()=>Lc,parseCallbackConfigArg:()=>cs});function cs(t){return t?Array.isArray(t)||"name"in t?{callbacks:t}:t:{}}var NN=class{setHandler(t){return this.setHandlers([t])}},Sp=class{constructor(t,e,r,n,i,o,a,s){this.runId=t,this.handlers=e,this.inheritableHandlers=r,this.tags=n,this.inheritableTags=i,this.metadata=o,this.inheritableMetadata=a,this._parentRunId=s}get parentRunId(){return this._parentRunId}async handleText(t){await Promise.all(this.handlers.map(e=>yt(async()=>{try{await e.handleText?.(t,this.runId,this._parentRunId,this.tags)}catch(r){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleText: ${r}`),e.raiseError)throw r}},e.awaitHandlers)))}async handleCustomEvent(t,e,r,n,i){await Promise.all(this.handlers.map(o=>yt(async()=>{try{await o.handleCustomEvent?.(t,e,this.runId,this.tags,this.metadata)}catch(a){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleCustomEvent: ${a}`),o.raiseError)throw a}},o.awaitHandlers)))}},RN=class extends Sp{getChild(t){let e=new Et(this.runId);return e.setHandlers(this.inheritableHandlers),e.addTags(this.inheritableTags),e.addMetadata(this.inheritableMetadata),t&&e.addTags([t],!1),e}async handleRetrieverEnd(t){await Promise.all(this.handlers.map(e=>yt(async()=>{if(!e.ignoreRetriever)try{await e.handleRetrieverEnd?.(t,this.runId,this._parentRunId,this.tags)}catch(r){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleRetriever`),e.raiseError)throw r}},e.awaitHandlers)))}async handleRetrieverError(t){await Promise.all(this.handlers.map(e=>yt(async()=>{if(!e.ignoreRetriever)try{await e.handleRetrieverError?.(t,this.runId,this._parentRunId,this.tags)}catch(r){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleRetrieverError: ${r}`),e.raiseError)throw t}},e.awaitHandlers)))}},zb=class extends Sp{async handleLLMNewToken(t,e,r,n,i,o){await Promise.all(this.handlers.map(a=>yt(async()=>{if(!a.ignoreLLM)try{await a.handleLLMNewToken?.(t,e??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,o)}catch(s){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMNewToken: ${s}`),a.raiseError)throw s}},a.awaitHandlers)))}async handleLLMError(t,e,r,n,i){await Promise.all(this.handlers.map(o=>yt(async()=>{if(!o.ignoreLLM)try{await o.handleLLMError?.(t,this.runId,this._parentRunId,this.tags,i)}catch(a){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleLLMError: ${a}`),o.raiseError)throw a}},o.awaitHandlers)))}async handleLLMEnd(t,e,r,n,i){await Promise.all(this.handlers.map(o=>yt(async()=>{if(!o.ignoreLLM)try{await o.handleLLMEnd?.(t,this.runId,this._parentRunId,this.tags,i)}catch(a){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleLLMEnd: ${a}`),o.raiseError)throw a}},o.awaitHandlers)))}},MN=class extends Sp{getChild(t){let e=new Et(this.runId);return e.setHandlers(this.inheritableHandlers),e.addTags(this.inheritableTags),e.addMetadata(this.inheritableMetadata),t&&e.addTags([t],!1),e}async handleChainError(t,e,r,n,i){await Promise.all(this.handlers.map(o=>yt(async()=>{if(!o.ignoreChain)try{await o.handleChainError?.(t,this.runId,this._parentRunId,this.tags,i)}catch(a){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleChainError: ${a}`),o.raiseError)throw a}},o.awaitHandlers)))}async handleChainEnd(t,e,r,n,i){await Promise.all(this.handlers.map(o=>yt(async()=>{if(!o.ignoreChain)try{await o.handleChainEnd?.(t,this.runId,this._parentRunId,this.tags,i)}catch(a){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleChainEnd: ${a}`),o.raiseError)throw a}},o.awaitHandlers)))}async handleAgentAction(t){await Promise.all(this.handlers.map(e=>yt(async()=>{if(!e.ignoreAgent)try{await e.handleAgentAction?.(t,this.runId,this._parentRunId,this.tags)}catch(r){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleAgentAction: ${r}`),e.raiseError)throw r}},e.awaitHandlers)))}async handleAgentEnd(t){await Promise.all(this.handlers.map(e=>yt(async()=>{if(!e.ignoreAgent)try{await e.handleAgentEnd?.(t,this.runId,this._parentRunId,this.tags)}catch(r){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleAgentEnd: ${r}`),e.raiseError)throw r}},e.awaitHandlers)))}},zN=class extends Sp{getChild(t){let e=new Et(this.runId);return e.setHandlers(this.inheritableHandlers),e.addTags(this.inheritableTags),e.addMetadata(this.inheritableMetadata),t&&e.addTags([t],!1),e}async handleToolError(t){await Promise.all(this.handlers.map(e=>yt(async()=>{if(!e.ignoreAgent)try{await e.handleToolError?.(t,this.runId,this._parentRunId,this.tags)}catch(r){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleToolError: ${r}`),e.raiseError)throw r}},e.awaitHandlers)))}async handleToolEnd(t){await Promise.all(this.handlers.map(e=>yt(async()=>{if(!e.ignoreAgent)try{await e.handleToolEnd?.(t,this.runId,this._parentRunId,this.tags)}catch(r){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleToolEnd: ${r}`),e.raiseError)throw r}},e.awaitHandlers)))}},Et=class xp extends NN{constructor(r,n){super();d(this,"handlers",[]);d(this,"inheritableHandlers",[]);d(this,"tags",[]);d(this,"inheritableTags",[]);d(this,"metadata",{});d(this,"inheritableMetadata",{});d(this,"name","callback_manager");d(this,"_parentRunId");this.handlers=n?.handlers??this.handlers,this.inheritableHandlers=n?.inheritableHandlers??this.inheritableHandlers,this.tags=n?.tags??this.tags,this.inheritableTags=n?.inheritableTags??this.inheritableTags,this.metadata=n?.metadata??this.metadata,this.inheritableMetadata=n?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=r}getParentRunId(){return this._parentRunId}async handleLLMStart(r,n,i=void 0,o=void 0,a=void 0,s=void 0,c=void 0,u=void 0){return Promise.all(n.map(async(l,p)=>{let f=p===0&&i?i:vn();return await Promise.all(this.handlers.map(m=>{if(!m.ignoreLLM)return as(m)&&m._createRunForLLMStart(r,[l],f,this._parentRunId,a,this.tags,this.metadata,u),yt(async()=>{try{await m.handleLLMStart?.(r,[l],f,this._parentRunId,a,this.tags,this.metadata,u)}catch(h){if((m.raiseError?console.error:console.warn)(`Error in handler ${m.constructor.name}, handleLLMStart: ${h}`),m.raiseError)throw h}},m.awaitHandlers)})),new zb(f,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(r,n,i=void 0,o=void 0,a=void 0,s=void 0,c=void 0,u=void 0){return Promise.all(n.map(async(l,p)=>{let f=p===0&&i?i:vn();return await Promise.all(this.handlers.map(m=>{if(!m.ignoreLLM)return as(m)&&m._createRunForChatModelStart(r,[l],f,this._parentRunId,a,this.tags,this.metadata,u),yt(async()=>{try{if(m.handleChatModelStart)await m.handleChatModelStart?.(r,[l],f,this._parentRunId,a,this.tags,this.metadata,u);else if(m.handleLLMStart){let h=zc(l);await m.handleLLMStart?.(r,[h],f,this._parentRunId,a,this.tags,this.metadata,u)}}catch(h){if((m.raiseError?console.error:console.warn)(`Error in handler ${m.constructor.name}, handleLLMStart: ${h}`),m.raiseError)throw h}},m.awaitHandlers)})),new zb(f,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(r,n,i=vn(),o=void 0,a=void 0,s=void 0,c=void 0,u=void 0,l=void 0){return await Promise.all(this.handlers.map(p=>{if(!p.ignoreChain)return as(p)&&p._createRunForChainStart(r,n,i,this._parentRunId,this.tags,this.metadata,o,c,l),yt(async()=>{try{await p.handleChainStart?.(r,n,i,this._parentRunId,this.tags,this.metadata,o,c,l)}catch(f){if((p.raiseError?console.error:console.warn)(`Error in handler ${p.constructor.name}, handleChainStart: ${f}`),p.raiseError)throw f}},p.awaitHandlers)})),new MN(i,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(r,n,i=vn(),o=void 0,a=void 0,s=void 0,c=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreAgent)return as(u)&&u._createRunForToolStart(r,n,i,this._parentRunId,this.tags,this.metadata,c),yt(async()=>{try{await u.handleToolStart?.(r,n,i,this._parentRunId,this.tags,this.metadata,c)}catch(l){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleToolStart: ${l}`),u.raiseError)throw l}},u.awaitHandlers)})),new zN(i,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(r,n,i=vn(),o=void 0,a=void 0,s=void 0,c=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreRetriever)return as(u)&&u._createRunForRetrieverStart(r,n,i,this._parentRunId,this.tags,this.metadata,c),yt(async()=>{try{await u.handleRetrieverStart?.(r,n,i,this._parentRunId,this.tags,this.metadata,c)}catch(l){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleRetrieverStart: ${l}`),u.raiseError)throw l}},u.awaitHandlers)})),new RN(i,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(r,n,i,o,a){await Promise.all(this.handlers.map(s=>yt(async()=>{if(!s.ignoreCustomEvent)try{await s.handleCustomEvent?.(r,n,i,this.tags,this.metadata)}catch(c){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleCustomEvent: ${c}`),s.raiseError)throw c}},s.awaitHandlers)))}addHandler(r,n=!0){this.handlers.push(r),n&&this.inheritableHandlers.push(r)}removeHandler(r){this.handlers=this.handlers.filter(n=>n!==r),this.inheritableHandlers=this.inheritableHandlers.filter(n=>n!==r)}setHandlers(r,n=!0){this.handlers=[],this.inheritableHandlers=[];for(let i of r)this.addHandler(i,n)}addTags(r,n=!0){this.removeTags(r),this.tags.push(...r),n&&this.inheritableTags.push(...r)}removeTags(r){this.tags=this.tags.filter(n=>!r.includes(n)),this.inheritableTags=this.inheritableTags.filter(n=>!r.includes(n))}addMetadata(r,n=!0){this.metadata={...this.metadata,...r},n&&(this.inheritableMetadata={...this.inheritableMetadata,...r})}removeMetadata(r){for(let n of Object.keys(r))delete this.metadata[n],delete this.inheritableMetadata[n]}copy(r=[],n=!0){let i=new xp(this._parentRunId);for(let o of this.handlers){let a=this.inheritableHandlers.includes(o);i.addHandler(o,a)}for(let o of this.tags){let a=this.inheritableTags.includes(o);i.addTags([o],a)}for(let o of Object.keys(this.metadata)){let a=Object.keys(this.inheritableMetadata).includes(o);i.addMetadata({[o]:this.metadata[o]},a)}for(let o of r)i.handlers.filter(a=>a.name==="console_callback_handler").some(a=>a.name===o.name)||i.addHandler(o,n);return i}static fromHandlers(r){class n extends co{constructor(){super();d(this,"name",vn());Object.assign(this,r)}}let i=new this;return i.addHandler(new n),i}static configure(r,n,i,o,a,s,c){return this._configureSync(r,n,i,o,a,s,c)}static _configureSync(r,n,i,o,a,s,c){let u;(r||n)&&(Array.isArray(r)||!r?(u=new xp,u.setHandlers(r?.map(Lc)??[],!0)):u=r,u=u.copy(Array.isArray(n)?n.map(Lc):n?.handlers,!1));let l=ft("LANGCHAIN_VERBOSE")==="true"||c?.verbose,p=wp.getTraceableRunTree()?.tracingEnabled||CN(),f=p||(ft("LANGCHAIN_TRACING")??!1);if(l||f){if(u||(u=new xp),l&&!u.handlers.some(m=>m.name===Mm.prototype.name)){let m=new Mm;u.addHandler(m,!0)}if(f&&!u.handlers.some(m=>m.name==="langchain_tracer")&&p){let m=new wp;u.addHandler(m,!0)}if(p){let m=wp.getTraceableRunTree();m&&u._parentRunId===void 0&&(u._parentRunId=m.id,u.handlers.find(g=>g.name==="langchain_tracer")?.updateFromRunTree(m))}}for(let{contextVar:m,inheritable:h=!0,handlerClass:g,envVar:x}of PN()){let y=x&&ft(x)==="true"&&g,v,S=m!==void 0?Mb(m):void 0;S&&Sv(S)?v=S:y&&(v=new g({})),v!==void 0&&(u||(u=new xp),u.handlers.some(k=>k.name===v.name)||u.addHandler(v,h))}return(i||o)&&u&&(u.addTags(i??[]),u.addTags(o??[],!1)),(a||s)&&u&&(u.addMetadata(a??{}),u.addMetadata(s??{},!1)),u}};function Lc(t){return"name"in t?t:co.fromMethods(t)}var Db=class{getStore(){}run(t,e){return e()}enterWith(t){}},XV=new Db,jN=Symbol.for("lc:child_config"),YV=class{getInstance(){return Xo()??XV}getRunnableConfig(){return this.getInstance().getStore()?.extra?.[jN]}runWithConfig(t,e,r){let n=Et._configureSync(t?.callbacks,void 0,t?.tags,void 0,t?.metadata),i=this.getInstance(),o=i.getStore(),a=n?.getParentRunId(),s=n?.handlers?.find(u=>u?.name==="langchain_tracer"),c;return s&&a?c=s.getRunTreeWithTracingConfig(a):r||(c=new Bn({name:"<runnable_lambda>",tracingEnabled:!1})),c&&(c.extra={...c.extra,[jN]:t}),o!==void 0&&o[Jo]!==void 0&&(c===void 0&&(c={}),c[Jo]=o[Jo]),i.run(c,e)}initializeGlobalInstance(t){Xo()===void 0&&u$(t)}},Ge=new YV;var Lb={};z(Lb,{AsyncLocalStorageProviderSingleton:()=>Ge,MockAsyncLocalStorage:()=>Db,_CONTEXT_VARIABLES_KEY:()=>Jo});var Lm=class{constructor(){this.currentStore=void 0}getStore(){return this.currentStore}run(e,r){let n=this.currentStore;this.currentStore=e;try{return r()}finally{this.currentStore=n}}enterWith(e){this.currentStore=e}disable(){this.currentStore=void 0}};function DN(){Ge.initializeGlobalInstance(new Lm)}var bi=class extends Error{constructor(e,r){let n=e??"";r?.lc_error_code&&(n=`${n}

Troubleshooting URL: https://docs.langchain.com/oss/javascript/langgraph/${r.lc_error_code}/
`);super(n);d(this,"lc_error_code");this.lc_error_code=r?.lc_error_code}},Um=class extends bi{get is_bubble_up(){return!0}},Fm=class extends bi{constructor(t,e){super(t,e),this.name="GraphRecursionError"}static get unminifiable_name(){return"GraphRecursionError"}},ia=class extends bi{constructor(t,e){super(t,e),this.name="GraphValueError"}static get unminifiable_name(){return"GraphValueError"}},wi=class extends Um{constructor(e,r){super(JSON.stringify(e,null,2),r);d(this,"interrupts");this.name="GraphInterrupt",this.interrupts=e??[]}static get unminifiable_name(){return"GraphInterrupt"}},Ip=class extends wi{constructor(t,e){super([{value:t}],e),this.name="NodeInterrupt"}static get unminifiable_name(){return"NodeInterrupt"}},kp=class extends Um{constructor(e){super();d(this,"command");this.name="ParentCommand",this.command=e}static get unminifiable_name(){return"ParentCommand"}};function Bm(t){return t!==void 0&&t.name===kp.unminifiable_name}function oa(t){return t!==void 0&&t.is_bubble_up===!0}function xi(t){return t!==void 0&&[wi.unminifiable_name,Ip.unminifiable_name].includes(t.name)}var Ep=class extends bi{constructor(t,e){super(t,e),this.name="EmptyInputError"}static get unminifiable_name(){return"EmptyInputError"}},He=class extends bi{constructor(t,e){super(t,e),this.name="EmptyChannelError"}static get unminifiable_name(){return"EmptyChannelError"}},Me=class extends bi{constructor(t,e){super(t,e),this.name="InvalidUpdateError"}static get unminifiable_name(){return"InvalidUpdateError"}};var Vm=class extends bi{constructor(t,e){super(t,e),this.name="UnreachableNodeError"}static get unminifiable_name(){return"UnreachableNodeError"}};var Zm=class extends bi{constructor(t,e){super(t,e),this.name="StateGraphInputError",this.message="Invalid StateGraph input. Make sure to pass a valid StateDefinition, Annotation.Root, or Zod schema."}static get unminifiable_name(){return"StateGraphInputError"}};function Ap(t){return nm({clockseq:t})}function po(t,e){let r=e.replace(/-/g,"").match(/.{2}/g).map(n=>parseInt(n,16));return yn(t,new Uint8Array(r))}var Ub="__error__",us="__scheduled__",Fb="__interrupt__",Bb="__resume__";var LN="[...]",QV="[Circular]",Gm=[],Uc=[];function eZ(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function UN(t,e,r,n){typeof n>"u"&&(n=eZ()),Zb(t,"",0,[],void 0,0,n);var i;try{Uc.length===0?i=JSON.stringify(t,e,r):i=JSON.stringify(t,tZ(e),r)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;Gm.length!==0;){var o=Gm.pop();o.length===4?Object.defineProperty(o[0],o[1],o[3]):o[0][o[1]]=o[2]}}return i}function Vb(t,e,r,n){var i=Object.getOwnPropertyDescriptor(n,r);i.get!==void 0?i.configurable?(Object.defineProperty(n,r,{value:t}),Gm.push([n,r,e,i])):Uc.push([e,r,t]):(n[r]=t,Gm.push([n,r,e]))}function Zb(t,e,r,n,i,o,a){o+=1;var s;if(typeof t=="object"&&t!==null){for(s=0;s<n.length;s++)if(n[s]===t){Vb(QV,t,e,i);return}if(typeof a.depthLimit<"u"&&o>a.depthLimit){Vb(LN,t,e,i);return}if(typeof a.edgesLimit<"u"&&r+1>a.edgesLimit){Vb(LN,t,e,i);return}if(n.push(t),Array.isArray(t))for(s=0;s<t.length;s++)Zb(t[s],s,s,n,t,o,a);else{var c=Object.keys(t);for(s=0;s<c.length;s++){var u=c[s];Zb(t[u],u,s,n,t,o,a)}}n.pop()}}function tZ(t){return t=typeof t<"u"?t:function(e,r){return r},function(e,r){if(Uc.length>0)for(var n=0;n<Uc.length;n++){var i=Uc[n];if(i[1]===e&&i[0]===r){r=i[2],Uc.splice(n,1);break}}return t.call(this,e,r)}}var FN=[];var BN={};var Hm=25;async function Ft(t){return Et._configureSync(t?.callbacks,void 0,t?.tags,void 0,t?.metadata)}function Bt(...t){let e={};for(let r of t.filter(n=>!!n))for(let n of Object.keys(r))if(n==="metadata")e[n]={...e[n],...r[n]};else if(n==="tags"){let i=e[n]??[];e[n]=[...new Set(i.concat(r[n]??[]))]}else if(n==="configurable")e[n]={...e[n],...r[n]};else if(n==="timeout")e.timeout===void 0?e.timeout=r.timeout:r.timeout!==void 0&&(e.timeout=Math.min(e.timeout,r.timeout));else if(n==="signal")e.signal===void 0?e.signal=r.signal:r.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,r.signal]):e.signal=r.signal);else if(n==="callbacks"){let i=e.callbacks,o=r.callbacks;if(Array.isArray(o))if(!i)e.callbacks=o;else if(Array.isArray(i))e.callbacks=i.concat(o);else{let a=i.copy();for(let s of o)a.addHandler(Lc(s),!0);e.callbacks=a}else if(o)if(!i)e.callbacks=o;else if(Array.isArray(i)){let a=o.copy();for(let s of i)a.addHandler(Lc(s),!0);e.callbacks=a}else e.callbacks=new Et(o._parentRunId,{handlers:i.handlers.concat(o.handlers),inheritableHandlers:i.inheritableHandlers.concat(o.inheritableHandlers),tags:Array.from(new Set(i.tags.concat(o.tags))),inheritableTags:Array.from(new Set(i.inheritableTags.concat(o.inheritableTags))),metadata:{...i.metadata,...o.metadata}})}else{let i=n;e[i]=r[i]??e[i]}return e}var rZ=new Set(["string","number","boolean"]);function Re(t){let e=Ge.getRunnableConfig(),r={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){let{runId:n,runName:i,...o}=e;r=Object.entries(o).reduce((a,[s,c])=>(c!==void 0&&(a[s]=c),a),r)}if(t&&(r=Object.entries(t).reduce((n,[i,o])=>(o!==void 0&&(n[i]=o),n),r)),r?.configurable)for(let n of Object.keys(r.configurable))rZ.has(typeof r.configurable[n])&&!r.metadata?.[n]&&(r.metadata||(r.metadata={}),r.metadata[n]=r.configurable[n]);if(r.timeout!==void 0){if(r.timeout<=0)throw new Error("Timeout must be a positive number");let n=r.timeout,i=AbortSignal.timeout(n);r.metadata||(r.metadata={}),r.metadata.timeoutMs===void 0&&(r.metadata.timeoutMs=n),r.signal!==void 0?"any"in AbortSignal&&(r.signal=AbortSignal.any([r.signal,i])):r.signal=i,delete r.timeout}return r}function ze(t={},{callbacks:e,maxConcurrency:r,recursionLimit:n,runName:i,configurable:o,runId:a}={}){let s=Re(t);return e!==void 0&&(delete s.runName,s.callbacks=e),n!==void 0&&(s.recursionLimit=n),r!==void 0&&(s.maxConcurrency=r),i!==void 0&&(s.runName=i),o!==void 0&&(s.configurable={...s.configurable,...o}),a!==void 0&&delete s.runId,s}function xr(t){if(t)return{configurable:t.configurable,recursionLimit:t.recursionLimit,callbacks:t.callbacks,tags:t.tags,metadata:t.metadata,maxConcurrency:t.maxConcurrency,timeout:t.timeout,signal:t.signal,store:t.store}}async function Sn(t,e){if(e===void 0)return t;let r;return Promise.race([t.catch(n=>{if(!e?.aborted)throw n}),new Promise((n,i)=>{r=()=>{i(aa(e))},e.addEventListener("abort",r),e.aborted&&i(aa(e))})]).finally(()=>e.removeEventListener("abort",r))}function aa(t){return t?.reason instanceof Error?t.reason:typeof t?.reason=="string"?new Error(t.reason):new Error("Aborted")}var Hb={};z(Hb,{AsyncGeneratorWithSetup:()=>sa,IterableReadableStream:()=>Ct,atee:()=>qm,concat:()=>en,pipeGeneratorWithSetup:()=>qb});var Ct=class Gb extends ReadableStream{constructor(){super(...arguments);d(this,"reader")}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{let r=await this.reader.read();return r.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:r.value}}catch(r){throw this.reader.releaseLock(),r}}async return(){if(this.ensureReader(),this.locked){let r=this.reader.cancel();this.reader.releaseLock(),await r}return{done:!0,value:void 0}}async throw(r){if(this.ensureReader(),this.locked){let n=this.reader.cancel();this.reader.releaseLock(),await n}throw r}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(r){let n=r.getReader();return new Gb({start(i){return o();function o(){return n.read().then(({done:a,value:s})=>{if(a){i.close();return}return i.enqueue(s),o()})}},cancel(){n.releaseLock()}})}static fromAsyncGenerator(r){return new Gb({async pull(n){let{value:i,done:o}=await r.next();o&&n.close(),n.enqueue(i)},async cancel(n){await r.return(n)}})}};function qm(t,e=2){let r=Array.from({length:e},()=>[]);return r.map(async function*(i){for(;;)if(i.length===0){let o=await t.next();for(let a of r)a.push(o)}else{if(i[0].done)return;yield i.shift().value}})}function en(t,e){if(Array.isArray(t)&&Array.isArray(e))return t.concat(e);if(typeof t=="string"&&typeof e=="string")return t+e;if(typeof t=="number"&&typeof e=="number")return t+e;if("concat"in t&&typeof t.concat=="function")return t.concat(e);if(typeof t=="object"&&typeof e=="object"){let r={...t};for(let[n,i]of Object.entries(e))n in r&&!Array.isArray(r[n])?r[n]=en(r[n],i):r[n]=i;return r}else throw new Error(`Cannot concat ${typeof t} and ${typeof e}`)}var sa=class{constructor(t){d(this,"generator");d(this,"setup");d(this,"config");d(this,"signal");d(this,"firstResult");d(this,"firstResultUsed",!1);this.generator=t.generator,this.config=t.config,this.signal=t.signal??this.config?.signal,this.setup=new Promise((e,r)=>{Ge.runWithConfig(xr(t.config),async()=>{this.firstResult=t.generator.next(),t.startSetup?this.firstResult.then(t.startSetup).then(e,r):this.firstResult.then(n=>e(void 0),r)},!0)})}async next(...t){return this.signal?.throwIfAborted(),this.firstResultUsed?Ge.runWithConfig(xr(this.config),this.signal?async()=>Sn(this.generator.next(...t),this.signal):async()=>this.generator.next(...t),!0):(this.firstResultUsed=!0,this.firstResult)}async return(t){return this.generator.return(t)}async throw(t){return this.generator.throw(t)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}};async function qb(t,e,r,n,...i){let o=new sa({generator:e,startSetup:r,signal:n}),a=await o.setup;return{output:t(o,a,...i),setup:a}}var nZ=Object.prototype.hasOwnProperty;function Wm(t,e){return nZ.call(t,e)}function Jm(t){if(Array.isArray(t)){let r=new Array(t.length);for(let n=0;n<r.length;n++)r[n]=""+n;return r}if(Object.keys)return Object.keys(t);let e=[];for(let r in t)Wm(t,r)&&e.push(r);return e}function Sr(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function Xm(t){let e=0,r=t.length,n;for(;e<r;){if(n=t.charCodeAt(e),n>=48&&n<=57){e++;continue}return!1}return!0}function fo(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function Ym(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function Km(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(let r=0,n=t.length;r<n;r++)if(Km(t[r]))return!0}else if(typeof t=="object"){let r=Jm(t),n=r.length;for(var e=0;e<n;e++)if(Km(t[r[e]]))return!0}}return!1}function VN(t,e){let r=[t];for(let n in e){let i=typeof e[n]=="object"?JSON.stringify(e[n],null,2):e[n];typeof i<"u"&&r.push(`${n}: ${i}`)}return r.join(`
`)}var Qm=class extends Error{constructor(t,e,r,n,i){super(VN(t,{name:e,index:r,operation:n,tree:i})),this.name=e,this.index=r,this.operation=n,this.tree=i,Object.setPrototypeOf(this,new.target.prototype),this.message=VN(t,{name:e,index:r,operation:n,tree:i})}};var Wb={};z(Wb,{JsonPatchError:()=>vt,_areEquals:()=>Tp,applyOperation:()=>ls,applyPatch:()=>ca,applyReducer:()=>aZ,deepClone:()=>iZ,getValueByPointer:()=>eh,validate:()=>ZN,validator:()=>th});var vt=Qm,iZ=Sr;function Kb(t){return Object.getOwnPropertyNames(Object.prototype).includes(t)}var Fc={add:function(t,e,r){if(Kb(e))throw new TypeError("JSON-Patch: modifying `__proto__`, `constructor`, or `prototype` prop is banned for security reasons");return t[e]=this.value,{newDocument:r}},remove:function(t,e,r){if(Kb(e))throw new TypeError("JSON-Patch: modifying `__proto__`, `constructor`, or `prototype` prop is banned for security reasons");var n=t[e];return delete t[e],{newDocument:r,removed:n}},replace:function(t,e,r){if(Kb(e))throw new TypeError("JSON-Patch: modifying `__proto__`, `constructor`, or `prototype` prop is banned for security reasons");var n=t[e];return t[e]=this.value,{newDocument:r,removed:n}},move:function(t,e,r){let n=eh(r,this.path);n&&(n=Sr(n));let i=ls(r,{op:"remove",path:this.from}).removed;return ls(r,{op:"add",path:this.path,value:i}),{newDocument:r,removed:n}},copy:function(t,e,r){let n=eh(r,this.from);return ls(r,{op:"add",path:this.path,value:Sr(n)}),{newDocument:r}},test:function(t,e,r){return{newDocument:r,test:Tp(t[e],this.value)}},_get:function(t,e,r){return this.value=t[e],{newDocument:r}}},oZ={add:function(t,e,r){return Xm(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:r,index:e}},remove:function(t,e,r){var n=t.splice(e,1);return{newDocument:r,removed:n[0]}},replace:function(t,e,r){var n=t[e];return t[e]=this.value,{newDocument:r,removed:n}},move:Fc.move,copy:Fc.copy,test:Fc.test,_get:Fc._get};function eh(t,e){if(e=="")return t;var r={op:"_get",path:e};return ls(t,r),r.value}function ls(t,e,r=!1,n=!0,i=!0,o=0){if(r&&(typeof r=="function"?r(e,0,t,e.path):th(e,0)),e.path===""){let a={newDocument:t};if(e.op==="add")return a.newDocument=e.value,a;if(e.op==="replace")return a.newDocument=e.value,a.removed=t,a;if(e.op==="move"||e.op==="copy")return a.newDocument=eh(t,e.from),e.op==="move"&&(a.removed=t),a;if(e.op==="test"){if(a.test=Tp(t,e.value),a.test===!1)throw new vt("Test operation failed","TEST_OPERATION_FAILED",o,e,t);return a.newDocument=t,a}else{if(e.op==="remove")return a.removed=t,a.newDocument=null,a;if(e.op==="_get")return e.value=t,a;if(r)throw new vt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",o,e,t);return a}}else{n||(t=Sr(t));let s=(e.path||"").split("/"),c=t,u=1,l=s.length,p,f,m;for(typeof r=="function"?m=r:m=th;;){if(f=s[u],f&&f.indexOf("~")!=-1&&(f=Ym(f)),i&&(f=="__proto__"||f=="prototype"&&u>0&&s[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&p===void 0&&(c[f]===void 0?p=s.slice(0,u).join("/"):u==l-1&&(p=e.path),p!==void 0&&m(e,0,t,p)),u++,Array.isArray(c)){if(f==="-")f=c.length;else{if(r&&!Xm(f))throw new vt("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",o,e,t);Xm(f)&&(f=~~f)}if(u>=l){if(r&&e.op==="add"&&f>c.length)throw new vt("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",o,e,t);let h=oZ[e.op].call(e,c,f,t);if(h.test===!1)throw new vt("Test operation failed","TEST_OPERATION_FAILED",o,e,t);return h}}else if(u>=l){let h=Fc[e.op].call(e,c,f,t);if(h.test===!1)throw new vt("Test operation failed","TEST_OPERATION_FAILED",o,e,t);return h}if(c=c[f],r&&u<l&&(!c||typeof c!="object"))throw new vt("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",o,e,t)}}}function ca(t,e,r,n=!0,i=!0){if(r&&!Array.isArray(e))throw new vt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(t=Sr(t));let o=new Array(e.length);for(let a=0,s=e.length;a<s;a++)o[a]=ls(t,e[a],r,!0,i,a),t=o[a].newDocument;return o.newDocument=t,o}function aZ(t,e,r){let n=ls(t,e);if(n.test===!1)throw new vt("Test operation failed","TEST_OPERATION_FAILED",r,e,t);return n.newDocument}function th(t,e,r,n){if(typeof t!="object"||t===null||Array.isArray(t))throw new vt("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,r);if(Fc[t.op]){if(typeof t.path!="string")throw new vt("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,r);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new vt('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,r);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new vt("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,r);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new vt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,r);if((t.op==="add"||t.op==="replace"||t.op==="test")&&Km(t.value))throw new vt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,r);if(r){if(t.op=="add"){var i=t.path.split("/").length,o=n.split("/").length;if(i!==o+1&&i!==o)throw new vt("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,r)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==n)throw new vt("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,r)}else if(t.op==="move"||t.op==="copy"){var a={op:"_get",path:t.from,value:void 0},s=ZN([a],r);if(s&&s.name==="OPERATION_PATH_UNRESOLVABLE")throw new vt("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,r)}}}else throw new vt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,r)}function ZN(t,e,r){try{if(!Array.isArray(t))throw new vt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)ca(Sr(e),Sr(t),r||!0);else{r=r||th;for(var n=0;n<t.length;n++)r(t[n],n,e,void 0)}}catch(i){if(i instanceof vt)return i;throw i}}function Tp(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var r=Array.isArray(t),n=Array.isArray(e),i,o,a;if(r&&n){if(o=t.length,o!=e.length)return!1;for(i=o;i--!==0;)if(!Tp(t[i],e[i]))return!1;return!0}if(r!=n)return!1;var s=Object.keys(t);if(o=s.length,o!==Object.keys(e).length)return!1;for(i=o;i--!==0;)if(!e.hasOwnProperty(s[i]))return!1;for(i=o;i--!==0;)if(a=s[i],!Tp(t[a],e[a]))return!1;return!0}return t!==t&&e!==e}function GN(t,e,r,n,i){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var o=Jm(e),a=Jm(t),s=!1,c=!1,u=a.length-1;u>=0;u--){var l=a[u],p=t[l];if(Wm(e,l)&&!(e[l]===void 0&&p!==void 0&&Array.isArray(e)===!1)){var f=e[l];typeof p=="object"&&p!=null&&typeof f=="object"&&f!=null&&Array.isArray(p)===Array.isArray(f)?GN(p,f,r,n+"/"+fo(l),i):p!==f&&(s=!0,i&&r.push({op:"test",path:n+"/"+fo(l),value:Sr(p)}),r.push({op:"replace",path:n+"/"+fo(l),value:Sr(f)}))}else Array.isArray(t)===Array.isArray(e)?(i&&r.push({op:"test",path:n+"/"+fo(l),value:Sr(p)}),r.push({op:"remove",path:n+"/"+fo(l)}),c=!0):(i&&r.push({op:"test",path:n,value:t}),r.push({op:"replace",path:n,value:e}),s=!0)}if(!(!c&&o.length==a.length))for(var u=0;u<o.length;u++){var l=o[u];!Wm(t,l)&&e[l]!==void 0&&r.push({op:"add",path:n+"/"+fo(l),value:Sr(e[l])})}}}function ua(t,e,r=!1){var n=[];return GN(t,e,n,"",r),n}var Hne={...Wb,JsonPatchError:Qm,deepClone:Sr,escapePathComponent:fo,unescapePathComponent:Ym};var Xb={};z(Xb,{LogStreamCallbackHandler:()=>nh,RunLog:()=>rh,RunLogPatch:()=>Si,isLogStreamHandler:()=>Yb});var Si=class{constructor(t){d(this,"ops");this.ops=t.ops??[]}concat(t){let e=this.ops.concat(t.ops),r=ca({},e);return new rh({ops:e,state:r[r.length-1].newDocument})}},rh=class Jb extends Si{constructor(r){super(r);d(this,"state");this.state=r.state}concat(r){let n=this.ops.concat(r.ops),i=ca(this.state,r.ops);return new Jb({ops:n,state:i[i.length-1].newDocument})}static fromRunLogPatch(r){let n=ca({},r.ops);return new Jb({ops:r.ops,state:n[n.length-1].newDocument})}},Yb=t=>t.name==="log_stream_tracer";async function HN(t,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");let{inputs:r}=t;if(["retriever","llm","prompt"].includes(t.run_type))return r;if(!(Object.keys(r).length===1&&r?.input===""))return r.input}async function qN(t,e){let{outputs:r}=t;return e==="original"||["retriever","llm","prompt"].includes(t.run_type)?r:r!==void 0&&Object.keys(r).length===1&&r?.output!==void 0?r.output:r}function sZ(t){return t!==void 0&&t.message!==void 0}var nh=class extends Jt{constructor(e){super({_awaitHandler:!0,...e});d(this,"autoClose",!0);d(this,"includeNames");d(this,"includeTypes");d(this,"includeTags");d(this,"excludeNames");d(this,"excludeTypes");d(this,"excludeTags");d(this,"_schemaFormat","original");d(this,"rootId");d(this,"keyMapByRunId",{});d(this,"counterMapByRunName",{});d(this,"transformStream");d(this,"writer");d(this,"receiveStream");d(this,"name","log_stream_tracer");d(this,"lc_prefer_streaming",!0);this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Ct.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;let r=e.tags??[],n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(n=n||r.find(i=>this.includeTags?.includes(i))!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(n=n&&r.every(i=>!this.excludeTags?.includes(i))),n}async*tapOutputIterable(e,r){for await(let n of r){if(e!==this.rootId){let i=this.keyMapByRunId[e];i&&await this.writer.write(new Si({ops:[{op:"add",path:`/logs/${i}/streamed_output/-`,value:n}]}))}yield n}}async onRunCreate(e){if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new Si({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;let r=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=r===1?e.name:`${e.name}:${r}`;let n={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(n.inputs=await HN(e,this._schemaFormat)),await this.writer.write(new Si({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))}async onRunUpdate(e){try{let r=this.keyMapByRunId[e.id];if(r===void 0)return;let n=[];this._schemaFormat==="streaming_events"&&n.push({op:"replace",path:`/logs/${r}/inputs`,value:await HN(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${r}/final_output`,value:await qN(e,this._schemaFormat)}),e.end_time!==void 0&&n.push({op:"add",path:`/logs/${r}/end_time`,value:new Date(e.end_time).toISOString()});let i=new Si({ops:n});await this.writer.write(i)}finally{if(e.id===this.rootId){let r=new Si({ops:[{op:"replace",path:"/final_output",value:await qN(e,this._schemaFormat)}]});await this.writer.write(r),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,r,n){let i=this.keyMapByRunId[e.id];if(i===void 0)return;let o=e.inputs.messages!==void 0,a;o?sZ(n?.chunk)?a=n?.chunk:a=new st({id:`run-${e.id}`,content:r}):a=r;let s=new Si({ops:[{op:"add",path:`/logs/${i}/streamed_output_str/-`,value:r},{op:"add",path:`/logs/${i}/streamed_output/-`,value:a}]});await this.writer.write(s)}};var Qb={};z(Qb,{ChatGenerationChunk:()=>tn,GenerationChunk:()=>Ii,RUN_KEY:()=>ps});var ps="__run",Ii=class KN{constructor(e){d(this,"text");d(this,"generationInfo");this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new KN({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}},tn=class WN extends Ii{constructor(r){super(r);d(this,"message");this.message=r.message}concat(r){return new WN({text:this.text+r.text,generationInfo:{...this.generationInfo,...r.generationInfo},message:this.message.concat(r.message)})}};var cZ=Object.prototype.toString,uZ=t=>cZ.call(t)==="[object Error]",lZ=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred.","Network connection lost"]);function JN(t){if(!(t&&uZ(t)&&t.name==="TypeError"&&typeof t.message=="string"))return!1;let{message:r,stack:n}=t;return r==="Load failed"?n===void 0||"__sentry_captured__"in t:r.startsWith("error sending request for url")?!0:lZ.has(r)}function pZ(t){if(typeof t=="number"){if(t<0)throw new TypeError("Expected `retries` to be a non-negative number.");if(Number.isNaN(t))throw new TypeError("Expected `retries` to be a valid number or Infinity, got NaN.")}else if(t!==void 0)throw new TypeError("Expected `retries` to be a number or Infinity.")}function ih(t,e,{min:r=0,allowInfinity:n=!1}={}){if(e!==void 0){if(typeof e!="number"||Number.isNaN(e))throw new TypeError(`Expected \`${t}\` to be a number${n?" or Infinity":""}.`);if(!n&&!Number.isFinite(e))throw new TypeError(`Expected \`${t}\` to be a finite number.`);if(e<r)throw new TypeError(`Expected \`${t}\` to be \u2265 ${r}.`)}}var dZ=class extends Error{constructor(t){super(),t instanceof Error?(this.originalError=t,{message:t}=t):(this.originalError=new Error(t),this.originalError.stack=this.stack),this.name="AbortError",this.message=t}};function fZ(t,e){let r=Math.max(1,t+1),n=e.randomize?Math.random()+1:1,i=Math.round(n*e.minTimeout*e.factor**(r-1));return i=Math.min(i,e.maxTimeout),i}function XN(t,e){return Number.isFinite(e)?e-(performance.now()-t):e}async function mZ({error:t,attemptNumber:e,retriesConsumed:r,startTime:n,options:i}){let o=t instanceof Error?t:new TypeError(`Non-error was thrown: "${t}". You should only throw errors.`);if(o instanceof dZ)throw o.originalError;let a=Number.isFinite(i.retries)?Math.max(0,i.retries-r):i.retries,s=i.maxRetryTime??Number.POSITIVE_INFINITY,c=Object.freeze({error:o,attemptNumber:e,retriesLeft:a,retriesConsumed:r});if(await i.onFailedAttempt(c),XN(n,s)<=0)throw o;let u=await i.shouldConsumeRetry(c),l=XN(n,s);if(l<=0||a<=0)throw o;if(o instanceof TypeError&&!JN(o)){if(u)throw o;return i.signal?.throwIfAborted(),!1}if(!await i.shouldRetry(c))throw o;if(!u)return i.signal?.throwIfAborted(),!1;let p=fZ(r,i),f=Math.min(p,l);return f>0&&await new Promise((m,h)=>{let g=()=>{clearTimeout(x),i.signal?.removeEventListener("abort",g),h(i.signal.reason)},x=setTimeout(()=>{i.signal?.removeEventListener("abort",g),m()},f);i.unref&&x.unref?.(),i.signal?.addEventListener("abort",g,{once:!0})}),i.signal?.throwIfAborted(),!0}async function $p(t,e={}){if(e={...e},pZ(e.retries),Object.hasOwn(e,"forever"))throw new Error("The `forever` option is no longer supported. For many use-cases, you can set `retries: Infinity` instead.");e.retries??(e.retries=10),e.factor??(e.factor=2),e.minTimeout??(e.minTimeout=1e3),e.maxTimeout??(e.maxTimeout=Number.POSITIVE_INFINITY),e.maxRetryTime??(e.maxRetryTime=Number.POSITIVE_INFINITY),e.randomize??(e.randomize=!1),e.onFailedAttempt??(e.onFailedAttempt=()=>{}),e.shouldRetry??(e.shouldRetry=()=>!0),e.shouldConsumeRetry??(e.shouldConsumeRetry=()=>!0),ih("factor",e.factor,{min:0,allowInfinity:!1}),ih("minTimeout",e.minTimeout,{min:0,allowInfinity:!1}),ih("maxTimeout",e.maxTimeout,{min:0,allowInfinity:!0}),ih("maxRetryTime",e.maxRetryTime,{min:0,allowInfinity:!0}),e.factor>0||(e.factor=1),e.signal?.throwIfAborted();let r=0,n=0,i=performance.now();for(;!Number.isFinite(e.retries)||n<=e.retries;){r++;try{e.signal?.throwIfAborted();let o=await t(r);return e.signal?.throwIfAborted(),o}catch(o){await mZ({error:o,attemptNumber:r,retriesConsumed:n,startTime:i,options:e})&&n++}}throw new Error("Retry attempts exhausted without throwing an error.")}var oh=Wo(hm(),1);var ew={};z(ew,{AsyncCaller:()=>mo});var hZ=[400,401,402,403,404,405,406,407,409],gZ=t=>{if(typeof t!="object"||t===null)return;if("message"in t&&typeof t.message=="string"&&(t.message.startsWith("Cancel")||t.message.startsWith("AbortError"))||"name"in t&&typeof t.name=="string"&&t.name==="AbortError"||"code"in t&&typeof t.code=="string"&&t.code==="ECONNABORTED")throw t;let e="response"in t&&typeof t.response=="object"&&t.response!==null&&"status"in t.response&&typeof t.response.status=="number"?t.response.status:void 0;if(e&&hZ.includes(+e))throw t;if(("error"in t&&typeof t.error=="object"&&t.error!==null&&"code"in t.error&&typeof t.error.code=="string"?t.error.code:void 0)==="insufficient_quota"){let n=new Error("message"in t&&typeof t.message=="string"?t.message:"Insufficient quota");throw n.name="InsufficientQuotaError",n}},mo=class{constructor(t){d(this,"maxConcurrency");d(this,"maxRetries");d(this,"onFailedAttempt");d(this,"queue");this.maxConcurrency=t.maxConcurrency??1/0,this.maxRetries=t.maxRetries??6,this.onFailedAttempt=t.onFailedAttempt??gZ;let e="default"in oh.default?oh.default.default:oh.default;this.queue=new e({concurrency:this.maxConcurrency})}async call(t,...e){return this.queue.add(()=>$p(()=>t(...e).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:({error:r})=>this.onFailedAttempt?.(r),retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(t,e,...r){if(t.signal){let n;return Promise.race([this.call(e,...r),new Promise((i,o)=>{n=()=>{o(aa(t.signal))},t.signal?.addEventListener("abort",n)})]).finally(()=>{t.signal&&n&&t.signal.removeEventListener("abort",n)})}return this.call(e,...r)}fetch(...t){return this.call(()=>fetch(...t).then(e=>e.ok?e:Promise.reject(e)))}};var yo={};hi(yo,{$ZodAny:()=>Fx,$ZodArray:()=>Zx,$ZodAsyncError:()=>Vn,$ZodBase64:()=>Cx,$ZodBase64URL:()=>Px,$ZodBigInt:()=>Ah,$ZodBigIntFormat:()=>jx,$ZodBoolean:()=>Vp,$ZodCIDRv4:()=>Tx,$ZodCIDRv6:()=>$x,$ZodCUID:()=>gx,$ZodCUID2:()=>_x,$ZodCatch:()=>c0,$ZodCheck:()=>tt,$ZodCheckBigIntFormat:()=>Hw,$ZodCheckEndsWith:()=>ix,$ZodCheckGreaterThan:()=>bh,$ZodCheckIncludes:()=>rx,$ZodCheckLengthEquals:()=>Yw,$ZodCheckLessThan:()=>vh,$ZodCheckLowerCase:()=>ex,$ZodCheckMaxLength:()=>Jw,$ZodCheckMaxSize:()=>qw,$ZodCheckMimeType:()=>ax,$ZodCheckMinLength:()=>Xw,$ZodCheckMinSize:()=>Kw,$ZodCheckMultipleOf:()=>Zw,$ZodCheckNumberFormat:()=>Gw,$ZodCheckOverwrite:()=>sx,$ZodCheckProperty:()=>ox,$ZodCheckRegex:()=>Qw,$ZodCheckSizeEquals:()=>Ww,$ZodCheckStartsWith:()=>nx,$ZodCheckStringFormat:()=>Wc,$ZodCheckUpperCase:()=>tx,$ZodCodec:()=>qp,$ZodCustom:()=>g0,$ZodCustomStringFormat:()=>Mx,$ZodDate:()=>Vx,$ZodDefault:()=>i0,$ZodDiscriminatedUnion:()=>qx,$ZodE164:()=>Nx,$ZodEmail:()=>dx,$ZodEmoji:()=>mx,$ZodEncodeError:()=>la,$ZodEnum:()=>Yx,$ZodError:()=>jp,$ZodExactOptional:()=>r0,$ZodFile:()=>e0,$ZodFunction:()=>f0,$ZodGUID:()=>lx,$ZodIPv4:()=>kx,$ZodIPv6:()=>Ex,$ZodISODate:()=>xx,$ZodISODateTime:()=>wx,$ZodISODuration:()=>Ix,$ZodISOTime:()=>Sx,$ZodIntersection:()=>Kx,$ZodJWT:()=>Rx,$ZodKSUID:()=>bx,$ZodLazy:()=>h0,$ZodLiteral:()=>Qx,$ZodMAC:()=>Ax,$ZodMap:()=>Jx,$ZodNaN:()=>u0,$ZodNanoID:()=>hx,$ZodNever:()=>Gp,$ZodNonOptional:()=>a0,$ZodNull:()=>Ux,$ZodNullable:()=>n0,$ZodNumber:()=>Eh,$ZodNumberFormat:()=>zx,$ZodObject:()=>IR,$ZodObjectJIT:()=>Gx,$ZodOptional:()=>gs,$ZodPipe:()=>l0,$ZodPrefault:()=>o0,$ZodPromise:()=>m0,$ZodReadonly:()=>p0,$ZodRealError:()=>Br,$ZodRecord:()=>Wx,$ZodRegistry:()=>Ph,$ZodSet:()=>Xx,$ZodString:()=>hs,$ZodStringFormat:()=>Xe,$ZodSuccess:()=>s0,$ZodSymbol:()=>Dx,$ZodTemplateLiteral:()=>d0,$ZodTransform:()=>t0,$ZodTuple:()=>Th,$ZodType:()=>we,$ZodULID:()=>yx,$ZodURL:()=>fx,$ZodUUID:()=>px,$ZodUndefined:()=>Lx,$ZodUnion:()=>Hp,$ZodUnknown:()=>Zp,$ZodVoid:()=>Bx,$ZodXID:()=>vx,$ZodXor:()=>Hx,$brand:()=>ah,$constructor:()=>I,$input:()=>y0,$output:()=>_0,Doc:()=>Bp,JSONSchema:()=>S1,JSONSchemaGenerator:()=>cg,NEVER:()=>tw,TimePrecision:()=>x0,_any:()=>V0,_array:()=>K0,_base64:()=>Jh,_base64url:()=>Xh,_bigint:()=>z0,_boolean:()=>R0,_catch:()=>z3,_check:()=>x1,_cidrv4:()=>Kh,_cidrv6:()=>Wh,_coercedBigint:()=>j0,_coercedBoolean:()=>M0,_coercedDate:()=>H0,_coercedNumber:()=>T0,_coercedString:()=>b0,_cuid:()=>Fh,_cuid2:()=>Bh,_custom:()=>J0,_date:()=>G0,_decode:()=>lh,_decodeAsync:()=>dh,_default:()=>N3,_discriminatedUnion:()=>w3,_e164:()=>Yh,_email:()=>Rh,_emoji:()=>Lh,_encode:()=>uh,_encodeAsync:()=>ph,_endsWith:()=>ru,_enum:()=>A3,_file:()=>W0,_float32:()=>O0,_float64:()=>C0,_gt:()=>Ai,_gte:()=>Ir,_guid:()=>Jp,_includes:()=>eu,_int:()=>$0,_int32:()=>P0,_int64:()=>D0,_intersection:()=>x3,_ipv4:()=>Hh,_ipv6:()=>qh,_isoDate:()=>I0,_isoDateTime:()=>S0,_isoDuration:()=>E0,_isoTime:()=>k0,_jwt:()=>Qh,_ksuid:()=>Gh,_lazy:()=>U3,_length:()=>vs,_literal:()=>$3,_lowercase:()=>Yc,_lt:()=>Ei,_lte:()=>nn,_mac:()=>w0,_map:()=>k3,_max:()=>nn,_maxLength:()=>ys,_maxSize:()=>ga,_mime:()=>nu,_min:()=>Ir,_minLength:()=>go,_minSize:()=>Ti,_multipleOf:()=>ha,_nan:()=>q0,_nanoid:()=>Uh,_nativeEnum:()=>T3,_negative:()=>tg,_never:()=>Qp,_nonnegative:()=>ng,_nonoptional:()=>R3,_nonpositive:()=>rg,_normalize:()=>iu,_null:()=>B0,_nullable:()=>P3,_number:()=>A0,_optional:()=>C3,_overwrite:()=>Zn,_parse:()=>Gc,_parseAsync:()=>Hc,_pipe:()=>j3,_positive:()=>eg,_promise:()=>F3,_property:()=>ig,_readonly:()=>D3,_record:()=>I3,_refine:()=>X0,_regex:()=>Xc,_safeDecode:()=>mh,_safeDecodeAsync:()=>gh,_safeEncode:()=>fh,_safeEncodeAsync:()=>hh,_safeParse:()=>qc,_safeParseAsync:()=>Kc,_set:()=>E3,_size:()=>_s,_slugify:()=>cu,_startsWith:()=>tu,_string:()=>v0,_stringFormat:()=>uu,_stringbool:()=>tS,_success:()=>M3,_superRefine:()=>Y0,_symbol:()=>U0,_templateLiteral:()=>L3,_toLowerCase:()=>au,_toUpperCase:()=>su,_transform:()=>O3,_trim:()=>ou,_tuple:()=>S3,_uint32:()=>N0,_uint64:()=>L0,_ulid:()=>Vh,_undefined:()=>F0,_union:()=>v3,_unknown:()=>Yp,_uppercase:()=>Qc,_url:()=>Xp,_uuid:()=>Mh,_uuidv4:()=>zh,_uuidv6:()=>jh,_uuidv7:()=>Dh,_void:()=>Z0,_xid:()=>Zh,_xor:()=>b3,clone:()=>ut,config:()=>bt,createStandardJSONSchemaMethod:()=>lu,createToJSONSchemaMethod:()=>rS,decode:()=>ZZ,decodeAsync:()=>HZ,describe:()=>Q0,encode:()=>VZ,encodeAsync:()=>GZ,extractDefs:()=>ya,finalize:()=>va,flattenError:()=>Dp,formatError:()=>Lp,globalConfig:()=>Op,globalRegistry:()=>qe,initializeContext:()=>_a,isValidBase64:()=>Ox,isValidBase64URL:()=>bR,isValidJWT:()=>wR,locales:()=>Wp,meta:()=>eS,parse:()=>ki,parseAsync:()=>fs,prettifyError:()=>fw,process:()=>Je,regexes:()=>kn,registry:()=>Nh,safeDecode:()=>KZ,safeDecodeAsync:()=>JZ,safeEncode:()=>qZ,safeEncodeAsync:()=>WZ,safeParse:()=>mw,safeParseAsync:()=>hw,toDotPath:()=>rR,toJSONSchema:()=>_o,treeifyError:()=>dw,util:()=>D,version:()=>cx});var tw=Object.freeze({status:"aborted"});function I(t,e,r){function n(s,c){if(s._zod||Object.defineProperty(s,"_zod",{value:{def:c,constr:a,traits:new Set},enumerable:!1}),s._zod.traits.has(t))return;s._zod.traits.add(t),e(s,c);let u=a.prototype,l=Object.keys(u);for(let p=0;p<l.length;p++){let f=l[p];f in s||(s[f]=u[f].bind(s))}}let i=r?.Parent??Object;class o extends i{}Object.defineProperty(o,"name",{value:t});function a(s){var c;let u=r?.Parent?new o:this;n(u,s),(c=u._zod).deferred??(c.deferred=[]);for(let l of u._zod.deferred)l();return u}return Object.defineProperty(a,"init",{value:n}),Object.defineProperty(a,Symbol.hasInstance,{value:s=>r?.Parent&&s instanceof r.Parent?!0:s?._zod?.traits?.has(t)}),Object.defineProperty(a,"name",{value:t}),a}var ah=Symbol("zod_brand"),Vn=class extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}},la=class extends Error{constructor(e){super(`Encountered unidirectional transform during encode: ${e}`),this.name="ZodEncodeError"}},Op={};function bt(t){return t&&Object.assign(Op,t),Op}var D={};hi(D,{BIGINT_FORMAT_RANGES:()=>pw,Class:()=>nw,NUMBER_FORMAT_RANGES:()=>lw,aborted:()=>ma,allowsEval:()=>aw,assert:()=>wZ,assertEqual:()=>_Z,assertIs:()=>vZ,assertNever:()=>bZ,assertNotEqual:()=>yZ,assignProp:()=>da,base64ToUint8Array:()=>QN,base64urlToUint8Array:()=>DZ,cached:()=>Vc,captureStackTrace:()=>ch,cleanEnum:()=>jZ,cleanRegex:()=>Np,clone:()=>ut,cloneDef:()=>SZ,createTransparentProxy:()=>$Z,defineLazy:()=>Ce,esc:()=>sh,escapeRegex:()=>In,extend:()=>PZ,finalizeIssue:()=>Fr,floatSafeRemainder:()=>iw,getElementAtPath:()=>IZ,getEnumValues:()=>Pp,getLengthableOrigin:()=>zp,getParsedType:()=>TZ,getSizableOrigin:()=>Mp,hexToUint8Array:()=>UZ,isObject:()=>ds,isPlainObject:()=>fa,issue:()=>Zc,joinValues:()=>$,jsonStringifyReplacer:()=>Bc,merge:()=>RZ,mergeDefs:()=>ho,normalizeParams:()=>Z,nullish:()=>pa,numKeys:()=>AZ,objectClone:()=>xZ,omit:()=>CZ,optionalKeys:()=>uw,parsedType:()=>B,partial:()=>MZ,pick:()=>OZ,prefixIssues:()=>rn,primitiveTypes:()=>cw,promiseAllObject:()=>kZ,propertyKeyTypes:()=>Rp,randomString:()=>EZ,required:()=>zZ,safeExtend:()=>NZ,shallowClone:()=>sw,slugify:()=>ow,stringifyPrimitive:()=>j,uint8ArrayToBase64:()=>eR,uint8ArrayToBase64url:()=>LZ,uint8ArrayToHex:()=>FZ,unwrapMessage:()=>Cp});function _Z(t){return t}function yZ(t){return t}function vZ(t){}function bZ(t){throw new Error("Unexpected value in exhaustive check")}function wZ(t){}function Pp(t){let e=Object.values(t).filter(n=>typeof n=="number");return Object.entries(t).filter(([n,i])=>e.indexOf(+n)===-1).map(([n,i])=>i)}function $(t,e="|"){return t.map(r=>j(r)).join(e)}function Bc(t,e){return typeof e=="bigint"?e.toString():e}function Vc(t){return{get value(){{let r=t();return Object.defineProperty(this,"value",{value:r}),r}throw new Error("cached value already set")}}}function pa(t){return t==null}function Np(t){let e=t.startsWith("^")?1:0,r=t.endsWith("$")?t.length-1:t.length;return t.slice(e,r)}function iw(t,e){let r=(t.toString().split(".")[1]||"").length,n=e.toString(),i=(n.split(".")[1]||"").length;if(i===0&&/\d?e-\d?/.test(n)){let c=n.match(/\d?e-(\d?)/);c?.[1]&&(i=Number.parseInt(c[1]))}let o=r>i?r:i,a=Number.parseInt(t.toFixed(o).replace(".","")),s=Number.parseInt(e.toFixed(o).replace(".",""));return a%s/10**o}var YN=Symbol("evaluating");function Ce(t,e,r){let n;Object.defineProperty(t,e,{get(){if(n!==YN)return n===void 0&&(n=YN,n=r()),n},set(i){Object.defineProperty(t,e,{value:i})},configurable:!0})}function xZ(t){return Object.create(Object.getPrototypeOf(t),Object.getOwnPropertyDescriptors(t))}function da(t,e,r){Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!0,configurable:!0})}function ho(...t){let e={};for(let r of t){let n=Object.getOwnPropertyDescriptors(r);Object.assign(e,n)}return Object.defineProperties({},e)}function SZ(t){return ho(t._zod.def)}function IZ(t,e){return e?e.reduce((r,n)=>r?.[n],t):t}function kZ(t){let e=Object.keys(t),r=e.map(n=>t[n]);return Promise.all(r).then(n=>{let i={};for(let o=0;o<e.length;o++)i[e[o]]=n[o];return i})}function EZ(t=10){let e="abcdefghijklmnopqrstuvwxyz",r="";for(let n=0;n<t;n++)r+=e[Math.floor(Math.random()*e.length)];return r}function sh(t){return JSON.stringify(t)}function ow(t){return t.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}var ch="captureStackTrace"in Error?Error.captureStackTrace:(...t)=>{};function ds(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}var aw=Vc(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{let t=Function;return new t(""),!0}catch{return!1}});function fa(t){if(ds(t)===!1)return!1;let e=t.constructor;if(e===void 0||typeof e!="function")return!0;let r=e.prototype;return!(ds(r)===!1||Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")===!1)}function sw(t){return fa(t)?{...t}:Array.isArray(t)?[...t]:t}function AZ(t){let e=0;for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&e++;return e}var TZ=t=>{let e=typeof t;switch(e){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(t)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":return Array.isArray(t)?"array":t===null?"null":t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?"promise":typeof Map<"u"&&t instanceof Map?"map":typeof Set<"u"&&t instanceof Set?"set":typeof Date<"u"&&t instanceof Date?"date":typeof File<"u"&&t instanceof File?"file":"object";default:throw new Error(`Unknown data type: ${e}`)}},Rp=new Set(["string","number","symbol"]),cw=new Set(["string","number","bigint","boolean","symbol","undefined"]);function In(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ut(t,e,r){let n=new t._zod.constr(e??t._zod.def);return(!e||r?.parent)&&(n._zod.parent=t),n}function Z(t){let e=t;if(!e)return{};if(typeof e=="string")return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}function $Z(t){let e;return new Proxy({},{get(r,n,i){return e??(e=t()),Reflect.get(e,n,i)},set(r,n,i,o){return e??(e=t()),Reflect.set(e,n,i,o)},has(r,n){return e??(e=t()),Reflect.has(e,n)},deleteProperty(r,n){return e??(e=t()),Reflect.deleteProperty(e,n)},ownKeys(r){return e??(e=t()),Reflect.ownKeys(e)},getOwnPropertyDescriptor(r,n){return e??(e=t()),Reflect.getOwnPropertyDescriptor(e,n)},defineProperty(r,n,i){return e??(e=t()),Reflect.defineProperty(e,n,i)}})}function j(t){return typeof t=="bigint"?t.toString()+"n":typeof t=="string"?`"${t}"`:`${t}`}function uw(t){return Object.keys(t).filter(e=>t[e]._zod.optin==="optional"&&t[e]._zod.optout==="optional")}var lw={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},pw={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function OZ(t,e){let r=t._zod.def,n=r.checks;if(n&&n.length>0)throw new Error(".pick() cannot be used on object schemas containing refinements");let o=ho(t._zod.def,{get shape(){let a={};for(let s in e){if(!(s in r.shape))throw new Error(`Unrecognized key: "${s}"`);e[s]&&(a[s]=r.shape[s])}return da(this,"shape",a),a},checks:[]});return ut(t,o)}function CZ(t,e){let r=t._zod.def,n=r.checks;if(n&&n.length>0)throw new Error(".omit() cannot be used on object schemas containing refinements");let o=ho(t._zod.def,{get shape(){let a={...t._zod.def.shape};for(let s in e){if(!(s in r.shape))throw new Error(`Unrecognized key: "${s}"`);e[s]&&delete a[s]}return da(this,"shape",a),a},checks:[]});return ut(t,o)}function PZ(t,e){if(!fa(e))throw new Error("Invalid input to extend: expected a plain object");let r=t._zod.def.checks;if(r&&r.length>0){let o=t._zod.def.shape;for(let a in e)if(Object.getOwnPropertyDescriptor(o,a)!==void 0)throw new Error("Cannot overwrite keys on object schemas containing refinements. Use `.safeExtend()` instead.")}let i=ho(t._zod.def,{get shape(){let o={...t._zod.def.shape,...e};return da(this,"shape",o),o}});return ut(t,i)}function NZ(t,e){if(!fa(e))throw new Error("Invalid input to safeExtend: expected a plain object");let r=ho(t._zod.def,{get shape(){let n={...t._zod.def.shape,...e};return da(this,"shape",n),n}});return ut(t,r)}function RZ(t,e){let r=ho(t._zod.def,{get shape(){let n={...t._zod.def.shape,...e._zod.def.shape};return da(this,"shape",n),n},get catchall(){return e._zod.def.catchall},checks:[]});return ut(t,r)}function MZ(t,e,r){let i=e._zod.def.checks;if(i&&i.length>0)throw new Error(".partial() cannot be used on object schemas containing refinements");let a=ho(e._zod.def,{get shape(){let s=e._zod.def.shape,c={...s};if(r)for(let u in r){if(!(u in s))throw new Error(`Unrecognized key: "${u}"`);r[u]&&(c[u]=t?new t({type:"optional",innerType:s[u]}):s[u])}else for(let u in s)c[u]=t?new t({type:"optional",innerType:s[u]}):s[u];return da(this,"shape",c),c},checks:[]});return ut(e,a)}function zZ(t,e,r){let n=ho(e._zod.def,{get shape(){let i=e._zod.def.shape,o={...i};if(r)for(let a in r){if(!(a in o))throw new Error(`Unrecognized key: "${a}"`);r[a]&&(o[a]=new t({type:"nonoptional",innerType:i[a]}))}else for(let a in i)o[a]=new t({type:"nonoptional",innerType:i[a]});return da(this,"shape",o),o}});return ut(e,n)}function ma(t,e=0){if(t.aborted===!0)return!0;for(let r=e;r<t.issues.length;r++)if(t.issues[r]?.continue!==!0)return!0;return!1}function rn(t,e){return e.map(r=>{var n;return(n=r).path??(n.path=[]),r.path.unshift(t),r})}function Cp(t){return typeof t=="string"?t:t?.message}function Fr(t,e,r){let n={...t,path:t.path??[]};if(!t.message){let i=Cp(t.inst?._zod.def?.error?.(t))??Cp(e?.error?.(t))??Cp(r.customError?.(t))??Cp(r.localeError?.(t))??"Invalid input";n.message=i}return delete n.inst,delete n.continue,e?.reportInput||delete n.input,n}function Mp(t){return t instanceof Set?"set":t instanceof Map?"map":t instanceof File?"file":"unknown"}function zp(t){return Array.isArray(t)?"array":typeof t=="string"?"string":"unknown"}function B(t){let e=typeof t;switch(e){case"number":return Number.isNaN(t)?"nan":"number";case"object":{if(t===null)return"null";if(Array.isArray(t))return"array";let r=t;if(r&&Object.getPrototypeOf(r)!==Object.prototype&&"constructor"in r&&r.constructor)return r.constructor.name}}return e}function Zc(...t){let[e,r,n]=t;return typeof e=="string"?{message:e,code:"custom",input:r,inst:n}:{...e}}function jZ(t){return Object.entries(t).filter(([e,r])=>Number.isNaN(Number.parseInt(e,10))).map(e=>e[1])}function QN(t){let e=atob(t),r=new Uint8Array(e.length);for(let n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return r}function eR(t){let e="";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return btoa(e)}function DZ(t){let e=t.replace(/-/g,"+").replace(/_/g,"/"),r="=".repeat((4-e.length%4)%4);return QN(e+r)}function LZ(t){return eR(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function UZ(t){let e=t.replace(/^0x/,"");if(e.length%2!==0)throw new Error("Invalid hex string length");let r=new Uint8Array(e.length/2);for(let n=0;n<e.length;n+=2)r[n/2]=Number.parseInt(e.slice(n,n+2),16);return r}function FZ(t){return Array.from(t).map(e=>e.toString(16).padStart(2,"0")).join("")}var nw=class{constructor(...e){}};var tR=(t,e)=>{t.name="$ZodError",Object.defineProperty(t,"_zod",{value:t._zod,enumerable:!1}),Object.defineProperty(t,"issues",{value:e,enumerable:!1}),t.message=JSON.stringify(e,Bc,2),Object.defineProperty(t,"toString",{value:()=>t.message,enumerable:!1})},jp=I("$ZodError",tR),Br=I("$ZodError",tR,{Parent:Error});function Dp(t,e=r=>r.message){let r={},n=[];for(let i of t.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(e(i))):n.push(e(i));return{formErrors:n,fieldErrors:r}}function Lp(t,e=r=>r.message){let r={_errors:[]},n=i=>{for(let o of i.issues)if(o.code==="invalid_union"&&o.errors.length)o.errors.map(a=>n({issues:a}));else if(o.code==="invalid_key")n({issues:o.issues});else if(o.code==="invalid_element")n({issues:o.issues});else if(o.path.length===0)r._errors.push(e(o));else{let a=r,s=0;for(;s<o.path.length;){let c=o.path[s];s===o.path.length-1?(a[c]=a[c]||{_errors:[]},a[c]._errors.push(e(o))):a[c]=a[c]||{_errors:[]},a=a[c],s++}}};return n(t),r}function dw(t,e=r=>r.message){let r={errors:[]},n=(i,o=[])=>{var a,s;for(let c of i.issues)if(c.code==="invalid_union"&&c.errors.length)c.errors.map(u=>n({issues:u},c.path));else if(c.code==="invalid_key")n({issues:c.issues},c.path);else if(c.code==="invalid_element")n({issues:c.issues},c.path);else{let u=[...o,...c.path];if(u.length===0){r.errors.push(e(c));continue}let l=r,p=0;for(;p<u.length;){let f=u[p],m=p===u.length-1;typeof f=="string"?(l.properties??(l.properties={}),(a=l.properties)[f]??(a[f]={errors:[]}),l=l.properties[f]):(l.items??(l.items=[]),(s=l.items)[f]??(s[f]={errors:[]}),l=l.items[f]),m&&l.errors.push(e(c)),p++}}};return n(t),r}function rR(t){let e=[],r=t.map(n=>typeof n=="object"?n.key:n);for(let n of r)typeof n=="number"?e.push(`[${n}]`):typeof n=="symbol"?e.push(`[${JSON.stringify(String(n))}]`):/[^\w$]/.test(n)?e.push(`[${JSON.stringify(n)}]`):(e.length&&e.push("."),e.push(n));return e.join("")}function fw(t){let e=[],r=[...t.issues].sort((n,i)=>(n.path??[]).length-(i.path??[]).length);for(let n of r)e.push(`\u2716 ${n.message}`),n.path?.length&&e.push(`  \u2192 at ${rR(n.path)}`);return e.join(`
`)}var Gc=t=>(e,r,n,i)=>{let o=n?Object.assign(n,{async:!1}):{async:!1},a=e._zod.run({value:r,issues:[]},o);if(a instanceof Promise)throw new Vn;if(a.issues.length){let s=new(i?.Err??t)(a.issues.map(c=>Fr(c,o,bt())));throw ch(s,i?.callee),s}return a.value},ki=Gc(Br),Hc=t=>async(e,r,n,i)=>{let o=n?Object.assign(n,{async:!0}):{async:!0},a=e._zod.run({value:r,issues:[]},o);if(a instanceof Promise&&(a=await a),a.issues.length){let s=new(i?.Err??t)(a.issues.map(c=>Fr(c,o,bt())));throw ch(s,i?.callee),s}return a.value},fs=Hc(Br),qc=t=>(e,r,n)=>{let i=n?{...n,async:!1}:{async:!1},o=e._zod.run({value:r,issues:[]},i);if(o instanceof Promise)throw new Vn;return o.issues.length?{success:!1,error:new(t??jp)(o.issues.map(a=>Fr(a,i,bt())))}:{success:!0,data:o.value}},mw=qc(Br),Kc=t=>async(e,r,n)=>{let i=n?Object.assign(n,{async:!0}):{async:!0},o=e._zod.run({value:r,issues:[]},i);return o instanceof Promise&&(o=await o),o.issues.length?{success:!1,error:new t(o.issues.map(a=>Fr(a,i,bt())))}:{success:!0,data:o.value}},hw=Kc(Br),uh=t=>(e,r,n)=>{let i=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return Gc(t)(e,r,i)},VZ=uh(Br),lh=t=>(e,r,n)=>Gc(t)(e,r,n),ZZ=lh(Br),ph=t=>async(e,r,n)=>{let i=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return Hc(t)(e,r,i)},GZ=ph(Br),dh=t=>async(e,r,n)=>Hc(t)(e,r,n),HZ=dh(Br),fh=t=>(e,r,n)=>{let i=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return qc(t)(e,r,i)},qZ=fh(Br),mh=t=>(e,r,n)=>qc(t)(e,r,n),KZ=mh(Br),hh=t=>async(e,r,n)=>{let i=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return Kc(t)(e,r,i)},WZ=hh(Br),gh=t=>async(e,r,n)=>Kc(t)(e,r,n),JZ=gh(Br);var kn={};hi(kn,{base64:()=>Cw,base64url:()=>_h,bigint:()=>jw,boolean:()=>Lw,browserEmail:()=>i9,cidrv4:()=>$w,cidrv6:()=>Ow,cuid:()=>gw,cuid2:()=>_w,date:()=>Nw,datetime:()=>Mw,domain:()=>s9,duration:()=>xw,e164:()=>Pw,email:()=>Iw,emoji:()=>kw,extendedDuration:()=>XZ,guid:()=>Sw,hex:()=>c9,hostname:()=>a9,html5Email:()=>t9,idnEmail:()=>n9,integer:()=>Dw,ipv4:()=>Ew,ipv6:()=>Aw,ksuid:()=>bw,lowercase:()=>Bw,mac:()=>Tw,md5_base64:()=>l9,md5_base64url:()=>p9,md5_hex:()=>u9,nanoid:()=>ww,null:()=>Uw,number:()=>yh,rfc5322Email:()=>r9,sha1_base64:()=>f9,sha1_base64url:()=>m9,sha1_hex:()=>d9,sha256_base64:()=>g9,sha256_base64url:()=>_9,sha256_hex:()=>h9,sha384_base64:()=>v9,sha384_base64url:()=>b9,sha384_hex:()=>y9,sha512_base64:()=>x9,sha512_base64url:()=>S9,sha512_hex:()=>w9,string:()=>zw,time:()=>Rw,ulid:()=>yw,undefined:()=>Fw,unicodeEmail:()=>nR,uppercase:()=>Vw,uuid:()=>ms,uuid4:()=>YZ,uuid6:()=>QZ,uuid7:()=>e9,xid:()=>vw});var gw=/^[cC][^\s-]{8,}$/,_w=/^[0-9a-z]+$/,yw=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,vw=/^[0-9a-vA-V]{20}$/,bw=/^[A-Za-z0-9]{27}$/,ww=/^[a-zA-Z0-9_-]{21}$/,xw=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,XZ=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Sw=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,ms=t=>t?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${t}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,YZ=ms(4),QZ=ms(6),e9=ms(7),Iw=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,t9=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,r9=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,nR=/^[^\s@"]{1,64}@[^\s@]{1,255}$/u,n9=nR,i9=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,o9="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function kw(){return new RegExp(o9,"u")}var Ew=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Aw=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,Tw=t=>{let e=In(t??":");return new RegExp(`^(?:[0-9A-F]{2}${e}){5}[0-9A-F]{2}$|^(?:[0-9a-f]{2}${e}){5}[0-9a-f]{2}$`)},$w=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,Ow=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Cw=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,_h=/^[A-Za-z0-9_-]*$/,a9=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,s9=/^([a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/,Pw=/^\+[1-9]\d{6,14}$/,iR="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",Nw=new RegExp(`^${iR}$`);function oR(t){let e="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof t.precision=="number"?t.precision===-1?`${e}`:t.precision===0?`${e}:[0-5]\\d`:`${e}:[0-5]\\d\\.\\d{${t.precision}}`:`${e}(?::[0-5]\\d(?:\\.\\d+)?)?`}function Rw(t){return new RegExp(`^${oR(t)}$`)}function Mw(t){let e=oR({precision:t.precision}),r=["Z"];t.local&&r.push(""),t.offset&&r.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");let n=`${e}(?:${r.join("|")})`;return new RegExp(`^${iR}T(?:${n})$`)}var zw=t=>{let e=t?`[\\s\\S]{${t?.minimum??0},${t?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${e}$`)},jw=/^-?\d+n?$/,Dw=/^-?\d+$/,yh=/^-?\d+(?:\.\d+)?$/,Lw=/^(?:true|false)$/i,Uw=/^null$/i;var Fw=/^undefined$/i;var Bw=/^[^A-Z]*$/,Vw=/^[^a-z]*$/,c9=/^[0-9a-fA-F]*$/;function Up(t,e){return new RegExp(`^[A-Za-z0-9+/]{${t}}${e}$`)}function Fp(t){return new RegExp(`^[A-Za-z0-9_-]{${t}}$`)}var u9=/^[0-9a-fA-F]{32}$/,l9=Up(22,"=="),p9=Fp(22),d9=/^[0-9a-fA-F]{40}$/,f9=Up(27,"="),m9=Fp(27),h9=/^[0-9a-fA-F]{64}$/,g9=Up(43,"="),_9=Fp(43),y9=/^[0-9a-fA-F]{96}$/,v9=Up(64,""),b9=Fp(64),w9=/^[0-9a-fA-F]{128}$/,x9=Up(86,"=="),S9=Fp(86);var tt=I("$ZodCheck",(t,e)=>{var r;t._zod??(t._zod={}),t._zod.def=e,(r=t._zod).onattach??(r.onattach=[])}),sR={number:"number",bigint:"bigint",object:"date"},vh=I("$ZodCheckLessThan",(t,e)=>{tt.init(t,e);let r=sR[typeof e.value];t._zod.onattach.push(n=>{let i=n._zod.bag,o=(e.inclusive?i.maximum:i.exclusiveMaximum)??Number.POSITIVE_INFINITY;e.value<o&&(e.inclusive?i.maximum=e.value:i.exclusiveMaximum=e.value)}),t._zod.check=n=>{(e.inclusive?n.value<=e.value:n.value<e.value)||n.issues.push({origin:r,code:"too_big",maximum:typeof e.value=="object"?e.value.getTime():e.value,input:n.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),bh=I("$ZodCheckGreaterThan",(t,e)=>{tt.init(t,e);let r=sR[typeof e.value];t._zod.onattach.push(n=>{let i=n._zod.bag,o=(e.inclusive?i.minimum:i.exclusiveMinimum)??Number.NEGATIVE_INFINITY;e.value>o&&(e.inclusive?i.minimum=e.value:i.exclusiveMinimum=e.value)}),t._zod.check=n=>{(e.inclusive?n.value>=e.value:n.value>e.value)||n.issues.push({origin:r,code:"too_small",minimum:typeof e.value=="object"?e.value.getTime():e.value,input:n.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),Zw=I("$ZodCheckMultipleOf",(t,e)=>{tt.init(t,e),t._zod.onattach.push(r=>{var n;(n=r._zod.bag).multipleOf??(n.multipleOf=e.value)}),t._zod.check=r=>{if(typeof r.value!=typeof e.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof r.value=="bigint"?r.value%e.value===BigInt(0):iw(r.value,e.value)===0)||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:e.value,input:r.value,inst:t,continue:!e.abort})}}),Gw=I("$ZodCheckNumberFormat",(t,e)=>{tt.init(t,e),e.format=e.format||"float64";let r=e.format?.includes("int"),n=r?"int":"number",[i,o]=lw[e.format];t._zod.onattach.push(a=>{let s=a._zod.bag;s.format=e.format,s.minimum=i,s.maximum=o,r&&(s.pattern=Dw)}),t._zod.check=a=>{let s=a.value;if(r){if(!Number.isInteger(s)){a.issues.push({expected:n,format:e.format,code:"invalid_type",continue:!1,input:s,inst:t});return}if(!Number.isSafeInteger(s)){s>0?a.issues.push({input:s,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:n,inclusive:!0,continue:!e.abort}):a.issues.push({input:s,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:n,inclusive:!0,continue:!e.abort});return}}s<i&&a.issues.push({origin:"number",input:s,code:"too_small",minimum:i,inclusive:!0,inst:t,continue:!e.abort}),s>o&&a.issues.push({origin:"number",input:s,code:"too_big",maximum:o,inclusive:!0,inst:t,continue:!e.abort})}}),Hw=I("$ZodCheckBigIntFormat",(t,e)=>{tt.init(t,e);let[r,n]=pw[e.format];t._zod.onattach.push(i=>{let o=i._zod.bag;o.format=e.format,o.minimum=r,o.maximum=n}),t._zod.check=i=>{let o=i.value;o<r&&i.issues.push({origin:"bigint",input:o,code:"too_small",minimum:r,inclusive:!0,inst:t,continue:!e.abort}),o>n&&i.issues.push({origin:"bigint",input:o,code:"too_big",maximum:n,inclusive:!0,inst:t,continue:!e.abort})}}),qw=I("$ZodCheckMaxSize",(t,e)=>{var r;tt.init(t,e),(r=t._zod.def).when??(r.when=n=>{let i=n.value;return!pa(i)&&i.size!==void 0}),t._zod.onattach.push(n=>{let i=n._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<i&&(n._zod.bag.maximum=e.maximum)}),t._zod.check=n=>{let i=n.value;i.size<=e.maximum||n.issues.push({origin:Mp(i),code:"too_big",maximum:e.maximum,inclusive:!0,input:i,inst:t,continue:!e.abort})}}),Kw=I("$ZodCheckMinSize",(t,e)=>{var r;tt.init(t,e),(r=t._zod.def).when??(r.when=n=>{let i=n.value;return!pa(i)&&i.size!==void 0}),t._zod.onattach.push(n=>{let i=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>i&&(n._zod.bag.minimum=e.minimum)}),t._zod.check=n=>{let i=n.value;i.size>=e.minimum||n.issues.push({origin:Mp(i),code:"too_small",minimum:e.minimum,inclusive:!0,input:i,inst:t,continue:!e.abort})}}),Ww=I("$ZodCheckSizeEquals",(t,e)=>{var r;tt.init(t,e),(r=t._zod.def).when??(r.when=n=>{let i=n.value;return!pa(i)&&i.size!==void 0}),t._zod.onattach.push(n=>{let i=n._zod.bag;i.minimum=e.size,i.maximum=e.size,i.size=e.size}),t._zod.check=n=>{let i=n.value,o=i.size;if(o===e.size)return;let a=o>e.size;n.issues.push({origin:Mp(i),...a?{code:"too_big",maximum:e.size}:{code:"too_small",minimum:e.size},inclusive:!0,exact:!0,input:n.value,inst:t,continue:!e.abort})}}),Jw=I("$ZodCheckMaxLength",(t,e)=>{var r;tt.init(t,e),(r=t._zod.def).when??(r.when=n=>{let i=n.value;return!pa(i)&&i.length!==void 0}),t._zod.onattach.push(n=>{let i=n._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<i&&(n._zod.bag.maximum=e.maximum)}),t._zod.check=n=>{let i=n.value;if(i.length<=e.maximum)return;let a=zp(i);n.issues.push({origin:a,code:"too_big",maximum:e.maximum,inclusive:!0,input:i,inst:t,continue:!e.abort})}}),Xw=I("$ZodCheckMinLength",(t,e)=>{var r;tt.init(t,e),(r=t._zod.def).when??(r.when=n=>{let i=n.value;return!pa(i)&&i.length!==void 0}),t._zod.onattach.push(n=>{let i=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>i&&(n._zod.bag.minimum=e.minimum)}),t._zod.check=n=>{let i=n.value;if(i.length>=e.minimum)return;let a=zp(i);n.issues.push({origin:a,code:"too_small",minimum:e.minimum,inclusive:!0,input:i,inst:t,continue:!e.abort})}}),Yw=I("$ZodCheckLengthEquals",(t,e)=>{var r;tt.init(t,e),(r=t._zod.def).when??(r.when=n=>{let i=n.value;return!pa(i)&&i.length!==void 0}),t._zod.onattach.push(n=>{let i=n._zod.bag;i.minimum=e.length,i.maximum=e.length,i.length=e.length}),t._zod.check=n=>{let i=n.value,o=i.length;if(o===e.length)return;let a=zp(i),s=o>e.length;n.issues.push({origin:a,...s?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length},inclusive:!0,exact:!0,input:n.value,inst:t,continue:!e.abort})}}),Wc=I("$ZodCheckStringFormat",(t,e)=>{var r,n;tt.init(t,e),t._zod.onattach.push(i=>{let o=i._zod.bag;o.format=e.format,e.pattern&&(o.patterns??(o.patterns=new Set),o.patterns.add(e.pattern))}),e.pattern?(r=t._zod).check??(r.check=i=>{e.pattern.lastIndex=0,!e.pattern.test(i.value)&&i.issues.push({origin:"string",code:"invalid_format",format:e.format,input:i.value,...e.pattern?{pattern:e.pattern.toString()}:{},inst:t,continue:!e.abort})}):(n=t._zod).check??(n.check=()=>{})}),Qw=I("$ZodCheckRegex",(t,e)=>{Wc.init(t,e),t._zod.check=r=>{e.pattern.lastIndex=0,!e.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:e.pattern.toString(),inst:t,continue:!e.abort})}}),ex=I("$ZodCheckLowerCase",(t,e)=>{e.pattern??(e.pattern=Bw),Wc.init(t,e)}),tx=I("$ZodCheckUpperCase",(t,e)=>{e.pattern??(e.pattern=Vw),Wc.init(t,e)}),rx=I("$ZodCheckIncludes",(t,e)=>{tt.init(t,e);let r=In(e.includes),n=new RegExp(typeof e.position=="number"?`^.{${e.position}}${r}`:r);e.pattern=n,t._zod.onattach.push(i=>{let o=i._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(n)}),t._zod.check=i=>{i.value.includes(e.includes,e.position)||i.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:e.includes,input:i.value,inst:t,continue:!e.abort})}}),nx=I("$ZodCheckStartsWith",(t,e)=>{tt.init(t,e);let r=new RegExp(`^${In(e.prefix)}.*`);e.pattern??(e.pattern=r),t._zod.onattach.push(n=>{let i=n._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(r)}),t._zod.check=n=>{n.value.startsWith(e.prefix)||n.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:e.prefix,input:n.value,inst:t,continue:!e.abort})}}),ix=I("$ZodCheckEndsWith",(t,e)=>{tt.init(t,e);let r=new RegExp(`.*${In(e.suffix)}$`);e.pattern??(e.pattern=r),t._zod.onattach.push(n=>{let i=n._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(r)}),t._zod.check=n=>{n.value.endsWith(e.suffix)||n.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:e.suffix,input:n.value,inst:t,continue:!e.abort})}});function aR(t,e,r){t.issues.length&&e.issues.push(...rn(r,t.issues))}var ox=I("$ZodCheckProperty",(t,e)=>{tt.init(t,e),t._zod.check=r=>{let n=e.schema._zod.run({value:r.value[e.property],issues:[]},{});if(n instanceof Promise)return n.then(i=>aR(i,r,e.property));aR(n,r,e.property)}}),ax=I("$ZodCheckMimeType",(t,e)=>{tt.init(t,e);let r=new Set(e.mime);t._zod.onattach.push(n=>{n._zod.bag.mime=e.mime}),t._zod.check=n=>{r.has(n.value.type)||n.issues.push({code:"invalid_value",values:e.mime,input:n.value.type,inst:t,continue:!e.abort})}}),sx=I("$ZodCheckOverwrite",(t,e)=>{tt.init(t,e),t._zod.check=r=>{r.value=e.tx(r.value)}});var Bp=class{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if(typeof e=="function"){e(this,{execution:"sync"}),e(this,{execution:"async"});return}let n=e.split(`
`).filter(a=>a),i=Math.min(...n.map(a=>a.length-a.trimStart().length)),o=n.map(a=>a.slice(i)).map(a=>" ".repeat(this.indent*2)+a);for(let a of o)this.content.push(a)}compile(){let e=Function,r=this?.args,i=[...(this?.content??[""]).map(o=>`  ${o}`)];return new e(...r,i.join(`
`))}};var cx={major:4,minor:3,patch:5};var we=I("$ZodType",(t,e)=>{var r;t??(t={}),t._zod.def=e,t._zod.bag=t._zod.bag||{},t._zod.version=cx;let n=[...t._zod.def.checks??[]];t._zod.traits.has("$ZodCheck")&&n.unshift(t);for(let i of n)for(let o of i._zod.onattach)o(t);if(n.length===0)(r=t._zod).deferred??(r.deferred=[]),t._zod.deferred?.push(()=>{t._zod.run=t._zod.parse});else{let i=(a,s,c)=>{let u=ma(a),l;for(let p of s){if(p._zod.def.when){if(!p._zod.def.when(a))continue}else if(u)continue;let f=a.issues.length,m=p._zod.check(a);if(m instanceof Promise&&c?.async===!1)throw new Vn;if(l||m instanceof Promise)l=(l??Promise.resolve()).then(async()=>{await m,a.issues.length!==f&&(u||(u=ma(a,f)))});else{if(a.issues.length===f)continue;u||(u=ma(a,f))}}return l?l.then(()=>a):a},o=(a,s,c)=>{if(ma(a))return a.aborted=!0,a;let u=i(s,n,c);if(u instanceof Promise){if(c.async===!1)throw new Vn;return u.then(l=>t._zod.parse(l,c))}return t._zod.parse(u,c)};t._zod.run=(a,s)=>{if(s.skipChecks)return t._zod.parse(a,s);if(s.direction==="backward"){let u=t._zod.parse({value:a.value,issues:[]},{...s,skipChecks:!0});return u instanceof Promise?u.then(l=>o(l,a,s)):o(u,a,s)}let c=t._zod.parse(a,s);if(c instanceof Promise){if(s.async===!1)throw new Vn;return c.then(u=>i(u,n,s))}return i(c,n,s)}}Ce(t,"~standard",()=>({validate:i=>{try{let o=mw(t,i);return o.success?{value:o.data}:{issues:o.error?.issues}}catch{return hw(t,i).then(a=>a.success?{value:a.data}:{issues:a.error?.issues})}},vendor:"zod",version:1}))}),hs=I("$ZodString",(t,e)=>{we.init(t,e),t._zod.pattern=[...t?._zod.bag?.patterns??[]].pop()??zw(t._zod.bag),t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:t}),r}}),Xe=I("$ZodStringFormat",(t,e)=>{Wc.init(t,e),hs.init(t,e)}),lx=I("$ZodGUID",(t,e)=>{e.pattern??(e.pattern=Sw),Xe.init(t,e)}),px=I("$ZodUUID",(t,e)=>{if(e.version){let n={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[e.version];if(n===void 0)throw new Error(`Invalid UUID version: "${e.version}"`);e.pattern??(e.pattern=ms(n))}else e.pattern??(e.pattern=ms());Xe.init(t,e)}),dx=I("$ZodEmail",(t,e)=>{e.pattern??(e.pattern=Iw),Xe.init(t,e)}),fx=I("$ZodURL",(t,e)=>{Xe.init(t,e),t._zod.check=r=>{try{let n=r.value.trim(),i=new URL(n);e.hostname&&(e.hostname.lastIndex=0,e.hostname.test(i.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:e.hostname.source,input:r.value,inst:t,continue:!e.abort})),e.protocol&&(e.protocol.lastIndex=0,e.protocol.test(i.protocol.endsWith(":")?i.protocol.slice(0,-1):i.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:e.protocol.source,input:r.value,inst:t,continue:!e.abort})),e.normalize?r.value=i.href:r.value=n;return}catch{r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:t,continue:!e.abort})}}}),mx=I("$ZodEmoji",(t,e)=>{e.pattern??(e.pattern=kw()),Xe.init(t,e)}),hx=I("$ZodNanoID",(t,e)=>{e.pattern??(e.pattern=ww),Xe.init(t,e)}),gx=I("$ZodCUID",(t,e)=>{e.pattern??(e.pattern=gw),Xe.init(t,e)}),_x=I("$ZodCUID2",(t,e)=>{e.pattern??(e.pattern=_w),Xe.init(t,e)}),yx=I("$ZodULID",(t,e)=>{e.pattern??(e.pattern=yw),Xe.init(t,e)}),vx=I("$ZodXID",(t,e)=>{e.pattern??(e.pattern=vw),Xe.init(t,e)}),bx=I("$ZodKSUID",(t,e)=>{e.pattern??(e.pattern=bw),Xe.init(t,e)}),wx=I("$ZodISODateTime",(t,e)=>{e.pattern??(e.pattern=Mw(e)),Xe.init(t,e)}),xx=I("$ZodISODate",(t,e)=>{e.pattern??(e.pattern=Nw),Xe.init(t,e)}),Sx=I("$ZodISOTime",(t,e)=>{e.pattern??(e.pattern=Rw(e)),Xe.init(t,e)}),Ix=I("$ZodISODuration",(t,e)=>{e.pattern??(e.pattern=xw),Xe.init(t,e)}),kx=I("$ZodIPv4",(t,e)=>{e.pattern??(e.pattern=Ew),Xe.init(t,e),t._zod.bag.format="ipv4"}),Ex=I("$ZodIPv6",(t,e)=>{e.pattern??(e.pattern=Aw),Xe.init(t,e),t._zod.bag.format="ipv6",t._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:t,continue:!e.abort})}}}),Ax=I("$ZodMAC",(t,e)=>{e.pattern??(e.pattern=Tw(e.delimiter)),Xe.init(t,e),t._zod.bag.format="mac"}),Tx=I("$ZodCIDRv4",(t,e)=>{e.pattern??(e.pattern=$w),Xe.init(t,e)}),$x=I("$ZodCIDRv6",(t,e)=>{e.pattern??(e.pattern=Ow),Xe.init(t,e),t._zod.check=r=>{let n=r.value.split("/");try{if(n.length!==2)throw new Error;let[i,o]=n;if(!o)throw new Error;let a=Number(o);if(`${a}`!==o)throw new Error;if(a<0||a>128)throw new Error;new URL(`http://[${i}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:t,continue:!e.abort})}}});function Ox(t){if(t==="")return!0;if(t.length%4!==0)return!1;try{return atob(t),!0}catch{return!1}}var Cx=I("$ZodBase64",(t,e)=>{e.pattern??(e.pattern=Cw),Xe.init(t,e),t._zod.bag.contentEncoding="base64",t._zod.check=r=>{Ox(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:t,continue:!e.abort})}});function bR(t){if(!_h.test(t))return!1;let e=t.replace(/[-_]/g,n=>n==="-"?"+":"/"),r=e.padEnd(Math.ceil(e.length/4)*4,"=");return Ox(r)}var Px=I("$ZodBase64URL",(t,e)=>{e.pattern??(e.pattern=_h),Xe.init(t,e),t._zod.bag.contentEncoding="base64url",t._zod.check=r=>{bR(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:t,continue:!e.abort})}}),Nx=I("$ZodE164",(t,e)=>{e.pattern??(e.pattern=Pw),Xe.init(t,e)});function wR(t,e=null){try{let r=t.split(".");if(r.length!==3)return!1;let[n]=r;if(!n)return!1;let i=JSON.parse(atob(n));return!("typ"in i&&i?.typ!=="JWT"||!i.alg||e&&(!("alg"in i)||i.alg!==e))}catch{return!1}}var Rx=I("$ZodJWT",(t,e)=>{Xe.init(t,e),t._zod.check=r=>{wR(r.value,e.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:t,continue:!e.abort})}}),Mx=I("$ZodCustomStringFormat",(t,e)=>{Xe.init(t,e),t._zod.check=r=>{e.fn(r.value)||r.issues.push({code:"invalid_format",format:e.format,input:r.value,inst:t,continue:!e.abort})}}),Eh=I("$ZodNumber",(t,e)=>{we.init(t,e),t._zod.pattern=t._zod.bag.pattern??yh,t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=Number(r.value)}catch{}let i=r.value;if(typeof i=="number"&&!Number.isNaN(i)&&Number.isFinite(i))return r;let o=typeof i=="number"?Number.isNaN(i)?"NaN":Number.isFinite(i)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:i,inst:t,...o?{received:o}:{}}),r}}),zx=I("$ZodNumberFormat",(t,e)=>{Gw.init(t,e),Eh.init(t,e)}),Vp=I("$ZodBoolean",(t,e)=>{we.init(t,e),t._zod.pattern=Lw,t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=!!r.value}catch{}let i=r.value;return typeof i=="boolean"||r.issues.push({expected:"boolean",code:"invalid_type",input:i,inst:t}),r}}),Ah=I("$ZodBigInt",(t,e)=>{we.init(t,e),t._zod.pattern=jw,t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=BigInt(r.value)}catch{}return typeof r.value=="bigint"||r.issues.push({expected:"bigint",code:"invalid_type",input:r.value,inst:t}),r}}),jx=I("$ZodBigIntFormat",(t,e)=>{Hw.init(t,e),Ah.init(t,e)}),Dx=I("$ZodSymbol",(t,e)=>{we.init(t,e),t._zod.parse=(r,n)=>{let i=r.value;return typeof i=="symbol"||r.issues.push({expected:"symbol",code:"invalid_type",input:i,inst:t}),r}}),Lx=I("$ZodUndefined",(t,e)=>{we.init(t,e),t._zod.pattern=Fw,t._zod.values=new Set([void 0]),t._zod.optin="optional",t._zod.optout="optional",t._zod.parse=(r,n)=>{let i=r.value;return typeof i>"u"||r.issues.push({expected:"undefined",code:"invalid_type",input:i,inst:t}),r}}),Ux=I("$ZodNull",(t,e)=>{we.init(t,e),t._zod.pattern=Uw,t._zod.values=new Set([null]),t._zod.parse=(r,n)=>{let i=r.value;return i===null||r.issues.push({expected:"null",code:"invalid_type",input:i,inst:t}),r}}),Fx=I("$ZodAny",(t,e)=>{we.init(t,e),t._zod.parse=r=>r}),Zp=I("$ZodUnknown",(t,e)=>{we.init(t,e),t._zod.parse=r=>r}),Gp=I("$ZodNever",(t,e)=>{we.init(t,e),t._zod.parse=(r,n)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:t}),r)}),Bx=I("$ZodVoid",(t,e)=>{we.init(t,e),t._zod.parse=(r,n)=>{let i=r.value;return typeof i>"u"||r.issues.push({expected:"void",code:"invalid_type",input:i,inst:t}),r}}),Vx=I("$ZodDate",(t,e)=>{we.init(t,e),t._zod.parse=(r,n)=>{if(e.coerce)try{r.value=new Date(r.value)}catch{}let i=r.value,o=i instanceof Date;return o&&!Number.isNaN(i.getTime())||r.issues.push({expected:"date",code:"invalid_type",input:i,...o?{received:"Invalid Date"}:{},inst:t}),r}});function uR(t,e,r){t.issues.length&&e.issues.push(...rn(r,t.issues)),e.value[r]=t.value}var Zx=I("$ZodArray",(t,e)=>{we.init(t,e),t._zod.parse=(r,n)=>{let i=r.value;if(!Array.isArray(i))return r.issues.push({expected:"array",code:"invalid_type",input:i,inst:t}),r;r.value=Array(i.length);let o=[];for(let a=0;a<i.length;a++){let s=i[a],c=e.element._zod.run({value:s,issues:[]},n);c instanceof Promise?o.push(c.then(u=>uR(u,r,a))):uR(c,r,a)}return o.length?Promise.all(o).then(()=>r):r}});function kh(t,e,r,n,i){if(t.issues.length){if(i&&!(r in n))return;e.issues.push(...rn(r,t.issues))}t.value===void 0?r in n&&(e.value[r]=void 0):e.value[r]=t.value}function xR(t){let e=Object.keys(t.shape);for(let n of e)if(!t.shape?.[n]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${n}": expected a Zod schema`);let r=uw(t.shape);return{...t,keys:e,keySet:new Set(e),numKeys:e.length,optionalKeys:new Set(r)}}function SR(t,e,r,n,i,o){let a=[],s=i.keySet,c=i.catchall._zod,u=c.def.type,l=c.optout==="optional";for(let p in e){if(s.has(p))continue;if(u==="never"){a.push(p);continue}let f=c.run({value:e[p],issues:[]},n);f instanceof Promise?t.push(f.then(m=>kh(m,r,p,e,l))):kh(f,r,p,e,l)}return a.length&&r.issues.push({code:"unrecognized_keys",keys:a,input:e,inst:o}),t.length?Promise.all(t).then(()=>r):r}var IR=I("$ZodObject",(t,e)=>{if(we.init(t,e),!Object.getOwnPropertyDescriptor(e,"shape")?.get){let s=e.shape;Object.defineProperty(e,"shape",{get:()=>{let c={...s};return Object.defineProperty(e,"shape",{value:c}),c}})}let n=Vc(()=>xR(e));Ce(t._zod,"propValues",()=>{let s=e.shape,c={};for(let u in s){let l=s[u]._zod;if(l.values){c[u]??(c[u]=new Set);for(let p of l.values)c[u].add(p)}}return c});let i=ds,o=e.catchall,a;t._zod.parse=(s,c)=>{a??(a=n.value);let u=s.value;if(!i(u))return s.issues.push({expected:"object",code:"invalid_type",input:u,inst:t}),s;s.value={};let l=[],p=a.shape;for(let f of a.keys){let m=p[f],h=m._zod.optout==="optional",g=m._zod.run({value:u[f],issues:[]},c);g instanceof Promise?l.push(g.then(x=>kh(x,s,f,u,h))):kh(g,s,f,u,h)}return o?SR(l,u,s,c,n.value,t):l.length?Promise.all(l).then(()=>s):s}}),Gx=I("$ZodObjectJIT",(t,e)=>{IR.init(t,e);let r=t._zod.parse,n=Vc(()=>xR(e)),i=f=>{let m=new Bp(["shape","payload","ctx"]),h=n.value,g=S=>{let k=sh(S);return`shape[${k}]._zod.run({ value: input[${k}], issues: [] }, ctx)`};m.write("const input = payload.value;");let x=Object.create(null),y=0;for(let S of h.keys)x[S]=`key_${y++}`;m.write("const newResult = {};");for(let S of h.keys){let k=x[S],T=sh(S),U=f[S]?._zod?.optout==="optional";m.write(`const ${k} = ${g(S)};`),U?m.write(`
        if (${k}.issues.length) {
          if (${T} in input) {
            payload.issues = payload.issues.concat(${k}.issues.map(iss => ({
              ...iss,
              path: iss.path ? [${T}, ...iss.path] : [${T}]
            })));
          }
        }
        
        if (${k}.value === undefined) {
          if (${T} in input) {
            newResult[${T}] = undefined;
          }
        } else {
          newResult[${T}] = ${k}.value;
        }
        
      `):m.write(`
        if (${k}.issues.length) {
          payload.issues = payload.issues.concat(${k}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${T}, ...iss.path] : [${T}]
          })));
        }
        
        if (${k}.value === undefined) {
          if (${T} in input) {
            newResult[${T}] = undefined;
          }
        } else {
          newResult[${T}] = ${k}.value;
        }
        
      `)}m.write("payload.value = newResult;"),m.write("return payload;");let v=m.compile();return(S,k)=>v(f,S,k)},o,a=ds,s=!Op.jitless,u=s&&aw.value,l=e.catchall,p;t._zod.parse=(f,m)=>{p??(p=n.value);let h=f.value;return a(h)?s&&u&&m?.async===!1&&m.jitless!==!0?(o||(o=i(e.shape)),f=o(f,m),l?SR([],h,f,m,p,t):f):r(f,m):(f.issues.push({expected:"object",code:"invalid_type",input:h,inst:t}),f)}});function lR(t,e,r,n){for(let o of t)if(o.issues.length===0)return e.value=o.value,e;let i=t.filter(o=>!ma(o));return i.length===1?(e.value=i[0].value,i[0]):(e.issues.push({code:"invalid_union",input:e.value,inst:r,errors:t.map(o=>o.issues.map(a=>Fr(a,n,bt())))}),e)}var Hp=I("$ZodUnion",(t,e)=>{we.init(t,e),Ce(t._zod,"optin",()=>e.options.some(i=>i._zod.optin==="optional")?"optional":void 0),Ce(t._zod,"optout",()=>e.options.some(i=>i._zod.optout==="optional")?"optional":void 0),Ce(t._zod,"values",()=>{if(e.options.every(i=>i._zod.values))return new Set(e.options.flatMap(i=>Array.from(i._zod.values)))}),Ce(t._zod,"pattern",()=>{if(e.options.every(i=>i._zod.pattern)){let i=e.options.map(o=>o._zod.pattern);return new RegExp(`^(${i.map(o=>Np(o.source)).join("|")})$`)}});let r=e.options.length===1,n=e.options[0]._zod.run;t._zod.parse=(i,o)=>{if(r)return n(i,o);let a=!1,s=[];for(let c of e.options){let u=c._zod.run({value:i.value,issues:[]},o);if(u instanceof Promise)s.push(u),a=!0;else{if(u.issues.length===0)return u;s.push(u)}}return a?Promise.all(s).then(c=>lR(c,i,t,o)):lR(s,i,t,o)}});function pR(t,e,r,n){let i=t.filter(o=>o.issues.length===0);return i.length===1?(e.value=i[0].value,e):(i.length===0?e.issues.push({code:"invalid_union",input:e.value,inst:r,errors:t.map(o=>o.issues.map(a=>Fr(a,n,bt())))}):e.issues.push({code:"invalid_union",input:e.value,inst:r,errors:[],inclusive:!1}),e)}var Hx=I("$ZodXor",(t,e)=>{Hp.init(t,e),e.inclusive=!1;let r=e.options.length===1,n=e.options[0]._zod.run;t._zod.parse=(i,o)=>{if(r)return n(i,o);let a=!1,s=[];for(let c of e.options){let u=c._zod.run({value:i.value,issues:[]},o);u instanceof Promise?(s.push(u),a=!0):s.push(u)}return a?Promise.all(s).then(c=>pR(c,i,t,o)):pR(s,i,t,o)}}),qx=I("$ZodDiscriminatedUnion",(t,e)=>{e.inclusive=!1,Hp.init(t,e);let r=t._zod.parse;Ce(t._zod,"propValues",()=>{let i={};for(let o of e.options){let a=o._zod.propValues;if(!a||Object.keys(a).length===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(o)}"`);for(let[s,c]of Object.entries(a)){i[s]||(i[s]=new Set);for(let u of c)i[s].add(u)}}return i});let n=Vc(()=>{let i=e.options,o=new Map;for(let a of i){let s=a._zod.propValues?.[e.discriminator];if(!s||s.size===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(a)}"`);for(let c of s){if(o.has(c))throw new Error(`Duplicate discriminator value "${String(c)}"`);o.set(c,a)}}return o});t._zod.parse=(i,o)=>{let a=i.value;if(!ds(a))return i.issues.push({code:"invalid_type",expected:"object",input:a,inst:t}),i;let s=n.value.get(a?.[e.discriminator]);return s?s._zod.run(i,o):e.unionFallback?r(i,o):(i.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",discriminator:e.discriminator,input:a,path:[e.discriminator],inst:t}),i)}}),Kx=I("$ZodIntersection",(t,e)=>{we.init(t,e),t._zod.parse=(r,n)=>{let i=r.value,o=e.left._zod.run({value:i,issues:[]},n),a=e.right._zod.run({value:i,issues:[]},n);return o instanceof Promise||a instanceof Promise?Promise.all([o,a]).then(([c,u])=>dR(r,c,u)):dR(r,o,a)}});function ux(t,e){if(t===e)return{valid:!0,data:t};if(t instanceof Date&&e instanceof Date&&+t==+e)return{valid:!0,data:t};if(fa(t)&&fa(e)){let r=Object.keys(e),n=Object.keys(t).filter(o=>r.indexOf(o)!==-1),i={...t,...e};for(let o of n){let a=ux(t[o],e[o]);if(!a.valid)return{valid:!1,mergeErrorPath:[o,...a.mergeErrorPath]};i[o]=a.data}return{valid:!0,data:i}}if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return{valid:!1,mergeErrorPath:[]};let r=[];for(let n=0;n<t.length;n++){let i=t[n],o=e[n],a=ux(i,o);if(!a.valid)return{valid:!1,mergeErrorPath:[n,...a.mergeErrorPath]};r.push(a.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function dR(t,e,r){let n=new Map,i;for(let s of e.issues)if(s.code==="unrecognized_keys"){i??(i=s);for(let c of s.keys)n.has(c)||n.set(c,{}),n.get(c).l=!0}else t.issues.push(s);for(let s of r.issues)if(s.code==="unrecognized_keys")for(let c of s.keys)n.has(c)||n.set(c,{}),n.get(c).r=!0;else t.issues.push(s);let o=[...n].filter(([,s])=>s.l&&s.r).map(([s])=>s);if(o.length&&i&&t.issues.push({...i,keys:o}),ma(t))return t;let a=ux(e.value,r.value);if(!a.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(a.mergeErrorPath)}`);return t.value=a.data,t}var Th=I("$ZodTuple",(t,e)=>{we.init(t,e);let r=e.items;t._zod.parse=(n,i)=>{let o=n.value;if(!Array.isArray(o))return n.issues.push({input:o,inst:t,expected:"tuple",code:"invalid_type"}),n;n.value=[];let a=[],s=[...r].reverse().findIndex(l=>l._zod.optin!=="optional"),c=s===-1?0:r.length-s;if(!e.rest){let l=o.length>r.length,p=o.length<c-1;if(l||p)return n.issues.push({...l?{code:"too_big",maximum:r.length,inclusive:!0}:{code:"too_small",minimum:r.length},input:o,inst:t,origin:"array"}),n}let u=-1;for(let l of r){if(u++,u>=o.length&&u>=c)continue;let p=l._zod.run({value:o[u],issues:[]},i);p instanceof Promise?a.push(p.then(f=>wh(f,n,u))):wh(p,n,u)}if(e.rest){let l=o.slice(r.length);for(let p of l){u++;let f=e.rest._zod.run({value:p,issues:[]},i);f instanceof Promise?a.push(f.then(m=>wh(m,n,u))):wh(f,n,u)}}return a.length?Promise.all(a).then(()=>n):n}});function wh(t,e,r){t.issues.length&&e.issues.push(...rn(r,t.issues)),e.value[r]=t.value}var Wx=I("$ZodRecord",(t,e)=>{we.init(t,e),t._zod.parse=(r,n)=>{let i=r.value;if(!fa(i))return r.issues.push({expected:"record",code:"invalid_type",input:i,inst:t}),r;let o=[],a=e.keyType._zod.values;if(a){r.value={};let s=new Set;for(let u of a)if(typeof u=="string"||typeof u=="number"||typeof u=="symbol"){s.add(typeof u=="number"?u.toString():u);let l=e.valueType._zod.run({value:i[u],issues:[]},n);l instanceof Promise?o.push(l.then(p=>{p.issues.length&&r.issues.push(...rn(u,p.issues)),r.value[u]=p.value})):(l.issues.length&&r.issues.push(...rn(u,l.issues)),r.value[u]=l.value)}let c;for(let u in i)s.has(u)||(c=c??[],c.push(u));c&&c.length>0&&r.issues.push({code:"unrecognized_keys",input:i,inst:t,keys:c})}else{r.value={};for(let s of Reflect.ownKeys(i)){if(s==="__proto__")continue;let c=e.keyType._zod.run({value:s,issues:[]},n);if(c instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(typeof s=="string"&&yh.test(s)&&c.issues.length&&c.issues.some(p=>p.code==="invalid_type"&&p.expected==="number")){let p=e.keyType._zod.run({value:Number(s),issues:[]},n);if(p instanceof Promise)throw new Error("Async schemas not supported in object keys currently");p.issues.length===0&&(c=p)}if(c.issues.length){e.mode==="loose"?r.value[s]=i[s]:r.issues.push({code:"invalid_key",origin:"record",issues:c.issues.map(p=>Fr(p,n,bt())),input:s,path:[s],inst:t});continue}let l=e.valueType._zod.run({value:i[s],issues:[]},n);l instanceof Promise?o.push(l.then(p=>{p.issues.length&&r.issues.push(...rn(s,p.issues)),r.value[c.value]=p.value})):(l.issues.length&&r.issues.push(...rn(s,l.issues)),r.value[c.value]=l.value)}}return o.length?Promise.all(o).then(()=>r):r}}),Jx=I("$ZodMap",(t,e)=>{we.init(t,e),t._zod.parse=(r,n)=>{let i=r.value;if(!(i instanceof Map))return r.issues.push({expected:"map",code:"invalid_type",input:i,inst:t}),r;let o=[];r.value=new Map;for(let[a,s]of i){let c=e.keyType._zod.run({value:a,issues:[]},n),u=e.valueType._zod.run({value:s,issues:[]},n);c instanceof Promise||u instanceof Promise?o.push(Promise.all([c,u]).then(([l,p])=>{fR(l,p,r,a,i,t,n)})):fR(c,u,r,a,i,t,n)}return o.length?Promise.all(o).then(()=>r):r}});function fR(t,e,r,n,i,o,a){t.issues.length&&(Rp.has(typeof n)?r.issues.push(...rn(n,t.issues)):r.issues.push({code:"invalid_key",origin:"map",input:i,inst:o,issues:t.issues.map(s=>Fr(s,a,bt()))})),e.issues.length&&(Rp.has(typeof n)?r.issues.push(...rn(n,e.issues)):r.issues.push({origin:"map",code:"invalid_element",input:i,inst:o,key:n,issues:e.issues.map(s=>Fr(s,a,bt()))})),r.value.set(t.value,e.value)}var Xx=I("$ZodSet",(t,e)=>{we.init(t,e),t._zod.parse=(r,n)=>{let i=r.value;if(!(i instanceof Set))return r.issues.push({input:i,inst:t,expected:"set",code:"invalid_type"}),r;let o=[];r.value=new Set;for(let a of i){let s=e.valueType._zod.run({value:a,issues:[]},n);s instanceof Promise?o.push(s.then(c=>mR(c,r))):mR(s,r)}return o.length?Promise.all(o).then(()=>r):r}});function mR(t,e){t.issues.length&&e.issues.push(...t.issues),e.value.add(t.value)}var Yx=I("$ZodEnum",(t,e)=>{we.init(t,e);let r=Pp(e.entries),n=new Set(r);t._zod.values=n,t._zod.pattern=new RegExp(`^(${r.filter(i=>Rp.has(typeof i)).map(i=>typeof i=="string"?In(i):i.toString()).join("|")})$`),t._zod.parse=(i,o)=>{let a=i.value;return n.has(a)||i.issues.push({code:"invalid_value",values:r,input:a,inst:t}),i}}),Qx=I("$ZodLiteral",(t,e)=>{if(we.init(t,e),e.values.length===0)throw new Error("Cannot create literal schema with no valid values");let r=new Set(e.values);t._zod.values=r,t._zod.pattern=new RegExp(`^(${e.values.map(n=>typeof n=="string"?In(n):n?In(n.toString()):String(n)).join("|")})$`),t._zod.parse=(n,i)=>{let o=n.value;return r.has(o)||n.issues.push({code:"invalid_value",values:e.values,input:o,inst:t}),n}}),e0=I("$ZodFile",(t,e)=>{we.init(t,e),t._zod.parse=(r,n)=>{let i=r.value;return i instanceof File||r.issues.push({expected:"file",code:"invalid_type",input:i,inst:t}),r}}),t0=I("$ZodTransform",(t,e)=>{we.init(t,e),t._zod.parse=(r,n)=>{if(n.direction==="backward")throw new la(t.constructor.name);let i=e.transform(r.value,r);if(n.async)return(i instanceof Promise?i:Promise.resolve(i)).then(a=>(r.value=a,r));if(i instanceof Promise)throw new Vn;return r.value=i,r}});function hR(t,e){return t.issues.length&&e===void 0?{issues:[],value:void 0}:t}var gs=I("$ZodOptional",(t,e)=>{we.init(t,e),t._zod.optin="optional",t._zod.optout="optional",Ce(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),Ce(t._zod,"pattern",()=>{let r=e.innerType._zod.pattern;return r?new RegExp(`^(${Np(r.source)})?$`):void 0}),t._zod.parse=(r,n)=>{if(e.innerType._zod.optin==="optional"){let i=e.innerType._zod.run(r,n);return i instanceof Promise?i.then(o=>hR(o,r.value)):hR(i,r.value)}return r.value===void 0?r:e.innerType._zod.run(r,n)}}),r0=I("$ZodExactOptional",(t,e)=>{gs.init(t,e),Ce(t._zod,"values",()=>e.innerType._zod.values),Ce(t._zod,"pattern",()=>e.innerType._zod.pattern),t._zod.parse=(r,n)=>e.innerType._zod.run(r,n)}),n0=I("$ZodNullable",(t,e)=>{we.init(t,e),Ce(t._zod,"optin",()=>e.innerType._zod.optin),Ce(t._zod,"optout",()=>e.innerType._zod.optout),Ce(t._zod,"pattern",()=>{let r=e.innerType._zod.pattern;return r?new RegExp(`^(${Np(r.source)}|null)$`):void 0}),Ce(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,null]):void 0),t._zod.parse=(r,n)=>r.value===null?r:e.innerType._zod.run(r,n)}),i0=I("$ZodDefault",(t,e)=>{we.init(t,e),t._zod.optin="optional",Ce(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>{if(n.direction==="backward")return e.innerType._zod.run(r,n);if(r.value===void 0)return r.value=e.defaultValue,r;let i=e.innerType._zod.run(r,n);return i instanceof Promise?i.then(o=>gR(o,e)):gR(i,e)}});function gR(t,e){return t.value===void 0&&(t.value=e.defaultValue),t}var o0=I("$ZodPrefault",(t,e)=>{we.init(t,e),t._zod.optin="optional",Ce(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>(n.direction==="backward"||r.value===void 0&&(r.value=e.defaultValue),e.innerType._zod.run(r,n))}),a0=I("$ZodNonOptional",(t,e)=>{we.init(t,e),Ce(t._zod,"values",()=>{let r=e.innerType._zod.values;return r?new Set([...r].filter(n=>n!==void 0)):void 0}),t._zod.parse=(r,n)=>{let i=e.innerType._zod.run(r,n);return i instanceof Promise?i.then(o=>_R(o,t)):_R(i,t)}});function _R(t,e){return!t.issues.length&&t.value===void 0&&t.issues.push({code:"invalid_type",expected:"nonoptional",input:t.value,inst:e}),t}var s0=I("$ZodSuccess",(t,e)=>{we.init(t,e),t._zod.parse=(r,n)=>{if(n.direction==="backward")throw new la("ZodSuccess");let i=e.innerType._zod.run(r,n);return i instanceof Promise?i.then(o=>(r.value=o.issues.length===0,r)):(r.value=i.issues.length===0,r)}}),c0=I("$ZodCatch",(t,e)=>{we.init(t,e),Ce(t._zod,"optin",()=>e.innerType._zod.optin),Ce(t._zod,"optout",()=>e.innerType._zod.optout),Ce(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(r,n)=>{if(n.direction==="backward")return e.innerType._zod.run(r,n);let i=e.innerType._zod.run(r,n);return i instanceof Promise?i.then(o=>(r.value=o.value,o.issues.length&&(r.value=e.catchValue({...r,error:{issues:o.issues.map(a=>Fr(a,n,bt()))},input:r.value}),r.issues=[]),r)):(r.value=i.value,i.issues.length&&(r.value=e.catchValue({...r,error:{issues:i.issues.map(o=>Fr(o,n,bt()))},input:r.value}),r.issues=[]),r)}}),u0=I("$ZodNaN",(t,e)=>{we.init(t,e),t._zod.parse=(r,n)=>((typeof r.value!="number"||!Number.isNaN(r.value))&&r.issues.push({input:r.value,inst:t,expected:"nan",code:"invalid_type"}),r)}),l0=I("$ZodPipe",(t,e)=>{we.init(t,e),Ce(t._zod,"values",()=>e.in._zod.values),Ce(t._zod,"optin",()=>e.in._zod.optin),Ce(t._zod,"optout",()=>e.out._zod.optout),Ce(t._zod,"propValues",()=>e.in._zod.propValues),t._zod.parse=(r,n)=>{if(n.direction==="backward"){let o=e.out._zod.run(r,n);return o instanceof Promise?o.then(a=>xh(a,e.in,n)):xh(o,e.in,n)}let i=e.in._zod.run(r,n);return i instanceof Promise?i.then(o=>xh(o,e.out,n)):xh(i,e.out,n)}});function xh(t,e,r){return t.issues.length?(t.aborted=!0,t):e._zod.run({value:t.value,issues:t.issues},r)}var qp=I("$ZodCodec",(t,e)=>{we.init(t,e),Ce(t._zod,"values",()=>e.in._zod.values),Ce(t._zod,"optin",()=>e.in._zod.optin),Ce(t._zod,"optout",()=>e.out._zod.optout),Ce(t._zod,"propValues",()=>e.in._zod.propValues),t._zod.parse=(r,n)=>{if((n.direction||"forward")==="forward"){let o=e.in._zod.run(r,n);return o instanceof Promise?o.then(a=>Sh(a,e,n)):Sh(o,e,n)}else{let o=e.out._zod.run(r,n);return o instanceof Promise?o.then(a=>Sh(a,e,n)):Sh(o,e,n)}}});function Sh(t,e,r){if(t.issues.length)return t.aborted=!0,t;if((r.direction||"forward")==="forward"){let i=e.transform(t.value,t);return i instanceof Promise?i.then(o=>Ih(t,o,e.out,r)):Ih(t,i,e.out,r)}else{let i=e.reverseTransform(t.value,t);return i instanceof Promise?i.then(o=>Ih(t,o,e.in,r)):Ih(t,i,e.in,r)}}function Ih(t,e,r,n){return t.issues.length?(t.aborted=!0,t):r._zod.run({value:e,issues:t.issues},n)}var p0=I("$ZodReadonly",(t,e)=>{we.init(t,e),Ce(t._zod,"propValues",()=>e.innerType._zod.propValues),Ce(t._zod,"values",()=>e.innerType._zod.values),Ce(t._zod,"optin",()=>e.innerType?._zod?.optin),Ce(t._zod,"optout",()=>e.innerType?._zod?.optout),t._zod.parse=(r,n)=>{if(n.direction==="backward")return e.innerType._zod.run(r,n);let i=e.innerType._zod.run(r,n);return i instanceof Promise?i.then(yR):yR(i)}});function yR(t){return t.value=Object.freeze(t.value),t}var d0=I("$ZodTemplateLiteral",(t,e)=>{we.init(t,e);let r=[];for(let n of e.parts)if(typeof n=="object"&&n!==null){if(!n._zod.pattern)throw new Error(`Invalid template literal part, no pattern found: ${[...n._zod.traits].shift()}`);let i=n._zod.pattern instanceof RegExp?n._zod.pattern.source:n._zod.pattern;if(!i)throw new Error(`Invalid template literal part: ${n._zod.traits}`);let o=i.startsWith("^")?1:0,a=i.endsWith("$")?i.length-1:i.length;r.push(i.slice(o,a))}else if(n===null||cw.has(typeof n))r.push(In(`${n}`));else throw new Error(`Invalid template literal part: ${n}`);t._zod.pattern=new RegExp(`^${r.join("")}$`),t._zod.parse=(n,i)=>typeof n.value!="string"?(n.issues.push({input:n.value,inst:t,expected:"string",code:"invalid_type"}),n):(t._zod.pattern.lastIndex=0,t._zod.pattern.test(n.value)||n.issues.push({input:n.value,inst:t,code:"invalid_format",format:e.format??"template_literal",pattern:t._zod.pattern.source}),n)}),f0=I("$ZodFunction",(t,e)=>(we.init(t,e),t._def=e,t._zod.def=e,t.implement=r=>{if(typeof r!="function")throw new Error("implement() must be called with a function");return function(...n){let i=t._def.input?ki(t._def.input,n):n,o=Reflect.apply(r,this,i);return t._def.output?ki(t._def.output,o):o}},t.implementAsync=r=>{if(typeof r!="function")throw new Error("implementAsync() must be called with a function");return async function(...n){let i=t._def.input?await fs(t._def.input,n):n,o=await Reflect.apply(r,this,i);return t._def.output?await fs(t._def.output,o):o}},t._zod.parse=(r,n)=>typeof r.value!="function"?(r.issues.push({code:"invalid_type",expected:"function",input:r.value,inst:t}),r):(t._def.output&&t._def.output._zod.def.type==="promise"?r.value=t.implementAsync(r.value):r.value=t.implement(r.value),r),t.input=(...r)=>{let n=t.constructor;return Array.isArray(r[0])?new n({type:"function",input:new Th({type:"tuple",items:r[0],rest:r[1]}),output:t._def.output}):new n({type:"function",input:r[0],output:t._def.output})},t.output=r=>{let n=t.constructor;return new n({type:"function",input:t._def.input,output:r})},t)),m0=I("$ZodPromise",(t,e)=>{we.init(t,e),t._zod.parse=(r,n)=>Promise.resolve(r.value).then(i=>e.innerType._zod.run({value:i,issues:[]},n))}),h0=I("$ZodLazy",(t,e)=>{we.init(t,e),Ce(t._zod,"innerType",()=>e.getter()),Ce(t._zod,"pattern",()=>t._zod.innerType?._zod?.pattern),Ce(t._zod,"propValues",()=>t._zod.innerType?._zod?.propValues),Ce(t._zod,"optin",()=>t._zod.innerType?._zod?.optin??void 0),Ce(t._zod,"optout",()=>t._zod.innerType?._zod?.optout??void 0),t._zod.parse=(r,n)=>t._zod.innerType._zod.run(r,n)}),g0=I("$ZodCustom",(t,e)=>{tt.init(t,e),we.init(t,e),t._zod.parse=(r,n)=>r,t._zod.check=r=>{let n=r.value,i=e.fn(n);if(i instanceof Promise)return i.then(o=>vR(o,r,n,t));vR(i,r,n,t)}});function vR(t,e,r,n){if(!t){let i={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(i.params=n._zod.def.params),e.issues.push(Zc(i))}}var Wp={};hi(Wp,{ar:()=>kR,az:()=>ER,be:()=>TR,bg:()=>$R,ca:()=>OR,cs:()=>CR,da:()=>PR,de:()=>NR,en:()=>$h,eo:()=>RR,es:()=>MR,fa:()=>zR,fi:()=>jR,fr:()=>DR,frCA:()=>LR,he:()=>UR,hu:()=>FR,hy:()=>VR,id:()=>ZR,is:()=>GR,it:()=>HR,ja:()=>qR,ka:()=>KR,kh:()=>WR,km:()=>Oh,ko:()=>JR,lt:()=>YR,mk:()=>QR,ms:()=>e1,nl:()=>t1,no:()=>r1,ota:()=>n1,pl:()=>o1,ps:()=>i1,pt:()=>a1,ru:()=>c1,sl:()=>u1,sv:()=>l1,ta:()=>p1,th:()=>d1,tr:()=>f1,ua:()=>m1,uk:()=>Ch,ur:()=>h1,uz:()=>g1,vi:()=>_1,yo:()=>b1,zhCN:()=>y1,zhTW:()=>v1});var k9=()=>{let t={string:{unit:"\u062D\u0631\u0641",verb:"\u0623\u0646 \u064A\u062D\u0648\u064A"},file:{unit:"\u0628\u0627\u064A\u062A",verb:"\u0623\u0646 \u064A\u062D\u0648\u064A"},array:{unit:"\u0639\u0646\u0635\u0631",verb:"\u0623\u0646 \u064A\u062D\u0648\u064A"},set:{unit:"\u0639\u0646\u0635\u0631",verb:"\u0623\u0646 \u064A\u062D\u0648\u064A"}};function e(i){return t[i]??null}let r={regex:"\u0645\u062F\u062E\u0644",email:"\u0628\u0631\u064A\u062F \u0625\u0644\u0643\u062A\u0631\u0648\u0646\u064A",url:"\u0631\u0627\u0628\u0637",emoji:"\u0625\u064A\u0645\u0648\u062C\u064A",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"\u062A\u0627\u0631\u064A\u062E \u0648\u0648\u0642\u062A \u0628\u0645\u0639\u064A\u0627\u0631 ISO",date:"\u062A\u0627\u0631\u064A\u062E \u0628\u0645\u0639\u064A\u0627\u0631 ISO",time:"\u0648\u0642\u062A \u0628\u0645\u0639\u064A\u0627\u0631 ISO",duration:"\u0645\u062F\u0629 \u0628\u0645\u0639\u064A\u0627\u0631 ISO",ipv4:"\u0639\u0646\u0648\u0627\u0646 IPv4",ipv6:"\u0639\u0646\u0648\u0627\u0646 IPv6",cidrv4:"\u0645\u062F\u0649 \u0639\u0646\u0627\u0648\u064A\u0646 \u0628\u0635\u064A\u063A\u0629 IPv4",cidrv6:"\u0645\u062F\u0649 \u0639\u0646\u0627\u0648\u064A\u0646 \u0628\u0635\u064A\u063A\u0629 IPv6",base64:"\u0646\u064E\u0635 \u0628\u062A\u0631\u0645\u064A\u0632 base64-encoded",base64url:"\u0646\u064E\u0635 \u0628\u062A\u0631\u0645\u064A\u0632 base64url-encoded",json_string:"\u0646\u064E\u0635 \u0639\u0644\u0649 \u0647\u064A\u0626\u0629 JSON",e164:"\u0631\u0642\u0645 \u0647\u0627\u062A\u0641 \u0628\u0645\u0639\u064A\u0627\u0631 E.164",jwt:"JWT",template_literal:"\u0645\u062F\u062E\u0644"},n={nan:"NaN"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`\u0645\u062F\u062E\u0644\u0627\u062A \u063A\u064A\u0631 \u0645\u0642\u0628\u0648\u0644\u0629: \u064A\u0641\u062A\u0631\u0636 \u0625\u062F\u062E\u0627\u0644 instanceof ${i.expected}\u060C \u0648\u0644\u0643\u0646 \u062A\u0645 \u0625\u062F\u062E\u0627\u0644 ${s}`:`\u0645\u062F\u062E\u0644\u0627\u062A \u063A\u064A\u0631 \u0645\u0642\u0628\u0648\u0644\u0629: \u064A\u0641\u062A\u0631\u0636 \u0625\u062F\u062E\u0627\u0644 ${o}\u060C \u0648\u0644\u0643\u0646 \u062A\u0645 \u0625\u062F\u062E\u0627\u0644 ${s}`}case"invalid_value":return i.values.length===1?`\u0645\u062F\u062E\u0644\u0627\u062A \u063A\u064A\u0631 \u0645\u0642\u0628\u0648\u0644\u0629: \u064A\u0641\u062A\u0631\u0636 \u0625\u062F\u062E\u0627\u0644 ${j(i.values[0])}`:`\u0627\u062E\u062A\u064A\u0627\u0631 \u063A\u064A\u0631 \u0645\u0642\u0628\u0648\u0644: \u064A\u062A\u0648\u0642\u0639 \u0627\u0646\u062A\u0642\u0627\u0621 \u0623\u062D\u062F \u0647\u0630\u0647 \u0627\u0644\u062E\u064A\u0627\u0631\u0627\u062A: ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?` \u0623\u0643\u0628\u0631 \u0645\u0646 \u0627\u0644\u0644\u0627\u0632\u0645: \u064A\u0641\u062A\u0631\u0636 \u0623\u0646 \u062A\u0643\u0648\u0646 ${i.origin??"\u0627\u0644\u0642\u064A\u0645\u0629"} ${o} ${i.maximum.toString()} ${a.unit??"\u0639\u0646\u0635\u0631"}`:`\u0623\u0643\u0628\u0631 \u0645\u0646 \u0627\u0644\u0644\u0627\u0632\u0645: \u064A\u0641\u062A\u0631\u0636 \u0623\u0646 \u062A\u0643\u0648\u0646 ${i.origin??"\u0627\u0644\u0642\u064A\u0645\u0629"} ${o} ${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`\u0623\u0635\u063A\u0631 \u0645\u0646 \u0627\u0644\u0644\u0627\u0632\u0645: \u064A\u0641\u062A\u0631\u0636 \u0644\u0640 ${i.origin} \u0623\u0646 \u064A\u0643\u0648\u0646 ${o} ${i.minimum.toString()} ${a.unit}`:`\u0623\u0635\u063A\u0631 \u0645\u0646 \u0627\u0644\u0644\u0627\u0632\u0645: \u064A\u0641\u062A\u0631\u0636 \u0644\u0640 ${i.origin} \u0623\u0646 \u064A\u0643\u0648\u0646 ${o} ${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`\u0646\u064E\u0635 \u063A\u064A\u0631 \u0645\u0642\u0628\u0648\u0644: \u064A\u062C\u0628 \u0623\u0646 \u064A\u0628\u062F\u0623 \u0628\u0640 "${i.prefix}"`:o.format==="ends_with"?`\u0646\u064E\u0635 \u063A\u064A\u0631 \u0645\u0642\u0628\u0648\u0644: \u064A\u062C\u0628 \u0623\u0646 \u064A\u0646\u062A\u0647\u064A \u0628\u0640 "${o.suffix}"`:o.format==="includes"?`\u0646\u064E\u0635 \u063A\u064A\u0631 \u0645\u0642\u0628\u0648\u0644: \u064A\u062C\u0628 \u0623\u0646 \u064A\u062A\u0636\u0645\u0651\u064E\u0646 "${o.includes}"`:o.format==="regex"?`\u0646\u064E\u0635 \u063A\u064A\u0631 \u0645\u0642\u0628\u0648\u0644: \u064A\u062C\u0628 \u0623\u0646 \u064A\u0637\u0627\u0628\u0642 \u0627\u0644\u0646\u0645\u0637 ${o.pattern}`:`${r[o.format]??i.format} \u063A\u064A\u0631 \u0645\u0642\u0628\u0648\u0644`}case"not_multiple_of":return`\u0631\u0642\u0645 \u063A\u064A\u0631 \u0645\u0642\u0628\u0648\u0644: \u064A\u062C\u0628 \u0623\u0646 \u064A\u0643\u0648\u0646 \u0645\u0646 \u0645\u0636\u0627\u0639\u0641\u0627\u062A ${i.divisor}`;case"unrecognized_keys":return`\u0645\u0639\u0631\u0641${i.keys.length>1?"\u0627\u062A":""} \u063A\u0631\u064A\u0628${i.keys.length>1?"\u0629":""}: ${$(i.keys,"\u060C ")}`;case"invalid_key":return`\u0645\u0639\u0631\u0641 \u063A\u064A\u0631 \u0645\u0642\u0628\u0648\u0644 \u0641\u064A ${i.origin}`;case"invalid_union":return"\u0645\u062F\u062E\u0644 \u063A\u064A\u0631 \u0645\u0642\u0628\u0648\u0644";case"invalid_element":return`\u0645\u062F\u062E\u0644 \u063A\u064A\u0631 \u0645\u0642\u0628\u0648\u0644 \u0641\u064A ${i.origin}`;default:return"\u0645\u062F\u062E\u0644 \u063A\u064A\u0631 \u0645\u0642\u0628\u0648\u0644"}}};function kR(){return{localeError:k9()}}var E9=()=>{let t={string:{unit:"simvol",verb:"olmal\u0131d\u0131r"},file:{unit:"bayt",verb:"olmal\u0131d\u0131r"},array:{unit:"element",verb:"olmal\u0131d\u0131r"},set:{unit:"element",verb:"olmal\u0131d\u0131r"}};function e(i){return t[i]??null}let r={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"},n={nan:"NaN"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`Yanl\u0131\u015F d\u0259y\u0259r: g\xF6zl\u0259nil\u0259n instanceof ${i.expected}, daxil olan ${s}`:`Yanl\u0131\u015F d\u0259y\u0259r: g\xF6zl\u0259nil\u0259n ${o}, daxil olan ${s}`}case"invalid_value":return i.values.length===1?`Yanl\u0131\u015F d\u0259y\u0259r: g\xF6zl\u0259nil\u0259n ${j(i.values[0])}`:`Yanl\u0131\u015F se\xE7im: a\u015Fa\u011F\u0131dak\u0131lardan biri olmal\u0131d\u0131r: ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`\xC7ox b\xF6y\xFCk: g\xF6zl\u0259nil\u0259n ${i.origin??"d\u0259y\u0259r"} ${o}${i.maximum.toString()} ${a.unit??"element"}`:`\xC7ox b\xF6y\xFCk: g\xF6zl\u0259nil\u0259n ${i.origin??"d\u0259y\u0259r"} ${o}${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`\xC7ox ki\xE7ik: g\xF6zl\u0259nil\u0259n ${i.origin} ${o}${i.minimum.toString()} ${a.unit}`:`\xC7ox ki\xE7ik: g\xF6zl\u0259nil\u0259n ${i.origin} ${o}${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`Yanl\u0131\u015F m\u0259tn: "${o.prefix}" il\u0259 ba\u015Flamal\u0131d\u0131r`:o.format==="ends_with"?`Yanl\u0131\u015F m\u0259tn: "${o.suffix}" il\u0259 bitm\u0259lidir`:o.format==="includes"?`Yanl\u0131\u015F m\u0259tn: "${o.includes}" daxil olmal\u0131d\u0131r`:o.format==="regex"?`Yanl\u0131\u015F m\u0259tn: ${o.pattern} \u015Fablonuna uy\u011Fun olmal\u0131d\u0131r`:`Yanl\u0131\u015F ${r[o.format]??i.format}`}case"not_multiple_of":return`Yanl\u0131\u015F \u0259d\u0259d: ${i.divisor} il\u0259 b\xF6l\xFCn\u0259 bil\u0259n olmal\u0131d\u0131r`;case"unrecognized_keys":return`Tan\u0131nmayan a\xE7ar${i.keys.length>1?"lar":""}: ${$(i.keys,", ")}`;case"invalid_key":return`${i.origin} daxilind\u0259 yanl\u0131\u015F a\xE7ar`;case"invalid_union":return"Yanl\u0131\u015F d\u0259y\u0259r";case"invalid_element":return`${i.origin} daxilind\u0259 yanl\u0131\u015F d\u0259y\u0259r`;default:return"Yanl\u0131\u015F d\u0259y\u0259r"}}};function ER(){return{localeError:E9()}}function AR(t,e,r,n){let i=Math.abs(t),o=i%10,a=i%100;return a>=11&&a<=19?n:o===1?e:o>=2&&o<=4?r:n}var A9=()=>{let t={string:{unit:{one:"\u0441\u0456\u043C\u0432\u0430\u043B",few:"\u0441\u0456\u043C\u0432\u0430\u043B\u044B",many:"\u0441\u0456\u043C\u0432\u0430\u043B\u0430\u045E"},verb:"\u043C\u0435\u0446\u044C"},array:{unit:{one:"\u044D\u043B\u0435\u043C\u0435\u043D\u0442",few:"\u044D\u043B\u0435\u043C\u0435\u043D\u0442\u044B",many:"\u044D\u043B\u0435\u043C\u0435\u043D\u0442\u0430\u045E"},verb:"\u043C\u0435\u0446\u044C"},set:{unit:{one:"\u044D\u043B\u0435\u043C\u0435\u043D\u0442",few:"\u044D\u043B\u0435\u043C\u0435\u043D\u0442\u044B",many:"\u044D\u043B\u0435\u043C\u0435\u043D\u0442\u0430\u045E"},verb:"\u043C\u0435\u0446\u044C"},file:{unit:{one:"\u0431\u0430\u0439\u0442",few:"\u0431\u0430\u0439\u0442\u044B",many:"\u0431\u0430\u0439\u0442\u0430\u045E"},verb:"\u043C\u0435\u0446\u044C"}};function e(i){return t[i]??null}let r={regex:"\u0443\u0432\u043E\u0434",email:"email \u0430\u0434\u0440\u0430\u0441",url:"URL",emoji:"\u044D\u043C\u043E\u0434\u0437\u0456",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO \u0434\u0430\u0442\u0430 \u0456 \u0447\u0430\u0441",date:"ISO \u0434\u0430\u0442\u0430",time:"ISO \u0447\u0430\u0441",duration:"ISO \u043F\u0440\u0430\u0446\u044F\u0433\u043B\u0430\u0441\u0446\u044C",ipv4:"IPv4 \u0430\u0434\u0440\u0430\u0441",ipv6:"IPv6 \u0430\u0434\u0440\u0430\u0441",cidrv4:"IPv4 \u0434\u044B\u044F\u043F\u0430\u0437\u043E\u043D",cidrv6:"IPv6 \u0434\u044B\u044F\u043F\u0430\u0437\u043E\u043D",base64:"\u0440\u0430\u0434\u043E\u043A \u0443 \u0444\u0430\u0440\u043C\u0430\u0446\u0435 base64",base64url:"\u0440\u0430\u0434\u043E\u043A \u0443 \u0444\u0430\u0440\u043C\u0430\u0446\u0435 base64url",json_string:"JSON \u0440\u0430\u0434\u043E\u043A",e164:"\u043D\u0443\u043C\u0430\u0440 E.164",jwt:"JWT",template_literal:"\u0443\u0432\u043E\u0434"},n={nan:"NaN",number:"\u043B\u0456\u043A",array:"\u043C\u0430\u0441\u0456\u045E"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`\u041D\u044F\u043F\u0440\u0430\u0432\u0456\u043B\u044C\u043D\u044B \u045E\u0432\u043E\u0434: \u0447\u0430\u043A\u0430\u045E\u0441\u044F instanceof ${i.expected}, \u0430\u0442\u0440\u044B\u043C\u0430\u043D\u0430 ${s}`:`\u041D\u044F\u043F\u0440\u0430\u0432\u0456\u043B\u044C\u043D\u044B \u045E\u0432\u043E\u0434: \u0447\u0430\u043A\u0430\u045E\u0441\u044F ${o}, \u0430\u0442\u0440\u044B\u043C\u0430\u043D\u0430 ${s}`}case"invalid_value":return i.values.length===1?`\u041D\u044F\u043F\u0440\u0430\u0432\u0456\u043B\u044C\u043D\u044B \u045E\u0432\u043E\u0434: \u0447\u0430\u043A\u0430\u043B\u0430\u0441\u044F ${j(i.values[0])}`:`\u041D\u044F\u043F\u0440\u0430\u0432\u0456\u043B\u044C\u043D\u044B \u0432\u0430\u0440\u044B\u044F\u043D\u0442: \u0447\u0430\u043A\u0430\u045E\u0441\u044F \u0430\u0434\u0437\u0456\u043D \u0437 ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);if(a){let s=Number(i.maximum),c=AR(s,a.unit.one,a.unit.few,a.unit.many);return`\u0417\u0430\u043D\u0430\u0434\u0442\u0430 \u0432\u044F\u043B\u0456\u043A\u0456: \u0447\u0430\u043A\u0430\u043B\u0430\u0441\u044F, \u0448\u0442\u043E ${i.origin??"\u0437\u043D\u0430\u0447\u044D\u043D\u043D\u0435"} \u043F\u0430\u0432\u0456\u043D\u043D\u0430 ${a.verb} ${o}${i.maximum.toString()} ${c}`}return`\u0417\u0430\u043D\u0430\u0434\u0442\u0430 \u0432\u044F\u043B\u0456\u043A\u0456: \u0447\u0430\u043A\u0430\u043B\u0430\u0441\u044F, \u0448\u0442\u043E ${i.origin??"\u0437\u043D\u0430\u0447\u044D\u043D\u043D\u0435"} \u043F\u0430\u0432\u0456\u043D\u043D\u0430 \u0431\u044B\u0446\u044C ${o}${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);if(a){let s=Number(i.minimum),c=AR(s,a.unit.one,a.unit.few,a.unit.many);return`\u0417\u0430\u043D\u0430\u0434\u0442\u0430 \u043C\u0430\u043B\u044B: \u0447\u0430\u043A\u0430\u043B\u0430\u0441\u044F, \u0448\u0442\u043E ${i.origin} \u043F\u0430\u0432\u0456\u043D\u043D\u0430 ${a.verb} ${o}${i.minimum.toString()} ${c}`}return`\u0417\u0430\u043D\u0430\u0434\u0442\u0430 \u043C\u0430\u043B\u044B: \u0447\u0430\u043A\u0430\u043B\u0430\u0441\u044F, \u0448\u0442\u043E ${i.origin} \u043F\u0430\u0432\u0456\u043D\u043D\u0430 \u0431\u044B\u0446\u044C ${o}${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`\u041D\u044F\u043F\u0440\u0430\u0432\u0456\u043B\u044C\u043D\u044B \u0440\u0430\u0434\u043E\u043A: \u043F\u0430\u0432\u0456\u043D\u0435\u043D \u043F\u0430\u0447\u044B\u043D\u0430\u0446\u0446\u0430 \u0437 "${o.prefix}"`:o.format==="ends_with"?`\u041D\u044F\u043F\u0440\u0430\u0432\u0456\u043B\u044C\u043D\u044B \u0440\u0430\u0434\u043E\u043A: \u043F\u0430\u0432\u0456\u043D\u0435\u043D \u0437\u0430\u043A\u0430\u043D\u0447\u0432\u0430\u0446\u0446\u0430 \u043D\u0430 "${o.suffix}"`:o.format==="includes"?`\u041D\u044F\u043F\u0440\u0430\u0432\u0456\u043B\u044C\u043D\u044B \u0440\u0430\u0434\u043E\u043A: \u043F\u0430\u0432\u0456\u043D\u0435\u043D \u0437\u043C\u044F\u0448\u0447\u0430\u0446\u044C "${o.includes}"`:o.format==="regex"?`\u041D\u044F\u043F\u0440\u0430\u0432\u0456\u043B\u044C\u043D\u044B \u0440\u0430\u0434\u043E\u043A: \u043F\u0430\u0432\u0456\u043D\u0435\u043D \u0430\u0434\u043F\u0430\u0432\u044F\u0434\u0430\u0446\u044C \u0448\u0430\u0431\u043B\u043E\u043D\u0443 ${o.pattern}`:`\u041D\u044F\u043F\u0440\u0430\u0432\u0456\u043B\u044C\u043D\u044B ${r[o.format]??i.format}`}case"not_multiple_of":return`\u041D\u044F\u043F\u0440\u0430\u0432\u0456\u043B\u044C\u043D\u044B \u043B\u0456\u043A: \u043F\u0430\u0432\u0456\u043D\u0435\u043D \u0431\u044B\u0446\u044C \u043A\u0440\u0430\u0442\u043D\u044B\u043C ${i.divisor}`;case"unrecognized_keys":return`\u041D\u0435\u0440\u0430\u0441\u043F\u0430\u0437\u043D\u0430\u043D\u044B ${i.keys.length>1?"\u043A\u043B\u044E\u0447\u044B":"\u043A\u043B\u044E\u0447"}: ${$(i.keys,", ")}`;case"invalid_key":return`\u041D\u044F\u043F\u0440\u0430\u0432\u0456\u043B\u044C\u043D\u044B \u043A\u043B\u044E\u0447 \u0443 ${i.origin}`;case"invalid_union":return"\u041D\u044F\u043F\u0440\u0430\u0432\u0456\u043B\u044C\u043D\u044B \u045E\u0432\u043E\u0434";case"invalid_element":return`\u041D\u044F\u043F\u0440\u0430\u0432\u0456\u043B\u044C\u043D\u0430\u0435 \u0437\u043D\u0430\u0447\u044D\u043D\u043D\u0435 \u045E ${i.origin}`;default:return"\u041D\u044F\u043F\u0440\u0430\u0432\u0456\u043B\u044C\u043D\u044B \u045E\u0432\u043E\u0434"}}};function TR(){return{localeError:A9()}}var T9=()=>{let t={string:{unit:"\u0441\u0438\u043C\u0432\u043E\u043B\u0430",verb:"\u0434\u0430 \u0441\u044A\u0434\u044A\u0440\u0436\u0430"},file:{unit:"\u0431\u0430\u0439\u0442\u0430",verb:"\u0434\u0430 \u0441\u044A\u0434\u044A\u0440\u0436\u0430"},array:{unit:"\u0435\u043B\u0435\u043C\u0435\u043D\u0442\u0430",verb:"\u0434\u0430 \u0441\u044A\u0434\u044A\u0440\u0436\u0430"},set:{unit:"\u0435\u043B\u0435\u043C\u0435\u043D\u0442\u0430",verb:"\u0434\u0430 \u0441\u044A\u0434\u044A\u0440\u0436\u0430"}};function e(i){return t[i]??null}let r={regex:"\u0432\u0445\u043E\u0434",email:"\u0438\u043C\u0435\u0439\u043B \u0430\u0434\u0440\u0435\u0441",url:"URL",emoji:"\u0435\u043C\u043E\u0434\u0436\u0438",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO \u0432\u0440\u0435\u043C\u0435",date:"ISO \u0434\u0430\u0442\u0430",time:"ISO \u0432\u0440\u0435\u043C\u0435",duration:"ISO \u043F\u0440\u043E\u0434\u044A\u043B\u0436\u0438\u0442\u0435\u043B\u043D\u043E\u0441\u0442",ipv4:"IPv4 \u0430\u0434\u0440\u0435\u0441",ipv6:"IPv6 \u0430\u0434\u0440\u0435\u0441",cidrv4:"IPv4 \u0434\u0438\u0430\u043F\u0430\u0437\u043E\u043D",cidrv6:"IPv6 \u0434\u0438\u0430\u043F\u0430\u0437\u043E\u043D",base64:"base64-\u043A\u043E\u0434\u0438\u0440\u0430\u043D \u043D\u0438\u0437",base64url:"base64url-\u043A\u043E\u0434\u0438\u0440\u0430\u043D \u043D\u0438\u0437",json_string:"JSON \u043D\u0438\u0437",e164:"E.164 \u043D\u043E\u043C\u0435\u0440",jwt:"JWT",template_literal:"\u0432\u0445\u043E\u0434"},n={nan:"NaN",number:"\u0447\u0438\u0441\u043B\u043E",array:"\u043C\u0430\u0441\u0438\u0432"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`\u041D\u0435\u0432\u0430\u043B\u0438\u0434\u0435\u043D \u0432\u0445\u043E\u0434: \u043E\u0447\u0430\u043A\u0432\u0430\u043D instanceof ${i.expected}, \u043F\u043E\u043B\u0443\u0447\u0435\u043D ${s}`:`\u041D\u0435\u0432\u0430\u043B\u0438\u0434\u0435\u043D \u0432\u0445\u043E\u0434: \u043E\u0447\u0430\u043A\u0432\u0430\u043D ${o}, \u043F\u043E\u043B\u0443\u0447\u0435\u043D ${s}`}case"invalid_value":return i.values.length===1?`\u041D\u0435\u0432\u0430\u043B\u0438\u0434\u0435\u043D \u0432\u0445\u043E\u0434: \u043E\u0447\u0430\u043A\u0432\u0430\u043D ${j(i.values[0])}`:`\u041D\u0435\u0432\u0430\u043B\u0438\u0434\u043D\u0430 \u043E\u043F\u0446\u0438\u044F: \u043E\u0447\u0430\u043A\u0432\u0430\u043D\u043E \u0435\u0434\u043D\u043E \u043E\u0442 ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`\u0422\u0432\u044A\u0440\u0434\u0435 \u0433\u043E\u043B\u044F\u043C\u043E: \u043E\u0447\u0430\u043A\u0432\u0430 \u0441\u0435 ${i.origin??"\u0441\u0442\u043E\u0439\u043D\u043E\u0441\u0442"} \u0434\u0430 \u0441\u044A\u0434\u044A\u0440\u0436\u0430 ${o}${i.maximum.toString()} ${a.unit??"\u0435\u043B\u0435\u043C\u0435\u043D\u0442\u0430"}`:`\u0422\u0432\u044A\u0440\u0434\u0435 \u0433\u043E\u043B\u044F\u043C\u043E: \u043E\u0447\u0430\u043A\u0432\u0430 \u0441\u0435 ${i.origin??"\u0441\u0442\u043E\u0439\u043D\u043E\u0441\u0442"} \u0434\u0430 \u0431\u044A\u0434\u0435 ${o}${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`\u0422\u0432\u044A\u0440\u0434\u0435 \u043C\u0430\u043B\u043A\u043E: \u043E\u0447\u0430\u043A\u0432\u0430 \u0441\u0435 ${i.origin} \u0434\u0430 \u0441\u044A\u0434\u044A\u0440\u0436\u0430 ${o}${i.minimum.toString()} ${a.unit}`:`\u0422\u0432\u044A\u0440\u0434\u0435 \u043C\u0430\u043B\u043A\u043E: \u043E\u0447\u0430\u043A\u0432\u0430 \u0441\u0435 ${i.origin} \u0434\u0430 \u0431\u044A\u0434\u0435 ${o}${i.minimum.toString()}`}case"invalid_format":{let o=i;if(o.format==="starts_with")return`\u041D\u0435\u0432\u0430\u043B\u0438\u0434\u0435\u043D \u043D\u0438\u0437: \u0442\u0440\u044F\u0431\u0432\u0430 \u0434\u0430 \u0437\u0430\u043F\u043E\u0447\u0432\u0430 \u0441 "${o.prefix}"`;if(o.format==="ends_with")return`\u041D\u0435\u0432\u0430\u043B\u0438\u0434\u0435\u043D \u043D\u0438\u0437: \u0442\u0440\u044F\u0431\u0432\u0430 \u0434\u0430 \u0437\u0430\u0432\u044A\u0440\u0448\u0432\u0430 \u0441 "${o.suffix}"`;if(o.format==="includes")return`\u041D\u0435\u0432\u0430\u043B\u0438\u0434\u0435\u043D \u043D\u0438\u0437: \u0442\u0440\u044F\u0431\u0432\u0430 \u0434\u0430 \u0432\u043A\u043B\u044E\u0447\u0432\u0430 "${o.includes}"`;if(o.format==="regex")return`\u041D\u0435\u0432\u0430\u043B\u0438\u0434\u0435\u043D \u043D\u0438\u0437: \u0442\u0440\u044F\u0431\u0432\u0430 \u0434\u0430 \u0441\u044A\u0432\u043F\u0430\u0434\u0430 \u0441 ${o.pattern}`;let a="\u041D\u0435\u0432\u0430\u043B\u0438\u0434\u0435\u043D";return o.format==="emoji"&&(a="\u041D\u0435\u0432\u0430\u043B\u0438\u0434\u043D\u043E"),o.format==="datetime"&&(a="\u041D\u0435\u0432\u0430\u043B\u0438\u0434\u043D\u043E"),o.format==="date"&&(a="\u041D\u0435\u0432\u0430\u043B\u0438\u0434\u043D\u0430"),o.format==="time"&&(a="\u041D\u0435\u0432\u0430\u043B\u0438\u0434\u043D\u043E"),o.format==="duration"&&(a="\u041D\u0435\u0432\u0430\u043B\u0438\u0434\u043D\u0430"),`${a} ${r[o.format]??i.format}`}case"not_multiple_of":return`\u041D\u0435\u0432\u0430\u043B\u0438\u0434\u043D\u043E \u0447\u0438\u0441\u043B\u043E: \u0442\u0440\u044F\u0431\u0432\u0430 \u0434\u0430 \u0431\u044A\u0434\u0435 \u043A\u0440\u0430\u0442\u043D\u043E \u043D\u0430 ${i.divisor}`;case"unrecognized_keys":return`\u041D\u0435\u0440\u0430\u0437\u043F\u043E\u0437\u043D\u0430\u0442${i.keys.length>1?"\u0438":""} \u043A\u043B\u044E\u0447${i.keys.length>1?"\u043E\u0432\u0435":""}: ${$(i.keys,", ")}`;case"invalid_key":return`\u041D\u0435\u0432\u0430\u043B\u0438\u0434\u0435\u043D \u043A\u043B\u044E\u0447 \u0432 ${i.origin}`;case"invalid_union":return"\u041D\u0435\u0432\u0430\u043B\u0438\u0434\u0435\u043D \u0432\u0445\u043E\u0434";case"invalid_element":return`\u041D\u0435\u0432\u0430\u043B\u0438\u0434\u043D\u0430 \u0441\u0442\u043E\u0439\u043D\u043E\u0441\u0442 \u0432 ${i.origin}`;default:return"\u041D\u0435\u0432\u0430\u043B\u0438\u0434\u0435\u043D \u0432\u0445\u043E\u0434"}}};function $R(){return{localeError:T9()}}var $9=()=>{let t={string:{unit:"car\xE0cters",verb:"contenir"},file:{unit:"bytes",verb:"contenir"},array:{unit:"elements",verb:"contenir"},set:{unit:"elements",verb:"contenir"}};function e(i){return t[i]??null}let r={regex:"entrada",email:"adre\xE7a electr\xF2nica",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data i hora ISO",date:"data ISO",time:"hora ISO",duration:"durada ISO",ipv4:"adre\xE7a IPv4",ipv6:"adre\xE7a IPv6",cidrv4:"rang IPv4",cidrv6:"rang IPv6",base64:"cadena codificada en base64",base64url:"cadena codificada en base64url",json_string:"cadena JSON",e164:"n\xFAmero E.164",jwt:"JWT",template_literal:"entrada"},n={nan:"NaN"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`Tipus inv\xE0lid: s'esperava instanceof ${i.expected}, s'ha rebut ${s}`:`Tipus inv\xE0lid: s'esperava ${o}, s'ha rebut ${s}`}case"invalid_value":return i.values.length===1?`Valor inv\xE0lid: s'esperava ${j(i.values[0])}`:`Opci\xF3 inv\xE0lida: s'esperava una de ${$(i.values," o ")}`;case"too_big":{let o=i.inclusive?"com a m\xE0xim":"menys de",a=e(i.origin);return a?`Massa gran: s'esperava que ${i.origin??"el valor"} contingu\xE9s ${o} ${i.maximum.toString()} ${a.unit??"elements"}`:`Massa gran: s'esperava que ${i.origin??"el valor"} fos ${o} ${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?"com a m\xEDnim":"m\xE9s de",a=e(i.origin);return a?`Massa petit: s'esperava que ${i.origin} contingu\xE9s ${o} ${i.minimum.toString()} ${a.unit}`:`Massa petit: s'esperava que ${i.origin} fos ${o} ${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`Format inv\xE0lid: ha de comen\xE7ar amb "${o.prefix}"`:o.format==="ends_with"?`Format inv\xE0lid: ha d'acabar amb "${o.suffix}"`:o.format==="includes"?`Format inv\xE0lid: ha d'incloure "${o.includes}"`:o.format==="regex"?`Format inv\xE0lid: ha de coincidir amb el patr\xF3 ${o.pattern}`:`Format inv\xE0lid per a ${r[o.format]??i.format}`}case"not_multiple_of":return`N\xFAmero inv\xE0lid: ha de ser m\xFAltiple de ${i.divisor}`;case"unrecognized_keys":return`Clau${i.keys.length>1?"s":""} no reconeguda${i.keys.length>1?"s":""}: ${$(i.keys,", ")}`;case"invalid_key":return`Clau inv\xE0lida a ${i.origin}`;case"invalid_union":return"Entrada inv\xE0lida";case"invalid_element":return`Element inv\xE0lid a ${i.origin}`;default:return"Entrada inv\xE0lida"}}};function OR(){return{localeError:$9()}}var O9=()=>{let t={string:{unit:"znak\u016F",verb:"m\xEDt"},file:{unit:"bajt\u016F",verb:"m\xEDt"},array:{unit:"prvk\u016F",verb:"m\xEDt"},set:{unit:"prvk\u016F",verb:"m\xEDt"}};function e(i){return t[i]??null}let r={regex:"regul\xE1rn\xED v\xFDraz",email:"e-mailov\xE1 adresa",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"datum a \u010Das ve form\xE1tu ISO",date:"datum ve form\xE1tu ISO",time:"\u010Das ve form\xE1tu ISO",duration:"doba trv\xE1n\xED ISO",ipv4:"IPv4 adresa",ipv6:"IPv6 adresa",cidrv4:"rozsah IPv4",cidrv6:"rozsah IPv6",base64:"\u0159et\u011Bzec zak\xF3dovan\xFD ve form\xE1tu base64",base64url:"\u0159et\u011Bzec zak\xF3dovan\xFD ve form\xE1tu base64url",json_string:"\u0159et\u011Bzec ve form\xE1tu JSON",e164:"\u010D\xEDslo E.164",jwt:"JWT",template_literal:"vstup"},n={nan:"NaN",number:"\u010D\xEDslo",string:"\u0159et\u011Bzec",function:"funkce",array:"pole"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`Neplatn\xFD vstup: o\u010Dek\xE1v\xE1no instanceof ${i.expected}, obdr\u017Eeno ${s}`:`Neplatn\xFD vstup: o\u010Dek\xE1v\xE1no ${o}, obdr\u017Eeno ${s}`}case"invalid_value":return i.values.length===1?`Neplatn\xFD vstup: o\u010Dek\xE1v\xE1no ${j(i.values[0])}`:`Neplatn\xE1 mo\u017Enost: o\u010Dek\xE1v\xE1na jedna z hodnot ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`Hodnota je p\u0159\xEDli\u0161 velk\xE1: ${i.origin??"hodnota"} mus\xED m\xEDt ${o}${i.maximum.toString()} ${a.unit??"prvk\u016F"}`:`Hodnota je p\u0159\xEDli\u0161 velk\xE1: ${i.origin??"hodnota"} mus\xED b\xFDt ${o}${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`Hodnota je p\u0159\xEDli\u0161 mal\xE1: ${i.origin??"hodnota"} mus\xED m\xEDt ${o}${i.minimum.toString()} ${a.unit??"prvk\u016F"}`:`Hodnota je p\u0159\xEDli\u0161 mal\xE1: ${i.origin??"hodnota"} mus\xED b\xFDt ${o}${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`Neplatn\xFD \u0159et\u011Bzec: mus\xED za\u010D\xEDnat na "${o.prefix}"`:o.format==="ends_with"?`Neplatn\xFD \u0159et\u011Bzec: mus\xED kon\u010Dit na "${o.suffix}"`:o.format==="includes"?`Neplatn\xFD \u0159et\u011Bzec: mus\xED obsahovat "${o.includes}"`:o.format==="regex"?`Neplatn\xFD \u0159et\u011Bzec: mus\xED odpov\xEDdat vzoru ${o.pattern}`:`Neplatn\xFD form\xE1t ${r[o.format]??i.format}`}case"not_multiple_of":return`Neplatn\xE9 \u010D\xEDslo: mus\xED b\xFDt n\xE1sobkem ${i.divisor}`;case"unrecognized_keys":return`Nezn\xE1m\xE9 kl\xED\u010De: ${$(i.keys,", ")}`;case"invalid_key":return`Neplatn\xFD kl\xED\u010D v ${i.origin}`;case"invalid_union":return"Neplatn\xFD vstup";case"invalid_element":return`Neplatn\xE1 hodnota v ${i.origin}`;default:return"Neplatn\xFD vstup"}}};function CR(){return{localeError:O9()}}var C9=()=>{let t={string:{unit:"tegn",verb:"havde"},file:{unit:"bytes",verb:"havde"},array:{unit:"elementer",verb:"indeholdt"},set:{unit:"elementer",verb:"indeholdt"}};function e(i){return t[i]??null}let r={regex:"input",email:"e-mailadresse",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO dato- og klokkesl\xE6t",date:"ISO-dato",time:"ISO-klokkesl\xE6t",duration:"ISO-varighed",ipv4:"IPv4-omr\xE5de",ipv6:"IPv6-omr\xE5de",cidrv4:"IPv4-spektrum",cidrv6:"IPv6-spektrum",base64:"base64-kodet streng",base64url:"base64url-kodet streng",json_string:"JSON-streng",e164:"E.164-nummer",jwt:"JWT",template_literal:"input"},n={nan:"NaN",string:"streng",number:"tal",boolean:"boolean",array:"liste",object:"objekt",set:"s\xE6t",file:"fil"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`Ugyldigt input: forventede instanceof ${i.expected}, fik ${s}`:`Ugyldigt input: forventede ${o}, fik ${s}`}case"invalid_value":return i.values.length===1?`Ugyldig v\xE6rdi: forventede ${j(i.values[0])}`:`Ugyldigt valg: forventede en af f\xF8lgende ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin),s=n[i.origin]??i.origin;return a?`For stor: forventede ${s??"value"} ${a.verb} ${o} ${i.maximum.toString()} ${a.unit??"elementer"}`:`For stor: forventede ${s??"value"} havde ${o} ${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin),s=n[i.origin]??i.origin;return a?`For lille: forventede ${s} ${a.verb} ${o} ${i.minimum.toString()} ${a.unit}`:`For lille: forventede ${s} havde ${o} ${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`Ugyldig streng: skal starte med "${o.prefix}"`:o.format==="ends_with"?`Ugyldig streng: skal ende med "${o.suffix}"`:o.format==="includes"?`Ugyldig streng: skal indeholde "${o.includes}"`:o.format==="regex"?`Ugyldig streng: skal matche m\xF8nsteret ${o.pattern}`:`Ugyldig ${r[o.format]??i.format}`}case"not_multiple_of":return`Ugyldigt tal: skal v\xE6re deleligt med ${i.divisor}`;case"unrecognized_keys":return`${i.keys.length>1?"Ukendte n\xF8gler":"Ukendt n\xF8gle"}: ${$(i.keys,", ")}`;case"invalid_key":return`Ugyldig n\xF8gle i ${i.origin}`;case"invalid_union":return"Ugyldigt input: matcher ingen af de tilladte typer";case"invalid_element":return`Ugyldig v\xE6rdi i ${i.origin}`;default:return"Ugyldigt input"}}};function PR(){return{localeError:C9()}}var P9=()=>{let t={string:{unit:"Zeichen",verb:"zu haben"},file:{unit:"Bytes",verb:"zu haben"},array:{unit:"Elemente",verb:"zu haben"},set:{unit:"Elemente",verb:"zu haben"}};function e(i){return t[i]??null}let r={regex:"Eingabe",email:"E-Mail-Adresse",url:"URL",emoji:"Emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-Datum und -Uhrzeit",date:"ISO-Datum",time:"ISO-Uhrzeit",duration:"ISO-Dauer",ipv4:"IPv4-Adresse",ipv6:"IPv6-Adresse",cidrv4:"IPv4-Bereich",cidrv6:"IPv6-Bereich",base64:"Base64-codierter String",base64url:"Base64-URL-codierter String",json_string:"JSON-String",e164:"E.164-Nummer",jwt:"JWT",template_literal:"Eingabe"},n={nan:"NaN",number:"Zahl",array:"Array"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`Ung\xFCltige Eingabe: erwartet instanceof ${i.expected}, erhalten ${s}`:`Ung\xFCltige Eingabe: erwartet ${o}, erhalten ${s}`}case"invalid_value":return i.values.length===1?`Ung\xFCltige Eingabe: erwartet ${j(i.values[0])}`:`Ung\xFCltige Option: erwartet eine von ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`Zu gro\xDF: erwartet, dass ${i.origin??"Wert"} ${o}${i.maximum.toString()} ${a.unit??"Elemente"} hat`:`Zu gro\xDF: erwartet, dass ${i.origin??"Wert"} ${o}${i.maximum.toString()} ist`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`Zu klein: erwartet, dass ${i.origin} ${o}${i.minimum.toString()} ${a.unit} hat`:`Zu klein: erwartet, dass ${i.origin} ${o}${i.minimum.toString()} ist`}case"invalid_format":{let o=i;return o.format==="starts_with"?`Ung\xFCltiger String: muss mit "${o.prefix}" beginnen`:o.format==="ends_with"?`Ung\xFCltiger String: muss mit "${o.suffix}" enden`:o.format==="includes"?`Ung\xFCltiger String: muss "${o.includes}" enthalten`:o.format==="regex"?`Ung\xFCltiger String: muss dem Muster ${o.pattern} entsprechen`:`Ung\xFCltig: ${r[o.format]??i.format}`}case"not_multiple_of":return`Ung\xFCltige Zahl: muss ein Vielfaches von ${i.divisor} sein`;case"unrecognized_keys":return`${i.keys.length>1?"Unbekannte Schl\xFCssel":"Unbekannter Schl\xFCssel"}: ${$(i.keys,", ")}`;case"invalid_key":return`Ung\xFCltiger Schl\xFCssel in ${i.origin}`;case"invalid_union":return"Ung\xFCltige Eingabe";case"invalid_element":return`Ung\xFCltiger Wert in ${i.origin}`;default:return"Ung\xFCltige Eingabe"}}};function NR(){return{localeError:P9()}}var N9=()=>{let t={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"},map:{unit:"entries",verb:"to have"}};function e(i){return t[i]??null}let r={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",mac:"MAC address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"},n={nan:"NaN"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return`Invalid input: expected ${o}, received ${s}`}case"invalid_value":return i.values.length===1?`Invalid input: expected ${j(i.values[0])}`:`Invalid option: expected one of ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`Too big: expected ${i.origin??"value"} to have ${o}${i.maximum.toString()} ${a.unit??"elements"}`:`Too big: expected ${i.origin??"value"} to be ${o}${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`Too small: expected ${i.origin} to have ${o}${i.minimum.toString()} ${a.unit}`:`Too small: expected ${i.origin} to be ${o}${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`Invalid string: must start with "${o.prefix}"`:o.format==="ends_with"?`Invalid string: must end with "${o.suffix}"`:o.format==="includes"?`Invalid string: must include "${o.includes}"`:o.format==="regex"?`Invalid string: must match pattern ${o.pattern}`:`Invalid ${r[o.format]??i.format}`}case"not_multiple_of":return`Invalid number: must be a multiple of ${i.divisor}`;case"unrecognized_keys":return`Unrecognized key${i.keys.length>1?"s":""}: ${$(i.keys,", ")}`;case"invalid_key":return`Invalid key in ${i.origin}`;case"invalid_union":return"Invalid input";case"invalid_element":return`Invalid value in ${i.origin}`;default:return"Invalid input"}}};function $h(){return{localeError:N9()}}var R9=()=>{let t={string:{unit:"karaktrojn",verb:"havi"},file:{unit:"bajtojn",verb:"havi"},array:{unit:"elementojn",verb:"havi"},set:{unit:"elementojn",verb:"havi"}};function e(i){return t[i]??null}let r={regex:"enigo",email:"retadreso",url:"URL",emoji:"emo\u011Dio",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-datotempo",date:"ISO-dato",time:"ISO-tempo",duration:"ISO-da\u016Dro",ipv4:"IPv4-adreso",ipv6:"IPv6-adreso",cidrv4:"IPv4-rango",cidrv6:"IPv6-rango",base64:"64-ume kodita karaktraro",base64url:"URL-64-ume kodita karaktraro",json_string:"JSON-karaktraro",e164:"E.164-nombro",jwt:"JWT",template_literal:"enigo"},n={nan:"NaN",number:"nombro",array:"tabelo",null:"senvalora"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`Nevalida enigo: atendi\u011Dis instanceof ${i.expected}, ricevi\u011Dis ${s}`:`Nevalida enigo: atendi\u011Dis ${o}, ricevi\u011Dis ${s}`}case"invalid_value":return i.values.length===1?`Nevalida enigo: atendi\u011Dis ${j(i.values[0])}`:`Nevalida opcio: atendi\u011Dis unu el ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`Tro granda: atendi\u011Dis ke ${i.origin??"valoro"} havu ${o}${i.maximum.toString()} ${a.unit??"elementojn"}`:`Tro granda: atendi\u011Dis ke ${i.origin??"valoro"} havu ${o}${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`Tro malgranda: atendi\u011Dis ke ${i.origin} havu ${o}${i.minimum.toString()} ${a.unit}`:`Tro malgranda: atendi\u011Dis ke ${i.origin} estu ${o}${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`Nevalida karaktraro: devas komenci\u011Di per "${o.prefix}"`:o.format==="ends_with"?`Nevalida karaktraro: devas fini\u011Di per "${o.suffix}"`:o.format==="includes"?`Nevalida karaktraro: devas inkluzivi "${o.includes}"`:o.format==="regex"?`Nevalida karaktraro: devas kongrui kun la modelo ${o.pattern}`:`Nevalida ${r[o.format]??i.format}`}case"not_multiple_of":return`Nevalida nombro: devas esti oblo de ${i.divisor}`;case"unrecognized_keys":return`Nekonata${i.keys.length>1?"j":""} \u015Dlosilo${i.keys.length>1?"j":""}: ${$(i.keys,", ")}`;case"invalid_key":return`Nevalida \u015Dlosilo en ${i.origin}`;case"invalid_union":return"Nevalida enigo";case"invalid_element":return`Nevalida valoro en ${i.origin}`;default:return"Nevalida enigo"}}};function RR(){return{localeError:R9()}}var M9=()=>{let t={string:{unit:"caracteres",verb:"tener"},file:{unit:"bytes",verb:"tener"},array:{unit:"elementos",verb:"tener"},set:{unit:"elementos",verb:"tener"}};function e(i){return t[i]??null}let r={regex:"entrada",email:"direcci\xF3n de correo electr\xF3nico",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"fecha y hora ISO",date:"fecha ISO",time:"hora ISO",duration:"duraci\xF3n ISO",ipv4:"direcci\xF3n IPv4",ipv6:"direcci\xF3n IPv6",cidrv4:"rango IPv4",cidrv6:"rango IPv6",base64:"cadena codificada en base64",base64url:"URL codificada en base64",json_string:"cadena JSON",e164:"n\xFAmero E.164",jwt:"JWT",template_literal:"entrada"},n={nan:"NaN",string:"texto",number:"n\xFAmero",boolean:"booleano",array:"arreglo",object:"objeto",set:"conjunto",file:"archivo",date:"fecha",bigint:"n\xFAmero grande",symbol:"s\xEDmbolo",undefined:"indefinido",null:"nulo",function:"funci\xF3n",map:"mapa",record:"registro",tuple:"tupla",enum:"enumeraci\xF3n",union:"uni\xF3n",literal:"literal",promise:"promesa",void:"vac\xEDo",never:"nunca",unknown:"desconocido",any:"cualquiera"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`Entrada inv\xE1lida: se esperaba instanceof ${i.expected}, recibido ${s}`:`Entrada inv\xE1lida: se esperaba ${o}, recibido ${s}`}case"invalid_value":return i.values.length===1?`Entrada inv\xE1lida: se esperaba ${j(i.values[0])}`:`Opci\xF3n inv\xE1lida: se esperaba una de ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin),s=n[i.origin]??i.origin;return a?`Demasiado grande: se esperaba que ${s??"valor"} tuviera ${o}${i.maximum.toString()} ${a.unit??"elementos"}`:`Demasiado grande: se esperaba que ${s??"valor"} fuera ${o}${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin),s=n[i.origin]??i.origin;return a?`Demasiado peque\xF1o: se esperaba que ${s} tuviera ${o}${i.minimum.toString()} ${a.unit}`:`Demasiado peque\xF1o: se esperaba que ${s} fuera ${o}${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`Cadena inv\xE1lida: debe comenzar con "${o.prefix}"`:o.format==="ends_with"?`Cadena inv\xE1lida: debe terminar en "${o.suffix}"`:o.format==="includes"?`Cadena inv\xE1lida: debe incluir "${o.includes}"`:o.format==="regex"?`Cadena inv\xE1lida: debe coincidir con el patr\xF3n ${o.pattern}`:`Inv\xE1lido ${r[o.format]??i.format}`}case"not_multiple_of":return`N\xFAmero inv\xE1lido: debe ser m\xFAltiplo de ${i.divisor}`;case"unrecognized_keys":return`Llave${i.keys.length>1?"s":""} desconocida${i.keys.length>1?"s":""}: ${$(i.keys,", ")}`;case"invalid_key":return`Llave inv\xE1lida en ${n[i.origin]??i.origin}`;case"invalid_union":return"Entrada inv\xE1lida";case"invalid_element":return`Valor inv\xE1lido en ${n[i.origin]??i.origin}`;default:return"Entrada inv\xE1lida"}}};function MR(){return{localeError:M9()}}var z9=()=>{let t={string:{unit:"\u06A9\u0627\u0631\u0627\u06A9\u062A\u0631",verb:"\u062F\u0627\u0634\u062A\u0647 \u0628\u0627\u0634\u062F"},file:{unit:"\u0628\u0627\u06CC\u062A",verb:"\u062F\u0627\u0634\u062A\u0647 \u0628\u0627\u0634\u062F"},array:{unit:"\u0622\u06CC\u062A\u0645",verb:"\u062F\u0627\u0634\u062A\u0647 \u0628\u0627\u0634\u062F"},set:{unit:"\u0622\u06CC\u062A\u0645",verb:"\u062F\u0627\u0634\u062A\u0647 \u0628\u0627\u0634\u062F"}};function e(i){return t[i]??null}let r={regex:"\u0648\u0631\u0648\u062F\u06CC",email:"\u0622\u062F\u0631\u0633 \u0627\u06CC\u0645\u06CC\u0644",url:"URL",emoji:"\u0627\u06CC\u0645\u0648\u062C\u06CC",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"\u062A\u0627\u0631\u06CC\u062E \u0648 \u0632\u0645\u0627\u0646 \u0627\u06CC\u0632\u0648",date:"\u062A\u0627\u0631\u06CC\u062E \u0627\u06CC\u0632\u0648",time:"\u0632\u0645\u0627\u0646 \u0627\u06CC\u0632\u0648",duration:"\u0645\u062F\u062A \u0632\u0645\u0627\u0646 \u0627\u06CC\u0632\u0648",ipv4:"IPv4 \u0622\u062F\u0631\u0633",ipv6:"IPv6 \u0622\u062F\u0631\u0633",cidrv4:"IPv4 \u062F\u0627\u0645\u0646\u0647",cidrv6:"IPv6 \u062F\u0627\u0645\u0646\u0647",base64:"base64-encoded \u0631\u0634\u062A\u0647",base64url:"base64url-encoded \u0631\u0634\u062A\u0647",json_string:"JSON \u0631\u0634\u062A\u0647",e164:"E.164 \u0639\u062F\u062F",jwt:"JWT",template_literal:"\u0648\u0631\u0648\u062F\u06CC"},n={nan:"NaN",number:"\u0639\u062F\u062F",array:"\u0622\u0631\u0627\u06CC\u0647"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`\u0648\u0631\u0648\u062F\u06CC \u0646\u0627\u0645\u0639\u062A\u0628\u0631: \u0645\u06CC\u200C\u0628\u0627\u06CC\u0633\u062A instanceof ${i.expected} \u0645\u06CC\u200C\u0628\u0648\u062F\u060C ${s} \u062F\u0631\u06CC\u0627\u0641\u062A \u0634\u062F`:`\u0648\u0631\u0648\u062F\u06CC \u0646\u0627\u0645\u0639\u062A\u0628\u0631: \u0645\u06CC\u200C\u0628\u0627\u06CC\u0633\u062A ${o} \u0645\u06CC\u200C\u0628\u0648\u062F\u060C ${s} \u062F\u0631\u06CC\u0627\u0641\u062A \u0634\u062F`}case"invalid_value":return i.values.length===1?`\u0648\u0631\u0648\u062F\u06CC \u0646\u0627\u0645\u0639\u062A\u0628\u0631: \u0645\u06CC\u200C\u0628\u0627\u06CC\u0633\u062A ${j(i.values[0])} \u0645\u06CC\u200C\u0628\u0648\u062F`:`\u06AF\u0632\u06CC\u0646\u0647 \u0646\u0627\u0645\u0639\u062A\u0628\u0631: \u0645\u06CC\u200C\u0628\u0627\u06CC\u0633\u062A \u06CC\u06A9\u06CC \u0627\u0632 ${$(i.values,"|")} \u0645\u06CC\u200C\u0628\u0648\u062F`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`\u062E\u06CC\u0644\u06CC \u0628\u0632\u0631\u06AF: ${i.origin??"\u0645\u0642\u062F\u0627\u0631"} \u0628\u0627\u06CC\u062F ${o}${i.maximum.toString()} ${a.unit??"\u0639\u0646\u0635\u0631"} \u0628\u0627\u0634\u062F`:`\u062E\u06CC\u0644\u06CC \u0628\u0632\u0631\u06AF: ${i.origin??"\u0645\u0642\u062F\u0627\u0631"} \u0628\u0627\u06CC\u062F ${o}${i.maximum.toString()} \u0628\u0627\u0634\u062F`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`\u062E\u06CC\u0644\u06CC \u06A9\u0648\u0686\u06A9: ${i.origin} \u0628\u0627\u06CC\u062F ${o}${i.minimum.toString()} ${a.unit} \u0628\u0627\u0634\u062F`:`\u062E\u06CC\u0644\u06CC \u06A9\u0648\u0686\u06A9: ${i.origin} \u0628\u0627\u06CC\u062F ${o}${i.minimum.toString()} \u0628\u0627\u0634\u062F`}case"invalid_format":{let o=i;return o.format==="starts_with"?`\u0631\u0634\u062A\u0647 \u0646\u0627\u0645\u0639\u062A\u0628\u0631: \u0628\u0627\u06CC\u062F \u0628\u0627 "${o.prefix}" \u0634\u0631\u0648\u0639 \u0634\u0648\u062F`:o.format==="ends_with"?`\u0631\u0634\u062A\u0647 \u0646\u0627\u0645\u0639\u062A\u0628\u0631: \u0628\u0627\u06CC\u062F \u0628\u0627 "${o.suffix}" \u062A\u0645\u0627\u0645 \u0634\u0648\u062F`:o.format==="includes"?`\u0631\u0634\u062A\u0647 \u0646\u0627\u0645\u0639\u062A\u0628\u0631: \u0628\u0627\u06CC\u062F \u0634\u0627\u0645\u0644 "${o.includes}" \u0628\u0627\u0634\u062F`:o.format==="regex"?`\u0631\u0634\u062A\u0647 \u0646\u0627\u0645\u0639\u062A\u0628\u0631: \u0628\u0627\u06CC\u062F \u0628\u0627 \u0627\u0644\u06AF\u0648\u06CC ${o.pattern} \u0645\u0637\u0627\u0628\u0642\u062A \u062F\u0627\u0634\u062A\u0647 \u0628\u0627\u0634\u062F`:`${r[o.format]??i.format} \u0646\u0627\u0645\u0639\u062A\u0628\u0631`}case"not_multiple_of":return`\u0639\u062F\u062F \u0646\u0627\u0645\u0639\u062A\u0628\u0631: \u0628\u0627\u06CC\u062F \u0645\u0636\u0631\u0628 ${i.divisor} \u0628\u0627\u0634\u062F`;case"unrecognized_keys":return`\u06A9\u0644\u06CC\u062F${i.keys.length>1?"\u0647\u0627\u06CC":""} \u0646\u0627\u0634\u0646\u0627\u0633: ${$(i.keys,", ")}`;case"invalid_key":return`\u06A9\u0644\u06CC\u062F \u0646\u0627\u0634\u0646\u0627\u0633 \u062F\u0631 ${i.origin}`;case"invalid_union":return"\u0648\u0631\u0648\u062F\u06CC \u0646\u0627\u0645\u0639\u062A\u0628\u0631";case"invalid_element":return`\u0645\u0642\u062F\u0627\u0631 \u0646\u0627\u0645\u0639\u062A\u0628\u0631 \u062F\u0631 ${i.origin}`;default:return"\u0648\u0631\u0648\u062F\u06CC \u0646\u0627\u0645\u0639\u062A\u0628\u0631"}}};function zR(){return{localeError:z9()}}var j9=()=>{let t={string:{unit:"merkki\xE4",subject:"merkkijonon"},file:{unit:"tavua",subject:"tiedoston"},array:{unit:"alkiota",subject:"listan"},set:{unit:"alkiota",subject:"joukon"},number:{unit:"",subject:"luvun"},bigint:{unit:"",subject:"suuren kokonaisluvun"},int:{unit:"",subject:"kokonaisluvun"},date:{unit:"",subject:"p\xE4iv\xE4m\xE4\xE4r\xE4n"}};function e(i){return t[i]??null}let r={regex:"s\xE4\xE4nn\xF6llinen lauseke",email:"s\xE4hk\xF6postiosoite",url:"URL-osoite",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-aikaleima",date:"ISO-p\xE4iv\xE4m\xE4\xE4r\xE4",time:"ISO-aika",duration:"ISO-kesto",ipv4:"IPv4-osoite",ipv6:"IPv6-osoite",cidrv4:"IPv4-alue",cidrv6:"IPv6-alue",base64:"base64-koodattu merkkijono",base64url:"base64url-koodattu merkkijono",json_string:"JSON-merkkijono",e164:"E.164-luku",jwt:"JWT",template_literal:"templaattimerkkijono"},n={nan:"NaN"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`Virheellinen tyyppi: odotettiin instanceof ${i.expected}, oli ${s}`:`Virheellinen tyyppi: odotettiin ${o}, oli ${s}`}case"invalid_value":return i.values.length===1?`Virheellinen sy\xF6te: t\xE4ytyy olla ${j(i.values[0])}`:`Virheellinen valinta: t\xE4ytyy olla yksi seuraavista: ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`Liian suuri: ${a.subject} t\xE4ytyy olla ${o}${i.maximum.toString()} ${a.unit}`.trim():`Liian suuri: arvon t\xE4ytyy olla ${o}${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`Liian pieni: ${a.subject} t\xE4ytyy olla ${o}${i.minimum.toString()} ${a.unit}`.trim():`Liian pieni: arvon t\xE4ytyy olla ${o}${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`Virheellinen sy\xF6te: t\xE4ytyy alkaa "${o.prefix}"`:o.format==="ends_with"?`Virheellinen sy\xF6te: t\xE4ytyy loppua "${o.suffix}"`:o.format==="includes"?`Virheellinen sy\xF6te: t\xE4ytyy sis\xE4lt\xE4\xE4 "${o.includes}"`:o.format==="regex"?`Virheellinen sy\xF6te: t\xE4ytyy vastata s\xE4\xE4nn\xF6llist\xE4 lauseketta ${o.pattern}`:`Virheellinen ${r[o.format]??i.format}`}case"not_multiple_of":return`Virheellinen luku: t\xE4ytyy olla luvun ${i.divisor} monikerta`;case"unrecognized_keys":return`${i.keys.length>1?"Tuntemattomat avaimet":"Tuntematon avain"}: ${$(i.keys,", ")}`;case"invalid_key":return"Virheellinen avain tietueessa";case"invalid_union":return"Virheellinen unioni";case"invalid_element":return"Virheellinen arvo joukossa";default:return"Virheellinen sy\xF6te"}}};function jR(){return{localeError:j9()}}var D9=()=>{let t={string:{unit:"caract\xE8res",verb:"avoir"},file:{unit:"octets",verb:"avoir"},array:{unit:"\xE9l\xE9ments",verb:"avoir"},set:{unit:"\xE9l\xE9ments",verb:"avoir"}};function e(i){return t[i]??null}let r={regex:"entr\xE9e",email:"adresse e-mail",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"date et heure ISO",date:"date ISO",time:"heure ISO",duration:"dur\xE9e ISO",ipv4:"adresse IPv4",ipv6:"adresse IPv6",cidrv4:"plage IPv4",cidrv6:"plage IPv6",base64:"cha\xEEne encod\xE9e en base64",base64url:"cha\xEEne encod\xE9e en base64url",json_string:"cha\xEEne JSON",e164:"num\xE9ro E.164",jwt:"JWT",template_literal:"entr\xE9e"},n={nan:"NaN",number:"nombre",array:"tableau"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`Entr\xE9e invalide : instanceof ${i.expected} attendu, ${s} re\xE7u`:`Entr\xE9e invalide : ${o} attendu, ${s} re\xE7u`}case"invalid_value":return i.values.length===1?`Entr\xE9e invalide : ${j(i.values[0])} attendu`:`Option invalide : une valeur parmi ${$(i.values,"|")} attendue`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`Trop grand : ${i.origin??"valeur"} doit ${a.verb} ${o}${i.maximum.toString()} ${a.unit??"\xE9l\xE9ment(s)"}`:`Trop grand : ${i.origin??"valeur"} doit \xEAtre ${o}${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`Trop petit : ${i.origin} doit ${a.verb} ${o}${i.minimum.toString()} ${a.unit}`:`Trop petit : ${i.origin} doit \xEAtre ${o}${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`Cha\xEEne invalide : doit commencer par "${o.prefix}"`:o.format==="ends_with"?`Cha\xEEne invalide : doit se terminer par "${o.suffix}"`:o.format==="includes"?`Cha\xEEne invalide : doit inclure "${o.includes}"`:o.format==="regex"?`Cha\xEEne invalide : doit correspondre au mod\xE8le ${o.pattern}`:`${r[o.format]??i.format} invalide`}case"not_multiple_of":return`Nombre invalide : doit \xEAtre un multiple de ${i.divisor}`;case"unrecognized_keys":return`Cl\xE9${i.keys.length>1?"s":""} non reconnue${i.keys.length>1?"s":""} : ${$(i.keys,", ")}`;case"invalid_key":return`Cl\xE9 invalide dans ${i.origin}`;case"invalid_union":return"Entr\xE9e invalide";case"invalid_element":return`Valeur invalide dans ${i.origin}`;default:return"Entr\xE9e invalide"}}};function DR(){return{localeError:D9()}}var L9=()=>{let t={string:{unit:"caract\xE8res",verb:"avoir"},file:{unit:"octets",verb:"avoir"},array:{unit:"\xE9l\xE9ments",verb:"avoir"},set:{unit:"\xE9l\xE9ments",verb:"avoir"}};function e(i){return t[i]??null}let r={regex:"entr\xE9e",email:"adresse courriel",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"date-heure ISO",date:"date ISO",time:"heure ISO",duration:"dur\xE9e ISO",ipv4:"adresse IPv4",ipv6:"adresse IPv6",cidrv4:"plage IPv4",cidrv6:"plage IPv6",base64:"cha\xEEne encod\xE9e en base64",base64url:"cha\xEEne encod\xE9e en base64url",json_string:"cha\xEEne JSON",e164:"num\xE9ro E.164",jwt:"JWT",template_literal:"entr\xE9e"},n={nan:"NaN"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`Entr\xE9e invalide : attendu instanceof ${i.expected}, re\xE7u ${s}`:`Entr\xE9e invalide : attendu ${o}, re\xE7u ${s}`}case"invalid_value":return i.values.length===1?`Entr\xE9e invalide : attendu ${j(i.values[0])}`:`Option invalide : attendu l'une des valeurs suivantes ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"\u2264":"<",a=e(i.origin);return a?`Trop grand : attendu que ${i.origin??"la valeur"} ait ${o}${i.maximum.toString()} ${a.unit}`:`Trop grand : attendu que ${i.origin??"la valeur"} soit ${o}${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?"\u2265":">",a=e(i.origin);return a?`Trop petit : attendu que ${i.origin} ait ${o}${i.minimum.toString()} ${a.unit}`:`Trop petit : attendu que ${i.origin} soit ${o}${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`Cha\xEEne invalide : doit commencer par "${o.prefix}"`:o.format==="ends_with"?`Cha\xEEne invalide : doit se terminer par "${o.suffix}"`:o.format==="includes"?`Cha\xEEne invalide : doit inclure "${o.includes}"`:o.format==="regex"?`Cha\xEEne invalide : doit correspondre au motif ${o.pattern}`:`${r[o.format]??i.format} invalide`}case"not_multiple_of":return`Nombre invalide : doit \xEAtre un multiple de ${i.divisor}`;case"unrecognized_keys":return`Cl\xE9${i.keys.length>1?"s":""} non reconnue${i.keys.length>1?"s":""} : ${$(i.keys,", ")}`;case"invalid_key":return`Cl\xE9 invalide dans ${i.origin}`;case"invalid_union":return"Entr\xE9e invalide";case"invalid_element":return`Valeur invalide dans ${i.origin}`;default:return"Entr\xE9e invalide"}}};function LR(){return{localeError:L9()}}var U9=()=>{let t={string:{label:"\u05DE\u05D7\u05E8\u05D5\u05D6\u05EA",gender:"f"},number:{label:"\u05DE\u05E1\u05E4\u05E8",gender:"m"},boolean:{label:"\u05E2\u05E8\u05DA \u05D1\u05D5\u05DC\u05D9\u05D0\u05E0\u05D9",gender:"m"},bigint:{label:"BigInt",gender:"m"},date:{label:"\u05EA\u05D0\u05E8\u05D9\u05DA",gender:"m"},array:{label:"\u05DE\u05E2\u05E8\u05DA",gender:"m"},object:{label:"\u05D0\u05D5\u05D1\u05D9\u05D9\u05E7\u05D8",gender:"m"},null:{label:"\u05E2\u05E8\u05DA \u05E8\u05D9\u05E7 (null)",gender:"m"},undefined:{label:"\u05E2\u05E8\u05DA \u05DC\u05D0 \u05DE\u05D5\u05D2\u05D3\u05E8 (undefined)",gender:"m"},symbol:{label:"\u05E1\u05D9\u05DE\u05D1\u05D5\u05DC (Symbol)",gender:"m"},function:{label:"\u05E4\u05D5\u05E0\u05E7\u05E6\u05D9\u05D4",gender:"f"},map:{label:"\u05DE\u05E4\u05D4 (Map)",gender:"f"},set:{label:"\u05E7\u05D1\u05D5\u05E6\u05D4 (Set)",gender:"f"},file:{label:"\u05E7\u05D5\u05D1\u05E5",gender:"m"},promise:{label:"Promise",gender:"m"},NaN:{label:"NaN",gender:"m"},unknown:{label:"\u05E2\u05E8\u05DA \u05DC\u05D0 \u05D9\u05D3\u05D5\u05E2",gender:"m"},value:{label:"\u05E2\u05E8\u05DA",gender:"m"}},e={string:{unit:"\u05EA\u05D5\u05D5\u05D9\u05DD",shortLabel:"\u05E7\u05E6\u05E8",longLabel:"\u05D0\u05E8\u05D5\u05DA"},file:{unit:"\u05D1\u05D9\u05D9\u05D8\u05D9\u05DD",shortLabel:"\u05E7\u05D8\u05DF",longLabel:"\u05D2\u05D3\u05D5\u05DC"},array:{unit:"\u05E4\u05E8\u05D9\u05D8\u05D9\u05DD",shortLabel:"\u05E7\u05D8\u05DF",longLabel:"\u05D2\u05D3\u05D5\u05DC"},set:{unit:"\u05E4\u05E8\u05D9\u05D8\u05D9\u05DD",shortLabel:"\u05E7\u05D8\u05DF",longLabel:"\u05D2\u05D3\u05D5\u05DC"},number:{unit:"",shortLabel:"\u05E7\u05D8\u05DF",longLabel:"\u05D2\u05D3\u05D5\u05DC"}},r=u=>u?t[u]:void 0,n=u=>{let l=r(u);return l?l.label:u??t.unknown.label},i=u=>`\u05D4${n(u)}`,o=u=>(r(u)?.gender??"m")==="f"?"\u05E6\u05E8\u05D9\u05DB\u05D4 \u05DC\u05D4\u05D9\u05D5\u05EA":"\u05E6\u05E8\u05D9\u05DA \u05DC\u05D4\u05D9\u05D5\u05EA",a=u=>u?e[u]??null:null,s={regex:{label:"\u05E7\u05DC\u05D8",gender:"m"},email:{label:"\u05DB\u05EA\u05D5\u05D1\u05EA \u05D0\u05D9\u05DE\u05D9\u05D9\u05DC",gender:"f"},url:{label:"\u05DB\u05EA\u05D5\u05D1\u05EA \u05E8\u05E9\u05EA",gender:"f"},emoji:{label:"\u05D0\u05D9\u05DE\u05D5\u05D2'\u05D9",gender:"m"},uuid:{label:"UUID",gender:"m"},nanoid:{label:"nanoid",gender:"m"},guid:{label:"GUID",gender:"m"},cuid:{label:"cuid",gender:"m"},cuid2:{label:"cuid2",gender:"m"},ulid:{label:"ULID",gender:"m"},xid:{label:"XID",gender:"m"},ksuid:{label:"KSUID",gender:"m"},datetime:{label:"\u05EA\u05D0\u05E8\u05D9\u05DA \u05D5\u05D6\u05DE\u05DF ISO",gender:"m"},date:{label:"\u05EA\u05D0\u05E8\u05D9\u05DA ISO",gender:"m"},time:{label:"\u05D6\u05DE\u05DF ISO",gender:"m"},duration:{label:"\u05DE\u05E9\u05DA \u05D6\u05DE\u05DF ISO",gender:"m"},ipv4:{label:"\u05DB\u05EA\u05D5\u05D1\u05EA IPv4",gender:"f"},ipv6:{label:"\u05DB\u05EA\u05D5\u05D1\u05EA IPv6",gender:"f"},cidrv4:{label:"\u05D8\u05D5\u05D5\u05D7 IPv4",gender:"m"},cidrv6:{label:"\u05D8\u05D5\u05D5\u05D7 IPv6",gender:"m"},base64:{label:"\u05DE\u05D7\u05E8\u05D5\u05D6\u05EA \u05D1\u05D1\u05E1\u05D9\u05E1 64",gender:"f"},base64url:{label:"\u05DE\u05D7\u05E8\u05D5\u05D6\u05EA \u05D1\u05D1\u05E1\u05D9\u05E1 64 \u05DC\u05DB\u05EA\u05D5\u05D1\u05D5\u05EA \u05E8\u05E9\u05EA",gender:"f"},json_string:{label:"\u05DE\u05D7\u05E8\u05D5\u05D6\u05EA JSON",gender:"f"},e164:{label:"\u05DE\u05E1\u05E4\u05E8 E.164",gender:"m"},jwt:{label:"JWT",gender:"m"},ends_with:{label:"\u05E7\u05DC\u05D8",gender:"m"},includes:{label:"\u05E7\u05DC\u05D8",gender:"m"},lowercase:{label:"\u05E7\u05DC\u05D8",gender:"m"},starts_with:{label:"\u05E7\u05DC\u05D8",gender:"m"},uppercase:{label:"\u05E7\u05DC\u05D8",gender:"m"}},c={nan:"NaN"};return u=>{switch(u.code){case"invalid_type":{let l=u.expected,p=c[l??""]??n(l),f=B(u.input),m=c[f]??t[f]?.label??f;return/^[A-Z]/.test(u.expected)?`\u05E7\u05DC\u05D8 \u05DC\u05D0 \u05EA\u05E7\u05D9\u05DF: \u05E6\u05E8\u05D9\u05DA \u05DC\u05D4\u05D9\u05D5\u05EA instanceof ${u.expected}, \u05D4\u05EA\u05E7\u05D1\u05DC ${m}`:`\u05E7\u05DC\u05D8 \u05DC\u05D0 \u05EA\u05E7\u05D9\u05DF: \u05E6\u05E8\u05D9\u05DA \u05DC\u05D4\u05D9\u05D5\u05EA ${p}, \u05D4\u05EA\u05E7\u05D1\u05DC ${m}`}case"invalid_value":{if(u.values.length===1)return`\u05E2\u05E8\u05DA \u05DC\u05D0 \u05EA\u05E7\u05D9\u05DF: \u05D4\u05E2\u05E8\u05DA \u05D7\u05D9\u05D9\u05D1 \u05DC\u05D4\u05D9\u05D5\u05EA ${j(u.values[0])}`;let l=u.values.map(m=>j(m));if(u.values.length===2)return`\u05E2\u05E8\u05DA \u05DC\u05D0 \u05EA\u05E7\u05D9\u05DF: \u05D4\u05D0\u05E4\u05E9\u05E8\u05D5\u05D9\u05D5\u05EA \u05D4\u05DE\u05EA\u05D0\u05D9\u05DE\u05D5\u05EA \u05D4\u05DF ${l[0]} \u05D0\u05D5 ${l[1]}`;let p=l[l.length-1];return`\u05E2\u05E8\u05DA \u05DC\u05D0 \u05EA\u05E7\u05D9\u05DF: \u05D4\u05D0\u05E4\u05E9\u05E8\u05D5\u05D9\u05D5\u05EA \u05D4\u05DE\u05EA\u05D0\u05D9\u05DE\u05D5\u05EA \u05D4\u05DF ${l.slice(0,-1).join(", ")} \u05D0\u05D5 ${p}`}case"too_big":{let l=a(u.origin),p=i(u.origin??"value");if(u.origin==="string")return`${l?.longLabel??"\u05D0\u05E8\u05D5\u05DA"} \u05DE\u05D3\u05D9: ${p} \u05E6\u05E8\u05D9\u05DB\u05D4 \u05DC\u05D4\u05DB\u05D9\u05DC ${u.maximum.toString()} ${l?.unit??""} ${u.inclusive?"\u05D0\u05D5 \u05E4\u05D7\u05D5\u05EA":"\u05DC\u05DB\u05DC \u05D4\u05D9\u05D5\u05EA\u05E8"}`.trim();if(u.origin==="number"){let h=u.inclusive?`\u05E7\u05D8\u05DF \u05D0\u05D5 \u05E9\u05D5\u05D5\u05D4 \u05DC-${u.maximum}`:`\u05E7\u05D8\u05DF \u05DE-${u.maximum}`;return`\u05D2\u05D3\u05D5\u05DC \u05DE\u05D3\u05D9: ${p} \u05E6\u05E8\u05D9\u05DA \u05DC\u05D4\u05D9\u05D5\u05EA ${h}`}if(u.origin==="array"||u.origin==="set"){let h=u.origin==="set"?"\u05E6\u05E8\u05D9\u05DB\u05D4":"\u05E6\u05E8\u05D9\u05DA",g=u.inclusive?`${u.maximum} ${l?.unit??""} \u05D0\u05D5 \u05E4\u05D7\u05D5\u05EA`:`\u05E4\u05D7\u05D5\u05EA \u05DE-${u.maximum} ${l?.unit??""}`;return`\u05D2\u05D3\u05D5\u05DC \u05DE\u05D3\u05D9: ${p} ${h} \u05DC\u05D4\u05DB\u05D9\u05DC ${g}`.trim()}let f=u.inclusive?"<=":"<",m=o(u.origin??"value");return l?.unit?`${l.longLabel} \u05DE\u05D3\u05D9: ${p} ${m} ${f}${u.maximum.toString()} ${l.unit}`:`${l?.longLabel??"\u05D2\u05D3\u05D5\u05DC"} \u05DE\u05D3\u05D9: ${p} ${m} ${f}${u.maximum.toString()}`}case"too_small":{let l=a(u.origin),p=i(u.origin??"value");if(u.origin==="string")return`${l?.shortLabel??"\u05E7\u05E6\u05E8"} \u05DE\u05D3\u05D9: ${p} \u05E6\u05E8\u05D9\u05DB\u05D4 \u05DC\u05D4\u05DB\u05D9\u05DC ${u.minimum.toString()} ${l?.unit??""} ${u.inclusive?"\u05D0\u05D5 \u05D9\u05D5\u05EA\u05E8":"\u05DC\u05E4\u05D7\u05D5\u05EA"}`.trim();if(u.origin==="number"){let h=u.inclusive?`\u05D2\u05D3\u05D5\u05DC \u05D0\u05D5 \u05E9\u05D5\u05D5\u05D4 \u05DC-${u.minimum}`:`\u05D2\u05D3\u05D5\u05DC \u05DE-${u.minimum}`;return`\u05E7\u05D8\u05DF \u05DE\u05D3\u05D9: ${p} \u05E6\u05E8\u05D9\u05DA \u05DC\u05D4\u05D9\u05D5\u05EA ${h}`}if(u.origin==="array"||u.origin==="set"){let h=u.origin==="set"?"\u05E6\u05E8\u05D9\u05DB\u05D4":"\u05E6\u05E8\u05D9\u05DA";if(u.minimum===1&&u.inclusive){let x=(u.origin==="set","\u05DC\u05E4\u05D7\u05D5\u05EA \u05E4\u05E8\u05D9\u05D8 \u05D0\u05D7\u05D3");return`\u05E7\u05D8\u05DF \u05DE\u05D3\u05D9: ${p} ${h} \u05DC\u05D4\u05DB\u05D9\u05DC ${x}`}let g=u.inclusive?`${u.minimum} ${l?.unit??""} \u05D0\u05D5 \u05D9\u05D5\u05EA\u05E8`:`\u05D9\u05D5\u05EA\u05E8 \u05DE-${u.minimum} ${l?.unit??""}`;return`\u05E7\u05D8\u05DF \u05DE\u05D3\u05D9: ${p} ${h} \u05DC\u05D4\u05DB\u05D9\u05DC ${g}`.trim()}let f=u.inclusive?">=":">",m=o(u.origin??"value");return l?.unit?`${l.shortLabel} \u05DE\u05D3\u05D9: ${p} ${m} ${f}${u.minimum.toString()} ${l.unit}`:`${l?.shortLabel??"\u05E7\u05D8\u05DF"} \u05DE\u05D3\u05D9: ${p} ${m} ${f}${u.minimum.toString()}`}case"invalid_format":{let l=u;if(l.format==="starts_with")return`\u05D4\u05DE\u05D7\u05E8\u05D5\u05D6\u05EA \u05D7\u05D9\u05D9\u05D1\u05EA \u05DC\u05D4\u05EA\u05D7\u05D9\u05DC \u05D1 "${l.prefix}"`;if(l.format==="ends_with")return`\u05D4\u05DE\u05D7\u05E8\u05D5\u05D6\u05EA \u05D7\u05D9\u05D9\u05D1\u05EA \u05DC\u05D4\u05E1\u05EA\u05D9\u05D9\u05DD \u05D1 "${l.suffix}"`;if(l.format==="includes")return`\u05D4\u05DE\u05D7\u05E8\u05D5\u05D6\u05EA \u05D7\u05D9\u05D9\u05D1\u05EA \u05DC\u05DB\u05DC\u05D5\u05DC "${l.includes}"`;if(l.format==="regex")return`\u05D4\u05DE\u05D7\u05E8\u05D5\u05D6\u05EA \u05D7\u05D9\u05D9\u05D1\u05EA \u05DC\u05D4\u05EA\u05D0\u05D9\u05DD \u05DC\u05EA\u05D1\u05E0\u05D9\u05EA ${l.pattern}`;let p=s[l.format],f=p?.label??l.format,h=(p?.gender??"m")==="f"?"\u05EA\u05E7\u05D9\u05E0\u05D4":"\u05EA\u05E7\u05D9\u05DF";return`${f} \u05DC\u05D0 ${h}`}case"not_multiple_of":return`\u05DE\u05E1\u05E4\u05E8 \u05DC\u05D0 \u05EA\u05E7\u05D9\u05DF: \u05D7\u05D9\u05D9\u05D1 \u05DC\u05D4\u05D9\u05D5\u05EA \u05DE\u05DB\u05E4\u05DC\u05D4 \u05E9\u05DC ${u.divisor}`;case"unrecognized_keys":return`\u05DE\u05E4\u05EA\u05D7${u.keys.length>1?"\u05D5\u05EA":""} \u05DC\u05D0 \u05DE\u05D6\u05D5\u05D4${u.keys.length>1?"\u05D9\u05DD":"\u05D4"}: ${$(u.keys,", ")}`;case"invalid_key":return"\u05E9\u05D3\u05D4 \u05DC\u05D0 \u05EA\u05E7\u05D9\u05DF \u05D1\u05D0\u05D5\u05D1\u05D9\u05D9\u05E7\u05D8";case"invalid_union":return"\u05E7\u05DC\u05D8 \u05DC\u05D0 \u05EA\u05E7\u05D9\u05DF";case"invalid_element":return`\u05E2\u05E8\u05DA \u05DC\u05D0 \u05EA\u05E7\u05D9\u05DF \u05D1${i(u.origin??"array")}`;default:return"\u05E7\u05DC\u05D8 \u05DC\u05D0 \u05EA\u05E7\u05D9\u05DF"}}};function UR(){return{localeError:U9()}}var F9=()=>{let t={string:{unit:"karakter",verb:"legyen"},file:{unit:"byte",verb:"legyen"},array:{unit:"elem",verb:"legyen"},set:{unit:"elem",verb:"legyen"}};function e(i){return t[i]??null}let r={regex:"bemenet",email:"email c\xEDm",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO id\u0151b\xE9lyeg",date:"ISO d\xE1tum",time:"ISO id\u0151",duration:"ISO id\u0151intervallum",ipv4:"IPv4 c\xEDm",ipv6:"IPv6 c\xEDm",cidrv4:"IPv4 tartom\xE1ny",cidrv6:"IPv6 tartom\xE1ny",base64:"base64-k\xF3dolt string",base64url:"base64url-k\xF3dolt string",json_string:"JSON string",e164:"E.164 sz\xE1m",jwt:"JWT",template_literal:"bemenet"},n={nan:"NaN",number:"sz\xE1m",array:"t\xF6mb"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`\xC9rv\xE9nytelen bemenet: a v\xE1rt \xE9rt\xE9k instanceof ${i.expected}, a kapott \xE9rt\xE9k ${s}`:`\xC9rv\xE9nytelen bemenet: a v\xE1rt \xE9rt\xE9k ${o}, a kapott \xE9rt\xE9k ${s}`}case"invalid_value":return i.values.length===1?`\xC9rv\xE9nytelen bemenet: a v\xE1rt \xE9rt\xE9k ${j(i.values[0])}`:`\xC9rv\xE9nytelen opci\xF3: valamelyik \xE9rt\xE9k v\xE1rt ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`T\xFAl nagy: ${i.origin??"\xE9rt\xE9k"} m\xE9rete t\xFAl nagy ${o}${i.maximum.toString()} ${a.unit??"elem"}`:`T\xFAl nagy: a bemeneti \xE9rt\xE9k ${i.origin??"\xE9rt\xE9k"} t\xFAl nagy: ${o}${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`T\xFAl kicsi: a bemeneti \xE9rt\xE9k ${i.origin} m\xE9rete t\xFAl kicsi ${o}${i.minimum.toString()} ${a.unit}`:`T\xFAl kicsi: a bemeneti \xE9rt\xE9k ${i.origin} t\xFAl kicsi ${o}${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`\xC9rv\xE9nytelen string: "${o.prefix}" \xE9rt\xE9kkel kell kezd\u0151dnie`:o.format==="ends_with"?`\xC9rv\xE9nytelen string: "${o.suffix}" \xE9rt\xE9kkel kell v\xE9gz\u0151dnie`:o.format==="includes"?`\xC9rv\xE9nytelen string: "${o.includes}" \xE9rt\xE9ket kell tartalmaznia`:o.format==="regex"?`\xC9rv\xE9nytelen string: ${o.pattern} mint\xE1nak kell megfelelnie`:`\xC9rv\xE9nytelen ${r[o.format]??i.format}`}case"not_multiple_of":return`\xC9rv\xE9nytelen sz\xE1m: ${i.divisor} t\xF6bbsz\xF6r\xF6s\xE9nek kell lennie`;case"unrecognized_keys":return`Ismeretlen kulcs${i.keys.length>1?"s":""}: ${$(i.keys,", ")}`;case"invalid_key":return`\xC9rv\xE9nytelen kulcs ${i.origin}`;case"invalid_union":return"\xC9rv\xE9nytelen bemenet";case"invalid_element":return`\xC9rv\xE9nytelen \xE9rt\xE9k: ${i.origin}`;default:return"\xC9rv\xE9nytelen bemenet"}}};function FR(){return{localeError:F9()}}function BR(t,e,r){return Math.abs(t)===1?e:r}function Jc(t){if(!t)return"";let e=["\u0561","\u0565","\u0568","\u056B","\u0578","\u0578\u0582","\u0585"],r=t[t.length-1];return t+(e.includes(r)?"\u0576":"\u0568")}var B9=()=>{let t={string:{unit:{one:"\u0576\u0577\u0561\u0576",many:"\u0576\u0577\u0561\u0576\u0576\u0565\u0580"},verb:"\u0578\u0582\u0576\u0565\u0576\u0561\u056C"},file:{unit:{one:"\u0562\u0561\u0575\u0569",many:"\u0562\u0561\u0575\u0569\u0565\u0580"},verb:"\u0578\u0582\u0576\u0565\u0576\u0561\u056C"},array:{unit:{one:"\u057F\u0561\u0580\u0580",many:"\u057F\u0561\u0580\u0580\u0565\u0580"},verb:"\u0578\u0582\u0576\u0565\u0576\u0561\u056C"},set:{unit:{one:"\u057F\u0561\u0580\u0580",many:"\u057F\u0561\u0580\u0580\u0565\u0580"},verb:"\u0578\u0582\u0576\u0565\u0576\u0561\u056C"}};function e(i){return t[i]??null}let r={regex:"\u0574\u0578\u0582\u057F\u0584",email:"\u0567\u056C. \u0570\u0561\u057D\u0581\u0565",url:"URL",emoji:"\u0567\u0574\u0578\u057B\u056B",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO \u0561\u0574\u057D\u0561\u0569\u056B\u057E \u0587 \u056A\u0561\u0574",date:"ISO \u0561\u0574\u057D\u0561\u0569\u056B\u057E",time:"ISO \u056A\u0561\u0574",duration:"ISO \u057F\u0587\u0578\u0572\u0578\u0582\u0569\u0575\u0578\u0582\u0576",ipv4:"IPv4 \u0570\u0561\u057D\u0581\u0565",ipv6:"IPv6 \u0570\u0561\u057D\u0581\u0565",cidrv4:"IPv4 \u0574\u056B\u057B\u0561\u056F\u0561\u0575\u0584",cidrv6:"IPv6 \u0574\u056B\u057B\u0561\u056F\u0561\u0575\u0584",base64:"base64 \u0571\u0587\u0561\u0579\u0561\u0583\u0578\u057E \u057F\u0578\u0572",base64url:"base64url \u0571\u0587\u0561\u0579\u0561\u0583\u0578\u057E \u057F\u0578\u0572",json_string:"JSON \u057F\u0578\u0572",e164:"E.164 \u0570\u0561\u0574\u0561\u0580",jwt:"JWT",template_literal:"\u0574\u0578\u0582\u057F\u0584"},n={nan:"NaN",number:"\u0569\u056B\u057E",array:"\u0566\u0561\u0576\u0563\u057E\u0561\u056E"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`\u054D\u056D\u0561\u056C \u0574\u0578\u0582\u057F\u0584\u0561\u0563\u0580\u0578\u0582\u0574\u2024 \u057D\u057A\u0561\u057D\u057E\u0578\u0582\u0574 \u0567\u0580 instanceof ${i.expected}, \u057D\u057F\u0561\u0581\u057E\u0565\u056C \u0567 ${s}`:`\u054D\u056D\u0561\u056C \u0574\u0578\u0582\u057F\u0584\u0561\u0563\u0580\u0578\u0582\u0574\u2024 \u057D\u057A\u0561\u057D\u057E\u0578\u0582\u0574 \u0567\u0580 ${o}, \u057D\u057F\u0561\u0581\u057E\u0565\u056C \u0567 ${s}`}case"invalid_value":return i.values.length===1?`\u054D\u056D\u0561\u056C \u0574\u0578\u0582\u057F\u0584\u0561\u0563\u0580\u0578\u0582\u0574\u2024 \u057D\u057A\u0561\u057D\u057E\u0578\u0582\u0574 \u0567\u0580 ${j(i.values[1])}`:`\u054D\u056D\u0561\u056C \u057F\u0561\u0580\u0562\u0565\u0580\u0561\u056F\u2024 \u057D\u057A\u0561\u057D\u057E\u0578\u0582\u0574 \u0567\u0580 \u0570\u0565\u057F\u0587\u0575\u0561\u056C\u0576\u0565\u0580\u056B\u0581 \u0574\u0565\u056F\u0568\u055D ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);if(a){let s=Number(i.maximum),c=BR(s,a.unit.one,a.unit.many);return`\u0549\u0561\u0583\u0561\u0566\u0561\u0576\u0581 \u0574\u0565\u056E \u0561\u0580\u056A\u0565\u0584\u2024 \u057D\u057A\u0561\u057D\u057E\u0578\u0582\u0574 \u0567, \u0578\u0580 ${Jc(i.origin??"\u0561\u0580\u056A\u0565\u0584")} \u056F\u0578\u0582\u0576\u0565\u0576\u0561 ${o}${i.maximum.toString()} ${c}`}return`\u0549\u0561\u0583\u0561\u0566\u0561\u0576\u0581 \u0574\u0565\u056E \u0561\u0580\u056A\u0565\u0584\u2024 \u057D\u057A\u0561\u057D\u057E\u0578\u0582\u0574 \u0567, \u0578\u0580 ${Jc(i.origin??"\u0561\u0580\u056A\u0565\u0584")} \u056C\u056B\u0576\u056B ${o}${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);if(a){let s=Number(i.minimum),c=BR(s,a.unit.one,a.unit.many);return`\u0549\u0561\u0583\u0561\u0566\u0561\u0576\u0581 \u0583\u0578\u0584\u0580 \u0561\u0580\u056A\u0565\u0584\u2024 \u057D\u057A\u0561\u057D\u057E\u0578\u0582\u0574 \u0567, \u0578\u0580 ${Jc(i.origin)} \u056F\u0578\u0582\u0576\u0565\u0576\u0561 ${o}${i.minimum.toString()} ${c}`}return`\u0549\u0561\u0583\u0561\u0566\u0561\u0576\u0581 \u0583\u0578\u0584\u0580 \u0561\u0580\u056A\u0565\u0584\u2024 \u057D\u057A\u0561\u057D\u057E\u0578\u0582\u0574 \u0567, \u0578\u0580 ${Jc(i.origin)} \u056C\u056B\u0576\u056B ${o}${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`\u054D\u056D\u0561\u056C \u057F\u0578\u0572\u2024 \u057A\u0565\u057F\u0584 \u0567 \u057D\u056F\u057D\u057E\u056B "${o.prefix}"-\u0578\u057E`:o.format==="ends_with"?`\u054D\u056D\u0561\u056C \u057F\u0578\u0572\u2024 \u057A\u0565\u057F\u0584 \u0567 \u0561\u057E\u0561\u0580\u057F\u057E\u056B "${o.suffix}"-\u0578\u057E`:o.format==="includes"?`\u054D\u056D\u0561\u056C \u057F\u0578\u0572\u2024 \u057A\u0565\u057F\u0584 \u0567 \u057A\u0561\u0580\u0578\u0582\u0576\u0561\u056F\u056B "${o.includes}"`:o.format==="regex"?`\u054D\u056D\u0561\u056C \u057F\u0578\u0572\u2024 \u057A\u0565\u057F\u0584 \u0567 \u0570\u0561\u0574\u0561\u057A\u0561\u057F\u0561\u057D\u056D\u0561\u0576\u056B ${o.pattern} \u0571\u0587\u0561\u0579\u0561\u0583\u056B\u0576`:`\u054D\u056D\u0561\u056C ${r[o.format]??i.format}`}case"not_multiple_of":return`\u054D\u056D\u0561\u056C \u0569\u056B\u057E\u2024 \u057A\u0565\u057F\u0584 \u0567 \u0562\u0561\u0566\u0574\u0561\u057A\u0561\u057F\u056B\u056F \u056C\u056B\u0576\u056B ${i.divisor}-\u056B`;case"unrecognized_keys":return`\u0549\u0573\u0561\u0576\u0561\u0579\u057E\u0561\u056E \u0562\u0561\u0576\u0561\u056C\u056B${i.keys.length>1?"\u0576\u0565\u0580":""}. ${$(i.keys,", ")}`;case"invalid_key":return`\u054D\u056D\u0561\u056C \u0562\u0561\u0576\u0561\u056C\u056B ${Jc(i.origin)}-\u0578\u0582\u0574`;case"invalid_union":return"\u054D\u056D\u0561\u056C \u0574\u0578\u0582\u057F\u0584\u0561\u0563\u0580\u0578\u0582\u0574";case"invalid_element":return`\u054D\u056D\u0561\u056C \u0561\u0580\u056A\u0565\u0584 ${Jc(i.origin)}-\u0578\u0582\u0574`;default:return"\u054D\u056D\u0561\u056C \u0574\u0578\u0582\u057F\u0584\u0561\u0563\u0580\u0578\u0582\u0574"}}};function VR(){return{localeError:B9()}}var V9=()=>{let t={string:{unit:"karakter",verb:"memiliki"},file:{unit:"byte",verb:"memiliki"},array:{unit:"item",verb:"memiliki"},set:{unit:"item",verb:"memiliki"}};function e(i){return t[i]??null}let r={regex:"input",email:"alamat email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"tanggal dan waktu format ISO",date:"tanggal format ISO",time:"jam format ISO",duration:"durasi format ISO",ipv4:"alamat IPv4",ipv6:"alamat IPv6",cidrv4:"rentang alamat IPv4",cidrv6:"rentang alamat IPv6",base64:"string dengan enkode base64",base64url:"string dengan enkode base64url",json_string:"string JSON",e164:"angka E.164",jwt:"JWT",template_literal:"input"},n={nan:"NaN"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`Input tidak valid: diharapkan instanceof ${i.expected}, diterima ${s}`:`Input tidak valid: diharapkan ${o}, diterima ${s}`}case"invalid_value":return i.values.length===1?`Input tidak valid: diharapkan ${j(i.values[0])}`:`Pilihan tidak valid: diharapkan salah satu dari ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`Terlalu besar: diharapkan ${i.origin??"value"} memiliki ${o}${i.maximum.toString()} ${a.unit??"elemen"}`:`Terlalu besar: diharapkan ${i.origin??"value"} menjadi ${o}${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`Terlalu kecil: diharapkan ${i.origin} memiliki ${o}${i.minimum.toString()} ${a.unit}`:`Terlalu kecil: diharapkan ${i.origin} menjadi ${o}${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`String tidak valid: harus dimulai dengan "${o.prefix}"`:o.format==="ends_with"?`String tidak valid: harus berakhir dengan "${o.suffix}"`:o.format==="includes"?`String tidak valid: harus menyertakan "${o.includes}"`:o.format==="regex"?`String tidak valid: harus sesuai pola ${o.pattern}`:`${r[o.format]??i.format} tidak valid`}case"not_multiple_of":return`Angka tidak valid: harus kelipatan dari ${i.divisor}`;case"unrecognized_keys":return`Kunci tidak dikenali ${i.keys.length>1?"s":""}: ${$(i.keys,", ")}`;case"invalid_key":return`Kunci tidak valid di ${i.origin}`;case"invalid_union":return"Input tidak valid";case"invalid_element":return`Nilai tidak valid di ${i.origin}`;default:return"Input tidak valid"}}};function ZR(){return{localeError:V9()}}var Z9=()=>{let t={string:{unit:"stafi",verb:"a\xF0 hafa"},file:{unit:"b\xE6ti",verb:"a\xF0 hafa"},array:{unit:"hluti",verb:"a\xF0 hafa"},set:{unit:"hluti",verb:"a\xF0 hafa"}};function e(i){return t[i]??null}let r={regex:"gildi",email:"netfang",url:"vefsl\xF3\xF0",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO dagsetning og t\xEDmi",date:"ISO dagsetning",time:"ISO t\xEDmi",duration:"ISO t\xEDmalengd",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded strengur",base64url:"base64url-encoded strengur",json_string:"JSON strengur",e164:"E.164 t\xF6lugildi",jwt:"JWT",template_literal:"gildi"},n={nan:"NaN",number:"n\xFAmer",array:"fylki"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`Rangt gildi: \xDE\xFA sl\xF3st inn ${s} \xFEar sem \xE1 a\xF0 vera instanceof ${i.expected}`:`Rangt gildi: \xDE\xFA sl\xF3st inn ${s} \xFEar sem \xE1 a\xF0 vera ${o}`}case"invalid_value":return i.values.length===1?`Rangt gildi: gert r\xE1\xF0 fyrir ${j(i.values[0])}`:`\xD3gilt val: m\xE1 vera eitt af eftirfarandi ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`Of st\xF3rt: gert er r\xE1\xF0 fyrir a\xF0 ${i.origin??"gildi"} hafi ${o}${i.maximum.toString()} ${a.unit??"hluti"}`:`Of st\xF3rt: gert er r\xE1\xF0 fyrir a\xF0 ${i.origin??"gildi"} s\xE9 ${o}${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`Of l\xEDti\xF0: gert er r\xE1\xF0 fyrir a\xF0 ${i.origin} hafi ${o}${i.minimum.toString()} ${a.unit}`:`Of l\xEDti\xF0: gert er r\xE1\xF0 fyrir a\xF0 ${i.origin} s\xE9 ${o}${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`\xD3gildur strengur: ver\xF0ur a\xF0 byrja \xE1 "${o.prefix}"`:o.format==="ends_with"?`\xD3gildur strengur: ver\xF0ur a\xF0 enda \xE1 "${o.suffix}"`:o.format==="includes"?`\xD3gildur strengur: ver\xF0ur a\xF0 innihalda "${o.includes}"`:o.format==="regex"?`\xD3gildur strengur: ver\xF0ur a\xF0 fylgja mynstri ${o.pattern}`:`Rangt ${r[o.format]??i.format}`}case"not_multiple_of":return`R\xF6ng tala: ver\xF0ur a\xF0 vera margfeldi af ${i.divisor}`;case"unrecognized_keys":return`\xD3\xFEekkt ${i.keys.length>1?"ir lyklar":"ur lykill"}: ${$(i.keys,", ")}`;case"invalid_key":return`Rangur lykill \xED ${i.origin}`;case"invalid_union":return"Rangt gildi";case"invalid_element":return`Rangt gildi \xED ${i.origin}`;default:return"Rangt gildi"}}};function GR(){return{localeError:Z9()}}var G9=()=>{let t={string:{unit:"caratteri",verb:"avere"},file:{unit:"byte",verb:"avere"},array:{unit:"elementi",verb:"avere"},set:{unit:"elementi",verb:"avere"}};function e(i){return t[i]??null}let r={regex:"input",email:"indirizzo email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data e ora ISO",date:"data ISO",time:"ora ISO",duration:"durata ISO",ipv4:"indirizzo IPv4",ipv6:"indirizzo IPv6",cidrv4:"intervallo IPv4",cidrv6:"intervallo IPv6",base64:"stringa codificata in base64",base64url:"URL codificata in base64",json_string:"stringa JSON",e164:"numero E.164",jwt:"JWT",template_literal:"input"},n={nan:"NaN",number:"numero",array:"vettore"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`Input non valido: atteso instanceof ${i.expected}, ricevuto ${s}`:`Input non valido: atteso ${o}, ricevuto ${s}`}case"invalid_value":return i.values.length===1?`Input non valido: atteso ${j(i.values[0])}`:`Opzione non valida: atteso uno tra ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`Troppo grande: ${i.origin??"valore"} deve avere ${o}${i.maximum.toString()} ${a.unit??"elementi"}`:`Troppo grande: ${i.origin??"valore"} deve essere ${o}${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`Troppo piccolo: ${i.origin} deve avere ${o}${i.minimum.toString()} ${a.unit}`:`Troppo piccolo: ${i.origin} deve essere ${o}${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`Stringa non valida: deve iniziare con "${o.prefix}"`:o.format==="ends_with"?`Stringa non valida: deve terminare con "${o.suffix}"`:o.format==="includes"?`Stringa non valida: deve includere "${o.includes}"`:o.format==="regex"?`Stringa non valida: deve corrispondere al pattern ${o.pattern}`:`Invalid ${r[o.format]??i.format}`}case"not_multiple_of":return`Numero non valido: deve essere un multiplo di ${i.divisor}`;case"unrecognized_keys":return`Chiav${i.keys.length>1?"i":"e"} non riconosciut${i.keys.length>1?"e":"a"}: ${$(i.keys,", ")}`;case"invalid_key":return`Chiave non valida in ${i.origin}`;case"invalid_union":return"Input non valido";case"invalid_element":return`Valore non valido in ${i.origin}`;default:return"Input non valido"}}};function HR(){return{localeError:G9()}}var H9=()=>{let t={string:{unit:"\u6587\u5B57",verb:"\u3067\u3042\u308B"},file:{unit:"\u30D0\u30A4\u30C8",verb:"\u3067\u3042\u308B"},array:{unit:"\u8981\u7D20",verb:"\u3067\u3042\u308B"},set:{unit:"\u8981\u7D20",verb:"\u3067\u3042\u308B"}};function e(i){return t[i]??null}let r={regex:"\u5165\u529B\u5024",email:"\u30E1\u30FC\u30EB\u30A2\u30C9\u30EC\u30B9",url:"URL",emoji:"\u7D75\u6587\u5B57",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO\u65E5\u6642",date:"ISO\u65E5\u4ED8",time:"ISO\u6642\u523B",duration:"ISO\u671F\u9593",ipv4:"IPv4\u30A2\u30C9\u30EC\u30B9",ipv6:"IPv6\u30A2\u30C9\u30EC\u30B9",cidrv4:"IPv4\u7BC4\u56F2",cidrv6:"IPv6\u7BC4\u56F2",base64:"base64\u30A8\u30F3\u30B3\u30FC\u30C9\u6587\u5B57\u5217",base64url:"base64url\u30A8\u30F3\u30B3\u30FC\u30C9\u6587\u5B57\u5217",json_string:"JSON\u6587\u5B57\u5217",e164:"E.164\u756A\u53F7",jwt:"JWT",template_literal:"\u5165\u529B\u5024"},n={nan:"NaN",number:"\u6570\u5024",array:"\u914D\u5217"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`\u7121\u52B9\u306A\u5165\u529B: instanceof ${i.expected}\u304C\u671F\u5F85\u3055\u308C\u307E\u3057\u305F\u304C\u3001${s}\u304C\u5165\u529B\u3055\u308C\u307E\u3057\u305F`:`\u7121\u52B9\u306A\u5165\u529B: ${o}\u304C\u671F\u5F85\u3055\u308C\u307E\u3057\u305F\u304C\u3001${s}\u304C\u5165\u529B\u3055\u308C\u307E\u3057\u305F`}case"invalid_value":return i.values.length===1?`\u7121\u52B9\u306A\u5165\u529B: ${j(i.values[0])}\u304C\u671F\u5F85\u3055\u308C\u307E\u3057\u305F`:`\u7121\u52B9\u306A\u9078\u629E: ${$(i.values,"\u3001")}\u306E\u3044\u305A\u308C\u304B\u3067\u3042\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059`;case"too_big":{let o=i.inclusive?"\u4EE5\u4E0B\u3067\u3042\u308B":"\u3088\u308A\u5C0F\u3055\u3044",a=e(i.origin);return a?`\u5927\u304D\u3059\u304E\u308B\u5024: ${i.origin??"\u5024"}\u306F${i.maximum.toString()}${a.unit??"\u8981\u7D20"}${o}\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059`:`\u5927\u304D\u3059\u304E\u308B\u5024: ${i.origin??"\u5024"}\u306F${i.maximum.toString()}${o}\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059`}case"too_small":{let o=i.inclusive?"\u4EE5\u4E0A\u3067\u3042\u308B":"\u3088\u308A\u5927\u304D\u3044",a=e(i.origin);return a?`\u5C0F\u3055\u3059\u304E\u308B\u5024: ${i.origin}\u306F${i.minimum.toString()}${a.unit}${o}\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059`:`\u5C0F\u3055\u3059\u304E\u308B\u5024: ${i.origin}\u306F${i.minimum.toString()}${o}\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059`}case"invalid_format":{let o=i;return o.format==="starts_with"?`\u7121\u52B9\u306A\u6587\u5B57\u5217: "${o.prefix}"\u3067\u59CB\u307E\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059`:o.format==="ends_with"?`\u7121\u52B9\u306A\u6587\u5B57\u5217: "${o.suffix}"\u3067\u7D42\u308F\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059`:o.format==="includes"?`\u7121\u52B9\u306A\u6587\u5B57\u5217: "${o.includes}"\u3092\u542B\u3080\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059`:o.format==="regex"?`\u7121\u52B9\u306A\u6587\u5B57\u5217: \u30D1\u30BF\u30FC\u30F3${o.pattern}\u306B\u4E00\u81F4\u3059\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059`:`\u7121\u52B9\u306A${r[o.format]??i.format}`}case"not_multiple_of":return`\u7121\u52B9\u306A\u6570\u5024: ${i.divisor}\u306E\u500D\u6570\u3067\u3042\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059`;case"unrecognized_keys":return`\u8A8D\u8B58\u3055\u308C\u3066\u3044\u306A\u3044\u30AD\u30FC${i.keys.length>1?"\u7FA4":""}: ${$(i.keys,"\u3001")}`;case"invalid_key":return`${i.origin}\u5185\u306E\u7121\u52B9\u306A\u30AD\u30FC`;case"invalid_union":return"\u7121\u52B9\u306A\u5165\u529B";case"invalid_element":return`${i.origin}\u5185\u306E\u7121\u52B9\u306A\u5024`;default:return"\u7121\u52B9\u306A\u5165\u529B"}}};function qR(){return{localeError:H9()}}var q9=()=>{let t={string:{unit:"\u10E1\u10D8\u10DB\u10D1\u10DD\u10DA\u10DD",verb:"\u10E3\u10DC\u10D3\u10D0 \u10E8\u10D4\u10D8\u10EA\u10D0\u10D5\u10D3\u10D4\u10E1"},file:{unit:"\u10D1\u10D0\u10D8\u10E2\u10D8",verb:"\u10E3\u10DC\u10D3\u10D0 \u10E8\u10D4\u10D8\u10EA\u10D0\u10D5\u10D3\u10D4\u10E1"},array:{unit:"\u10D4\u10DA\u10D4\u10DB\u10D4\u10DC\u10E2\u10D8",verb:"\u10E3\u10DC\u10D3\u10D0 \u10E8\u10D4\u10D8\u10EA\u10D0\u10D5\u10D3\u10D4\u10E1"},set:{unit:"\u10D4\u10DA\u10D4\u10DB\u10D4\u10DC\u10E2\u10D8",verb:"\u10E3\u10DC\u10D3\u10D0 \u10E8\u10D4\u10D8\u10EA\u10D0\u10D5\u10D3\u10D4\u10E1"}};function e(i){return t[i]??null}let r={regex:"\u10E8\u10D4\u10E7\u10D5\u10D0\u10DC\u10D0",email:"\u10D4\u10DA-\u10E4\u10DD\u10E1\u10E2\u10D8\u10E1 \u10DB\u10D8\u10E1\u10D0\u10DB\u10D0\u10E0\u10D7\u10D8",url:"URL",emoji:"\u10D4\u10DB\u10DD\u10EF\u10D8",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"\u10D7\u10D0\u10E0\u10D8\u10E6\u10D8-\u10D3\u10E0\u10DD",date:"\u10D7\u10D0\u10E0\u10D8\u10E6\u10D8",time:"\u10D3\u10E0\u10DD",duration:"\u10EE\u10D0\u10DC\u10D2\u10E0\u10EB\u10DA\u10D8\u10D5\u10DD\u10D1\u10D0",ipv4:"IPv4 \u10DB\u10D8\u10E1\u10D0\u10DB\u10D0\u10E0\u10D7\u10D8",ipv6:"IPv6 \u10DB\u10D8\u10E1\u10D0\u10DB\u10D0\u10E0\u10D7\u10D8",cidrv4:"IPv4 \u10D3\u10D8\u10D0\u10DE\u10D0\u10D6\u10DD\u10DC\u10D8",cidrv6:"IPv6 \u10D3\u10D8\u10D0\u10DE\u10D0\u10D6\u10DD\u10DC\u10D8",base64:"base64-\u10D9\u10DD\u10D3\u10D8\u10E0\u10D4\u10D1\u10E3\u10DA\u10D8 \u10E1\u10E2\u10E0\u10D8\u10DC\u10D2\u10D8",base64url:"base64url-\u10D9\u10DD\u10D3\u10D8\u10E0\u10D4\u10D1\u10E3\u10DA\u10D8 \u10E1\u10E2\u10E0\u10D8\u10DC\u10D2\u10D8",json_string:"JSON \u10E1\u10E2\u10E0\u10D8\u10DC\u10D2\u10D8",e164:"E.164 \u10DC\u10DD\u10DB\u10D4\u10E0\u10D8",jwt:"JWT",template_literal:"\u10E8\u10D4\u10E7\u10D5\u10D0\u10DC\u10D0"},n={nan:"NaN",number:"\u10E0\u10D8\u10EA\u10EE\u10D5\u10D8",string:"\u10E1\u10E2\u10E0\u10D8\u10DC\u10D2\u10D8",boolean:"\u10D1\u10E3\u10DA\u10D4\u10D0\u10DC\u10D8",function:"\u10E4\u10E3\u10DC\u10E5\u10EA\u10D8\u10D0",array:"\u10DB\u10D0\u10E1\u10D8\u10D5\u10D8"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`\u10D0\u10E0\u10D0\u10E1\u10EC\u10DD\u10E0\u10D8 \u10E8\u10D4\u10E7\u10D5\u10D0\u10DC\u10D0: \u10DB\u10DD\u10E1\u10D0\u10DA\u10DD\u10D3\u10DC\u10D4\u10DA\u10D8 instanceof ${i.expected}, \u10DB\u10D8\u10E6\u10D4\u10D1\u10E3\u10DA\u10D8 ${s}`:`\u10D0\u10E0\u10D0\u10E1\u10EC\u10DD\u10E0\u10D8 \u10E8\u10D4\u10E7\u10D5\u10D0\u10DC\u10D0: \u10DB\u10DD\u10E1\u10D0\u10DA\u10DD\u10D3\u10DC\u10D4\u10DA\u10D8 ${o}, \u10DB\u10D8\u10E6\u10D4\u10D1\u10E3\u10DA\u10D8 ${s}`}case"invalid_value":return i.values.length===1?`\u10D0\u10E0\u10D0\u10E1\u10EC\u10DD\u10E0\u10D8 \u10E8\u10D4\u10E7\u10D5\u10D0\u10DC\u10D0: \u10DB\u10DD\u10E1\u10D0\u10DA\u10DD\u10D3\u10DC\u10D4\u10DA\u10D8 ${j(i.values[0])}`:`\u10D0\u10E0\u10D0\u10E1\u10EC\u10DD\u10E0\u10D8 \u10D5\u10D0\u10E0\u10D8\u10D0\u10DC\u10E2\u10D8: \u10DB\u10DD\u10E1\u10D0\u10DA\u10DD\u10D3\u10DC\u10D4\u10DA\u10D8\u10D0 \u10D4\u10E0\u10D7-\u10D4\u10E0\u10D7\u10D8 ${$(i.values,"|")}-\u10D3\u10D0\u10DC`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`\u10D6\u10D4\u10D3\u10DB\u10D4\u10E2\u10D0\u10D3 \u10D3\u10D8\u10D3\u10D8: \u10DB\u10DD\u10E1\u10D0\u10DA\u10DD\u10D3\u10DC\u10D4\u10DA\u10D8 ${i.origin??"\u10DB\u10DC\u10D8\u10E8\u10D5\u10DC\u10D4\u10DA\u10DD\u10D1\u10D0"} ${a.verb} ${o}${i.maximum.toString()} ${a.unit}`:`\u10D6\u10D4\u10D3\u10DB\u10D4\u10E2\u10D0\u10D3 \u10D3\u10D8\u10D3\u10D8: \u10DB\u10DD\u10E1\u10D0\u10DA\u10DD\u10D3\u10DC\u10D4\u10DA\u10D8 ${i.origin??"\u10DB\u10DC\u10D8\u10E8\u10D5\u10DC\u10D4\u10DA\u10DD\u10D1\u10D0"} \u10D8\u10E7\u10DD\u10E1 ${o}${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`\u10D6\u10D4\u10D3\u10DB\u10D4\u10E2\u10D0\u10D3 \u10DE\u10D0\u10E2\u10D0\u10E0\u10D0: \u10DB\u10DD\u10E1\u10D0\u10DA\u10DD\u10D3\u10DC\u10D4\u10DA\u10D8 ${i.origin} ${a.verb} ${o}${i.minimum.toString()} ${a.unit}`:`\u10D6\u10D4\u10D3\u10DB\u10D4\u10E2\u10D0\u10D3 \u10DE\u10D0\u10E2\u10D0\u10E0\u10D0: \u10DB\u10DD\u10E1\u10D0\u10DA\u10DD\u10D3\u10DC\u10D4\u10DA\u10D8 ${i.origin} \u10D8\u10E7\u10DD\u10E1 ${o}${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`\u10D0\u10E0\u10D0\u10E1\u10EC\u10DD\u10E0\u10D8 \u10E1\u10E2\u10E0\u10D8\u10DC\u10D2\u10D8: \u10E3\u10DC\u10D3\u10D0 \u10D8\u10EC\u10E7\u10D4\u10D1\u10DD\u10D3\u10D4\u10E1 "${o.prefix}"-\u10D8\u10D7`:o.format==="ends_with"?`\u10D0\u10E0\u10D0\u10E1\u10EC\u10DD\u10E0\u10D8 \u10E1\u10E2\u10E0\u10D8\u10DC\u10D2\u10D8: \u10E3\u10DC\u10D3\u10D0 \u10DB\u10D7\u10D0\u10D5\u10E0\u10D3\u10D4\u10D1\u10DD\u10D3\u10D4\u10E1 "${o.suffix}"-\u10D8\u10D7`:o.format==="includes"?`\u10D0\u10E0\u10D0\u10E1\u10EC\u10DD\u10E0\u10D8 \u10E1\u10E2\u10E0\u10D8\u10DC\u10D2\u10D8: \u10E3\u10DC\u10D3\u10D0 \u10E8\u10D4\u10D8\u10EA\u10D0\u10D5\u10D3\u10D4\u10E1 "${o.includes}"-\u10E1`:o.format==="regex"?`\u10D0\u10E0\u10D0\u10E1\u10EC\u10DD\u10E0\u10D8 \u10E1\u10E2\u10E0\u10D8\u10DC\u10D2\u10D8: \u10E3\u10DC\u10D3\u10D0 \u10E8\u10D4\u10D4\u10E1\u10D0\u10D1\u10D0\u10DB\u10D4\u10D1\u10DD\u10D3\u10D4\u10E1 \u10E8\u10D0\u10D1\u10DA\u10DD\u10DC\u10E1 ${o.pattern}`:`\u10D0\u10E0\u10D0\u10E1\u10EC\u10DD\u10E0\u10D8 ${r[o.format]??i.format}`}case"not_multiple_of":return`\u10D0\u10E0\u10D0\u10E1\u10EC\u10DD\u10E0\u10D8 \u10E0\u10D8\u10EA\u10EE\u10D5\u10D8: \u10E3\u10DC\u10D3\u10D0 \u10D8\u10E7\u10DD\u10E1 ${i.divisor}-\u10D8\u10E1 \u10EF\u10D4\u10E0\u10D0\u10D3\u10D8`;case"unrecognized_keys":return`\u10E3\u10EA\u10DC\u10DD\u10D1\u10D8 \u10D2\u10D0\u10E1\u10D0\u10E6\u10D4\u10D1${i.keys.length>1?"\u10D4\u10D1\u10D8":"\u10D8"}: ${$(i.keys,", ")}`;case"invalid_key":return`\u10D0\u10E0\u10D0\u10E1\u10EC\u10DD\u10E0\u10D8 \u10D2\u10D0\u10E1\u10D0\u10E6\u10D4\u10D1\u10D8 ${i.origin}-\u10E8\u10D8`;case"invalid_union":return"\u10D0\u10E0\u10D0\u10E1\u10EC\u10DD\u10E0\u10D8 \u10E8\u10D4\u10E7\u10D5\u10D0\u10DC\u10D0";case"invalid_element":return`\u10D0\u10E0\u10D0\u10E1\u10EC\u10DD\u10E0\u10D8 \u10DB\u10DC\u10D8\u10E8\u10D5\u10DC\u10D4\u10DA\u10DD\u10D1\u10D0 ${i.origin}-\u10E8\u10D8`;default:return"\u10D0\u10E0\u10D0\u10E1\u10EC\u10DD\u10E0\u10D8 \u10E8\u10D4\u10E7\u10D5\u10D0\u10DC\u10D0"}}};function KR(){return{localeError:q9()}}var K9=()=>{let t={string:{unit:"\u178F\u17BD\u17A2\u1780\u17D2\u179F\u179A",verb:"\u1782\u17BD\u179A\u1798\u17B6\u1793"},file:{unit:"\u1794\u17C3",verb:"\u1782\u17BD\u179A\u1798\u17B6\u1793"},array:{unit:"\u1792\u17B6\u178F\u17BB",verb:"\u1782\u17BD\u179A\u1798\u17B6\u1793"},set:{unit:"\u1792\u17B6\u178F\u17BB",verb:"\u1782\u17BD\u179A\u1798\u17B6\u1793"}};function e(i){return t[i]??null}let r={regex:"\u1791\u17B7\u1793\u17D2\u1793\u1793\u17D0\u1799\u1794\u1789\u17D2\u1785\u17BC\u179B",email:"\u17A2\u17B6\u179F\u1799\u178A\u17D2\u178B\u17B6\u1793\u17A2\u17CA\u17B8\u1798\u17C2\u179B",url:"URL",emoji:"\u179F\u1789\u17D2\u1789\u17B6\u17A2\u17B6\u179A\u1798\u17D2\u1798\u178E\u17CD",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"\u1780\u17B6\u179B\u1794\u179A\u17B7\u1785\u17D2\u1786\u17C1\u1791 \u1793\u17B7\u1784\u1798\u17C9\u17C4\u1784 ISO",date:"\u1780\u17B6\u179B\u1794\u179A\u17B7\u1785\u17D2\u1786\u17C1\u1791 ISO",time:"\u1798\u17C9\u17C4\u1784 ISO",duration:"\u179A\u1799\u17C8\u1796\u17C1\u179B ISO",ipv4:"\u17A2\u17B6\u179F\u1799\u178A\u17D2\u178B\u17B6\u1793 IPv4",ipv6:"\u17A2\u17B6\u179F\u1799\u178A\u17D2\u178B\u17B6\u1793 IPv6",cidrv4:"\u178A\u17C2\u1793\u17A2\u17B6\u179F\u1799\u178A\u17D2\u178B\u17B6\u1793 IPv4",cidrv6:"\u178A\u17C2\u1793\u17A2\u17B6\u179F\u1799\u178A\u17D2\u178B\u17B6\u1793 IPv6",base64:"\u1781\u17D2\u179F\u17C2\u17A2\u1780\u17D2\u179F\u179A\u17A2\u17CA\u17B7\u1780\u17BC\u178A base64",base64url:"\u1781\u17D2\u179F\u17C2\u17A2\u1780\u17D2\u179F\u179A\u17A2\u17CA\u17B7\u1780\u17BC\u178A base64url",json_string:"\u1781\u17D2\u179F\u17C2\u17A2\u1780\u17D2\u179F\u179A JSON",e164:"\u179B\u17C1\u1781 E.164",jwt:"JWT",template_literal:"\u1791\u17B7\u1793\u17D2\u1793\u1793\u17D0\u1799\u1794\u1789\u17D2\u1785\u17BC\u179B"},n={nan:"NaN",number:"\u179B\u17C1\u1781",array:"\u17A2\u17B6\u179A\u17C1 (Array)",null:"\u1782\u17D2\u1798\u17B6\u1793\u178F\u1798\u17D2\u179B\u17C3 (null)"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`\u1791\u17B7\u1793\u17D2\u1793\u1793\u17D0\u1799\u1794\u1789\u17D2\u1785\u17BC\u179B\u1798\u17B7\u1793\u178F\u17D2\u179A\u17B9\u1798\u178F\u17D2\u179A\u17BC\u179C\u17D6 \u178F\u17D2\u179A\u17BC\u179C\u1780\u17B6\u179A instanceof ${i.expected} \u1794\u17C9\u17BB\u1793\u17D2\u178F\u17C2\u1791\u1791\u17BD\u179B\u1794\u17B6\u1793 ${s}`:`\u1791\u17B7\u1793\u17D2\u1793\u1793\u17D0\u1799\u1794\u1789\u17D2\u1785\u17BC\u179B\u1798\u17B7\u1793\u178F\u17D2\u179A\u17B9\u1798\u178F\u17D2\u179A\u17BC\u179C\u17D6 \u178F\u17D2\u179A\u17BC\u179C\u1780\u17B6\u179A ${o} \u1794\u17C9\u17BB\u1793\u17D2\u178F\u17C2\u1791\u1791\u17BD\u179B\u1794\u17B6\u1793 ${s}`}case"invalid_value":return i.values.length===1?`\u1791\u17B7\u1793\u17D2\u1793\u1793\u17D0\u1799\u1794\u1789\u17D2\u1785\u17BC\u179B\u1798\u17B7\u1793\u178F\u17D2\u179A\u17B9\u1798\u178F\u17D2\u179A\u17BC\u179C\u17D6 \u178F\u17D2\u179A\u17BC\u179C\u1780\u17B6\u179A ${j(i.values[0])}`:`\u1787\u1798\u17D2\u179A\u17BE\u179F\u1798\u17B7\u1793\u178F\u17D2\u179A\u17B9\u1798\u178F\u17D2\u179A\u17BC\u179C\u17D6 \u178F\u17D2\u179A\u17BC\u179C\u1787\u17B6\u1798\u17BD\u1799\u1780\u17D2\u1793\u17BB\u1784\u1785\u17C6\u178E\u17C4\u1798 ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`\u1792\u17C6\u1796\u17C1\u1780\u17D6 \u178F\u17D2\u179A\u17BC\u179C\u1780\u17B6\u179A ${i.origin??"\u178F\u1798\u17D2\u179B\u17C3"} ${o} ${i.maximum.toString()} ${a.unit??"\u1792\u17B6\u178F\u17BB"}`:`\u1792\u17C6\u1796\u17C1\u1780\u17D6 \u178F\u17D2\u179A\u17BC\u179C\u1780\u17B6\u179A ${i.origin??"\u178F\u1798\u17D2\u179B\u17C3"} ${o} ${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`\u178F\u17BC\u1785\u1796\u17C1\u1780\u17D6 \u178F\u17D2\u179A\u17BC\u179C\u1780\u17B6\u179A ${i.origin} ${o} ${i.minimum.toString()} ${a.unit}`:`\u178F\u17BC\u1785\u1796\u17C1\u1780\u17D6 \u178F\u17D2\u179A\u17BC\u179C\u1780\u17B6\u179A ${i.origin} ${o} ${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`\u1781\u17D2\u179F\u17C2\u17A2\u1780\u17D2\u179F\u179A\u1798\u17B7\u1793\u178F\u17D2\u179A\u17B9\u1798\u178F\u17D2\u179A\u17BC\u179C\u17D6 \u178F\u17D2\u179A\u17BC\u179C\u1785\u17B6\u1794\u17CB\u1795\u17D2\u178F\u17BE\u1798\u178A\u17C4\u1799 "${o.prefix}"`:o.format==="ends_with"?`\u1781\u17D2\u179F\u17C2\u17A2\u1780\u17D2\u179F\u179A\u1798\u17B7\u1793\u178F\u17D2\u179A\u17B9\u1798\u178F\u17D2\u179A\u17BC\u179C\u17D6 \u178F\u17D2\u179A\u17BC\u179C\u1794\u1789\u17D2\u1785\u1794\u17CB\u178A\u17C4\u1799 "${o.suffix}"`:o.format==="includes"?`\u1781\u17D2\u179F\u17C2\u17A2\u1780\u17D2\u179F\u179A\u1798\u17B7\u1793\u178F\u17D2\u179A\u17B9\u1798\u178F\u17D2\u179A\u17BC\u179C\u17D6 \u178F\u17D2\u179A\u17BC\u179C\u1798\u17B6\u1793 "${o.includes}"`:o.format==="regex"?`\u1781\u17D2\u179F\u17C2\u17A2\u1780\u17D2\u179F\u179A\u1798\u17B7\u1793\u178F\u17D2\u179A\u17B9\u1798\u178F\u17D2\u179A\u17BC\u179C\u17D6 \u178F\u17D2\u179A\u17BC\u179C\u178F\u17C2\u1795\u17D2\u1782\u17BC\u1795\u17D2\u1782\u1784\u1793\u17B9\u1784\u1791\u1798\u17D2\u179A\u1784\u17CB\u178A\u17C2\u179B\u1794\u17B6\u1793\u1780\u17C6\u178E\u178F\u17CB ${o.pattern}`:`\u1798\u17B7\u1793\u178F\u17D2\u179A\u17B9\u1798\u178F\u17D2\u179A\u17BC\u179C\u17D6 ${r[o.format]??i.format}`}case"not_multiple_of":return`\u179B\u17C1\u1781\u1798\u17B7\u1793\u178F\u17D2\u179A\u17B9\u1798\u178F\u17D2\u179A\u17BC\u179C\u17D6 \u178F\u17D2\u179A\u17BC\u179C\u178F\u17C2\u1787\u17B6\u1796\u17A0\u17BB\u1782\u17BB\u178E\u1793\u17C3 ${i.divisor}`;case"unrecognized_keys":return`\u179A\u1780\u1783\u17BE\u1789\u179F\u17C4\u1798\u17B7\u1793\u179F\u17D2\u1782\u17B6\u179B\u17CB\u17D6 ${$(i.keys,", ")}`;case"invalid_key":return`\u179F\u17C4\u1798\u17B7\u1793\u178F\u17D2\u179A\u17B9\u1798\u178F\u17D2\u179A\u17BC\u179C\u1793\u17C5\u1780\u17D2\u1793\u17BB\u1784 ${i.origin}`;case"invalid_union":return"\u1791\u17B7\u1793\u17D2\u1793\u1793\u17D0\u1799\u1798\u17B7\u1793\u178F\u17D2\u179A\u17B9\u1798\u178F\u17D2\u179A\u17BC\u179C";case"invalid_element":return`\u1791\u17B7\u1793\u17D2\u1793\u1793\u17D0\u1799\u1798\u17B7\u1793\u178F\u17D2\u179A\u17B9\u1798\u178F\u17D2\u179A\u17BC\u179C\u1793\u17C5\u1780\u17D2\u1793\u17BB\u1784 ${i.origin}`;default:return"\u1791\u17B7\u1793\u17D2\u1793\u1793\u17D0\u1799\u1798\u17B7\u1793\u178F\u17D2\u179A\u17B9\u1798\u178F\u17D2\u179A\u17BC\u179C"}}};function Oh(){return{localeError:K9()}}function WR(){return Oh()}var W9=()=>{let t={string:{unit:"\uBB38\uC790",verb:"to have"},file:{unit:"\uBC14\uC774\uD2B8",verb:"to have"},array:{unit:"\uAC1C",verb:"to have"},set:{unit:"\uAC1C",verb:"to have"}};function e(i){return t[i]??null}let r={regex:"\uC785\uB825",email:"\uC774\uBA54\uC77C \uC8FC\uC18C",url:"URL",emoji:"\uC774\uBAA8\uC9C0",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO \uB0A0\uC9DC\uC2DC\uAC04",date:"ISO \uB0A0\uC9DC",time:"ISO \uC2DC\uAC04",duration:"ISO \uAE30\uAC04",ipv4:"IPv4 \uC8FC\uC18C",ipv6:"IPv6 \uC8FC\uC18C",cidrv4:"IPv4 \uBC94\uC704",cidrv6:"IPv6 \uBC94\uC704",base64:"base64 \uC778\uCF54\uB529 \uBB38\uC790\uC5F4",base64url:"base64url \uC778\uCF54\uB529 \uBB38\uC790\uC5F4",json_string:"JSON \uBB38\uC790\uC5F4",e164:"E.164 \uBC88\uD638",jwt:"JWT",template_literal:"\uC785\uB825"},n={nan:"NaN"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`\uC798\uBABB\uB41C \uC785\uB825: \uC608\uC0C1 \uD0C0\uC785\uC740 instanceof ${i.expected}, \uBC1B\uC740 \uD0C0\uC785\uC740 ${s}\uC785\uB2C8\uB2E4`:`\uC798\uBABB\uB41C \uC785\uB825: \uC608\uC0C1 \uD0C0\uC785\uC740 ${o}, \uBC1B\uC740 \uD0C0\uC785\uC740 ${s}\uC785\uB2C8\uB2E4`}case"invalid_value":return i.values.length===1?`\uC798\uBABB\uB41C \uC785\uB825: \uAC12\uC740 ${j(i.values[0])} \uC774\uC5B4\uC57C \uD569\uB2C8\uB2E4`:`\uC798\uBABB\uB41C \uC635\uC158: ${$(i.values,"\uB610\uB294 ")} \uC911 \uD558\uB098\uC5EC\uC57C \uD569\uB2C8\uB2E4`;case"too_big":{let o=i.inclusive?"\uC774\uD558":"\uBBF8\uB9CC",a=o==="\uBBF8\uB9CC"?"\uC774\uC5B4\uC57C \uD569\uB2C8\uB2E4":"\uC5EC\uC57C \uD569\uB2C8\uB2E4",s=e(i.origin),c=s?.unit??"\uC694\uC18C";return s?`${i.origin??"\uAC12"}\uC774 \uB108\uBB34 \uD07D\uB2C8\uB2E4: ${i.maximum.toString()}${c} ${o}${a}`:`${i.origin??"\uAC12"}\uC774 \uB108\uBB34 \uD07D\uB2C8\uB2E4: ${i.maximum.toString()} ${o}${a}`}case"too_small":{let o=i.inclusive?"\uC774\uC0C1":"\uCD08\uACFC",a=o==="\uC774\uC0C1"?"\uC774\uC5B4\uC57C \uD569\uB2C8\uB2E4":"\uC5EC\uC57C \uD569\uB2C8\uB2E4",s=e(i.origin),c=s?.unit??"\uC694\uC18C";return s?`${i.origin??"\uAC12"}\uC774 \uB108\uBB34 \uC791\uC2B5\uB2C8\uB2E4: ${i.minimum.toString()}${c} ${o}${a}`:`${i.origin??"\uAC12"}\uC774 \uB108\uBB34 \uC791\uC2B5\uB2C8\uB2E4: ${i.minimum.toString()} ${o}${a}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`\uC798\uBABB\uB41C \uBB38\uC790\uC5F4: "${o.prefix}"(\uC73C)\uB85C \uC2DC\uC791\uD574\uC57C \uD569\uB2C8\uB2E4`:o.format==="ends_with"?`\uC798\uBABB\uB41C \uBB38\uC790\uC5F4: "${o.suffix}"(\uC73C)\uB85C \uB05D\uB098\uC57C \uD569\uB2C8\uB2E4`:o.format==="includes"?`\uC798\uBABB\uB41C \uBB38\uC790\uC5F4: "${o.includes}"\uC744(\uB97C) \uD3EC\uD568\uD574\uC57C \uD569\uB2C8\uB2E4`:o.format==="regex"?`\uC798\uBABB\uB41C \uBB38\uC790\uC5F4: \uC815\uADDC\uC2DD ${o.pattern} \uD328\uD134\uACFC \uC77C\uCE58\uD574\uC57C \uD569\uB2C8\uB2E4`:`\uC798\uBABB\uB41C ${r[o.format]??i.format}`}case"not_multiple_of":return`\uC798\uBABB\uB41C \uC22B\uC790: ${i.divisor}\uC758 \uBC30\uC218\uC5EC\uC57C \uD569\uB2C8\uB2E4`;case"unrecognized_keys":return`\uC778\uC2DD\uD560 \uC218 \uC5C6\uB294 \uD0A4: ${$(i.keys,", ")}`;case"invalid_key":return`\uC798\uBABB\uB41C \uD0A4: ${i.origin}`;case"invalid_union":return"\uC798\uBABB\uB41C \uC785\uB825";case"invalid_element":return`\uC798\uBABB\uB41C \uAC12: ${i.origin}`;default:return"\uC798\uBABB\uB41C \uC785\uB825"}}};function JR(){return{localeError:W9()}}var Kp=t=>t.charAt(0).toUpperCase()+t.slice(1);function XR(t){let e=Math.abs(t),r=e%10,n=e%100;return n>=11&&n<=19||r===0?"many":r===1?"one":"few"}var J9=()=>{let t={string:{unit:{one:"simbolis",few:"simboliai",many:"simboli\u0173"},verb:{smaller:{inclusive:"turi b\u016Bti ne ilgesn\u0117 kaip",notInclusive:"turi b\u016Bti trumpesn\u0117 kaip"},bigger:{inclusive:"turi b\u016Bti ne trumpesn\u0117 kaip",notInclusive:"turi b\u016Bti ilgesn\u0117 kaip"}}},file:{unit:{one:"baitas",few:"baitai",many:"bait\u0173"},verb:{smaller:{inclusive:"turi b\u016Bti ne didesnis kaip",notInclusive:"turi b\u016Bti ma\u017Eesnis kaip"},bigger:{inclusive:"turi b\u016Bti ne ma\u017Eesnis kaip",notInclusive:"turi b\u016Bti didesnis kaip"}}},array:{unit:{one:"element\u0105",few:"elementus",many:"element\u0173"},verb:{smaller:{inclusive:"turi tur\u0117ti ne daugiau kaip",notInclusive:"turi tur\u0117ti ma\u017Eiau kaip"},bigger:{inclusive:"turi tur\u0117ti ne ma\u017Eiau kaip",notInclusive:"turi tur\u0117ti daugiau kaip"}}},set:{unit:{one:"element\u0105",few:"elementus",many:"element\u0173"},verb:{smaller:{inclusive:"turi tur\u0117ti ne daugiau kaip",notInclusive:"turi tur\u0117ti ma\u017Eiau kaip"},bigger:{inclusive:"turi tur\u0117ti ne ma\u017Eiau kaip",notInclusive:"turi tur\u0117ti daugiau kaip"}}}};function e(i,o,a,s){let c=t[i]??null;return c===null?c:{unit:c.unit[o],verb:c.verb[s][a?"inclusive":"notInclusive"]}}let r={regex:"\u012Fvestis",email:"el. pa\u0161to adresas",url:"URL",emoji:"jaustukas",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO data ir laikas",date:"ISO data",time:"ISO laikas",duration:"ISO trukm\u0117",ipv4:"IPv4 adresas",ipv6:"IPv6 adresas",cidrv4:"IPv4 tinklo prefiksas (CIDR)",cidrv6:"IPv6 tinklo prefiksas (CIDR)",base64:"base64 u\u017Ekoduota eilut\u0117",base64url:"base64url u\u017Ekoduota eilut\u0117",json_string:"JSON eilut\u0117",e164:"E.164 numeris",jwt:"JWT",template_literal:"\u012Fvestis"},n={nan:"NaN",number:"skai\u010Dius",bigint:"sveikasis skai\u010Dius",string:"eilut\u0117",boolean:"login\u0117 reik\u0161m\u0117",undefined:"neapibr\u0117\u017Eta reik\u0161m\u0117",function:"funkcija",symbol:"simbolis",array:"masyvas",object:"objektas",null:"nulin\u0117 reik\u0161m\u0117"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`Gautas tipas ${s}, o tik\u0117tasi - instanceof ${i.expected}`:`Gautas tipas ${s}, o tik\u0117tasi - ${o}`}case"invalid_value":return i.values.length===1?`Privalo b\u016Bti ${j(i.values[0])}`:`Privalo b\u016Bti vienas i\u0161 ${$(i.values,"|")} pasirinkim\u0173`;case"too_big":{let o=n[i.origin]??i.origin,a=e(i.origin,XR(Number(i.maximum)),i.inclusive??!1,"smaller");if(a?.verb)return`${Kp(o??i.origin??"reik\u0161m\u0117")} ${a.verb} ${i.maximum.toString()} ${a.unit??"element\u0173"}`;let s=i.inclusive?"ne didesnis kaip":"ma\u017Eesnis kaip";return`${Kp(o??i.origin??"reik\u0161m\u0117")} turi b\u016Bti ${s} ${i.maximum.toString()} ${a?.unit}`}case"too_small":{let o=n[i.origin]??i.origin,a=e(i.origin,XR(Number(i.minimum)),i.inclusive??!1,"bigger");if(a?.verb)return`${Kp(o??i.origin??"reik\u0161m\u0117")} ${a.verb} ${i.minimum.toString()} ${a.unit??"element\u0173"}`;let s=i.inclusive?"ne ma\u017Eesnis kaip":"didesnis kaip";return`${Kp(o??i.origin??"reik\u0161m\u0117")} turi b\u016Bti ${s} ${i.minimum.toString()} ${a?.unit}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`Eilut\u0117 privalo prasid\u0117ti "${o.prefix}"`:o.format==="ends_with"?`Eilut\u0117 privalo pasibaigti "${o.suffix}"`:o.format==="includes"?`Eilut\u0117 privalo \u012Ftraukti "${o.includes}"`:o.format==="regex"?`Eilut\u0117 privalo atitikti ${o.pattern}`:`Neteisingas ${r[o.format]??i.format}`}case"not_multiple_of":return`Skai\u010Dius privalo b\u016Bti ${i.divisor} kartotinis.`;case"unrecognized_keys":return`Neatpa\u017Eint${i.keys.length>1?"i":"as"} rakt${i.keys.length>1?"ai":"as"}: ${$(i.keys,", ")}`;case"invalid_key":return"Rastas klaidingas raktas";case"invalid_union":return"Klaidinga \u012Fvestis";case"invalid_element":{let o=n[i.origin]??i.origin;return`${Kp(o??i.origin??"reik\u0161m\u0117")} turi klaiding\u0105 \u012Fvest\u012F`}default:return"Klaidinga \u012Fvestis"}}};function YR(){return{localeError:J9()}}var X9=()=>{let t={string:{unit:"\u0437\u043D\u0430\u0446\u0438",verb:"\u0434\u0430 \u0438\u043C\u0430\u0430\u0442"},file:{unit:"\u0431\u0430\u0458\u0442\u0438",verb:"\u0434\u0430 \u0438\u043C\u0430\u0430\u0442"},array:{unit:"\u0441\u0442\u0430\u0432\u043A\u0438",verb:"\u0434\u0430 \u0438\u043C\u0430\u0430\u0442"},set:{unit:"\u0441\u0442\u0430\u0432\u043A\u0438",verb:"\u0434\u0430 \u0438\u043C\u0430\u0430\u0442"}};function e(i){return t[i]??null}let r={regex:"\u0432\u043D\u0435\u0441",email:"\u0430\u0434\u0440\u0435\u0441\u0430 \u043D\u0430 \u0435-\u043F\u043E\u0448\u0442\u0430",url:"URL",emoji:"\u0435\u043C\u043E\u045F\u0438",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO \u0434\u0430\u0442\u0443\u043C \u0438 \u0432\u0440\u0435\u043C\u0435",date:"ISO \u0434\u0430\u0442\u0443\u043C",time:"ISO \u0432\u0440\u0435\u043C\u0435",duration:"ISO \u0432\u0440\u0435\u043C\u0435\u0442\u0440\u0430\u0435\u045A\u0435",ipv4:"IPv4 \u0430\u0434\u0440\u0435\u0441\u0430",ipv6:"IPv6 \u0430\u0434\u0440\u0435\u0441\u0430",cidrv4:"IPv4 \u043E\u043F\u0441\u0435\u0433",cidrv6:"IPv6 \u043E\u043F\u0441\u0435\u0433",base64:"base64-\u0435\u043D\u043A\u043E\u0434\u0438\u0440\u0430\u043D\u0430 \u043D\u0438\u0437\u0430",base64url:"base64url-\u0435\u043D\u043A\u043E\u0434\u0438\u0440\u0430\u043D\u0430 \u043D\u0438\u0437\u0430",json_string:"JSON \u043D\u0438\u0437\u0430",e164:"E.164 \u0431\u0440\u043E\u0458",jwt:"JWT",template_literal:"\u0432\u043D\u0435\u0441"},n={nan:"NaN",number:"\u0431\u0440\u043E\u0458",array:"\u043D\u0438\u0437\u0430"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`\u0413\u0440\u0435\u0448\u0435\u043D \u0432\u043D\u0435\u0441: \u0441\u0435 \u043E\u0447\u0435\u043A\u0443\u0432\u0430 instanceof ${i.expected}, \u043F\u0440\u0438\u043C\u0435\u043D\u043E ${s}`:`\u0413\u0440\u0435\u0448\u0435\u043D \u0432\u043D\u0435\u0441: \u0441\u0435 \u043E\u0447\u0435\u043A\u0443\u0432\u0430 ${o}, \u043F\u0440\u0438\u043C\u0435\u043D\u043E ${s}`}case"invalid_value":return i.values.length===1?`Invalid input: expected ${j(i.values[0])}`:`\u0413\u0440\u0435\u0448\u0430\u043D\u0430 \u043E\u043F\u0446\u0438\u0458\u0430: \u0441\u0435 \u043E\u0447\u0435\u043A\u0443\u0432\u0430 \u0435\u0434\u043D\u0430 ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`\u041F\u0440\u0435\u043C\u043D\u043E\u0433\u0443 \u0433\u043E\u043B\u0435\u043C: \u0441\u0435 \u043E\u0447\u0435\u043A\u0443\u0432\u0430 ${i.origin??"\u0432\u0440\u0435\u0434\u043D\u043E\u0441\u0442\u0430"} \u0434\u0430 \u0438\u043C\u0430 ${o}${i.maximum.toString()} ${a.unit??"\u0435\u043B\u0435\u043C\u0435\u043D\u0442\u0438"}`:`\u041F\u0440\u0435\u043C\u043D\u043E\u0433\u0443 \u0433\u043E\u043B\u0435\u043C: \u0441\u0435 \u043E\u0447\u0435\u043A\u0443\u0432\u0430 ${i.origin??"\u0432\u0440\u0435\u0434\u043D\u043E\u0441\u0442\u0430"} \u0434\u0430 \u0431\u0438\u0434\u0435 ${o}${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`\u041F\u0440\u0435\u043C\u043D\u043E\u0433\u0443 \u043C\u0430\u043B: \u0441\u0435 \u043E\u0447\u0435\u043A\u0443\u0432\u0430 ${i.origin} \u0434\u0430 \u0438\u043C\u0430 ${o}${i.minimum.toString()} ${a.unit}`:`\u041F\u0440\u0435\u043C\u043D\u043E\u0433\u0443 \u043C\u0430\u043B: \u0441\u0435 \u043E\u0447\u0435\u043A\u0443\u0432\u0430 ${i.origin} \u0434\u0430 \u0431\u0438\u0434\u0435 ${o}${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`\u041D\u0435\u0432\u0430\u0436\u0435\u0447\u043A\u0430 \u043D\u0438\u0437\u0430: \u043C\u043E\u0440\u0430 \u0434\u0430 \u0437\u0430\u043F\u043E\u0447\u043D\u0443\u0432\u0430 \u0441\u043E "${o.prefix}"`:o.format==="ends_with"?`\u041D\u0435\u0432\u0430\u0436\u0435\u0447\u043A\u0430 \u043D\u0438\u0437\u0430: \u043C\u043E\u0440\u0430 \u0434\u0430 \u0437\u0430\u0432\u0440\u0448\u0443\u0432\u0430 \u0441\u043E "${o.suffix}"`:o.format==="includes"?`\u041D\u0435\u0432\u0430\u0436\u0435\u0447\u043A\u0430 \u043D\u0438\u0437\u0430: \u043C\u043E\u0440\u0430 \u0434\u0430 \u0432\u043A\u043B\u0443\u0447\u0443\u0432\u0430 "${o.includes}"`:o.format==="regex"?`\u041D\u0435\u0432\u0430\u0436\u0435\u0447\u043A\u0430 \u043D\u0438\u0437\u0430: \u043C\u043E\u0440\u0430 \u0434\u0430 \u043E\u0434\u0433\u043E\u0430\u0440\u0430 \u043D\u0430 \u043F\u0430\u0442\u0435\u0440\u043D\u043E\u0442 ${o.pattern}`:`Invalid ${r[o.format]??i.format}`}case"not_multiple_of":return`\u0413\u0440\u0435\u0448\u0435\u043D \u0431\u0440\u043E\u0458: \u043C\u043E\u0440\u0430 \u0434\u0430 \u0431\u0438\u0434\u0435 \u0434\u0435\u043B\u0438\u0432 \u0441\u043E ${i.divisor}`;case"unrecognized_keys":return`${i.keys.length>1?"\u041D\u0435\u043F\u0440\u0435\u043F\u043E\u0437\u043D\u0430\u0435\u043D\u0438 \u043A\u043B\u0443\u0447\u0435\u0432\u0438":"\u041D\u0435\u043F\u0440\u0435\u043F\u043E\u0437\u043D\u0430\u0435\u043D \u043A\u043B\u0443\u0447"}: ${$(i.keys,", ")}`;case"invalid_key":return`\u0413\u0440\u0435\u0448\u0435\u043D \u043A\u043B\u0443\u0447 \u0432\u043E ${i.origin}`;case"invalid_union":return"\u0413\u0440\u0435\u0448\u0435\u043D \u0432\u043D\u0435\u0441";case"invalid_element":return`\u0413\u0440\u0435\u0448\u043D\u0430 \u0432\u0440\u0435\u0434\u043D\u043E\u0441\u0442 \u0432\u043E ${i.origin}`;default:return"\u0413\u0440\u0435\u0448\u0435\u043D \u0432\u043D\u0435\u0441"}}};function QR(){return{localeError:X9()}}var Y9=()=>{let t={string:{unit:"aksara",verb:"mempunyai"},file:{unit:"bait",verb:"mempunyai"},array:{unit:"elemen",verb:"mempunyai"},set:{unit:"elemen",verb:"mempunyai"}};function e(i){return t[i]??null}let r={regex:"input",email:"alamat e-mel",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"tarikh masa ISO",date:"tarikh ISO",time:"masa ISO",duration:"tempoh ISO",ipv4:"alamat IPv4",ipv6:"alamat IPv6",cidrv4:"julat IPv4",cidrv6:"julat IPv6",base64:"string dikodkan base64",base64url:"string dikodkan base64url",json_string:"string JSON",e164:"nombor E.164",jwt:"JWT",template_literal:"input"},n={nan:"NaN",number:"nombor"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`Input tidak sah: dijangka instanceof ${i.expected}, diterima ${s}`:`Input tidak sah: dijangka ${o}, diterima ${s}`}case"invalid_value":return i.values.length===1?`Input tidak sah: dijangka ${j(i.values[0])}`:`Pilihan tidak sah: dijangka salah satu daripada ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`Terlalu besar: dijangka ${i.origin??"nilai"} ${a.verb} ${o}${i.maximum.toString()} ${a.unit??"elemen"}`:`Terlalu besar: dijangka ${i.origin??"nilai"} adalah ${o}${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`Terlalu kecil: dijangka ${i.origin} ${a.verb} ${o}${i.minimum.toString()} ${a.unit}`:`Terlalu kecil: dijangka ${i.origin} adalah ${o}${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`String tidak sah: mesti bermula dengan "${o.prefix}"`:o.format==="ends_with"?`String tidak sah: mesti berakhir dengan "${o.suffix}"`:o.format==="includes"?`String tidak sah: mesti mengandungi "${o.includes}"`:o.format==="regex"?`String tidak sah: mesti sepadan dengan corak ${o.pattern}`:`${r[o.format]??i.format} tidak sah`}case"not_multiple_of":return`Nombor tidak sah: perlu gandaan ${i.divisor}`;case"unrecognized_keys":return`Kunci tidak dikenali: ${$(i.keys,", ")}`;case"invalid_key":return`Kunci tidak sah dalam ${i.origin}`;case"invalid_union":return"Input tidak sah";case"invalid_element":return`Nilai tidak sah dalam ${i.origin}`;default:return"Input tidak sah"}}};function e1(){return{localeError:Y9()}}var Q9=()=>{let t={string:{unit:"tekens",verb:"heeft"},file:{unit:"bytes",verb:"heeft"},array:{unit:"elementen",verb:"heeft"},set:{unit:"elementen",verb:"heeft"}};function e(i){return t[i]??null}let r={regex:"invoer",email:"emailadres",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datum en tijd",date:"ISO datum",time:"ISO tijd",duration:"ISO duur",ipv4:"IPv4-adres",ipv6:"IPv6-adres",cidrv4:"IPv4-bereik",cidrv6:"IPv6-bereik",base64:"base64-gecodeerde tekst",base64url:"base64 URL-gecodeerde tekst",json_string:"JSON string",e164:"E.164-nummer",jwt:"JWT",template_literal:"invoer"},n={nan:"NaN",number:"getal"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`Ongeldige invoer: verwacht instanceof ${i.expected}, ontving ${s}`:`Ongeldige invoer: verwacht ${o}, ontving ${s}`}case"invalid_value":return i.values.length===1?`Ongeldige invoer: verwacht ${j(i.values[0])}`:`Ongeldige optie: verwacht \xE9\xE9n van ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin),s=i.origin==="date"?"laat":i.origin==="string"?"lang":"groot";return a?`Te ${s}: verwacht dat ${i.origin??"waarde"} ${o}${i.maximum.toString()} ${a.unit??"elementen"} ${a.verb}`:`Te ${s}: verwacht dat ${i.origin??"waarde"} ${o}${i.maximum.toString()} is`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin),s=i.origin==="date"?"vroeg":i.origin==="string"?"kort":"klein";return a?`Te ${s}: verwacht dat ${i.origin} ${o}${i.minimum.toString()} ${a.unit} ${a.verb}`:`Te ${s}: verwacht dat ${i.origin} ${o}${i.minimum.toString()} is`}case"invalid_format":{let o=i;return o.format==="starts_with"?`Ongeldige tekst: moet met "${o.prefix}" beginnen`:o.format==="ends_with"?`Ongeldige tekst: moet op "${o.suffix}" eindigen`:o.format==="includes"?`Ongeldige tekst: moet "${o.includes}" bevatten`:o.format==="regex"?`Ongeldige tekst: moet overeenkomen met patroon ${o.pattern}`:`Ongeldig: ${r[o.format]??i.format}`}case"not_multiple_of":return`Ongeldig getal: moet een veelvoud van ${i.divisor} zijn`;case"unrecognized_keys":return`Onbekende key${i.keys.length>1?"s":""}: ${$(i.keys,", ")}`;case"invalid_key":return`Ongeldige key in ${i.origin}`;case"invalid_union":return"Ongeldige invoer";case"invalid_element":return`Ongeldige waarde in ${i.origin}`;default:return"Ongeldige invoer"}}};function t1(){return{localeError:Q9()}}var e3=()=>{let t={string:{unit:"tegn",verb:"\xE5 ha"},file:{unit:"bytes",verb:"\xE5 ha"},array:{unit:"elementer",verb:"\xE5 inneholde"},set:{unit:"elementer",verb:"\xE5 inneholde"}};function e(i){return t[i]??null}let r={regex:"input",email:"e-postadresse",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO dato- og klokkeslett",date:"ISO-dato",time:"ISO-klokkeslett",duration:"ISO-varighet",ipv4:"IPv4-omr\xE5de",ipv6:"IPv6-omr\xE5de",cidrv4:"IPv4-spekter",cidrv6:"IPv6-spekter",base64:"base64-enkodet streng",base64url:"base64url-enkodet streng",json_string:"JSON-streng",e164:"E.164-nummer",jwt:"JWT",template_literal:"input"},n={nan:"NaN",number:"tall",array:"liste"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`Ugyldig input: forventet instanceof ${i.expected}, fikk ${s}`:`Ugyldig input: forventet ${o}, fikk ${s}`}case"invalid_value":return i.values.length===1?`Ugyldig verdi: forventet ${j(i.values[0])}`:`Ugyldig valg: forventet en av ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`For stor(t): forventet ${i.origin??"value"} til \xE5 ha ${o}${i.maximum.toString()} ${a.unit??"elementer"}`:`For stor(t): forventet ${i.origin??"value"} til \xE5 ha ${o}${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`For lite(n): forventet ${i.origin} til \xE5 ha ${o}${i.minimum.toString()} ${a.unit}`:`For lite(n): forventet ${i.origin} til \xE5 ha ${o}${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`Ugyldig streng: m\xE5 starte med "${o.prefix}"`:o.format==="ends_with"?`Ugyldig streng: m\xE5 ende med "${o.suffix}"`:o.format==="includes"?`Ugyldig streng: m\xE5 inneholde "${o.includes}"`:o.format==="regex"?`Ugyldig streng: m\xE5 matche m\xF8nsteret ${o.pattern}`:`Ugyldig ${r[o.format]??i.format}`}case"not_multiple_of":return`Ugyldig tall: m\xE5 v\xE6re et multiplum av ${i.divisor}`;case"unrecognized_keys":return`${i.keys.length>1?"Ukjente n\xF8kler":"Ukjent n\xF8kkel"}: ${$(i.keys,", ")}`;case"invalid_key":return`Ugyldig n\xF8kkel i ${i.origin}`;case"invalid_union":return"Ugyldig input";case"invalid_element":return`Ugyldig verdi i ${i.origin}`;default:return"Ugyldig input"}}};function r1(){return{localeError:e3()}}var t3=()=>{let t={string:{unit:"harf",verb:"olmal\u0131d\u0131r"},file:{unit:"bayt",verb:"olmal\u0131d\u0131r"},array:{unit:"unsur",verb:"olmal\u0131d\u0131r"},set:{unit:"unsur",verb:"olmal\u0131d\u0131r"}};function e(i){return t[i]??null}let r={regex:"giren",email:"epostag\xE2h",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO heng\xE2m\u0131",date:"ISO tarihi",time:"ISO zaman\u0131",duration:"ISO m\xFCddeti",ipv4:"IPv4 ni\u015F\xE2n\u0131",ipv6:"IPv6 ni\u015F\xE2n\u0131",cidrv4:"IPv4 menzili",cidrv6:"IPv6 menzili",base64:"base64-\u015Fifreli metin",base64url:"base64url-\u015Fifreli metin",json_string:"JSON metin",e164:"E.164 say\u0131s\u0131",jwt:"JWT",template_literal:"giren"},n={nan:"NaN",number:"numara",array:"saf",null:"gayb"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`F\xE2sit giren: umulan instanceof ${i.expected}, al\u0131nan ${s}`:`F\xE2sit giren: umulan ${o}, al\u0131nan ${s}`}case"invalid_value":return i.values.length===1?`F\xE2sit giren: umulan ${j(i.values[0])}`:`F\xE2sit tercih: m\xFBteberler ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`Fazla b\xFCy\xFCk: ${i.origin??"value"}, ${o}${i.maximum.toString()} ${a.unit??"elements"} sahip olmal\u0131yd\u0131.`:`Fazla b\xFCy\xFCk: ${i.origin??"value"}, ${o}${i.maximum.toString()} olmal\u0131yd\u0131.`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`Fazla k\xFC\xE7\xFCk: ${i.origin}, ${o}${i.minimum.toString()} ${a.unit} sahip olmal\u0131yd\u0131.`:`Fazla k\xFC\xE7\xFCk: ${i.origin}, ${o}${i.minimum.toString()} olmal\u0131yd\u0131.`}case"invalid_format":{let o=i;return o.format==="starts_with"?`F\xE2sit metin: "${o.prefix}" ile ba\u015Flamal\u0131.`:o.format==="ends_with"?`F\xE2sit metin: "${o.suffix}" ile bitmeli.`:o.format==="includes"?`F\xE2sit metin: "${o.includes}" ihtiv\xE2 etmeli.`:o.format==="regex"?`F\xE2sit metin: ${o.pattern} nak\u015F\u0131na uymal\u0131.`:`F\xE2sit ${r[o.format]??i.format}`}case"not_multiple_of":return`F\xE2sit say\u0131: ${i.divisor} kat\u0131 olmal\u0131yd\u0131.`;case"unrecognized_keys":return`Tan\u0131nmayan anahtar ${i.keys.length>1?"s":""}: ${$(i.keys,", ")}`;case"invalid_key":return`${i.origin} i\xE7in tan\u0131nmayan anahtar var.`;case"invalid_union":return"Giren tan\u0131namad\u0131.";case"invalid_element":return`${i.origin} i\xE7in tan\u0131nmayan k\u0131ymet var.`;default:return"K\u0131ymet tan\u0131namad\u0131."}}};function n1(){return{localeError:t3()}}var r3=()=>{let t={string:{unit:"\u062A\u0648\u06A9\u064A",verb:"\u0648\u0644\u0631\u064A"},file:{unit:"\u0628\u0627\u06CC\u067C\u0633",verb:"\u0648\u0644\u0631\u064A"},array:{unit:"\u062A\u0648\u06A9\u064A",verb:"\u0648\u0644\u0631\u064A"},set:{unit:"\u062A\u0648\u06A9\u064A",verb:"\u0648\u0644\u0631\u064A"}};function e(i){return t[i]??null}let r={regex:"\u0648\u0631\u0648\u062F\u064A",email:"\u0628\u0631\u06CC\u069A\u0646\u0627\u0644\u06CC\u06A9",url:"\u06CC\u0648 \u0622\u0631 \u0627\u0644",emoji:"\u0627\u06CC\u0645\u0648\u062C\u064A",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"\u0646\u06CC\u067C\u0647 \u0627\u0648 \u0648\u062E\u062A",date:"\u0646\u06D0\u067C\u0647",time:"\u0648\u062E\u062A",duration:"\u0645\u0648\u062F\u0647",ipv4:"\u062F IPv4 \u067E\u062A\u0647",ipv6:"\u062F IPv6 \u067E\u062A\u0647",cidrv4:"\u062F IPv4 \u0633\u0627\u062D\u0647",cidrv6:"\u062F IPv6 \u0633\u0627\u062D\u0647",base64:"base64-encoded \u0645\u062A\u0646",base64url:"base64url-encoded \u0645\u062A\u0646",json_string:"JSON \u0645\u062A\u0646",e164:"\u062F E.164 \u0634\u0645\u06D0\u0631\u0647",jwt:"JWT",template_literal:"\u0648\u0631\u0648\u062F\u064A"},n={nan:"NaN",number:"\u0639\u062F\u062F",array:"\u0627\u0631\u06D0"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`\u0646\u0627\u0633\u0645 \u0648\u0631\u0648\u062F\u064A: \u0628\u0627\u06CC\u062F instanceof ${i.expected} \u0648\u0627\u06CC, \u0645\u06AB\u0631 ${s} \u062A\u0631\u0644\u0627\u0633\u0647 \u0634\u0648`:`\u0646\u0627\u0633\u0645 \u0648\u0631\u0648\u062F\u064A: \u0628\u0627\u06CC\u062F ${o} \u0648\u0627\u06CC, \u0645\u06AB\u0631 ${s} \u062A\u0631\u0644\u0627\u0633\u0647 \u0634\u0648`}case"invalid_value":return i.values.length===1?`\u0646\u0627\u0633\u0645 \u0648\u0631\u0648\u062F\u064A: \u0628\u0627\u06CC\u062F ${j(i.values[0])} \u0648\u0627\u06CC`:`\u0646\u0627\u0633\u0645 \u0627\u0646\u062A\u062E\u0627\u0628: \u0628\u0627\u06CC\u062F \u06CC\u0648 \u0644\u0647 ${$(i.values,"|")} \u0685\u062E\u0647 \u0648\u0627\u06CC`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`\u0689\u06CC\u0631 \u0644\u0648\u06CC: ${i.origin??"\u0627\u0631\u0632\u069A\u062A"} \u0628\u0627\u06CC\u062F ${o}${i.maximum.toString()} ${a.unit??"\u0639\u0646\u0635\u0631\u0648\u0646\u0647"} \u0648\u0644\u0631\u064A`:`\u0689\u06CC\u0631 \u0644\u0648\u06CC: ${i.origin??"\u0627\u0631\u0632\u069A\u062A"} \u0628\u0627\u06CC\u062F ${o}${i.maximum.toString()} \u0648\u064A`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`\u0689\u06CC\u0631 \u06A9\u0648\u0686\u0646\u06CC: ${i.origin} \u0628\u0627\u06CC\u062F ${o}${i.minimum.toString()} ${a.unit} \u0648\u0644\u0631\u064A`:`\u0689\u06CC\u0631 \u06A9\u0648\u0686\u0646\u06CC: ${i.origin} \u0628\u0627\u06CC\u062F ${o}${i.minimum.toString()} \u0648\u064A`}case"invalid_format":{let o=i;return o.format==="starts_with"?`\u0646\u0627\u0633\u0645 \u0645\u062A\u0646: \u0628\u0627\u06CC\u062F \u062F "${o.prefix}" \u0633\u0631\u0647 \u067E\u06CC\u0644 \u0634\u064A`:o.format==="ends_with"?`\u0646\u0627\u0633\u0645 \u0645\u062A\u0646: \u0628\u0627\u06CC\u062F \u062F "${o.suffix}" \u0633\u0631\u0647 \u067E\u0627\u06CC \u062A\u0647 \u0648\u0631\u0633\u064A\u0696\u064A`:o.format==="includes"?`\u0646\u0627\u0633\u0645 \u0645\u062A\u0646: \u0628\u0627\u06CC\u062F "${o.includes}" \u0648\u0644\u0631\u064A`:o.format==="regex"?`\u0646\u0627\u0633\u0645 \u0645\u062A\u0646: \u0628\u0627\u06CC\u062F \u062F ${o.pattern} \u0633\u0631\u0647 \u0645\u0637\u0627\u0628\u0642\u062A \u0648\u0644\u0631\u064A`:`${r[o.format]??i.format} \u0646\u0627\u0633\u0645 \u062F\u06CC`}case"not_multiple_of":return`\u0646\u0627\u0633\u0645 \u0639\u062F\u062F: \u0628\u0627\u06CC\u062F \u062F ${i.divisor} \u0645\u0636\u0631\u0628 \u0648\u064A`;case"unrecognized_keys":return`\u0646\u0627\u0633\u0645 ${i.keys.length>1?"\u06A9\u0644\u06CC\u0689\u0648\u0646\u0647":"\u06A9\u0644\u06CC\u0689"}: ${$(i.keys,", ")}`;case"invalid_key":return`\u0646\u0627\u0633\u0645 \u06A9\u0644\u06CC\u0689 \u067E\u0647 ${i.origin} \u06A9\u06D0`;case"invalid_union":return"\u0646\u0627\u0633\u0645\u0647 \u0648\u0631\u0648\u062F\u064A";case"invalid_element":return`\u0646\u0627\u0633\u0645 \u0639\u0646\u0635\u0631 \u067E\u0647 ${i.origin} \u06A9\u06D0`;default:return"\u0646\u0627\u0633\u0645\u0647 \u0648\u0631\u0648\u062F\u064A"}}};function i1(){return{localeError:r3()}}var n3=()=>{let t={string:{unit:"znak\xF3w",verb:"mie\u0107"},file:{unit:"bajt\xF3w",verb:"mie\u0107"},array:{unit:"element\xF3w",verb:"mie\u0107"},set:{unit:"element\xF3w",verb:"mie\u0107"}};function e(i){return t[i]??null}let r={regex:"wyra\u017Cenie",email:"adres email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data i godzina w formacie ISO",date:"data w formacie ISO",time:"godzina w formacie ISO",duration:"czas trwania ISO",ipv4:"adres IPv4",ipv6:"adres IPv6",cidrv4:"zakres IPv4",cidrv6:"zakres IPv6",base64:"ci\u0105g znak\xF3w zakodowany w formacie base64",base64url:"ci\u0105g znak\xF3w zakodowany w formacie base64url",json_string:"ci\u0105g znak\xF3w w formacie JSON",e164:"liczba E.164",jwt:"JWT",template_literal:"wej\u015Bcie"},n={nan:"NaN",number:"liczba",array:"tablica"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`Nieprawid\u0142owe dane wej\u015Bciowe: oczekiwano instanceof ${i.expected}, otrzymano ${s}`:`Nieprawid\u0142owe dane wej\u015Bciowe: oczekiwano ${o}, otrzymano ${s}`}case"invalid_value":return i.values.length===1?`Nieprawid\u0142owe dane wej\u015Bciowe: oczekiwano ${j(i.values[0])}`:`Nieprawid\u0142owa opcja: oczekiwano jednej z warto\u015Bci ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`Za du\u017Ca warto\u015B\u0107: oczekiwano, \u017Ce ${i.origin??"warto\u015B\u0107"} b\u0119dzie mie\u0107 ${o}${i.maximum.toString()} ${a.unit??"element\xF3w"}`:`Zbyt du\u017C(y/a/e): oczekiwano, \u017Ce ${i.origin??"warto\u015B\u0107"} b\u0119dzie wynosi\u0107 ${o}${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`Za ma\u0142a warto\u015B\u0107: oczekiwano, \u017Ce ${i.origin??"warto\u015B\u0107"} b\u0119dzie mie\u0107 ${o}${i.minimum.toString()} ${a.unit??"element\xF3w"}`:`Zbyt ma\u0142(y/a/e): oczekiwano, \u017Ce ${i.origin??"warto\u015B\u0107"} b\u0119dzie wynosi\u0107 ${o}${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`Nieprawid\u0142owy ci\u0105g znak\xF3w: musi zaczyna\u0107 si\u0119 od "${o.prefix}"`:o.format==="ends_with"?`Nieprawid\u0142owy ci\u0105g znak\xF3w: musi ko\u0144czy\u0107 si\u0119 na "${o.suffix}"`:o.format==="includes"?`Nieprawid\u0142owy ci\u0105g znak\xF3w: musi zawiera\u0107 "${o.includes}"`:o.format==="regex"?`Nieprawid\u0142owy ci\u0105g znak\xF3w: musi odpowiada\u0107 wzorcowi ${o.pattern}`:`Nieprawid\u0142ow(y/a/e) ${r[o.format]??i.format}`}case"not_multiple_of":return`Nieprawid\u0142owa liczba: musi by\u0107 wielokrotno\u015Bci\u0105 ${i.divisor}`;case"unrecognized_keys":return`Nierozpoznane klucze${i.keys.length>1?"s":""}: ${$(i.keys,", ")}`;case"invalid_key":return`Nieprawid\u0142owy klucz w ${i.origin}`;case"invalid_union":return"Nieprawid\u0142owe dane wej\u015Bciowe";case"invalid_element":return`Nieprawid\u0142owa warto\u015B\u0107 w ${i.origin}`;default:return"Nieprawid\u0142owe dane wej\u015Bciowe"}}};function o1(){return{localeError:n3()}}var i3=()=>{let t={string:{unit:"caracteres",verb:"ter"},file:{unit:"bytes",verb:"ter"},array:{unit:"itens",verb:"ter"},set:{unit:"itens",verb:"ter"}};function e(i){return t[i]??null}let r={regex:"padr\xE3o",email:"endere\xE7o de e-mail",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data e hora ISO",date:"data ISO",time:"hora ISO",duration:"dura\xE7\xE3o ISO",ipv4:"endere\xE7o IPv4",ipv6:"endere\xE7o IPv6",cidrv4:"faixa de IPv4",cidrv6:"faixa de IPv6",base64:"texto codificado em base64",base64url:"URL codificada em base64",json_string:"texto JSON",e164:"n\xFAmero E.164",jwt:"JWT",template_literal:"entrada"},n={nan:"NaN",number:"n\xFAmero",null:"nulo"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`Tipo inv\xE1lido: esperado instanceof ${i.expected}, recebido ${s}`:`Tipo inv\xE1lido: esperado ${o}, recebido ${s}`}case"invalid_value":return i.values.length===1?`Entrada inv\xE1lida: esperado ${j(i.values[0])}`:`Op\xE7\xE3o inv\xE1lida: esperada uma das ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`Muito grande: esperado que ${i.origin??"valor"} tivesse ${o}${i.maximum.toString()} ${a.unit??"elementos"}`:`Muito grande: esperado que ${i.origin??"valor"} fosse ${o}${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`Muito pequeno: esperado que ${i.origin} tivesse ${o}${i.minimum.toString()} ${a.unit}`:`Muito pequeno: esperado que ${i.origin} fosse ${o}${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`Texto inv\xE1lido: deve come\xE7ar com "${o.prefix}"`:o.format==="ends_with"?`Texto inv\xE1lido: deve terminar com "${o.suffix}"`:o.format==="includes"?`Texto inv\xE1lido: deve incluir "${o.includes}"`:o.format==="regex"?`Texto inv\xE1lido: deve corresponder ao padr\xE3o ${o.pattern}`:`${r[o.format]??i.format} inv\xE1lido`}case"not_multiple_of":return`N\xFAmero inv\xE1lido: deve ser m\xFAltiplo de ${i.divisor}`;case"unrecognized_keys":return`Chave${i.keys.length>1?"s":""} desconhecida${i.keys.length>1?"s":""}: ${$(i.keys,", ")}`;case"invalid_key":return`Chave inv\xE1lida em ${i.origin}`;case"invalid_union":return"Entrada inv\xE1lida";case"invalid_element":return`Valor inv\xE1lido em ${i.origin}`;default:return"Campo inv\xE1lido"}}};function a1(){return{localeError:i3()}}function s1(t,e,r,n){let i=Math.abs(t),o=i%10,a=i%100;return a>=11&&a<=19?n:o===1?e:o>=2&&o<=4?r:n}var o3=()=>{let t={string:{unit:{one:"\u0441\u0438\u043C\u0432\u043E\u043B",few:"\u0441\u0438\u043C\u0432\u043E\u043B\u0430",many:"\u0441\u0438\u043C\u0432\u043E\u043B\u043E\u0432"},verb:"\u0438\u043C\u0435\u0442\u044C"},file:{unit:{one:"\u0431\u0430\u0439\u0442",few:"\u0431\u0430\u0439\u0442\u0430",many:"\u0431\u0430\u0439\u0442"},verb:"\u0438\u043C\u0435\u0442\u044C"},array:{unit:{one:"\u044D\u043B\u0435\u043C\u0435\u043D\u0442",few:"\u044D\u043B\u0435\u043C\u0435\u043D\u0442\u0430",many:"\u044D\u043B\u0435\u043C\u0435\u043D\u0442\u043E\u0432"},verb:"\u0438\u043C\u0435\u0442\u044C"},set:{unit:{one:"\u044D\u043B\u0435\u043C\u0435\u043D\u0442",few:"\u044D\u043B\u0435\u043C\u0435\u043D\u0442\u0430",many:"\u044D\u043B\u0435\u043C\u0435\u043D\u0442\u043E\u0432"},verb:"\u0438\u043C\u0435\u0442\u044C"}};function e(i){return t[i]??null}let r={regex:"\u0432\u0432\u043E\u0434",email:"email \u0430\u0434\u0440\u0435\u0441",url:"URL",emoji:"\u044D\u043C\u043E\u0434\u0437\u0438",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO \u0434\u0430\u0442\u0430 \u0438 \u0432\u0440\u0435\u043C\u044F",date:"ISO \u0434\u0430\u0442\u0430",time:"ISO \u0432\u0440\u0435\u043C\u044F",duration:"ISO \u0434\u043B\u0438\u0442\u0435\u043B\u044C\u043D\u043E\u0441\u0442\u044C",ipv4:"IPv4 \u0430\u0434\u0440\u0435\u0441",ipv6:"IPv6 \u0430\u0434\u0440\u0435\u0441",cidrv4:"IPv4 \u0434\u0438\u0430\u043F\u0430\u0437\u043E\u043D",cidrv6:"IPv6 \u0434\u0438\u0430\u043F\u0430\u0437\u043E\u043D",base64:"\u0441\u0442\u0440\u043E\u043A\u0430 \u0432 \u0444\u043E\u0440\u043C\u0430\u0442\u0435 base64",base64url:"\u0441\u0442\u0440\u043E\u043A\u0430 \u0432 \u0444\u043E\u0440\u043C\u0430\u0442\u0435 base64url",json_string:"JSON \u0441\u0442\u0440\u043E\u043A\u0430",e164:"\u043D\u043E\u043C\u0435\u0440 E.164",jwt:"JWT",template_literal:"\u0432\u0432\u043E\u0434"},n={nan:"NaN",number:"\u0447\u0438\u0441\u043B\u043E",array:"\u043C\u0430\u0441\u0441\u0438\u0432"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 \u0432\u0432\u043E\u0434: \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C instanceof ${i.expected}, \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u043E ${s}`:`\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 \u0432\u0432\u043E\u0434: \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C ${o}, \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u043E ${s}`}case"invalid_value":return i.values.length===1?`\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 \u0432\u0432\u043E\u0434: \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C ${j(i.values[0])}`:`\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 \u0432\u0430\u0440\u0438\u0430\u043D\u0442: \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u0434\u043D\u043E \u0438\u0437 ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);if(a){let s=Number(i.maximum),c=s1(s,a.unit.one,a.unit.few,a.unit.many);return`\u0421\u043B\u0438\u0448\u043A\u043E\u043C \u0431\u043E\u043B\u044C\u0448\u043E\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435: \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C, \u0447\u0442\u043E ${i.origin??"\u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435"} \u0431\u0443\u0434\u0435\u0442 \u0438\u043C\u0435\u0442\u044C ${o}${i.maximum.toString()} ${c}`}return`\u0421\u043B\u0438\u0448\u043A\u043E\u043C \u0431\u043E\u043B\u044C\u0448\u043E\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435: \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C, \u0447\u0442\u043E ${i.origin??"\u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435"} \u0431\u0443\u0434\u0435\u0442 ${o}${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);if(a){let s=Number(i.minimum),c=s1(s,a.unit.one,a.unit.few,a.unit.many);return`\u0421\u043B\u0438\u0448\u043A\u043E\u043C \u043C\u0430\u043B\u0435\u043D\u044C\u043A\u043E\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435: \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C, \u0447\u0442\u043E ${i.origin} \u0431\u0443\u0434\u0435\u0442 \u0438\u043C\u0435\u0442\u044C ${o}${i.minimum.toString()} ${c}`}return`\u0421\u043B\u0438\u0448\u043A\u043E\u043C \u043C\u0430\u043B\u0435\u043D\u044C\u043A\u043E\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435: \u043E\u0436\u0438\u0434\u0430\u043B\u043E\u0441\u044C, \u0447\u0442\u043E ${i.origin} \u0431\u0443\u0434\u0435\u0442 ${o}${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`\u041D\u0435\u0432\u0435\u0440\u043D\u0430\u044F \u0441\u0442\u0440\u043E\u043A\u0430: \u0434\u043E\u043B\u0436\u043D\u0430 \u043D\u0430\u0447\u0438\u043D\u0430\u0442\u044C\u0441\u044F \u0441 "${o.prefix}"`:o.format==="ends_with"?`\u041D\u0435\u0432\u0435\u0440\u043D\u0430\u044F \u0441\u0442\u0440\u043E\u043A\u0430: \u0434\u043E\u043B\u0436\u043D\u0430 \u0437\u0430\u043A\u0430\u043D\u0447\u0438\u0432\u0430\u0442\u044C\u0441\u044F \u043D\u0430 "${o.suffix}"`:o.format==="includes"?`\u041D\u0435\u0432\u0435\u0440\u043D\u0430\u044F \u0441\u0442\u0440\u043E\u043A\u0430: \u0434\u043E\u043B\u0436\u043D\u0430 \u0441\u043E\u0434\u0435\u0440\u0436\u0430\u0442\u044C "${o.includes}"`:o.format==="regex"?`\u041D\u0435\u0432\u0435\u0440\u043D\u0430\u044F \u0441\u0442\u0440\u043E\u043A\u0430: \u0434\u043E\u043B\u0436\u043D\u0430 \u0441\u043E\u043E\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u043E\u0432\u0430\u0442\u044C \u0448\u0430\u0431\u043B\u043E\u043D\u0443 ${o.pattern}`:`\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 ${r[o.format]??i.format}`}case"not_multiple_of":return`\u041D\u0435\u0432\u0435\u0440\u043D\u043E\u0435 \u0447\u0438\u0441\u043B\u043E: \u0434\u043E\u043B\u0436\u043D\u043E \u0431\u044B\u0442\u044C \u043A\u0440\u0430\u0442\u043D\u044B\u043C ${i.divisor}`;case"unrecognized_keys":return`\u041D\u0435\u0440\u0430\u0441\u043F\u043E\u0437\u043D\u0430\u043D\u043D${i.keys.length>1?"\u044B\u0435":"\u044B\u0439"} \u043A\u043B\u044E\u0447${i.keys.length>1?"\u0438":""}: ${$(i.keys,", ")}`;case"invalid_key":return`\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 \u043A\u043B\u044E\u0447 \u0432 ${i.origin}`;case"invalid_union":return"\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0435 \u0432\u0445\u043E\u0434\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435";case"invalid_element":return`\u041D\u0435\u0432\u0435\u0440\u043D\u043E\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435 \u0432 ${i.origin}`;default:return"\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0435 \u0432\u0445\u043E\u0434\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435"}}};function c1(){return{localeError:o3()}}var a3=()=>{let t={string:{unit:"znakov",verb:"imeti"},file:{unit:"bajtov",verb:"imeti"},array:{unit:"elementov",verb:"imeti"},set:{unit:"elementov",verb:"imeti"}};function e(i){return t[i]??null}let r={regex:"vnos",email:"e-po\u0161tni naslov",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datum in \u010Das",date:"ISO datum",time:"ISO \u010Das",duration:"ISO trajanje",ipv4:"IPv4 naslov",ipv6:"IPv6 naslov",cidrv4:"obseg IPv4",cidrv6:"obseg IPv6",base64:"base64 kodiran niz",base64url:"base64url kodiran niz",json_string:"JSON niz",e164:"E.164 \u0161tevilka",jwt:"JWT",template_literal:"vnos"},n={nan:"NaN",number:"\u0161tevilo",array:"tabela"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`Neveljaven vnos: pri\u010Dakovano instanceof ${i.expected}, prejeto ${s}`:`Neveljaven vnos: pri\u010Dakovano ${o}, prejeto ${s}`}case"invalid_value":return i.values.length===1?`Neveljaven vnos: pri\u010Dakovano ${j(i.values[0])}`:`Neveljavna mo\u017Enost: pri\u010Dakovano eno izmed ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`Preveliko: pri\u010Dakovano, da bo ${i.origin??"vrednost"} imelo ${o}${i.maximum.toString()} ${a.unit??"elementov"}`:`Preveliko: pri\u010Dakovano, da bo ${i.origin??"vrednost"} ${o}${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`Premajhno: pri\u010Dakovano, da bo ${i.origin} imelo ${o}${i.minimum.toString()} ${a.unit}`:`Premajhno: pri\u010Dakovano, da bo ${i.origin} ${o}${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`Neveljaven niz: mora se za\u010Deti z "${o.prefix}"`:o.format==="ends_with"?`Neveljaven niz: mora se kon\u010Dati z "${o.suffix}"`:o.format==="includes"?`Neveljaven niz: mora vsebovati "${o.includes}"`:o.format==="regex"?`Neveljaven niz: mora ustrezati vzorcu ${o.pattern}`:`Neveljaven ${r[o.format]??i.format}`}case"not_multiple_of":return`Neveljavno \u0161tevilo: mora biti ve\u010Dkratnik ${i.divisor}`;case"unrecognized_keys":return`Neprepoznan${i.keys.length>1?"i klju\u010Di":" klju\u010D"}: ${$(i.keys,", ")}`;case"invalid_key":return`Neveljaven klju\u010D v ${i.origin}`;case"invalid_union":return"Neveljaven vnos";case"invalid_element":return`Neveljavna vrednost v ${i.origin}`;default:return"Neveljaven vnos"}}};function u1(){return{localeError:a3()}}var s3=()=>{let t={string:{unit:"tecken",verb:"att ha"},file:{unit:"bytes",verb:"att ha"},array:{unit:"objekt",verb:"att inneh\xE5lla"},set:{unit:"objekt",verb:"att inneh\xE5lla"}};function e(i){return t[i]??null}let r={regex:"regulj\xE4rt uttryck",email:"e-postadress",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-datum och tid",date:"ISO-datum",time:"ISO-tid",duration:"ISO-varaktighet",ipv4:"IPv4-intervall",ipv6:"IPv6-intervall",cidrv4:"IPv4-spektrum",cidrv6:"IPv6-spektrum",base64:"base64-kodad str\xE4ng",base64url:"base64url-kodad str\xE4ng",json_string:"JSON-str\xE4ng",e164:"E.164-nummer",jwt:"JWT",template_literal:"mall-literal"},n={nan:"NaN",number:"antal",array:"lista"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`Ogiltig inmatning: f\xF6rv\xE4ntat instanceof ${i.expected}, fick ${s}`:`Ogiltig inmatning: f\xF6rv\xE4ntat ${o}, fick ${s}`}case"invalid_value":return i.values.length===1?`Ogiltig inmatning: f\xF6rv\xE4ntat ${j(i.values[0])}`:`Ogiltigt val: f\xF6rv\xE4ntade en av ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`F\xF6r stor(t): f\xF6rv\xE4ntade ${i.origin??"v\xE4rdet"} att ha ${o}${i.maximum.toString()} ${a.unit??"element"}`:`F\xF6r stor(t): f\xF6rv\xE4ntat ${i.origin??"v\xE4rdet"} att ha ${o}${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`F\xF6r lite(t): f\xF6rv\xE4ntade ${i.origin??"v\xE4rdet"} att ha ${o}${i.minimum.toString()} ${a.unit}`:`F\xF6r lite(t): f\xF6rv\xE4ntade ${i.origin??"v\xE4rdet"} att ha ${o}${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`Ogiltig str\xE4ng: m\xE5ste b\xF6rja med "${o.prefix}"`:o.format==="ends_with"?`Ogiltig str\xE4ng: m\xE5ste sluta med "${o.suffix}"`:o.format==="includes"?`Ogiltig str\xE4ng: m\xE5ste inneh\xE5lla "${o.includes}"`:o.format==="regex"?`Ogiltig str\xE4ng: m\xE5ste matcha m\xF6nstret "${o.pattern}"`:`Ogiltig(t) ${r[o.format]??i.format}`}case"not_multiple_of":return`Ogiltigt tal: m\xE5ste vara en multipel av ${i.divisor}`;case"unrecognized_keys":return`${i.keys.length>1?"Ok\xE4nda nycklar":"Ok\xE4nd nyckel"}: ${$(i.keys,", ")}`;case"invalid_key":return`Ogiltig nyckel i ${i.origin??"v\xE4rdet"}`;case"invalid_union":return"Ogiltig input";case"invalid_element":return`Ogiltigt v\xE4rde i ${i.origin??"v\xE4rdet"}`;default:return"Ogiltig input"}}};function l1(){return{localeError:s3()}}var c3=()=>{let t={string:{unit:"\u0B8E\u0BB4\u0BC1\u0BA4\u0BCD\u0BA4\u0BC1\u0B95\u0BCD\u0B95\u0BB3\u0BCD",verb:"\u0B95\u0BCA\u0BA3\u0BCD\u0B9F\u0BBF\u0BB0\u0BC1\u0B95\u0BCD\u0B95 \u0BB5\u0BC7\u0BA3\u0BCD\u0B9F\u0BC1\u0BAE\u0BCD"},file:{unit:"\u0BAA\u0BC8\u0B9F\u0BCD\u0B9F\u0BC1\u0B95\u0BB3\u0BCD",verb:"\u0B95\u0BCA\u0BA3\u0BCD\u0B9F\u0BBF\u0BB0\u0BC1\u0B95\u0BCD\u0B95 \u0BB5\u0BC7\u0BA3\u0BCD\u0B9F\u0BC1\u0BAE\u0BCD"},array:{unit:"\u0B89\u0BB1\u0BC1\u0BAA\u0BCD\u0BAA\u0BC1\u0B95\u0BB3\u0BCD",verb:"\u0B95\u0BCA\u0BA3\u0BCD\u0B9F\u0BBF\u0BB0\u0BC1\u0B95\u0BCD\u0B95 \u0BB5\u0BC7\u0BA3\u0BCD\u0B9F\u0BC1\u0BAE\u0BCD"},set:{unit:"\u0B89\u0BB1\u0BC1\u0BAA\u0BCD\u0BAA\u0BC1\u0B95\u0BB3\u0BCD",verb:"\u0B95\u0BCA\u0BA3\u0BCD\u0B9F\u0BBF\u0BB0\u0BC1\u0B95\u0BCD\u0B95 \u0BB5\u0BC7\u0BA3\u0BCD\u0B9F\u0BC1\u0BAE\u0BCD"}};function e(i){return t[i]??null}let r={regex:"\u0B89\u0BB3\u0BCD\u0BB3\u0BC0\u0B9F\u0BC1",email:"\u0BAE\u0BBF\u0BA9\u0BCD\u0BA9\u0B9E\u0BCD\u0B9A\u0BB2\u0BCD \u0BAE\u0BC1\u0B95\u0BB5\u0BB0\u0BBF",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO \u0BA4\u0BC7\u0BA4\u0BBF \u0BA8\u0BC7\u0BB0\u0BAE\u0BCD",date:"ISO \u0BA4\u0BC7\u0BA4\u0BBF",time:"ISO \u0BA8\u0BC7\u0BB0\u0BAE\u0BCD",duration:"ISO \u0B95\u0BBE\u0BB2 \u0B85\u0BB3\u0BB5\u0BC1",ipv4:"IPv4 \u0BAE\u0BC1\u0B95\u0BB5\u0BB0\u0BBF",ipv6:"IPv6 \u0BAE\u0BC1\u0B95\u0BB5\u0BB0\u0BBF",cidrv4:"IPv4 \u0BB5\u0BB0\u0BAE\u0BCD\u0BAA\u0BC1",cidrv6:"IPv6 \u0BB5\u0BB0\u0BAE\u0BCD\u0BAA\u0BC1",base64:"base64-encoded \u0B9A\u0BB0\u0BAE\u0BCD",base64url:"base64url-encoded \u0B9A\u0BB0\u0BAE\u0BCD",json_string:"JSON \u0B9A\u0BB0\u0BAE\u0BCD",e164:"E.164 \u0B8E\u0BA3\u0BCD",jwt:"JWT",template_literal:"input"},n={nan:"NaN",number:"\u0B8E\u0BA3\u0BCD",array:"\u0B85\u0BA3\u0BBF",null:"\u0BB5\u0BC6\u0BB1\u0BC1\u0BAE\u0BC8"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`\u0BA4\u0BB5\u0BB1\u0BBE\u0BA9 \u0B89\u0BB3\u0BCD\u0BB3\u0BC0\u0B9F\u0BC1: \u0B8E\u0BA4\u0BBF\u0BB0\u0BCD\u0BAA\u0BBE\u0BB0\u0BCD\u0B95\u0BCD\u0B95\u0BAA\u0BCD\u0BAA\u0B9F\u0BCD\u0B9F\u0BA4\u0BC1 instanceof ${i.expected}, \u0BAA\u0BC6\u0BB1\u0BAA\u0BCD\u0BAA\u0B9F\u0BCD\u0B9F\u0BA4\u0BC1 ${s}`:`\u0BA4\u0BB5\u0BB1\u0BBE\u0BA9 \u0B89\u0BB3\u0BCD\u0BB3\u0BC0\u0B9F\u0BC1: \u0B8E\u0BA4\u0BBF\u0BB0\u0BCD\u0BAA\u0BBE\u0BB0\u0BCD\u0B95\u0BCD\u0B95\u0BAA\u0BCD\u0BAA\u0B9F\u0BCD\u0B9F\u0BA4\u0BC1 ${o}, \u0BAA\u0BC6\u0BB1\u0BAA\u0BCD\u0BAA\u0B9F\u0BCD\u0B9F\u0BA4\u0BC1 ${s}`}case"invalid_value":return i.values.length===1?`\u0BA4\u0BB5\u0BB1\u0BBE\u0BA9 \u0B89\u0BB3\u0BCD\u0BB3\u0BC0\u0B9F\u0BC1: \u0B8E\u0BA4\u0BBF\u0BB0\u0BCD\u0BAA\u0BBE\u0BB0\u0BCD\u0B95\u0BCD\u0B95\u0BAA\u0BCD\u0BAA\u0B9F\u0BCD\u0B9F\u0BA4\u0BC1 ${j(i.values[0])}`:`\u0BA4\u0BB5\u0BB1\u0BBE\u0BA9 \u0BB5\u0BBF\u0BB0\u0BC1\u0BAA\u0BCD\u0BAA\u0BAE\u0BCD: \u0B8E\u0BA4\u0BBF\u0BB0\u0BCD\u0BAA\u0BBE\u0BB0\u0BCD\u0B95\u0BCD\u0B95\u0BAA\u0BCD\u0BAA\u0B9F\u0BCD\u0B9F\u0BA4\u0BC1 ${$(i.values,"|")} \u0B87\u0BB2\u0BCD \u0B92\u0BA9\u0BCD\u0BB1\u0BC1`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`\u0BAE\u0BBF\u0B95 \u0BAA\u0BC6\u0BB0\u0BBF\u0BAF\u0BA4\u0BC1: \u0B8E\u0BA4\u0BBF\u0BB0\u0BCD\u0BAA\u0BBE\u0BB0\u0BCD\u0B95\u0BCD\u0B95\u0BAA\u0BCD\u0BAA\u0B9F\u0BCD\u0B9F\u0BA4\u0BC1 ${i.origin??"\u0BAE\u0BA4\u0BBF\u0BAA\u0BCD\u0BAA\u0BC1"} ${o}${i.maximum.toString()} ${a.unit??"\u0B89\u0BB1\u0BC1\u0BAA\u0BCD\u0BAA\u0BC1\u0B95\u0BB3\u0BCD"} \u0B86\u0B95 \u0B87\u0BB0\u0BC1\u0B95\u0BCD\u0B95 \u0BB5\u0BC7\u0BA3\u0BCD\u0B9F\u0BC1\u0BAE\u0BCD`:`\u0BAE\u0BBF\u0B95 \u0BAA\u0BC6\u0BB0\u0BBF\u0BAF\u0BA4\u0BC1: \u0B8E\u0BA4\u0BBF\u0BB0\u0BCD\u0BAA\u0BBE\u0BB0\u0BCD\u0B95\u0BCD\u0B95\u0BAA\u0BCD\u0BAA\u0B9F\u0BCD\u0B9F\u0BA4\u0BC1 ${i.origin??"\u0BAE\u0BA4\u0BBF\u0BAA\u0BCD\u0BAA\u0BC1"} ${o}${i.maximum.toString()} \u0B86\u0B95 \u0B87\u0BB0\u0BC1\u0B95\u0BCD\u0B95 \u0BB5\u0BC7\u0BA3\u0BCD\u0B9F\u0BC1\u0BAE\u0BCD`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`\u0BAE\u0BBF\u0B95\u0B9A\u0BCD \u0B9A\u0BBF\u0BB1\u0BBF\u0BAF\u0BA4\u0BC1: \u0B8E\u0BA4\u0BBF\u0BB0\u0BCD\u0BAA\u0BBE\u0BB0\u0BCD\u0B95\u0BCD\u0B95\u0BAA\u0BCD\u0BAA\u0B9F\u0BCD\u0B9F\u0BA4\u0BC1 ${i.origin} ${o}${i.minimum.toString()} ${a.unit} \u0B86\u0B95 \u0B87\u0BB0\u0BC1\u0B95\u0BCD\u0B95 \u0BB5\u0BC7\u0BA3\u0BCD\u0B9F\u0BC1\u0BAE\u0BCD`:`\u0BAE\u0BBF\u0B95\u0B9A\u0BCD \u0B9A\u0BBF\u0BB1\u0BBF\u0BAF\u0BA4\u0BC1: \u0B8E\u0BA4\u0BBF\u0BB0\u0BCD\u0BAA\u0BBE\u0BB0\u0BCD\u0B95\u0BCD\u0B95\u0BAA\u0BCD\u0BAA\u0B9F\u0BCD\u0B9F\u0BA4\u0BC1 ${i.origin} ${o}${i.minimum.toString()} \u0B86\u0B95 \u0B87\u0BB0\u0BC1\u0B95\u0BCD\u0B95 \u0BB5\u0BC7\u0BA3\u0BCD\u0B9F\u0BC1\u0BAE\u0BCD`}case"invalid_format":{let o=i;return o.format==="starts_with"?`\u0BA4\u0BB5\u0BB1\u0BBE\u0BA9 \u0B9A\u0BB0\u0BAE\u0BCD: "${o.prefix}" \u0B87\u0BB2\u0BCD \u0BA4\u0BCA\u0B9F\u0B99\u0BCD\u0B95 \u0BB5\u0BC7\u0BA3\u0BCD\u0B9F\u0BC1\u0BAE\u0BCD`:o.format==="ends_with"?`\u0BA4\u0BB5\u0BB1\u0BBE\u0BA9 \u0B9A\u0BB0\u0BAE\u0BCD: "${o.suffix}" \u0B87\u0BB2\u0BCD \u0BAE\u0BC1\u0B9F\u0BBF\u0BB5\u0B9F\u0BC8\u0BAF \u0BB5\u0BC7\u0BA3\u0BCD\u0B9F\u0BC1\u0BAE\u0BCD`:o.format==="includes"?`\u0BA4\u0BB5\u0BB1\u0BBE\u0BA9 \u0B9A\u0BB0\u0BAE\u0BCD: "${o.includes}" \u0B90 \u0B89\u0BB3\u0BCD\u0BB3\u0B9F\u0B95\u0BCD\u0B95 \u0BB5\u0BC7\u0BA3\u0BCD\u0B9F\u0BC1\u0BAE\u0BCD`:o.format==="regex"?`\u0BA4\u0BB5\u0BB1\u0BBE\u0BA9 \u0B9A\u0BB0\u0BAE\u0BCD: ${o.pattern} \u0BAE\u0BC1\u0BB1\u0BC8\u0BAA\u0BBE\u0B9F\u0BCD\u0B9F\u0BC1\u0B9F\u0BA9\u0BCD \u0BAA\u0BCA\u0BB0\u0BC1\u0BA8\u0BCD\u0BA4 \u0BB5\u0BC7\u0BA3\u0BCD\u0B9F\u0BC1\u0BAE\u0BCD`:`\u0BA4\u0BB5\u0BB1\u0BBE\u0BA9 ${r[o.format]??i.format}`}case"not_multiple_of":return`\u0BA4\u0BB5\u0BB1\u0BBE\u0BA9 \u0B8E\u0BA3\u0BCD: ${i.divisor} \u0B87\u0BA9\u0BCD \u0BAA\u0BB2\u0BAE\u0BBE\u0B95 \u0B87\u0BB0\u0BC1\u0B95\u0BCD\u0B95 \u0BB5\u0BC7\u0BA3\u0BCD\u0B9F\u0BC1\u0BAE\u0BCD`;case"unrecognized_keys":return`\u0B85\u0B9F\u0BC8\u0BAF\u0BBE\u0BB3\u0BAE\u0BCD \u0BA4\u0BC6\u0BB0\u0BBF\u0BAF\u0BBE\u0BA4 \u0BB5\u0BBF\u0B9A\u0BC8${i.keys.length>1?"\u0B95\u0BB3\u0BCD":""}: ${$(i.keys,", ")}`;case"invalid_key":return`${i.origin} \u0B87\u0BB2\u0BCD \u0BA4\u0BB5\u0BB1\u0BBE\u0BA9 \u0BB5\u0BBF\u0B9A\u0BC8`;case"invalid_union":return"\u0BA4\u0BB5\u0BB1\u0BBE\u0BA9 \u0B89\u0BB3\u0BCD\u0BB3\u0BC0\u0B9F\u0BC1";case"invalid_element":return`${i.origin} \u0B87\u0BB2\u0BCD \u0BA4\u0BB5\u0BB1\u0BBE\u0BA9 \u0BAE\u0BA4\u0BBF\u0BAA\u0BCD\u0BAA\u0BC1`;default:return"\u0BA4\u0BB5\u0BB1\u0BBE\u0BA9 \u0B89\u0BB3\u0BCD\u0BB3\u0BC0\u0B9F\u0BC1"}}};function p1(){return{localeError:c3()}}var u3=()=>{let t={string:{unit:"\u0E15\u0E31\u0E27\u0E2D\u0E31\u0E01\u0E29\u0E23",verb:"\u0E04\u0E27\u0E23\u0E21\u0E35"},file:{unit:"\u0E44\u0E1A\u0E15\u0E4C",verb:"\u0E04\u0E27\u0E23\u0E21\u0E35"},array:{unit:"\u0E23\u0E32\u0E22\u0E01\u0E32\u0E23",verb:"\u0E04\u0E27\u0E23\u0E21\u0E35"},set:{unit:"\u0E23\u0E32\u0E22\u0E01\u0E32\u0E23",verb:"\u0E04\u0E27\u0E23\u0E21\u0E35"}};function e(i){return t[i]??null}let r={regex:"\u0E02\u0E49\u0E2D\u0E21\u0E39\u0E25\u0E17\u0E35\u0E48\u0E1B\u0E49\u0E2D\u0E19",email:"\u0E17\u0E35\u0E48\u0E2D\u0E22\u0E39\u0E48\u0E2D\u0E35\u0E40\u0E21\u0E25",url:"URL",emoji:"\u0E2D\u0E34\u0E42\u0E21\u0E08\u0E34",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"\u0E27\u0E31\u0E19\u0E17\u0E35\u0E48\u0E40\u0E27\u0E25\u0E32\u0E41\u0E1A\u0E1A ISO",date:"\u0E27\u0E31\u0E19\u0E17\u0E35\u0E48\u0E41\u0E1A\u0E1A ISO",time:"\u0E40\u0E27\u0E25\u0E32\u0E41\u0E1A\u0E1A ISO",duration:"\u0E0A\u0E48\u0E27\u0E07\u0E40\u0E27\u0E25\u0E32\u0E41\u0E1A\u0E1A ISO",ipv4:"\u0E17\u0E35\u0E48\u0E2D\u0E22\u0E39\u0E48 IPv4",ipv6:"\u0E17\u0E35\u0E48\u0E2D\u0E22\u0E39\u0E48 IPv6",cidrv4:"\u0E0A\u0E48\u0E27\u0E07 IP \u0E41\u0E1A\u0E1A IPv4",cidrv6:"\u0E0A\u0E48\u0E27\u0E07 IP \u0E41\u0E1A\u0E1A IPv6",base64:"\u0E02\u0E49\u0E2D\u0E04\u0E27\u0E32\u0E21\u0E41\u0E1A\u0E1A Base64",base64url:"\u0E02\u0E49\u0E2D\u0E04\u0E27\u0E32\u0E21\u0E41\u0E1A\u0E1A Base64 \u0E2A\u0E33\u0E2B\u0E23\u0E31\u0E1A URL",json_string:"\u0E02\u0E49\u0E2D\u0E04\u0E27\u0E32\u0E21\u0E41\u0E1A\u0E1A JSON",e164:"\u0E40\u0E1A\u0E2D\u0E23\u0E4C\u0E42\u0E17\u0E23\u0E28\u0E31\u0E1E\u0E17\u0E4C\u0E23\u0E30\u0E2B\u0E27\u0E48\u0E32\u0E07\u0E1B\u0E23\u0E30\u0E40\u0E17\u0E28 (E.164)",jwt:"\u0E42\u0E17\u0E40\u0E04\u0E19 JWT",template_literal:"\u0E02\u0E49\u0E2D\u0E21\u0E39\u0E25\u0E17\u0E35\u0E48\u0E1B\u0E49\u0E2D\u0E19"},n={nan:"NaN",number:"\u0E15\u0E31\u0E27\u0E40\u0E25\u0E02",array:"\u0E2D\u0E32\u0E23\u0E4C\u0E40\u0E23\u0E22\u0E4C (Array)",null:"\u0E44\u0E21\u0E48\u0E21\u0E35\u0E04\u0E48\u0E32 (null)"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`\u0E1B\u0E23\u0E30\u0E40\u0E20\u0E17\u0E02\u0E49\u0E2D\u0E21\u0E39\u0E25\u0E44\u0E21\u0E48\u0E16\u0E39\u0E01\u0E15\u0E49\u0E2D\u0E07: \u0E04\u0E27\u0E23\u0E40\u0E1B\u0E47\u0E19 instanceof ${i.expected} \u0E41\u0E15\u0E48\u0E44\u0E14\u0E49\u0E23\u0E31\u0E1A ${s}`:`\u0E1B\u0E23\u0E30\u0E40\u0E20\u0E17\u0E02\u0E49\u0E2D\u0E21\u0E39\u0E25\u0E44\u0E21\u0E48\u0E16\u0E39\u0E01\u0E15\u0E49\u0E2D\u0E07: \u0E04\u0E27\u0E23\u0E40\u0E1B\u0E47\u0E19 ${o} \u0E41\u0E15\u0E48\u0E44\u0E14\u0E49\u0E23\u0E31\u0E1A ${s}`}case"invalid_value":return i.values.length===1?`\u0E04\u0E48\u0E32\u0E44\u0E21\u0E48\u0E16\u0E39\u0E01\u0E15\u0E49\u0E2D\u0E07: \u0E04\u0E27\u0E23\u0E40\u0E1B\u0E47\u0E19 ${j(i.values[0])}`:`\u0E15\u0E31\u0E27\u0E40\u0E25\u0E37\u0E2D\u0E01\u0E44\u0E21\u0E48\u0E16\u0E39\u0E01\u0E15\u0E49\u0E2D\u0E07: \u0E04\u0E27\u0E23\u0E40\u0E1B\u0E47\u0E19\u0E2B\u0E19\u0E36\u0E48\u0E07\u0E43\u0E19 ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"\u0E44\u0E21\u0E48\u0E40\u0E01\u0E34\u0E19":"\u0E19\u0E49\u0E2D\u0E22\u0E01\u0E27\u0E48\u0E32",a=e(i.origin);return a?`\u0E40\u0E01\u0E34\u0E19\u0E01\u0E33\u0E2B\u0E19\u0E14: ${i.origin??"\u0E04\u0E48\u0E32"} \u0E04\u0E27\u0E23\u0E21\u0E35${o} ${i.maximum.toString()} ${a.unit??"\u0E23\u0E32\u0E22\u0E01\u0E32\u0E23"}`:`\u0E40\u0E01\u0E34\u0E19\u0E01\u0E33\u0E2B\u0E19\u0E14: ${i.origin??"\u0E04\u0E48\u0E32"} \u0E04\u0E27\u0E23\u0E21\u0E35${o} ${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?"\u0E2D\u0E22\u0E48\u0E32\u0E07\u0E19\u0E49\u0E2D\u0E22":"\u0E21\u0E32\u0E01\u0E01\u0E27\u0E48\u0E32",a=e(i.origin);return a?`\u0E19\u0E49\u0E2D\u0E22\u0E01\u0E27\u0E48\u0E32\u0E01\u0E33\u0E2B\u0E19\u0E14: ${i.origin} \u0E04\u0E27\u0E23\u0E21\u0E35${o} ${i.minimum.toString()} ${a.unit}`:`\u0E19\u0E49\u0E2D\u0E22\u0E01\u0E27\u0E48\u0E32\u0E01\u0E33\u0E2B\u0E19\u0E14: ${i.origin} \u0E04\u0E27\u0E23\u0E21\u0E35${o} ${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`\u0E23\u0E39\u0E1B\u0E41\u0E1A\u0E1A\u0E44\u0E21\u0E48\u0E16\u0E39\u0E01\u0E15\u0E49\u0E2D\u0E07: \u0E02\u0E49\u0E2D\u0E04\u0E27\u0E32\u0E21\u0E15\u0E49\u0E2D\u0E07\u0E02\u0E36\u0E49\u0E19\u0E15\u0E49\u0E19\u0E14\u0E49\u0E27\u0E22 "${o.prefix}"`:o.format==="ends_with"?`\u0E23\u0E39\u0E1B\u0E41\u0E1A\u0E1A\u0E44\u0E21\u0E48\u0E16\u0E39\u0E01\u0E15\u0E49\u0E2D\u0E07: \u0E02\u0E49\u0E2D\u0E04\u0E27\u0E32\u0E21\u0E15\u0E49\u0E2D\u0E07\u0E25\u0E07\u0E17\u0E49\u0E32\u0E22\u0E14\u0E49\u0E27\u0E22 "${o.suffix}"`:o.format==="includes"?`\u0E23\u0E39\u0E1B\u0E41\u0E1A\u0E1A\u0E44\u0E21\u0E48\u0E16\u0E39\u0E01\u0E15\u0E49\u0E2D\u0E07: \u0E02\u0E49\u0E2D\u0E04\u0E27\u0E32\u0E21\u0E15\u0E49\u0E2D\u0E07\u0E21\u0E35 "${o.includes}" \u0E2D\u0E22\u0E39\u0E48\u0E43\u0E19\u0E02\u0E49\u0E2D\u0E04\u0E27\u0E32\u0E21`:o.format==="regex"?`\u0E23\u0E39\u0E1B\u0E41\u0E1A\u0E1A\u0E44\u0E21\u0E48\u0E16\u0E39\u0E01\u0E15\u0E49\u0E2D\u0E07: \u0E15\u0E49\u0E2D\u0E07\u0E15\u0E23\u0E07\u0E01\u0E31\u0E1A\u0E23\u0E39\u0E1B\u0E41\u0E1A\u0E1A\u0E17\u0E35\u0E48\u0E01\u0E33\u0E2B\u0E19\u0E14 ${o.pattern}`:`\u0E23\u0E39\u0E1B\u0E41\u0E1A\u0E1A\u0E44\u0E21\u0E48\u0E16\u0E39\u0E01\u0E15\u0E49\u0E2D\u0E07: ${r[o.format]??i.format}`}case"not_multiple_of":return`\u0E15\u0E31\u0E27\u0E40\u0E25\u0E02\u0E44\u0E21\u0E48\u0E16\u0E39\u0E01\u0E15\u0E49\u0E2D\u0E07: \u0E15\u0E49\u0E2D\u0E07\u0E40\u0E1B\u0E47\u0E19\u0E08\u0E33\u0E19\u0E27\u0E19\u0E17\u0E35\u0E48\u0E2B\u0E32\u0E23\u0E14\u0E49\u0E27\u0E22 ${i.divisor} \u0E44\u0E14\u0E49\u0E25\u0E07\u0E15\u0E31\u0E27`;case"unrecognized_keys":return`\u0E1E\u0E1A\u0E04\u0E35\u0E22\u0E4C\u0E17\u0E35\u0E48\u0E44\u0E21\u0E48\u0E23\u0E39\u0E49\u0E08\u0E31\u0E01: ${$(i.keys,", ")}`;case"invalid_key":return`\u0E04\u0E35\u0E22\u0E4C\u0E44\u0E21\u0E48\u0E16\u0E39\u0E01\u0E15\u0E49\u0E2D\u0E07\u0E43\u0E19 ${i.origin}`;case"invalid_union":return"\u0E02\u0E49\u0E2D\u0E21\u0E39\u0E25\u0E44\u0E21\u0E48\u0E16\u0E39\u0E01\u0E15\u0E49\u0E2D\u0E07: \u0E44\u0E21\u0E48\u0E15\u0E23\u0E07\u0E01\u0E31\u0E1A\u0E23\u0E39\u0E1B\u0E41\u0E1A\u0E1A\u0E22\u0E39\u0E40\u0E19\u0E35\u0E22\u0E19\u0E17\u0E35\u0E48\u0E01\u0E33\u0E2B\u0E19\u0E14\u0E44\u0E27\u0E49";case"invalid_element":return`\u0E02\u0E49\u0E2D\u0E21\u0E39\u0E25\u0E44\u0E21\u0E48\u0E16\u0E39\u0E01\u0E15\u0E49\u0E2D\u0E07\u0E43\u0E19 ${i.origin}`;default:return"\u0E02\u0E49\u0E2D\u0E21\u0E39\u0E25\u0E44\u0E21\u0E48\u0E16\u0E39\u0E01\u0E15\u0E49\u0E2D\u0E07"}}};function d1(){return{localeError:u3()}}var l3=()=>{let t={string:{unit:"karakter",verb:"olmal\u0131"},file:{unit:"bayt",verb:"olmal\u0131"},array:{unit:"\xF6\u011Fe",verb:"olmal\u0131"},set:{unit:"\xF6\u011Fe",verb:"olmal\u0131"}};function e(i){return t[i]??null}let r={regex:"girdi",email:"e-posta adresi",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO tarih ve saat",date:"ISO tarih",time:"ISO saat",duration:"ISO s\xFCre",ipv4:"IPv4 adresi",ipv6:"IPv6 adresi",cidrv4:"IPv4 aral\u0131\u011F\u0131",cidrv6:"IPv6 aral\u0131\u011F\u0131",base64:"base64 ile \u015Fifrelenmi\u015F metin",base64url:"base64url ile \u015Fifrelenmi\u015F metin",json_string:"JSON dizesi",e164:"E.164 say\u0131s\u0131",jwt:"JWT",template_literal:"\u015Eablon dizesi"},n={nan:"NaN"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`Ge\xE7ersiz de\u011Fer: beklenen instanceof ${i.expected}, al\u0131nan ${s}`:`Ge\xE7ersiz de\u011Fer: beklenen ${o}, al\u0131nan ${s}`}case"invalid_value":return i.values.length===1?`Ge\xE7ersiz de\u011Fer: beklenen ${j(i.values[0])}`:`Ge\xE7ersiz se\xE7enek: a\u015Fa\u011F\u0131dakilerden biri olmal\u0131: ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`\xC7ok b\xFCy\xFCk: beklenen ${i.origin??"de\u011Fer"} ${o}${i.maximum.toString()} ${a.unit??"\xF6\u011Fe"}`:`\xC7ok b\xFCy\xFCk: beklenen ${i.origin??"de\u011Fer"} ${o}${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`\xC7ok k\xFC\xE7\xFCk: beklenen ${i.origin} ${o}${i.minimum.toString()} ${a.unit}`:`\xC7ok k\xFC\xE7\xFCk: beklenen ${i.origin} ${o}${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`Ge\xE7ersiz metin: "${o.prefix}" ile ba\u015Flamal\u0131`:o.format==="ends_with"?`Ge\xE7ersiz metin: "${o.suffix}" ile bitmeli`:o.format==="includes"?`Ge\xE7ersiz metin: "${o.includes}" i\xE7ermeli`:o.format==="regex"?`Ge\xE7ersiz metin: ${o.pattern} desenine uymal\u0131`:`Ge\xE7ersiz ${r[o.format]??i.format}`}case"not_multiple_of":return`Ge\xE7ersiz say\u0131: ${i.divisor} ile tam b\xF6l\xFCnebilmeli`;case"unrecognized_keys":return`Tan\u0131nmayan anahtar${i.keys.length>1?"lar":""}: ${$(i.keys,", ")}`;case"invalid_key":return`${i.origin} i\xE7inde ge\xE7ersiz anahtar`;case"invalid_union":return"Ge\xE7ersiz de\u011Fer";case"invalid_element":return`${i.origin} i\xE7inde ge\xE7ersiz de\u011Fer`;default:return"Ge\xE7ersiz de\u011Fer"}}};function f1(){return{localeError:l3()}}var p3=()=>{let t={string:{unit:"\u0441\u0438\u043C\u0432\u043E\u043B\u0456\u0432",verb:"\u043C\u0430\u0442\u0438\u043C\u0435"},file:{unit:"\u0431\u0430\u0439\u0442\u0456\u0432",verb:"\u043C\u0430\u0442\u0438\u043C\u0435"},array:{unit:"\u0435\u043B\u0435\u043C\u0435\u043D\u0442\u0456\u0432",verb:"\u043C\u0430\u0442\u0438\u043C\u0435"},set:{unit:"\u0435\u043B\u0435\u043C\u0435\u043D\u0442\u0456\u0432",verb:"\u043C\u0430\u0442\u0438\u043C\u0435"}};function e(i){return t[i]??null}let r={regex:"\u0432\u0445\u0456\u0434\u043D\u0456 \u0434\u0430\u043D\u0456",email:"\u0430\u0434\u0440\u0435\u0441\u0430 \u0435\u043B\u0435\u043A\u0442\u0440\u043E\u043D\u043D\u043E\u0457 \u043F\u043E\u0448\u0442\u0438",url:"URL",emoji:"\u0435\u043C\u043E\u0434\u0437\u0456",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"\u0434\u0430\u0442\u0430 \u0442\u0430 \u0447\u0430\u0441 ISO",date:"\u0434\u0430\u0442\u0430 ISO",time:"\u0447\u0430\u0441 ISO",duration:"\u0442\u0440\u0438\u0432\u0430\u043B\u0456\u0441\u0442\u044C ISO",ipv4:"\u0430\u0434\u0440\u0435\u0441\u0430 IPv4",ipv6:"\u0430\u0434\u0440\u0435\u0441\u0430 IPv6",cidrv4:"\u0434\u0456\u0430\u043F\u0430\u0437\u043E\u043D IPv4",cidrv6:"\u0434\u0456\u0430\u043F\u0430\u0437\u043E\u043D IPv6",base64:"\u0440\u044F\u0434\u043E\u043A \u0443 \u043A\u043E\u0434\u0443\u0432\u0430\u043D\u043D\u0456 base64",base64url:"\u0440\u044F\u0434\u043E\u043A \u0443 \u043A\u043E\u0434\u0443\u0432\u0430\u043D\u043D\u0456 base64url",json_string:"\u0440\u044F\u0434\u043E\u043A JSON",e164:"\u043D\u043E\u043C\u0435\u0440 E.164",jwt:"JWT",template_literal:"\u0432\u0445\u0456\u0434\u043D\u0456 \u0434\u0430\u043D\u0456"},n={nan:"NaN",number:"\u0447\u0438\u0441\u043B\u043E",array:"\u043C\u0430\u0441\u0438\u0432"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u0456 \u0432\u0445\u0456\u0434\u043D\u0456 \u0434\u0430\u043D\u0456: \u043E\u0447\u0456\u043A\u0443\u0454\u0442\u044C\u0441\u044F instanceof ${i.expected}, \u043E\u0442\u0440\u0438\u043C\u0430\u043D\u043E ${s}`:`\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u0456 \u0432\u0445\u0456\u0434\u043D\u0456 \u0434\u0430\u043D\u0456: \u043E\u0447\u0456\u043A\u0443\u0454\u0442\u044C\u0441\u044F ${o}, \u043E\u0442\u0440\u0438\u043C\u0430\u043D\u043E ${s}`}case"invalid_value":return i.values.length===1?`\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u0456 \u0432\u0445\u0456\u0434\u043D\u0456 \u0434\u0430\u043D\u0456: \u043E\u0447\u0456\u043A\u0443\u0454\u0442\u044C\u0441\u044F ${j(i.values[0])}`:`\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u0430 \u043E\u043F\u0446\u0456\u044F: \u043E\u0447\u0456\u043A\u0443\u0454\u0442\u044C\u0441\u044F \u043E\u0434\u043D\u0435 \u0437 ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`\u0417\u0430\u043D\u0430\u0434\u0442\u043E \u0432\u0435\u043B\u0438\u043A\u0435: \u043E\u0447\u0456\u043A\u0443\u0454\u0442\u044C\u0441\u044F, \u0449\u043E ${i.origin??"\u0437\u043D\u0430\u0447\u0435\u043D\u043D\u044F"} ${a.verb} ${o}${i.maximum.toString()} ${a.unit??"\u0435\u043B\u0435\u043C\u0435\u043D\u0442\u0456\u0432"}`:`\u0417\u0430\u043D\u0430\u0434\u0442\u043E \u0432\u0435\u043B\u0438\u043A\u0435: \u043E\u0447\u0456\u043A\u0443\u0454\u0442\u044C\u0441\u044F, \u0449\u043E ${i.origin??"\u0437\u043D\u0430\u0447\u0435\u043D\u043D\u044F"} \u0431\u0443\u0434\u0435 ${o}${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`\u0417\u0430\u043D\u0430\u0434\u0442\u043E \u043C\u0430\u043B\u0435: \u043E\u0447\u0456\u043A\u0443\u0454\u0442\u044C\u0441\u044F, \u0449\u043E ${i.origin} ${a.verb} ${o}${i.minimum.toString()} ${a.unit}`:`\u0417\u0430\u043D\u0430\u0434\u0442\u043E \u043C\u0430\u043B\u0435: \u043E\u0447\u0456\u043A\u0443\u0454\u0442\u044C\u0441\u044F, \u0449\u043E ${i.origin} \u0431\u0443\u0434\u0435 ${o}${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u0438\u0439 \u0440\u044F\u0434\u043E\u043A: \u043F\u043E\u0432\u0438\u043D\u0435\u043D \u043F\u043E\u0447\u0438\u043D\u0430\u0442\u0438\u0441\u044F \u0437 "${o.prefix}"`:o.format==="ends_with"?`\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u0438\u0439 \u0440\u044F\u0434\u043E\u043A: \u043F\u043E\u0432\u0438\u043D\u0435\u043D \u0437\u0430\u043A\u0456\u043D\u0447\u0443\u0432\u0430\u0442\u0438\u0441\u044F \u043D\u0430 "${o.suffix}"`:o.format==="includes"?`\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u0438\u0439 \u0440\u044F\u0434\u043E\u043A: \u043F\u043E\u0432\u0438\u043D\u0435\u043D \u043C\u0456\u0441\u0442\u0438\u0442\u0438 "${o.includes}"`:o.format==="regex"?`\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u0438\u0439 \u0440\u044F\u0434\u043E\u043A: \u043F\u043E\u0432\u0438\u043D\u0435\u043D \u0432\u0456\u0434\u043F\u043E\u0432\u0456\u0434\u0430\u0442\u0438 \u0448\u0430\u0431\u043B\u043E\u043D\u0443 ${o.pattern}`:`\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u0438\u0439 ${r[o.format]??i.format}`}case"not_multiple_of":return`\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u0435 \u0447\u0438\u0441\u043B\u043E: \u043F\u043E\u0432\u0438\u043D\u043D\u043E \u0431\u0443\u0442\u0438 \u043A\u0440\u0430\u0442\u043D\u0438\u043C ${i.divisor}`;case"unrecognized_keys":return`\u041D\u0435\u0440\u043E\u0437\u043F\u0456\u0437\u043D\u0430\u043D\u0438\u0439 \u043A\u043B\u044E\u0447${i.keys.length>1?"\u0456":""}: ${$(i.keys,", ")}`;case"invalid_key":return`\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u0438\u0439 \u043A\u043B\u044E\u0447 \u0443 ${i.origin}`;case"invalid_union":return"\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u0456 \u0432\u0445\u0456\u0434\u043D\u0456 \u0434\u0430\u043D\u0456";case"invalid_element":return`\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u043D\u044F \u0443 ${i.origin}`;default:return"\u041D\u0435\u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u0456 \u0432\u0445\u0456\u0434\u043D\u0456 \u0434\u0430\u043D\u0456"}}};function Ch(){return{localeError:p3()}}function m1(){return Ch()}var d3=()=>{let t={string:{unit:"\u062D\u0631\u0648\u0641",verb:"\u06C1\u0648\u0646\u0627"},file:{unit:"\u0628\u0627\u0626\u0679\u0633",verb:"\u06C1\u0648\u0646\u0627"},array:{unit:"\u0622\u0626\u0679\u0645\u0632",verb:"\u06C1\u0648\u0646\u0627"},set:{unit:"\u0622\u0626\u0679\u0645\u0632",verb:"\u06C1\u0648\u0646\u0627"}};function e(i){return t[i]??null}let r={regex:"\u0627\u0646 \u067E\u0679",email:"\u0627\u06CC \u0645\u06CC\u0644 \u0627\u06CC\u0688\u0631\u06CC\u0633",url:"\u06CC\u0648 \u0622\u0631 \u0627\u06CC\u0644",emoji:"\u0627\u06CC\u0645\u0648\u062C\u06CC",uuid:"\u06CC\u0648 \u06CC\u0648 \u0622\u0626\u06CC \u0688\u06CC",uuidv4:"\u06CC\u0648 \u06CC\u0648 \u0622\u0626\u06CC \u0688\u06CC \u0648\u06CC 4",uuidv6:"\u06CC\u0648 \u06CC\u0648 \u0622\u0626\u06CC \u0688\u06CC \u0648\u06CC 6",nanoid:"\u0646\u06CC\u0646\u0648 \u0622\u0626\u06CC \u0688\u06CC",guid:"\u062C\u06CC \u06CC\u0648 \u0622\u0626\u06CC \u0688\u06CC",cuid:"\u0633\u06CC \u06CC\u0648 \u0622\u0626\u06CC \u0688\u06CC",cuid2:"\u0633\u06CC \u06CC\u0648 \u0622\u0626\u06CC \u0688\u06CC 2",ulid:"\u06CC\u0648 \u0627\u06CC\u0644 \u0622\u0626\u06CC \u0688\u06CC",xid:"\u0627\u06CC\u06A9\u0633 \u0622\u0626\u06CC \u0688\u06CC",ksuid:"\u06A9\u06D2 \u0627\u06CC\u0633 \u06CC\u0648 \u0622\u0626\u06CC \u0688\u06CC",datetime:"\u0622\u0626\u06CC \u0627\u06CC\u0633 \u0627\u0648 \u0688\u06CC\u0679 \u0679\u0627\u0626\u0645",date:"\u0622\u0626\u06CC \u0627\u06CC\u0633 \u0627\u0648 \u062A\u0627\u0631\u06CC\u062E",time:"\u0622\u0626\u06CC \u0627\u06CC\u0633 \u0627\u0648 \u0648\u0642\u062A",duration:"\u0622\u0626\u06CC \u0627\u06CC\u0633 \u0627\u0648 \u0645\u062F\u062A",ipv4:"\u0622\u0626\u06CC \u067E\u06CC \u0648\u06CC 4 \u0627\u06CC\u0688\u0631\u06CC\u0633",ipv6:"\u0622\u0626\u06CC \u067E\u06CC \u0648\u06CC 6 \u0627\u06CC\u0688\u0631\u06CC\u0633",cidrv4:"\u0622\u0626\u06CC \u067E\u06CC \u0648\u06CC 4 \u0631\u06CC\u0646\u062C",cidrv6:"\u0622\u0626\u06CC \u067E\u06CC \u0648\u06CC 6 \u0631\u06CC\u0646\u062C",base64:"\u0628\u06CC\u0633 64 \u0627\u0646 \u06A9\u0648\u0688\u0688 \u0633\u0679\u0631\u0646\u06AF",base64url:"\u0628\u06CC\u0633 64 \u06CC\u0648 \u0622\u0631 \u0627\u06CC\u0644 \u0627\u0646 \u06A9\u0648\u0688\u0688 \u0633\u0679\u0631\u0646\u06AF",json_string:"\u062C\u06D2 \u0627\u06CC\u0633 \u0627\u0648 \u0627\u06CC\u0646 \u0633\u0679\u0631\u0646\u06AF",e164:"\u0627\u06CC 164 \u0646\u0645\u0628\u0631",jwt:"\u062C\u06D2 \u0688\u0628\u0644\u06CC\u0648 \u0679\u06CC",template_literal:"\u0627\u0646 \u067E\u0679"},n={nan:"NaN",number:"\u0646\u0645\u0628\u0631",array:"\u0622\u0631\u06D2",null:"\u0646\u0644"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`\u063A\u0644\u0637 \u0627\u0646 \u067E\u0679: instanceof ${i.expected} \u0645\u062A\u0648\u0642\u0639 \u062A\u06BE\u0627\u060C ${s} \u0645\u0648\u0635\u0648\u0644 \u06C1\u0648\u0627`:`\u063A\u0644\u0637 \u0627\u0646 \u067E\u0679: ${o} \u0645\u062A\u0648\u0642\u0639 \u062A\u06BE\u0627\u060C ${s} \u0645\u0648\u0635\u0648\u0644 \u06C1\u0648\u0627`}case"invalid_value":return i.values.length===1?`\u063A\u0644\u0637 \u0627\u0646 \u067E\u0679: ${j(i.values[0])} \u0645\u062A\u0648\u0642\u0639 \u062A\u06BE\u0627`:`\u063A\u0644\u0637 \u0622\u067E\u0634\u0646: ${$(i.values,"|")} \u0645\u06CC\u06BA \u0633\u06D2 \u0627\u06CC\u06A9 \u0645\u062A\u0648\u0642\u0639 \u062A\u06BE\u0627`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`\u0628\u06C1\u062A \u0628\u0691\u0627: ${i.origin??"\u0648\u06CC\u0644\u06CC\u0648"} \u06A9\u06D2 ${o}${i.maximum.toString()} ${a.unit??"\u0639\u0646\u0627\u0635\u0631"} \u06C1\u0648\u0646\u06D2 \u0645\u062A\u0648\u0642\u0639 \u062A\u06BE\u06D2`:`\u0628\u06C1\u062A \u0628\u0691\u0627: ${i.origin??"\u0648\u06CC\u0644\u06CC\u0648"} \u06A9\u0627 ${o}${i.maximum.toString()} \u06C1\u0648\u0646\u0627 \u0645\u062A\u0648\u0642\u0639 \u062A\u06BE\u0627`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`\u0628\u06C1\u062A \u0686\u06BE\u0648\u0679\u0627: ${i.origin} \u06A9\u06D2 ${o}${i.minimum.toString()} ${a.unit} \u06C1\u0648\u0646\u06D2 \u0645\u062A\u0648\u0642\u0639 \u062A\u06BE\u06D2`:`\u0628\u06C1\u062A \u0686\u06BE\u0648\u0679\u0627: ${i.origin} \u06A9\u0627 ${o}${i.minimum.toString()} \u06C1\u0648\u0646\u0627 \u0645\u062A\u0648\u0642\u0639 \u062A\u06BE\u0627`}case"invalid_format":{let o=i;return o.format==="starts_with"?`\u063A\u0644\u0637 \u0633\u0679\u0631\u0646\u06AF: "${o.prefix}" \u0633\u06D2 \u0634\u0631\u0648\u0639 \u06C1\u0648\u0646\u0627 \u0686\u0627\u06C1\u06CC\u06D2`:o.format==="ends_with"?`\u063A\u0644\u0637 \u0633\u0679\u0631\u0646\u06AF: "${o.suffix}" \u067E\u0631 \u062E\u062A\u0645 \u06C1\u0648\u0646\u0627 \u0686\u0627\u06C1\u06CC\u06D2`:o.format==="includes"?`\u063A\u0644\u0637 \u0633\u0679\u0631\u0646\u06AF: "${o.includes}" \u0634\u0627\u0645\u0644 \u06C1\u0648\u0646\u0627 \u0686\u0627\u06C1\u06CC\u06D2`:o.format==="regex"?`\u063A\u0644\u0637 \u0633\u0679\u0631\u0646\u06AF: \u067E\u06CC\u0679\u0631\u0646 ${o.pattern} \u0633\u06D2 \u0645\u06CC\u0686 \u06C1\u0648\u0646\u0627 \u0686\u0627\u06C1\u06CC\u06D2`:`\u063A\u0644\u0637 ${r[o.format]??i.format}`}case"not_multiple_of":return`\u063A\u0644\u0637 \u0646\u0645\u0628\u0631: ${i.divisor} \u06A9\u0627 \u0645\u0636\u0627\u0639\u0641 \u06C1\u0648\u0646\u0627 \u0686\u0627\u06C1\u06CC\u06D2`;case"unrecognized_keys":return`\u063A\u06CC\u0631 \u062A\u0633\u0644\u06CC\u0645 \u0634\u062F\u06C1 \u06A9\u06CC${i.keys.length>1?"\u0632":""}: ${$(i.keys,"\u060C ")}`;case"invalid_key":return`${i.origin} \u0645\u06CC\u06BA \u063A\u0644\u0637 \u06A9\u06CC`;case"invalid_union":return"\u063A\u0644\u0637 \u0627\u0646 \u067E\u0679";case"invalid_element":return`${i.origin} \u0645\u06CC\u06BA \u063A\u0644\u0637 \u0648\u06CC\u0644\u06CC\u0648`;default:return"\u063A\u0644\u0637 \u0627\u0646 \u067E\u0679"}}};function h1(){return{localeError:d3()}}var f3=()=>{let t={string:{unit:"belgi",verb:"bo\u2018lishi kerak"},file:{unit:"bayt",verb:"bo\u2018lishi kerak"},array:{unit:"element",verb:"bo\u2018lishi kerak"},set:{unit:"element",verb:"bo\u2018lishi kerak"}};function e(i){return t[i]??null}let r={regex:"kirish",email:"elektron pochta manzili",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO sana va vaqti",date:"ISO sana",time:"ISO vaqt",duration:"ISO davomiylik",ipv4:"IPv4 manzil",ipv6:"IPv6 manzil",mac:"MAC manzil",cidrv4:"IPv4 diapazon",cidrv6:"IPv6 diapazon",base64:"base64 kodlangan satr",base64url:"base64url kodlangan satr",json_string:"JSON satr",e164:"E.164 raqam",jwt:"JWT",template_literal:"kirish"},n={nan:"NaN",number:"raqam",array:"massiv"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`Noto\u2018g\u2018ri kirish: kutilgan instanceof ${i.expected}, qabul qilingan ${s}`:`Noto\u2018g\u2018ri kirish: kutilgan ${o}, qabul qilingan ${s}`}case"invalid_value":return i.values.length===1?`Noto\u2018g\u2018ri kirish: kutilgan ${j(i.values[0])}`:`Noto\u2018g\u2018ri variant: quyidagilardan biri kutilgan ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`Juda katta: kutilgan ${i.origin??"qiymat"} ${o}${i.maximum.toString()} ${a.unit} ${a.verb}`:`Juda katta: kutilgan ${i.origin??"qiymat"} ${o}${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`Juda kichik: kutilgan ${i.origin} ${o}${i.minimum.toString()} ${a.unit} ${a.verb}`:`Juda kichik: kutilgan ${i.origin} ${o}${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`Noto\u2018g\u2018ri satr: "${o.prefix}" bilan boshlanishi kerak`:o.format==="ends_with"?`Noto\u2018g\u2018ri satr: "${o.suffix}" bilan tugashi kerak`:o.format==="includes"?`Noto\u2018g\u2018ri satr: "${o.includes}" ni o\u2018z ichiga olishi kerak`:o.format==="regex"?`Noto\u2018g\u2018ri satr: ${o.pattern} shabloniga mos kelishi kerak`:`Noto\u2018g\u2018ri ${r[o.format]??i.format}`}case"not_multiple_of":return`Noto\u2018g\u2018ri raqam: ${i.divisor} ning karralisi bo\u2018lishi kerak`;case"unrecognized_keys":return`Noma\u2019lum kalit${i.keys.length>1?"lar":""}: ${$(i.keys,", ")}`;case"invalid_key":return`${i.origin} dagi kalit noto\u2018g\u2018ri`;case"invalid_union":return"Noto\u2018g\u2018ri kirish";case"invalid_element":return`${i.origin} da noto\u2018g\u2018ri qiymat`;default:return"Noto\u2018g\u2018ri kirish"}}};function g1(){return{localeError:f3()}}var m3=()=>{let t={string:{unit:"k\xFD t\u1EF1",verb:"c\xF3"},file:{unit:"byte",verb:"c\xF3"},array:{unit:"ph\u1EA7n t\u1EED",verb:"c\xF3"},set:{unit:"ph\u1EA7n t\u1EED",verb:"c\xF3"}};function e(i){return t[i]??null}let r={regex:"\u0111\u1EA7u v\xE0o",email:"\u0111\u1ECBa ch\u1EC9 email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ng\xE0y gi\u1EDD ISO",date:"ng\xE0y ISO",time:"gi\u1EDD ISO",duration:"kho\u1EA3ng th\u1EDDi gian ISO",ipv4:"\u0111\u1ECBa ch\u1EC9 IPv4",ipv6:"\u0111\u1ECBa ch\u1EC9 IPv6",cidrv4:"d\u1EA3i IPv4",cidrv6:"d\u1EA3i IPv6",base64:"chu\u1ED7i m\xE3 h\xF3a base64",base64url:"chu\u1ED7i m\xE3 h\xF3a base64url",json_string:"chu\u1ED7i JSON",e164:"s\u1ED1 E.164",jwt:"JWT",template_literal:"\u0111\u1EA7u v\xE0o"},n={nan:"NaN",number:"s\u1ED1",array:"m\u1EA3ng"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`\u0110\u1EA7u v\xE0o kh\xF4ng h\u1EE3p l\u1EC7: mong \u0111\u1EE3i instanceof ${i.expected}, nh\u1EADn \u0111\u01B0\u1EE3c ${s}`:`\u0110\u1EA7u v\xE0o kh\xF4ng h\u1EE3p l\u1EC7: mong \u0111\u1EE3i ${o}, nh\u1EADn \u0111\u01B0\u1EE3c ${s}`}case"invalid_value":return i.values.length===1?`\u0110\u1EA7u v\xE0o kh\xF4ng h\u1EE3p l\u1EC7: mong \u0111\u1EE3i ${j(i.values[0])}`:`T\xF9y ch\u1ECDn kh\xF4ng h\u1EE3p l\u1EC7: mong \u0111\u1EE3i m\u1ED9t trong c\xE1c gi\xE1 tr\u1ECB ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`Qu\xE1 l\u1EDBn: mong \u0111\u1EE3i ${i.origin??"gi\xE1 tr\u1ECB"} ${a.verb} ${o}${i.maximum.toString()} ${a.unit??"ph\u1EA7n t\u1EED"}`:`Qu\xE1 l\u1EDBn: mong \u0111\u1EE3i ${i.origin??"gi\xE1 tr\u1ECB"} ${o}${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`Qu\xE1 nh\u1ECF: mong \u0111\u1EE3i ${i.origin} ${a.verb} ${o}${i.minimum.toString()} ${a.unit}`:`Qu\xE1 nh\u1ECF: mong \u0111\u1EE3i ${i.origin} ${o}${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`Chu\u1ED7i kh\xF4ng h\u1EE3p l\u1EC7: ph\u1EA3i b\u1EAFt \u0111\u1EA7u b\u1EB1ng "${o.prefix}"`:o.format==="ends_with"?`Chu\u1ED7i kh\xF4ng h\u1EE3p l\u1EC7: ph\u1EA3i k\u1EBFt th\xFAc b\u1EB1ng "${o.suffix}"`:o.format==="includes"?`Chu\u1ED7i kh\xF4ng h\u1EE3p l\u1EC7: ph\u1EA3i bao g\u1ED3m "${o.includes}"`:o.format==="regex"?`Chu\u1ED7i kh\xF4ng h\u1EE3p l\u1EC7: ph\u1EA3i kh\u1EDBp v\u1EDBi m\u1EABu ${o.pattern}`:`${r[o.format]??i.format} kh\xF4ng h\u1EE3p l\u1EC7`}case"not_multiple_of":return`S\u1ED1 kh\xF4ng h\u1EE3p l\u1EC7: ph\u1EA3i l\xE0 b\u1ED9i s\u1ED1 c\u1EE7a ${i.divisor}`;case"unrecognized_keys":return`Kh\xF3a kh\xF4ng \u0111\u01B0\u1EE3c nh\u1EADn d\u1EA1ng: ${$(i.keys,", ")}`;case"invalid_key":return`Kh\xF3a kh\xF4ng h\u1EE3p l\u1EC7 trong ${i.origin}`;case"invalid_union":return"\u0110\u1EA7u v\xE0o kh\xF4ng h\u1EE3p l\u1EC7";case"invalid_element":return`Gi\xE1 tr\u1ECB kh\xF4ng h\u1EE3p l\u1EC7 trong ${i.origin}`;default:return"\u0110\u1EA7u v\xE0o kh\xF4ng h\u1EE3p l\u1EC7"}}};function _1(){return{localeError:m3()}}var h3=()=>{let t={string:{unit:"\u5B57\u7B26",verb:"\u5305\u542B"},file:{unit:"\u5B57\u8282",verb:"\u5305\u542B"},array:{unit:"\u9879",verb:"\u5305\u542B"},set:{unit:"\u9879",verb:"\u5305\u542B"}};function e(i){return t[i]??null}let r={regex:"\u8F93\u5165",email:"\u7535\u5B50\u90AE\u4EF6",url:"URL",emoji:"\u8868\u60C5\u7B26\u53F7",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO\u65E5\u671F\u65F6\u95F4",date:"ISO\u65E5\u671F",time:"ISO\u65F6\u95F4",duration:"ISO\u65F6\u957F",ipv4:"IPv4\u5730\u5740",ipv6:"IPv6\u5730\u5740",cidrv4:"IPv4\u7F51\u6BB5",cidrv6:"IPv6\u7F51\u6BB5",base64:"base64\u7F16\u7801\u5B57\u7B26\u4E32",base64url:"base64url\u7F16\u7801\u5B57\u7B26\u4E32",json_string:"JSON\u5B57\u7B26\u4E32",e164:"E.164\u53F7\u7801",jwt:"JWT",template_literal:"\u8F93\u5165"},n={nan:"NaN",number:"\u6570\u5B57",array:"\u6570\u7EC4",null:"\u7A7A\u503C(null)"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`\u65E0\u6548\u8F93\u5165\uFF1A\u671F\u671B instanceof ${i.expected}\uFF0C\u5B9E\u9645\u63A5\u6536 ${s}`:`\u65E0\u6548\u8F93\u5165\uFF1A\u671F\u671B ${o}\uFF0C\u5B9E\u9645\u63A5\u6536 ${s}`}case"invalid_value":return i.values.length===1?`\u65E0\u6548\u8F93\u5165\uFF1A\u671F\u671B ${j(i.values[0])}`:`\u65E0\u6548\u9009\u9879\uFF1A\u671F\u671B\u4EE5\u4E0B\u4E4B\u4E00 ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`\u6570\u503C\u8FC7\u5927\uFF1A\u671F\u671B ${i.origin??"\u503C"} ${o}${i.maximum.toString()} ${a.unit??"\u4E2A\u5143\u7D20"}`:`\u6570\u503C\u8FC7\u5927\uFF1A\u671F\u671B ${i.origin??"\u503C"} ${o}${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`\u6570\u503C\u8FC7\u5C0F\uFF1A\u671F\u671B ${i.origin} ${o}${i.minimum.toString()} ${a.unit}`:`\u6570\u503C\u8FC7\u5C0F\uFF1A\u671F\u671B ${i.origin} ${o}${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`\u65E0\u6548\u5B57\u7B26\u4E32\uFF1A\u5FC5\u987B\u4EE5 "${o.prefix}" \u5F00\u5934`:o.format==="ends_with"?`\u65E0\u6548\u5B57\u7B26\u4E32\uFF1A\u5FC5\u987B\u4EE5 "${o.suffix}" \u7ED3\u5C3E`:o.format==="includes"?`\u65E0\u6548\u5B57\u7B26\u4E32\uFF1A\u5FC5\u987B\u5305\u542B "${o.includes}"`:o.format==="regex"?`\u65E0\u6548\u5B57\u7B26\u4E32\uFF1A\u5FC5\u987B\u6EE1\u8DB3\u6B63\u5219\u8868\u8FBE\u5F0F ${o.pattern}`:`\u65E0\u6548${r[o.format]??i.format}`}case"not_multiple_of":return`\u65E0\u6548\u6570\u5B57\uFF1A\u5FC5\u987B\u662F ${i.divisor} \u7684\u500D\u6570`;case"unrecognized_keys":return`\u51FA\u73B0\u672A\u77E5\u7684\u952E(key): ${$(i.keys,", ")}`;case"invalid_key":return`${i.origin} \u4E2D\u7684\u952E(key)\u65E0\u6548`;case"invalid_union":return"\u65E0\u6548\u8F93\u5165";case"invalid_element":return`${i.origin} \u4E2D\u5305\u542B\u65E0\u6548\u503C(value)`;default:return"\u65E0\u6548\u8F93\u5165"}}};function y1(){return{localeError:h3()}}var g3=()=>{let t={string:{unit:"\u5B57\u5143",verb:"\u64C1\u6709"},file:{unit:"\u4F4D\u5143\u7D44",verb:"\u64C1\u6709"},array:{unit:"\u9805\u76EE",verb:"\u64C1\u6709"},set:{unit:"\u9805\u76EE",verb:"\u64C1\u6709"}};function e(i){return t[i]??null}let r={regex:"\u8F38\u5165",email:"\u90F5\u4EF6\u5730\u5740",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO \u65E5\u671F\u6642\u9593",date:"ISO \u65E5\u671F",time:"ISO \u6642\u9593",duration:"ISO \u671F\u9593",ipv4:"IPv4 \u4F4D\u5740",ipv6:"IPv6 \u4F4D\u5740",cidrv4:"IPv4 \u7BC4\u570D",cidrv6:"IPv6 \u7BC4\u570D",base64:"base64 \u7DE8\u78BC\u5B57\u4E32",base64url:"base64url \u7DE8\u78BC\u5B57\u4E32",json_string:"JSON \u5B57\u4E32",e164:"E.164 \u6578\u503C",jwt:"JWT",template_literal:"\u8F38\u5165"},n={nan:"NaN"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`\u7121\u6548\u7684\u8F38\u5165\u503C\uFF1A\u9810\u671F\u70BA instanceof ${i.expected}\uFF0C\u4F46\u6536\u5230 ${s}`:`\u7121\u6548\u7684\u8F38\u5165\u503C\uFF1A\u9810\u671F\u70BA ${o}\uFF0C\u4F46\u6536\u5230 ${s}`}case"invalid_value":return i.values.length===1?`\u7121\u6548\u7684\u8F38\u5165\u503C\uFF1A\u9810\u671F\u70BA ${j(i.values[0])}`:`\u7121\u6548\u7684\u9078\u9805\uFF1A\u9810\u671F\u70BA\u4EE5\u4E0B\u5176\u4E2D\u4E4B\u4E00 ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`\u6578\u503C\u904E\u5927\uFF1A\u9810\u671F ${i.origin??"\u503C"} \u61C9\u70BA ${o}${i.maximum.toString()} ${a.unit??"\u500B\u5143\u7D20"}`:`\u6578\u503C\u904E\u5927\uFF1A\u9810\u671F ${i.origin??"\u503C"} \u61C9\u70BA ${o}${i.maximum.toString()}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`\u6578\u503C\u904E\u5C0F\uFF1A\u9810\u671F ${i.origin} \u61C9\u70BA ${o}${i.minimum.toString()} ${a.unit}`:`\u6578\u503C\u904E\u5C0F\uFF1A\u9810\u671F ${i.origin} \u61C9\u70BA ${o}${i.minimum.toString()}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`\u7121\u6548\u7684\u5B57\u4E32\uFF1A\u5FC5\u9808\u4EE5 "${o.prefix}" \u958B\u982D`:o.format==="ends_with"?`\u7121\u6548\u7684\u5B57\u4E32\uFF1A\u5FC5\u9808\u4EE5 "${o.suffix}" \u7D50\u5C3E`:o.format==="includes"?`\u7121\u6548\u7684\u5B57\u4E32\uFF1A\u5FC5\u9808\u5305\u542B "${o.includes}"`:o.format==="regex"?`\u7121\u6548\u7684\u5B57\u4E32\uFF1A\u5FC5\u9808\u7B26\u5408\u683C\u5F0F ${o.pattern}`:`\u7121\u6548\u7684 ${r[o.format]??i.format}`}case"not_multiple_of":return`\u7121\u6548\u7684\u6578\u5B57\uFF1A\u5FC5\u9808\u70BA ${i.divisor} \u7684\u500D\u6578`;case"unrecognized_keys":return`\u7121\u6CD5\u8B58\u5225\u7684\u9375\u503C${i.keys.length>1?"\u5011":""}\uFF1A${$(i.keys,"\u3001")}`;case"invalid_key":return`${i.origin} \u4E2D\u6709\u7121\u6548\u7684\u9375\u503C`;case"invalid_union":return"\u7121\u6548\u7684\u8F38\u5165\u503C";case"invalid_element":return`${i.origin} \u4E2D\u6709\u7121\u6548\u7684\u503C`;default:return"\u7121\u6548\u7684\u8F38\u5165\u503C"}}};function v1(){return{localeError:g3()}}var _3=()=>{let t={string:{unit:"\xE0mi",verb:"n\xED"},file:{unit:"bytes",verb:"n\xED"},array:{unit:"nkan",verb:"n\xED"},set:{unit:"nkan",verb:"n\xED"}};function e(i){return t[i]??null}let r={regex:"\u1EB9\u0300r\u1ECD \xECb\xE1w\u1ECDl\xE9",email:"\xE0d\xEDr\u1EB9\u0301s\xEC \xECm\u1EB9\u0301l\xEC",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"\xE0k\xF3k\xF2 ISO",date:"\u1ECDj\u1ECD\u0301 ISO",time:"\xE0k\xF3k\xF2 ISO",duration:"\xE0k\xF3k\xF2 t\xF3 p\xE9 ISO",ipv4:"\xE0d\xEDr\u1EB9\u0301s\xEC IPv4",ipv6:"\xE0d\xEDr\u1EB9\u0301s\xEC IPv6",cidrv4:"\xE0gb\xE8gb\xE8 IPv4",cidrv6:"\xE0gb\xE8gb\xE8 IPv6",base64:"\u1ECD\u0300r\u1ECD\u0300 t\xED a k\u1ECD\u0301 n\xED base64",base64url:"\u1ECD\u0300r\u1ECD\u0300 base64url",json_string:"\u1ECD\u0300r\u1ECD\u0300 JSON",e164:"n\u1ECD\u0301mb\xE0 E.164",jwt:"JWT",template_literal:"\u1EB9\u0300r\u1ECD \xECb\xE1w\u1ECDl\xE9"},n={nan:"NaN",number:"n\u1ECD\u0301mb\xE0",array:"akop\u1ECD"};return i=>{switch(i.code){case"invalid_type":{let o=n[i.expected]??i.expected,a=B(i.input),s=n[a]??a;return/^[A-Z]/.test(i.expected)?`\xCCb\xE1w\u1ECDl\xE9 a\u1E63\xEC\u1E63e: a n\xED l\xE1ti fi instanceof ${i.expected}, \xE0m\u1ECD\u0300 a r\xED ${s}`:`\xCCb\xE1w\u1ECDl\xE9 a\u1E63\xEC\u1E63e: a n\xED l\xE1ti fi ${o}, \xE0m\u1ECD\u0300 a r\xED ${s}`}case"invalid_value":return i.values.length===1?`\xCCb\xE1w\u1ECDl\xE9 a\u1E63\xEC\u1E63e: a n\xED l\xE1ti fi ${j(i.values[0])}`:`\xC0\u1E63\xE0y\xE0n a\u1E63\xEC\u1E63e: yan \u1ECD\u0300kan l\xE1ra ${$(i.values,"|")}`;case"too_big":{let o=i.inclusive?"<=":"<",a=e(i.origin);return a?`T\xF3 p\u1ECD\u0300 j\xF9: a n\xED l\xE1ti j\u1EB9\u0301 p\xE9 ${i.origin??"iye"} ${a.verb} ${o}${i.maximum} ${a.unit}`:`T\xF3 p\u1ECD\u0300 j\xF9: a n\xED l\xE1ti j\u1EB9\u0301 ${o}${i.maximum}`}case"too_small":{let o=i.inclusive?">=":">",a=e(i.origin);return a?`K\xE9r\xE9 ju: a n\xED l\xE1ti j\u1EB9\u0301 p\xE9 ${i.origin} ${a.verb} ${o}${i.minimum} ${a.unit}`:`K\xE9r\xE9 ju: a n\xED l\xE1ti j\u1EB9\u0301 ${o}${i.minimum}`}case"invalid_format":{let o=i;return o.format==="starts_with"?`\u1ECC\u0300r\u1ECD\u0300 a\u1E63\xEC\u1E63e: gb\u1ECD\u0301d\u1ECD\u0300 b\u1EB9\u0300r\u1EB9\u0300 p\u1EB9\u0300l\xFA "${o.prefix}"`:o.format==="ends_with"?`\u1ECC\u0300r\u1ECD\u0300 a\u1E63\xEC\u1E63e: gb\u1ECD\u0301d\u1ECD\u0300 par\xED p\u1EB9\u0300l\xFA "${o.suffix}"`:o.format==="includes"?`\u1ECC\u0300r\u1ECD\u0300 a\u1E63\xEC\u1E63e: gb\u1ECD\u0301d\u1ECD\u0300 n\xED "${o.includes}"`:o.format==="regex"?`\u1ECC\u0300r\u1ECD\u0300 a\u1E63\xEC\u1E63e: gb\u1ECD\u0301d\u1ECD\u0300 b\xE1 \xE0p\u1EB9\u1EB9r\u1EB9 mu ${o.pattern}`:`A\u1E63\xEC\u1E63e: ${r[o.format]??i.format}`}case"not_multiple_of":return`N\u1ECD\u0301mb\xE0 a\u1E63\xEC\u1E63e: gb\u1ECD\u0301d\u1ECD\u0300 j\u1EB9\u0301 \xE8y\xE0 p\xEDp\xEDn ti ${i.divisor}`;case"unrecognized_keys":return`B\u1ECDt\xECn\xEC \xE0\xECm\u1ECD\u0300: ${$(i.keys,", ")}`;case"invalid_key":return`B\u1ECDt\xECn\xEC a\u1E63\xEC\u1E63e n\xEDn\xFA ${i.origin}`;case"invalid_union":return"\xCCb\xE1w\u1ECDl\xE9 a\u1E63\xEC\u1E63e";case"invalid_element":return`Iye a\u1E63\xEC\u1E63e n\xEDn\xFA ${i.origin}`;default:return"\xCCb\xE1w\u1ECDl\xE9 a\u1E63\xEC\u1E63e"}}};function b1(){return{localeError:_3()}}var w1,_0=Symbol("ZodOutput"),y0=Symbol("ZodInput"),Ph=class{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...r){let n=r[0];return this._map.set(e,n),n&&typeof n=="object"&&"id"in n&&this._idmap.set(n.id,e),this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(e){let r=this._map.get(e);return r&&typeof r=="object"&&"id"in r&&this._idmap.delete(r.id),this._map.delete(e),this}get(e){let r=e._zod.parent;if(r){let n={...this.get(r)??{}};delete n.id;let i={...n,...this._map.get(e)};return Object.keys(i).length?i:void 0}return this._map.get(e)}has(e){return this._map.has(e)}};function Nh(){return new Ph}(w1=globalThis).__zod_globalRegistry??(w1.__zod_globalRegistry=Nh());var qe=globalThis.__zod_globalRegistry;function v0(t,e){return new t({type:"string",...Z(e)})}function b0(t,e){return new t({type:"string",coerce:!0,...Z(e)})}function Rh(t,e){return new t({type:"string",format:"email",check:"string_format",abort:!1,...Z(e)})}function Jp(t,e){return new t({type:"string",format:"guid",check:"string_format",abort:!1,...Z(e)})}function Mh(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,...Z(e)})}function zh(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...Z(e)})}function jh(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...Z(e)})}function Dh(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...Z(e)})}function Xp(t,e){return new t({type:"string",format:"url",check:"string_format",abort:!1,...Z(e)})}function Lh(t,e){return new t({type:"string",format:"emoji",check:"string_format",abort:!1,...Z(e)})}function Uh(t,e){return new t({type:"string",format:"nanoid",check:"string_format",abort:!1,...Z(e)})}function Fh(t,e){return new t({type:"string",format:"cuid",check:"string_format",abort:!1,...Z(e)})}function Bh(t,e){return new t({type:"string",format:"cuid2",check:"string_format",abort:!1,...Z(e)})}function Vh(t,e){return new t({type:"string",format:"ulid",check:"string_format",abort:!1,...Z(e)})}function Zh(t,e){return new t({type:"string",format:"xid",check:"string_format",abort:!1,...Z(e)})}function Gh(t,e){return new t({type:"string",format:"ksuid",check:"string_format",abort:!1,...Z(e)})}function Hh(t,e){return new t({type:"string",format:"ipv4",check:"string_format",abort:!1,...Z(e)})}function qh(t,e){return new t({type:"string",format:"ipv6",check:"string_format",abort:!1,...Z(e)})}function w0(t,e){return new t({type:"string",format:"mac",check:"string_format",abort:!1,...Z(e)})}function Kh(t,e){return new t({type:"string",format:"cidrv4",check:"string_format",abort:!1,...Z(e)})}function Wh(t,e){return new t({type:"string",format:"cidrv6",check:"string_format",abort:!1,...Z(e)})}function Jh(t,e){return new t({type:"string",format:"base64",check:"string_format",abort:!1,...Z(e)})}function Xh(t,e){return new t({type:"string",format:"base64url",check:"string_format",abort:!1,...Z(e)})}function Yh(t,e){return new t({type:"string",format:"e164",check:"string_format",abort:!1,...Z(e)})}function Qh(t,e){return new t({type:"string",format:"jwt",check:"string_format",abort:!1,...Z(e)})}var x0={Any:null,Minute:-1,Second:0,Millisecond:3,Microsecond:6};function S0(t,e){return new t({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...Z(e)})}function I0(t,e){return new t({type:"string",format:"date",check:"string_format",...Z(e)})}function k0(t,e){return new t({type:"string",format:"time",check:"string_format",precision:null,...Z(e)})}function E0(t,e){return new t({type:"string",format:"duration",check:"string_format",...Z(e)})}function A0(t,e){return new t({type:"number",checks:[],...Z(e)})}function T0(t,e){return new t({type:"number",coerce:!0,checks:[],...Z(e)})}function $0(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"safeint",...Z(e)})}function O0(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"float32",...Z(e)})}function C0(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"float64",...Z(e)})}function P0(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"int32",...Z(e)})}function N0(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"uint32",...Z(e)})}function R0(t,e){return new t({type:"boolean",...Z(e)})}function M0(t,e){return new t({type:"boolean",coerce:!0,...Z(e)})}function z0(t,e){return new t({type:"bigint",...Z(e)})}function j0(t,e){return new t({type:"bigint",coerce:!0,...Z(e)})}function D0(t,e){return new t({type:"bigint",check:"bigint_format",abort:!1,format:"int64",...Z(e)})}function L0(t,e){return new t({type:"bigint",check:"bigint_format",abort:!1,format:"uint64",...Z(e)})}function U0(t,e){return new t({type:"symbol",...Z(e)})}function F0(t,e){return new t({type:"undefined",...Z(e)})}function B0(t,e){return new t({type:"null",...Z(e)})}function V0(t){return new t({type:"any"})}function Yp(t){return new t({type:"unknown"})}function Qp(t,e){return new t({type:"never",...Z(e)})}function Z0(t,e){return new t({type:"void",...Z(e)})}function G0(t,e){return new t({type:"date",...Z(e)})}function H0(t,e){return new t({type:"date",coerce:!0,...Z(e)})}function q0(t,e){return new t({type:"nan",...Z(e)})}function Ei(t,e){return new vh({check:"less_than",...Z(e),value:t,inclusive:!1})}function nn(t,e){return new vh({check:"less_than",...Z(e),value:t,inclusive:!0})}function Ai(t,e){return new bh({check:"greater_than",...Z(e),value:t,inclusive:!1})}function Ir(t,e){return new bh({check:"greater_than",...Z(e),value:t,inclusive:!0})}function eg(t){return Ai(0,t)}function tg(t){return Ei(0,t)}function rg(t){return nn(0,t)}function ng(t){return Ir(0,t)}function ha(t,e){return new Zw({check:"multiple_of",...Z(e),value:t})}function ga(t,e){return new qw({check:"max_size",...Z(e),maximum:t})}function Ti(t,e){return new Kw({check:"min_size",...Z(e),minimum:t})}function _s(t,e){return new Ww({check:"size_equals",...Z(e),size:t})}function ys(t,e){return new Jw({check:"max_length",...Z(e),maximum:t})}function go(t,e){return new Xw({check:"min_length",...Z(e),minimum:t})}function vs(t,e){return new Yw({check:"length_equals",...Z(e),length:t})}function Xc(t,e){return new Qw({check:"string_format",format:"regex",...Z(e),pattern:t})}function Yc(t){return new ex({check:"string_format",format:"lowercase",...Z(t)})}function Qc(t){return new tx({check:"string_format",format:"uppercase",...Z(t)})}function eu(t,e){return new rx({check:"string_format",format:"includes",...Z(e),includes:t})}function tu(t,e){return new nx({check:"string_format",format:"starts_with",...Z(e),prefix:t})}function ru(t,e){return new ix({check:"string_format",format:"ends_with",...Z(e),suffix:t})}function ig(t,e,r){return new ox({check:"property",property:t,schema:e,...Z(r)})}function nu(t,e){return new ax({check:"mime_type",mime:t,...Z(e)})}function Zn(t){return new sx({check:"overwrite",tx:t})}function iu(t){return Zn(e=>e.normalize(t))}function ou(){return Zn(t=>t.trim())}function au(){return Zn(t=>t.toLowerCase())}function su(){return Zn(t=>t.toUpperCase())}function cu(){return Zn(t=>ow(t))}function K0(t,e,r){return new t({type:"array",element:e,...Z(r)})}function v3(t,e,r){return new t({type:"union",options:e,...Z(r)})}function b3(t,e,r){return new t({type:"union",options:e,inclusive:!1,...Z(r)})}function w3(t,e,r,n){return new t({type:"union",options:r,discriminator:e,...Z(n)})}function x3(t,e,r){return new t({type:"intersection",left:e,right:r})}function S3(t,e,r,n){let i=r instanceof we,o=i?n:r,a=i?r:null;return new t({type:"tuple",items:e,rest:a,...Z(o)})}function I3(t,e,r,n){return new t({type:"record",keyType:e,valueType:r,...Z(n)})}function k3(t,e,r,n){return new t({type:"map",keyType:e,valueType:r,...Z(n)})}function E3(t,e,r){return new t({type:"set",valueType:e,...Z(r)})}function A3(t,e,r){let n=Array.isArray(e)?Object.fromEntries(e.map(i=>[i,i])):e;return new t({type:"enum",entries:n,...Z(r)})}function T3(t,e,r){return new t({type:"enum",entries:e,...Z(r)})}function $3(t,e,r){return new t({type:"literal",values:Array.isArray(e)?e:[e],...Z(r)})}function W0(t,e){return new t({type:"file",...Z(e)})}function O3(t,e){return new t({type:"transform",transform:e})}function C3(t,e){return new t({type:"optional",innerType:e})}function P3(t,e){return new t({type:"nullable",innerType:e})}function N3(t,e,r){return new t({type:"default",innerType:e,get defaultValue(){return typeof r=="function"?r():sw(r)}})}function R3(t,e,r){return new t({type:"nonoptional",innerType:e,...Z(r)})}function M3(t,e){return new t({type:"success",innerType:e})}function z3(t,e,r){return new t({type:"catch",innerType:e,catchValue:typeof r=="function"?r:()=>r})}function j3(t,e,r){return new t({type:"pipe",in:e,out:r})}function D3(t,e){return new t({type:"readonly",innerType:e})}function L3(t,e,r){return new t({type:"template_literal",parts:e,...Z(r)})}function U3(t,e){return new t({type:"lazy",getter:e})}function F3(t,e){return new t({type:"promise",innerType:e})}function J0(t,e,r){let n=Z(r);return n.abort??(n.abort=!0),new t({type:"custom",check:"custom",fn:e,...n})}function X0(t,e,r){return new t({type:"custom",check:"custom",fn:e,...Z(r)})}function Y0(t){let e=x1(r=>(r.addIssue=n=>{if(typeof n=="string")r.issues.push(Zc(n,r.value,e._zod.def));else{let i=n;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=r.value),i.inst??(i.inst=e),i.continue??(i.continue=!e._zod.def.abort),r.issues.push(Zc(i))}},t(r.value,r)));return e}function x1(t,e){let r=new tt({check:"custom",...Z(e)});return r._zod.check=t,r}function Q0(t){let e=new tt({check:"describe"});return e._zod.onattach=[r=>{let n=qe.get(r)??{};qe.add(r,{...n,description:t})}],e._zod.check=()=>{},e}function eS(t){let e=new tt({check:"meta"});return e._zod.onattach=[r=>{let n=qe.get(r)??{};qe.add(r,{...n,...t})}],e._zod.check=()=>{},e}function tS(t,e){let r=Z(e),n=r.truthy??["true","1","yes","on","y","enabled"],i=r.falsy??["false","0","no","off","n","disabled"];r.case!=="sensitive"&&(n=n.map(m=>typeof m=="string"?m.toLowerCase():m),i=i.map(m=>typeof m=="string"?m.toLowerCase():m));let o=new Set(n),a=new Set(i),s=t.Codec??qp,c=t.Boolean??Vp,u=t.String??hs,l=new u({type:"string",error:r.error}),p=new c({type:"boolean",error:r.error}),f=new s({type:"pipe",in:l,out:p,transform:((m,h)=>{let g=m;return r.case!=="sensitive"&&(g=g.toLowerCase()),o.has(g)?!0:a.has(g)?!1:(h.issues.push({code:"invalid_value",expected:"stringbool",values:[...o,...a],input:h.value,inst:f,continue:!1}),{})}),reverseTransform:((m,h)=>m===!0?n[0]||"true":i[0]||"false"),error:r.error});return f}function uu(t,e,r,n={}){let i=Z(n),o={...Z(n),check:"string_format",type:"string",format:e,fn:typeof r=="function"?r:s=>r.test(s),...i};return r instanceof RegExp&&(o.pattern=r),new t(o)}function _a(t){let e=t?.target??"draft-2020-12";return e==="draft-4"&&(e="draft-04"),e==="draft-7"&&(e="draft-07"),{processors:t.processors??{},metadataRegistry:t?.metadata??qe,target:e,unrepresentable:t?.unrepresentable??"throw",override:t?.override??(()=>{}),io:t?.io??"output",counter:0,seen:new Map,cycles:t?.cycles??"ref",reused:t?.reused??"inline",external:t?.external??void 0}}function Je(t,e,r={path:[],schemaPath:[]}){var n;let i=t._zod.def,o=e.seen.get(t);if(o)return o.count++,r.schemaPath.includes(t)&&(o.cycle=r.path),o.schema;let a={schema:{},count:1,cycle:void 0,path:r.path};e.seen.set(t,a);let s=t._zod.toJSONSchema?.();if(s)a.schema=s;else{let l={...r,schemaPath:[...r.schemaPath,t],path:r.path};if(t._zod.processJSONSchema)t._zod.processJSONSchema(e,a.schema,l);else{let f=a.schema,m=e.processors[i.type];if(!m)throw new Error(`[toJSONSchema]: Non-representable type encountered: ${i.type}`);m(t,e,f,l)}let p=t._zod.parent;p&&(a.ref||(a.ref=p),Je(p,e,l),e.seen.get(p).isParent=!0)}let c=e.metadataRegistry.get(t);return c&&Object.assign(a.schema,c),e.io==="input"&&kr(t)&&(delete a.schema.examples,delete a.schema.default),e.io==="input"&&a.schema._prefault&&((n=a.schema).default??(n.default=a.schema._prefault)),delete a.schema._prefault,e.seen.get(t).schema}function ya(t,e){let r=t.seen.get(e);if(!r)throw new Error("Unprocessed schema. This is a bug in Zod.");let n=new Map;for(let a of t.seen.entries()){let s=t.metadataRegistry.get(a[0])?.id;if(s){let c=n.get(s);if(c&&c!==a[0])throw new Error(`Duplicate schema id "${s}" detected during JSON Schema conversion. Two different schemas cannot share the same id when converted together.`);n.set(s,a[0])}}let i=a=>{let s=t.target==="draft-2020-12"?"$defs":"definitions";if(t.external){let p=t.external.registry.get(a[0])?.id,f=t.external.uri??(h=>h);if(p)return{ref:f(p)};let m=a[1].defId??a[1].schema.id??`schema${t.counter++}`;return a[1].defId=m,{defId:m,ref:`${f("__shared")}#/${s}/${m}`}}if(a[1]===r)return{ref:"#"};let u=`#/${s}/`,l=a[1].schema.id??`__schema${t.counter++}`;return{defId:l,ref:u+l}},o=a=>{if(a[1].schema.$ref)return;let s=a[1],{ref:c,defId:u}=i(a);s.def={...s.schema},u&&(s.defId=u);let l=s.schema;for(let p in l)delete l[p];l.$ref=c};if(t.cycles==="throw")for(let a of t.seen.entries()){let s=a[1];if(s.cycle)throw new Error(`Cycle detected: #/${s.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(let a of t.seen.entries()){let s=a[1];if(e===a[0]){o(a);continue}if(t.external){let u=t.external.registry.get(a[0])?.id;if(e!==a[0]&&u){o(a);continue}}if(t.metadataRegistry.get(a[0])?.id){o(a);continue}if(s.cycle){o(a);continue}if(s.count>1&&t.reused==="ref"){o(a);continue}}}function va(t,e){let r=t.seen.get(e);if(!r)throw new Error("Unprocessed schema. This is a bug in Zod.");let n=a=>{let s=t.seen.get(a);if(s.ref===null)return;let c=s.def??s.schema,u={...c},l=s.ref;if(s.ref=null,l){n(l);let f=t.seen.get(l),m=f.schema;if(m.$ref&&(t.target==="draft-07"||t.target==="draft-04"||t.target==="openapi-3.0")?(c.allOf=c.allOf??[],c.allOf.push(m)):Object.assign(c,m),Object.assign(c,u),a._zod.parent===l)for(let g in c)g==="$ref"||g==="allOf"||g in u||delete c[g];if(m.$ref)for(let g in c)g==="$ref"||g==="allOf"||g in f.def&&JSON.stringify(c[g])===JSON.stringify(f.def[g])&&delete c[g]}let p=a._zod.parent;if(p&&p!==l){n(p);let f=t.seen.get(p);if(f?.schema.$ref&&(c.$ref=f.schema.$ref,f.def))for(let m in c)m==="$ref"||m==="allOf"||m in f.def&&JSON.stringify(c[m])===JSON.stringify(f.def[m])&&delete c[m]}t.override({zodSchema:a,jsonSchema:c,path:s.path??[]})};for(let a of[...t.seen.entries()].reverse())n(a[0]);let i={};if(t.target==="draft-2020-12"?i.$schema="https://json-schema.org/draft/2020-12/schema":t.target==="draft-07"?i.$schema="http://json-schema.org/draft-07/schema#":t.target==="draft-04"?i.$schema="http://json-schema.org/draft-04/schema#":t.target,t.external?.uri){let a=t.external.registry.get(e)?.id;if(!a)throw new Error("Schema is missing an `id` property");i.$id=t.external.uri(a)}Object.assign(i,r.def??r.schema);let o=t.external?.defs??{};for(let a of t.seen.entries()){let s=a[1];s.def&&s.defId&&(o[s.defId]=s.def)}t.external||Object.keys(o).length>0&&(t.target==="draft-2020-12"?i.$defs=o:i.definitions=o);try{let a=JSON.parse(JSON.stringify(i));return Object.defineProperty(a,"~standard",{value:{...e["~standard"],jsonSchema:{input:lu(e,"input",t.processors),output:lu(e,"output",t.processors)}},enumerable:!1,writable:!1}),a}catch{throw new Error("Error converting schema to JSON.")}}function kr(t,e){let r=e??{seen:new Set};if(r.seen.has(t))return!1;r.seen.add(t);let n=t._zod.def;if(n.type==="transform")return!0;if(n.type==="array")return kr(n.element,r);if(n.type==="set")return kr(n.valueType,r);if(n.type==="lazy")return kr(n.getter(),r);if(n.type==="promise"||n.type==="optional"||n.type==="nonoptional"||n.type==="nullable"||n.type==="readonly"||n.type==="default"||n.type==="prefault")return kr(n.innerType,r);if(n.type==="intersection")return kr(n.left,r)||kr(n.right,r);if(n.type==="record"||n.type==="map")return kr(n.keyType,r)||kr(n.valueType,r);if(n.type==="pipe")return kr(n.in,r)||kr(n.out,r);if(n.type==="object"){for(let i in n.shape)if(kr(n.shape[i],r))return!0;return!1}if(n.type==="union"){for(let i of n.options)if(kr(i,r))return!0;return!1}if(n.type==="tuple"){for(let i of n.items)if(kr(i,r))return!0;return!!(n.rest&&kr(n.rest,r))}return!1}var rS=(t,e={})=>r=>{let n=_a({...r,processors:e});return Je(t,n),ya(n,t),va(n,t)},lu=(t,e,r={})=>n=>{let{libraryOptions:i,target:o}=n??{},a=_a({...i??{},target:o,io:e,processors:r});return Je(t,a),ya(a,t),va(a,t)};var B3={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},nS=(t,e,r,n)=>{let i=r;i.type="string";let{minimum:o,maximum:a,format:s,patterns:c,contentEncoding:u}=t._zod.bag;if(typeof o=="number"&&(i.minLength=o),typeof a=="number"&&(i.maxLength=a),s&&(i.format=B3[s]??s,i.format===""&&delete i.format,s==="time"&&delete i.format),u&&(i.contentEncoding=u),c&&c.size>0){let l=[...c];l.length===1?i.pattern=l[0].source:l.length>1&&(i.allOf=[...l.map(p=>({...e.target==="draft-07"||e.target==="draft-04"||e.target==="openapi-3.0"?{type:"string"}:{},pattern:p.source}))])}},iS=(t,e,r,n)=>{let i=r,{minimum:o,maximum:a,format:s,multipleOf:c,exclusiveMaximum:u,exclusiveMinimum:l}=t._zod.bag;typeof s=="string"&&s.includes("int")?i.type="integer":i.type="number",typeof l=="number"&&(e.target==="draft-04"||e.target==="openapi-3.0"?(i.minimum=l,i.exclusiveMinimum=!0):i.exclusiveMinimum=l),typeof o=="number"&&(i.minimum=o,typeof l=="number"&&e.target!=="draft-04"&&(l>=o?delete i.minimum:delete i.exclusiveMinimum)),typeof u=="number"&&(e.target==="draft-04"||e.target==="openapi-3.0"?(i.maximum=u,i.exclusiveMaximum=!0):i.exclusiveMaximum=u),typeof a=="number"&&(i.maximum=a,typeof u=="number"&&e.target!=="draft-04"&&(u<=a?delete i.maximum:delete i.exclusiveMaximum)),typeof c=="number"&&(i.multipleOf=c)},oS=(t,e,r,n)=>{r.type="boolean"},aS=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema")},sS=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema")},cS=(t,e,r,n)=>{e.target==="openapi-3.0"?(r.type="string",r.nullable=!0,r.enum=[null]):r.type="null"},uS=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema")},lS=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema")},pS=(t,e,r,n)=>{r.not={}},dS=(t,e,r,n)=>{},fS=(t,e,r,n)=>{},mS=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema")},hS=(t,e,r,n)=>{let i=t._zod.def,o=Pp(i.entries);o.every(a=>typeof a=="number")&&(r.type="number"),o.every(a=>typeof a=="string")&&(r.type="string"),r.enum=o},gS=(t,e,r,n)=>{let i=t._zod.def,o=[];for(let a of i.values)if(a===void 0){if(e.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof a=="bigint"){if(e.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");o.push(Number(a))}else o.push(a);if(o.length!==0)if(o.length===1){let a=o[0];r.type=a===null?"null":typeof a,e.target==="draft-04"||e.target==="openapi-3.0"?r.enum=[a]:r.const=a}else o.every(a=>typeof a=="number")&&(r.type="number"),o.every(a=>typeof a=="string")&&(r.type="string"),o.every(a=>typeof a=="boolean")&&(r.type="boolean"),o.every(a=>a===null)&&(r.type="null"),r.enum=o},_S=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema")},yS=(t,e,r,n)=>{let i=r,o=t._zod.pattern;if(!o)throw new Error("Pattern not found in template literal");i.type="string",i.pattern=o.source},vS=(t,e,r,n)=>{let i=r,o={type:"string",format:"binary",contentEncoding:"binary"},{minimum:a,maximum:s,mime:c}=t._zod.bag;a!==void 0&&(o.minLength=a),s!==void 0&&(o.maxLength=s),c?c.length===1?(o.contentMediaType=c[0],Object.assign(i,o)):(Object.assign(i,o),i.anyOf=c.map(u=>({contentMediaType:u}))):Object.assign(i,o)},bS=(t,e,r,n)=>{r.type="boolean"},wS=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema")},xS=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Function types cannot be represented in JSON Schema")},SS=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema")},IS=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema")},kS=(t,e,r,n)=>{if(e.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema")},ES=(t,e,r,n)=>{let i=r,o=t._zod.def,{minimum:a,maximum:s}=t._zod.bag;typeof a=="number"&&(i.minItems=a),typeof s=="number"&&(i.maxItems=s),i.type="array",i.items=Je(o.element,e,{...n,path:[...n.path,"items"]})},AS=(t,e,r,n)=>{let i=r,o=t._zod.def;i.type="object",i.properties={};let a=o.shape;for(let u in a)i.properties[u]=Je(a[u],e,{...n,path:[...n.path,"properties",u]});let s=new Set(Object.keys(a)),c=new Set([...s].filter(u=>{let l=o.shape[u]._zod;return e.io==="input"?l.optin===void 0:l.optout===void 0}));c.size>0&&(i.required=Array.from(c)),o.catchall?._zod.def.type==="never"?i.additionalProperties=!1:o.catchall?o.catchall&&(i.additionalProperties=Je(o.catchall,e,{...n,path:[...n.path,"additionalProperties"]})):e.io==="output"&&(i.additionalProperties=!1)},ag=(t,e,r,n)=>{let i=t._zod.def,o=i.inclusive===!1,a=i.options.map((s,c)=>Je(s,e,{...n,path:[...n.path,o?"oneOf":"anyOf",c]}));o?r.oneOf=a:r.anyOf=a},TS=(t,e,r,n)=>{let i=t._zod.def,o=Je(i.left,e,{...n,path:[...n.path,"allOf",0]}),a=Je(i.right,e,{...n,path:[...n.path,"allOf",1]}),s=u=>"allOf"in u&&Object.keys(u).length===1,c=[...s(o)?o.allOf:[o],...s(a)?a.allOf:[a]];r.allOf=c},$S=(t,e,r,n)=>{let i=r,o=t._zod.def;i.type="array";let a=e.target==="draft-2020-12"?"prefixItems":"items",s=e.target==="draft-2020-12"||e.target==="openapi-3.0"?"items":"additionalItems",c=o.items.map((f,m)=>Je(f,e,{...n,path:[...n.path,a,m]})),u=o.rest?Je(o.rest,e,{...n,path:[...n.path,s,...e.target==="openapi-3.0"?[o.items.length]:[]]}):null;e.target==="draft-2020-12"?(i.prefixItems=c,u&&(i.items=u)):e.target==="openapi-3.0"?(i.items={anyOf:c},u&&i.items.anyOf.push(u),i.minItems=c.length,u||(i.maxItems=c.length)):(i.items=c,u&&(i.additionalItems=u));let{minimum:l,maximum:p}=t._zod.bag;typeof l=="number"&&(i.minItems=l),typeof p=="number"&&(i.maxItems=p)},OS=(t,e,r,n)=>{let i=r,o=t._zod.def;i.type="object";let a=o.keyType,c=a._zod.bag?.patterns;if(o.mode==="loose"&&c&&c.size>0){let l=Je(o.valueType,e,{...n,path:[...n.path,"patternProperties","*"]});i.patternProperties={};for(let p of c)i.patternProperties[p.source]=l}else(e.target==="draft-07"||e.target==="draft-2020-12")&&(i.propertyNames=Je(o.keyType,e,{...n,path:[...n.path,"propertyNames"]})),i.additionalProperties=Je(o.valueType,e,{...n,path:[...n.path,"additionalProperties"]});let u=a._zod.values;if(u){let l=[...u].filter(p=>typeof p=="string"||typeof p=="number");l.length>0&&(i.required=l)}},CS=(t,e,r,n)=>{let i=t._zod.def,o=Je(i.innerType,e,n),a=e.seen.get(t);e.target==="openapi-3.0"?(a.ref=i.innerType,r.nullable=!0):r.anyOf=[o,{type:"null"}]},PS=(t,e,r,n)=>{let i=t._zod.def;Je(i.innerType,e,n);let o=e.seen.get(t);o.ref=i.innerType},NS=(t,e,r,n)=>{let i=t._zod.def;Je(i.innerType,e,n);let o=e.seen.get(t);o.ref=i.innerType,r.default=JSON.parse(JSON.stringify(i.defaultValue))},RS=(t,e,r,n)=>{let i=t._zod.def;Je(i.innerType,e,n);let o=e.seen.get(t);o.ref=i.innerType,e.io==="input"&&(r._prefault=JSON.parse(JSON.stringify(i.defaultValue)))},MS=(t,e,r,n)=>{let i=t._zod.def;Je(i.innerType,e,n);let o=e.seen.get(t);o.ref=i.innerType;let a;try{a=i.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}r.default=a},zS=(t,e,r,n)=>{let i=t._zod.def,o=e.io==="input"?i.in._zod.def.type==="transform"?i.out:i.in:i.out;Je(o,e,n);let a=e.seen.get(t);a.ref=o},jS=(t,e,r,n)=>{let i=t._zod.def;Je(i.innerType,e,n);let o=e.seen.get(t);o.ref=i.innerType,r.readOnly=!0},DS=(t,e,r,n)=>{let i=t._zod.def;Je(i.innerType,e,n);let o=e.seen.get(t);o.ref=i.innerType},sg=(t,e,r,n)=>{let i=t._zod.def;Je(i.innerType,e,n);let o=e.seen.get(t);o.ref=i.innerType},LS=(t,e,r,n)=>{let i=t._zod.innerType;Je(i,e,n);let o=e.seen.get(t);o.ref=i},og={string:nS,number:iS,boolean:oS,bigint:aS,symbol:sS,null:cS,undefined:uS,void:lS,never:pS,any:dS,unknown:fS,date:mS,enum:hS,literal:gS,nan:_S,template_literal:yS,file:vS,success:bS,custom:wS,function:xS,transform:SS,map:IS,set:kS,array:ES,object:AS,union:ag,intersection:TS,tuple:$S,record:OS,nullable:CS,nonoptional:PS,default:NS,prefault:RS,catch:MS,pipe:zS,readonly:jS,promise:DS,optional:sg,lazy:LS};function _o(t,e){if("_idmap"in t){let n=t,i=_a({...e,processors:og}),o={};for(let c of n._idmap.entries()){let[u,l]=c;Je(l,i)}let a={},s={registry:n,uri:e?.uri,defs:o};i.external=s;for(let c of n._idmap.entries()){let[u,l]=c;ya(i,l),a[u]=va(i,l)}if(Object.keys(o).length>0){let c=i.target==="draft-2020-12"?"$defs":"definitions";a.__shared={[c]:o}}return{schemas:a}}let r=_a({...e,processors:og});return Je(t,r),ya(r,t),va(r,t)}var cg=class{get metadataRegistry(){return this.ctx.metadataRegistry}get target(){return this.ctx.target}get unrepresentable(){return this.ctx.unrepresentable}get override(){return this.ctx.override}get io(){return this.ctx.io}get counter(){return this.ctx.counter}set counter(e){this.ctx.counter=e}get seen(){return this.ctx.seen}constructor(e){let r=e?.target??"draft-2020-12";r==="draft-4"&&(r="draft-04"),r==="draft-7"&&(r="draft-07"),this.ctx=_a({processors:og,target:r,...e?.metadata&&{metadata:e.metadata},...e?.unrepresentable&&{unrepresentable:e.unrepresentable},...e?.override&&{override:e.override},...e?.io&&{io:e.io}})}process(e,r={path:[],schemaPath:[]}){return Je(e,this.ctx,r)}emit(e,r){r&&(r.cycles&&(this.ctx.cycles=r.cycles),r.reused&&(this.ctx.reused=r.reused),r.external&&(this.ctx.external=r.external)),ya(this.ctx,e);let n=va(this.ctx,e),{"~standard":i,...o}=n;return o}};var S1={};function rt(t){if(typeof t!="object"||t===null)return!1;let e=t;if(!("_zod"in e))return!1;let r=e._zod;return typeof r=="object"&&r!==null&&"def"in r}function lt(t){if(typeof t!="object"||t===null)return!1;let e=t;if(!("_def"in e)||"_zod"in e)return!1;let r=e._def;return typeof r=="object"&&r!=null&&"typeName"in r}function I1(t){return rt(t)&&console.warn("[WARNING] Attempting to use Zod 4 schema in a context where Zod 3 schema is expected. This may cause unexpected behavior."),lt(t)}function Er(t){return!t||typeof t!="object"||Array.isArray(t)?!1:!!(rt(t)||lt(t))}function US(t){return typeof t=="object"&&t!==null&&"_def"in t&&typeof t._def=="object"&&t._def!==null&&"typeName"in t._def&&t._def.typeName==="ZodLiteral"}function FS(t){return rt(t)?typeof t=="object"&&t!==null&&"_zod"in t&&typeof t._zod=="object"&&t._zod!==null&&"def"in t._zod&&typeof t._zod.def=="object"&&t._zod.def!==null&&"type"in t._zod.def&&t._zod.def.type==="literal":!1}function k1(t){return!!(US(t)||FS(t))}async function lg(t,e){if(rt(t))try{return{success:!0,data:await fs(t,e)}}catch(r){return{success:!1,error:r}}if(lt(t))return await t.safeParseAsync(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}async function ba(t,e){if(rt(t))return await fs(t,e);if(lt(t))return await t.parseAsync(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function E1(t,e){if(rt(t))try{return{success:!0,data:ki(t,e)}}catch(r){return{success:!1,error:r}}if(lt(t))return t.safeParse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function du(t,e){if(rt(t))return ki(t,e);if(lt(t))return t.parse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function Gn(t){if(rt(t))return qe.get(t)?.description;if(lt(t)||"description"in t&&typeof t.description=="string")return t.description}function A1(t){if(!Er(t))return!1;if(lt(t)){let e=t._def;if(e.typeName==="ZodObject"){let r=t;return!r.shape||Object.keys(r.shape).length===0}if(e.typeName==="ZodRecord")return!0}if(rt(t)){let e=t._zod.def;if(e.type==="object"){let r=t;return!r.shape||Object.keys(r.shape).length===0}if(e.type==="record")return!0}return typeof t=="object"&&t!==null&&!("shape"in t)}function fu(t){return Er(t)?lt(t)?t._def.typeName==="ZodString":rt(t)?t._zod.def.type==="string":!1:!1}function pg(t){return typeof t=="object"&&t!==null&&"_def"in t&&typeof t._def=="object"&&t._def!==null&&"typeName"in t._def&&t._def.typeName==="ZodObject"}function En(t){return rt(t)?typeof t=="object"&&t!==null&&"_zod"in t&&typeof t._zod=="object"&&t._zod!==null&&"def"in t._zod&&typeof t._zod.def=="object"&&t._zod.def!==null&&"type"in t._zod.def&&t._zod.def.type==="object":!1}function ed(t){return rt(t)?typeof t=="object"&&t!==null&&"_zod"in t&&typeof t._zod=="object"&&t._zod!==null&&"def"in t._zod&&typeof t._zod.def=="object"&&t._zod.def!==null&&"type"in t._zod.def&&t._zod.def.type==="array":!1}function BS(t){return rt(t)?typeof t=="object"&&t!==null&&"_zod"in t&&typeof t._zod=="object"&&t._zod!==null&&"def"in t._zod&&typeof t._zod.def=="object"&&t._zod.def!==null&&"type"in t._zod.def&&t._zod.def.type==="optional":!1}function VS(t){return rt(t)?typeof t=="object"&&t!==null&&"_zod"in t&&typeof t._zod=="object"&&t._zod!==null&&"def"in t._zod&&typeof t._zod.def=="object"&&t._zod.def!==null&&"type"in t._zod.def&&t._zod.def.type==="nullable":!1}function Vr(t){return!!(pg(t)||En(t))}function ws(t){if(lt(t))return t.shape;if(rt(t))return t._zod.def.shape;throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function dg(t,e){if(lt(t))return t.extend(e);if(rt(t))return D.extend(t,e);throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function mu(t){if(lt(t))return t.partial();if(rt(t))return D.partial(gs,t,void 0);throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function pu(t,e=!1){if(lt(t))return t.strict();if(En(t)){let r=t._zod.def.shape;if(e)for(let[o,a]of Object.entries(t._zod.def.shape)){if(En(a)){let c=pu(a,e);r[o]=c}else if(ed(a)){let c=a._zod.def.element;En(c)&&(c=pu(c,e)),r[o]=ut(a,{...a._zod.def,element:c})}else r[o]=a;let s=qe.get(a);s&&qe.add(r[o],s)}let n=ut(t,{...t._zod.def,shape:r,catchall:Qp(Gp)}),i=qe.get(t);return i&&qe.add(n,i),n}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function ug(t,e=!1){if(pg(t))return t.passthrough();if(En(t)){let r=t._zod.def.shape;if(e)for(let[o,a]of Object.entries(t._zod.def.shape)){if(En(a)){let c=ug(a,e);r[o]=c}else if(ed(a)){let c=a._zod.def.element;En(c)&&(c=ug(c,e)),r[o]=ut(a,{...a._zod.def,element:c})}else r[o]=a;let s=qe.get(a);s&&qe.add(r[o],s)}let n=ut(t,{...t._zod.def,shape:r,catchall:Yp(Zp)}),i=qe.get(t);return i&&qe.add(n,i),n}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function fg(t){if(lt(t))try{let e=t.parse(void 0);return()=>e}catch{return}if(rt(t))try{let e=ki(t,void 0);return()=>e}catch{return}}function Z3(t){return lt(t)&&"typeName"in t._def&&t._def.typeName==="ZodEffects"}function G3(t){return rt(t)&&t._zod.def.type==="pipe"}function bs(t,e,r){let n=r.get(t);if(n!==void 0)return n;if(lt(t))return Z3(t)?bs(t._def.schema,e,r):t;if(rt(t)){let i=t;if(G3(t)&&(i=bs(t._zod.def.in,e,r)),e){if(En(i)){let a={};for(let[s,c]of Object.entries(i._zod.def.shape))a[s]=bs(c,e,r);i=ut(i,{...i._zod.def,shape:a})}else if(ed(i)){let a=bs(i._zod.def.element,e,r);i=ut(i,{...i._zod.def,element:a})}else if(BS(i)){let a=bs(i._zod.def.innerType,e,r);i=ut(i,{...i._zod.def,innerType:a})}else if(VS(i)){let a=bs(i._zod.def.innerType,e,r);i=ut(i,{...i._zod.def,innerType:a})}}let o=qe.get(t);return o&&qe.add(i,o),r.set(t,i),i}throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function mg(t,e=!1){return bs(t,e,new WeakMap)}function T1(t,e){if(lt(t)){let r=ws(t),n={};for(let[i,o]of Object.entries(r))e(i,o)?n[i]=o.optional():n[i]=o;return t.extend(n)}if(rt(t)){let r=ws(t),n={...t._zod.def.shape};for(let[a,s]of Object.entries(r))e(a,s)&&(n[a]=new gs({type:"optional",innerType:s}));let i=ut(t,{...t._zod.def,shape:n}),o=qe.get(t);return o&&qe.add(i,o),i}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function hg(t){return t instanceof Error&&(t.constructor.name==="ZodError"||t.constructor.name==="$ZodError")}var O1=Symbol("Let zodToJsonSchema decide on which parser to use"),$1={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},C1=t=>typeof t=="string"?{...$1,name:t}:{...$1,...t};var P1=t=>{let e=C1(t),r=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,flags:{hasReferencedOpenAiAnyType:!1},currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,i])=>[i._def,{def:i._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};var gg=(t,e)=>{let r=0;for(;r<t.length&&r<e.length&&t[r]===e[r];r++);return[(t.length-r).toString(),...e.slice(r)].join("/")};function mt(t){if(t.target!=="openAi")return{};let e=[...t.basePath,t.definitionPath,t.openAiAnyTypeName];return t.flags.hasReferencedOpenAiAnyType=!0,{$ref:t.$refStrategy==="relative"?gg(e,t.currentPath):e.join("/")}}function ZS(t,e,r,n){n?.errorMessages&&r&&(t.errorMessage={...t.errorMessage,[e]:r})}function Be(t,e,r,n,i){t[e]=r,ZS(t,e,n,i)}var Vt={};hi(Vt,{BRAND:()=>_G,DIRTY:()=>xs,EMPTY_PATH:()=>W3,INVALID:()=>fe,NEVER:()=>tH,OK:()=>sr,ParseStatus:()=>Xt,Schema:()=>Pe,ZodAny:()=>Sa,ZodArray:()=>xo,ZodBigInt:()=>Is,ZodBoolean:()=>ks,ZodBranded:()=>rd,ZodCatch:()=>zs,ZodDate:()=>Es,ZodDefault:()=>Ms,ZodDiscriminatedUnion:()=>vg,ZodEffects:()=>$n,ZodEnum:()=>Ns,ZodError:()=>Zr,ZodFirstPartyTypeKind:()=>O,ZodFunction:()=>wg,ZodIntersection:()=>Os,ZodIssueCode:()=>L,ZodLazy:()=>Cs,ZodLiteral:()=>Ps,ZodMap:()=>bu,ZodNaN:()=>xu,ZodNativeEnum:()=>Rs,ZodNever:()=>Hn,ZodNull:()=>Ts,ZodNullable:()=>Ci,ZodNumber:()=>Ss,ZodObject:()=>Gr,ZodOptional:()=>An,ZodParsedType:()=>ee,ZodPipeline:()=>nd,ZodPromise:()=>Ia,ZodReadonly:()=>js,ZodRecord:()=>bg,ZodSchema:()=>Pe,ZodSet:()=>wu,ZodString:()=>xa,ZodSymbol:()=>yu,ZodTransformer:()=>$n,ZodTuple:()=>Oi,ZodType:()=>Pe,ZodUndefined:()=>As,ZodUnion:()=>$s,ZodUnknown:()=>wo,ZodVoid:()=>vu,addIssueToContext:()=>W,any:()=>EG,array:()=>OG,bigint:()=>wG,boolean:()=>V1,coerce:()=>eH,custom:()=>U1,date:()=>xG,datetimeRegex:()=>D1,defaultErrorMap:()=>vo,discriminatedUnion:()=>RG,effect:()=>HG,enum:()=>VG,function:()=>UG,getErrorMap:()=>hu,getParsedType:()=>$i,instanceof:()=>vG,intersection:()=>MG,isAborted:()=>_g,isAsync:()=>gu,isDirty:()=>yg,isValid:()=>wa,late:()=>yG,lazy:()=>FG,literal:()=>BG,makeIssue:()=>td,map:()=>DG,nan:()=>bG,nativeEnum:()=>ZG,never:()=>TG,null:()=>kG,nullable:()=>KG,number:()=>B1,object:()=>CG,objectUtil:()=>GS,oboolean:()=>QG,onumber:()=>YG,optional:()=>qG,ostring:()=>XG,pipeline:()=>JG,preprocess:()=>WG,promise:()=>GG,quotelessJson:()=>H3,record:()=>jG,set:()=>LG,setErrorMap:()=>K3,strictObject:()=>PG,string:()=>F1,symbol:()=>SG,transformer:()=>HG,tuple:()=>zG,undefined:()=>IG,union:()=>NG,unknown:()=>AG,util:()=>Le,void:()=>$G});var Le;(function(t){t.assertEqual=i=>{};function e(i){}t.assertIs=e;function r(i){throw new Error}t.assertNever=r,t.arrayToEnum=i=>{let o={};for(let a of i)o[a]=a;return o},t.getValidEnumValues=i=>{let o=t.objectKeys(i).filter(s=>typeof i[i[s]]!="number"),a={};for(let s of o)a[s]=i[s];return t.objectValues(a)},t.objectValues=i=>t.objectKeys(i).map(function(o){return i[o]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{let o=[];for(let a in i)Object.prototype.hasOwnProperty.call(i,a)&&o.push(a);return o},t.find=(i,o)=>{for(let a of i)if(o(a))return a},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&Number.isFinite(i)&&Math.floor(i)===i;function n(i,o=" | "){return i.map(a=>typeof a=="string"?`'${a}'`:a).join(o)}t.joinValues=n,t.jsonStringifyReplacer=(i,o)=>typeof o=="bigint"?o.toString():o})(Le||(Le={}));var GS;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(GS||(GS={}));var ee=Le.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),$i=t=>{switch(typeof t){case"undefined":return ee.undefined;case"string":return ee.string;case"number":return Number.isNaN(t)?ee.nan:ee.number;case"boolean":return ee.boolean;case"function":return ee.function;case"bigint":return ee.bigint;case"symbol":return ee.symbol;case"object":return Array.isArray(t)?ee.array:t===null?ee.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?ee.promise:typeof Map<"u"&&t instanceof Map?ee.map:typeof Set<"u"&&t instanceof Set?ee.set:typeof Date<"u"&&t instanceof Date?ee.date:ee.object;default:return ee.unknown}};var L=Le.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),H3=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),Zr=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(o){return o.message},n={_errors:[]},i=o=>{for(let a of o.issues)if(a.code==="invalid_union")a.unionErrors.map(i);else if(a.code==="invalid_return_type")i(a.returnTypeError);else if(a.code==="invalid_arguments")i(a.argumentsError);else if(a.path.length===0)n._errors.push(r(a));else{let s=n,c=0;for(;c<a.path.length;){let u=a.path[c];c===a.path.length-1?(s[u]=s[u]||{_errors:[]},s[u]._errors.push(r(a))):s[u]=s[u]||{_errors:[]},s=s[u],c++}}};return i(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Le.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r=Object.create(null),n=[];for(let i of this.issues)if(i.path.length>0){let o=i.path[0];r[o]=r[o]||[],r[o].push(e(i))}else n.push(e(i));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};Zr.create=t=>new Zr(t);var q3=(t,e)=>{let r;switch(t.code){case L.invalid_type:t.received===ee.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case L.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,Le.jsonStringifyReplacer)}`;break;case L.unrecognized_keys:r=`Unrecognized key(s) in object: ${Le.joinValues(t.keys,", ")}`;break;case L.invalid_union:r="Invalid input";break;case L.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${Le.joinValues(t.options)}`;break;case L.invalid_enum_value:r=`Invalid enum value. Expected ${Le.joinValues(t.options)}, received '${t.received}'`;break;case L.invalid_arguments:r="Invalid function arguments";break;case L.invalid_return_type:r="Invalid function return type";break;case L.invalid_date:r="Invalid date";break;case L.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:Le.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case L.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case L.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case L.custom:r="Invalid input";break;case L.invalid_intersection_types:r="Intersection results could not be merged";break;case L.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case L.not_finite:r="Number must be finite";break;default:r=e.defaultError,Le.assertNever(t)}return{message:r}},vo=q3;var N1=vo;function K3(t){N1=t}function hu(){return N1}var td=t=>{let{data:e,path:r,errorMaps:n,issueData:i}=t,o=[...r,...i.path||[]],a={...i,path:o};if(i.message!==void 0)return{...i,path:o,message:i.message};let s="",c=n.filter(u=>!!u).slice().reverse();for(let u of c)s=u(a,{data:e,defaultError:s}).message;return{...i,path:o,message:s}},W3=[];function W(t,e){let r=hu(),n=td({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===vo?void 0:vo].filter(i=>!!i)});t.common.issues.push(n)}var Xt=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let i of r){if(i.status==="aborted")return fe;i.status==="dirty"&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let i of r){let o=await i.key,a=await i.value;n.push({key:o,value:a})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let i of r){let{key:o,value:a}=i;if(o.status==="aborted"||a.status==="aborted")return fe;o.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),o.value!=="__proto__"&&(typeof a.value<"u"||i.alwaysSet)&&(n[o.value]=a.value)}return{status:e.value,value:n}}},fe=Object.freeze({status:"aborted"}),xs=t=>({status:"dirty",value:t}),sr=t=>({status:"valid",value:t}),_g=t=>t.status==="aborted",yg=t=>t.status==="dirty",wa=t=>t.status==="valid",gu=t=>typeof Promise<"u"&&t instanceof Promise;var ae;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(ae||(ae={}));var Tn=class{constructor(e,r,n,i){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=i}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},R1=(t,e)=>{if(wa(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new Zr(t.common.issues);return this._error=r,this._error}}};function Ee(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:i}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(a,s)=>{let{message:c}=t;return a.code==="invalid_enum_value"?{message:c??s.defaultError}:typeof s.data>"u"?{message:c??n??s.defaultError}:a.code!=="invalid_type"?{message:s.defaultError}:{message:c??r??s.defaultError}},description:i}}var Pe=class{get description(){return this._def.description}_getType(e){return $i(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:$i(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Xt,ctx:{common:e.parent.common,data:e.data,parsedType:$i(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(gu(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){let n={common:{issues:[],async:r?.async??!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:$i(e)},i=this._parseSync({data:e,path:n.path,parent:n});return R1(n,i)}"~validate"(e){let r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:$i(e)};if(!this["~standard"].async)try{let n=this._parseSync({data:e,path:[],parent:r});return wa(n)?{value:n.value}:{issues:r.common.issues}}catch(n){n?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:r}).then(n=>wa(n)?{value:n.value}:{issues:r.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:$i(e)},i=this._parse({data:e,path:n.path,parent:n}),o=await(gu(i)?i:Promise.resolve(i));return R1(n,o)}refine(e,r){let n=i=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(i):r;return this._refinement((i,o)=>{let a=e(i),s=()=>o.addIssue({code:L.custom,...n(i)});return typeof Promise<"u"&&a instanceof Promise?a.then(c=>c?!0:(s(),!1)):a?!0:(s(),!1)})}refinement(e,r){return this._refinement((n,i)=>e(n)?!0:(i.addIssue(typeof r=="function"?r(n,i):r),!1))}_refinement(e){return new $n({schema:this,typeName:O.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return An.create(this,this._def)}nullable(){return Ci.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return xo.create(this)}promise(){return Ia.create(this,this._def)}or(e){return $s.create([this,e],this._def)}and(e){return Os.create(this,e,this._def)}transform(e){return new $n({...Ee(this._def),schema:this,typeName:O.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new Ms({...Ee(this._def),innerType:this,defaultValue:r,typeName:O.ZodDefault})}brand(){return new rd({typeName:O.ZodBranded,type:this,...Ee(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new zs({...Ee(this._def),innerType:this,catchValue:r,typeName:O.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return nd.create(this,e)}readonly(){return js.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},J3=/^c[^\s-]{8,}$/i,X3=/^[0-9a-z]+$/,Y3=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Q3=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,eG=/^[a-z0-9_-]{21}$/i,tG=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,rG=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,nG=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,iG="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",HS,oG=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,aG=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,sG=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,cG=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,uG=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,lG=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,z1="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",pG=new RegExp(`^${z1}$`);function j1(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);let r=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${r}`}function dG(t){return new RegExp(`^${j1(t)}$`)}function D1(t){let e=`${z1}T${j1(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function fG(t,e){return!!((e==="v4"||!e)&&oG.test(t)||(e==="v6"||!e)&&sG.test(t))}function mG(t,e){if(!tG.test(t))return!1;try{let[r]=t.split(".");if(!r)return!1;let n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),i=JSON.parse(atob(n));return!(typeof i!="object"||i===null||"typ"in i&&i?.typ!=="JWT"||!i.alg||e&&i.alg!==e)}catch{return!1}}function hG(t,e){return!!((e==="v4"||!e)&&aG.test(t)||(e==="v6"||!e)&&cG.test(t))}var xa=class t extends Pe{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==ee.string){let o=this._getOrReturnCtx(e);return W(o,{code:L.invalid_type,expected:ee.string,received:o.parsedType}),fe}let n=new Xt,i;for(let o of this._def.checks)if(o.kind==="min")e.data.length<o.value&&(i=this._getOrReturnCtx(e,i),W(i,{code:L.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),n.dirty());else if(o.kind==="max")e.data.length>o.value&&(i=this._getOrReturnCtx(e,i),W(i,{code:L.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),n.dirty());else if(o.kind==="length"){let a=e.data.length>o.value,s=e.data.length<o.value;(a||s)&&(i=this._getOrReturnCtx(e,i),a?W(i,{code:L.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}):s&&W(i,{code:L.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}),n.dirty())}else if(o.kind==="email")nG.test(e.data)||(i=this._getOrReturnCtx(e,i),W(i,{validation:"email",code:L.invalid_string,message:o.message}),n.dirty());else if(o.kind==="emoji")HS||(HS=new RegExp(iG,"u")),HS.test(e.data)||(i=this._getOrReturnCtx(e,i),W(i,{validation:"emoji",code:L.invalid_string,message:o.message}),n.dirty());else if(o.kind==="uuid")Q3.test(e.data)||(i=this._getOrReturnCtx(e,i),W(i,{validation:"uuid",code:L.invalid_string,message:o.message}),n.dirty());else if(o.kind==="nanoid")eG.test(e.data)||(i=this._getOrReturnCtx(e,i),W(i,{validation:"nanoid",code:L.invalid_string,message:o.message}),n.dirty());else if(o.kind==="cuid")J3.test(e.data)||(i=this._getOrReturnCtx(e,i),W(i,{validation:"cuid",code:L.invalid_string,message:o.message}),n.dirty());else if(o.kind==="cuid2")X3.test(e.data)||(i=this._getOrReturnCtx(e,i),W(i,{validation:"cuid2",code:L.invalid_string,message:o.message}),n.dirty());else if(o.kind==="ulid")Y3.test(e.data)||(i=this._getOrReturnCtx(e,i),W(i,{validation:"ulid",code:L.invalid_string,message:o.message}),n.dirty());else if(o.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),W(i,{validation:"url",code:L.invalid_string,message:o.message}),n.dirty()}else o.kind==="regex"?(o.regex.lastIndex=0,o.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),W(i,{validation:"regex",code:L.invalid_string,message:o.message}),n.dirty())):o.kind==="trim"?e.data=e.data.trim():o.kind==="includes"?e.data.includes(o.value,o.position)||(i=this._getOrReturnCtx(e,i),W(i,{code:L.invalid_string,validation:{includes:o.value,position:o.position},message:o.message}),n.dirty()):o.kind==="toLowerCase"?e.data=e.data.toLowerCase():o.kind==="toUpperCase"?e.data=e.data.toUpperCase():o.kind==="startsWith"?e.data.startsWith(o.value)||(i=this._getOrReturnCtx(e,i),W(i,{code:L.invalid_string,validation:{startsWith:o.value},message:o.message}),n.dirty()):o.kind==="endsWith"?e.data.endsWith(o.value)||(i=this._getOrReturnCtx(e,i),W(i,{code:L.invalid_string,validation:{endsWith:o.value},message:o.message}),n.dirty()):o.kind==="datetime"?D1(o).test(e.data)||(i=this._getOrReturnCtx(e,i),W(i,{code:L.invalid_string,validation:"datetime",message:o.message}),n.dirty()):o.kind==="date"?pG.test(e.data)||(i=this._getOrReturnCtx(e,i),W(i,{code:L.invalid_string,validation:"date",message:o.message}),n.dirty()):o.kind==="time"?dG(o).test(e.data)||(i=this._getOrReturnCtx(e,i),W(i,{code:L.invalid_string,validation:"time",message:o.message}),n.dirty()):o.kind==="duration"?rG.test(e.data)||(i=this._getOrReturnCtx(e,i),W(i,{validation:"duration",code:L.invalid_string,message:o.message}),n.dirty()):o.kind==="ip"?fG(e.data,o.version)||(i=this._getOrReturnCtx(e,i),W(i,{validation:"ip",code:L.invalid_string,message:o.message}),n.dirty()):o.kind==="jwt"?mG(e.data,o.alg)||(i=this._getOrReturnCtx(e,i),W(i,{validation:"jwt",code:L.invalid_string,message:o.message}),n.dirty()):o.kind==="cidr"?hG(e.data,o.version)||(i=this._getOrReturnCtx(e,i),W(i,{validation:"cidr",code:L.invalid_string,message:o.message}),n.dirty()):o.kind==="base64"?uG.test(e.data)||(i=this._getOrReturnCtx(e,i),W(i,{validation:"base64",code:L.invalid_string,message:o.message}),n.dirty()):o.kind==="base64url"?lG.test(e.data)||(i=this._getOrReturnCtx(e,i),W(i,{validation:"base64url",code:L.invalid_string,message:o.message}),n.dirty()):Le.assertNever(o);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(i=>e.test(i),{validation:r,code:L.invalid_string,...ae.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...ae.errToObj(e)})}url(e){return this._addCheck({kind:"url",...ae.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...ae.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...ae.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...ae.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...ae.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...ae.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...ae.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...ae.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...ae.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...ae.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...ae.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...ae.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...ae.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...ae.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...ae.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...ae.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...ae.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...ae.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...ae.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...ae.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...ae.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...ae.errToObj(r)})}nonempty(e){return this.min(1,ae.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};xa.create=t=>new xa({checks:[],typeName:O.ZodString,coerce:t?.coerce??!1,...Ee(t)});function gG(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=r>n?r:n,o=Number.parseInt(t.toFixed(i).replace(".","")),a=Number.parseInt(e.toFixed(i).replace(".",""));return o%a/10**i}var Ss=class t extends Pe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==ee.number){let o=this._getOrReturnCtx(e);return W(o,{code:L.invalid_type,expected:ee.number,received:o.parsedType}),fe}let n,i=new Xt;for(let o of this._def.checks)o.kind==="int"?Le.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),W(n,{code:L.invalid_type,expected:"integer",received:"float",message:o.message}),i.dirty()):o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(n=this._getOrReturnCtx(e,n),W(n,{code:L.too_small,minimum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),i.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(n=this._getOrReturnCtx(e,n),W(n,{code:L.too_big,maximum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),i.dirty()):o.kind==="multipleOf"?gG(e.data,o.value)!==0&&(n=this._getOrReturnCtx(e,n),W(n,{code:L.not_multiple_of,multipleOf:o.value,message:o.message}),i.dirty()):o.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),W(n,{code:L.not_finite,message:o.message}),i.dirty()):Le.assertNever(o);return{status:i.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,ae.toString(r))}gt(e,r){return this.setLimit("min",e,!1,ae.toString(r))}lte(e,r){return this.setLimit("max",e,!0,ae.toString(r))}lt(e,r){return this.setLimit("max",e,!1,ae.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:ae.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:ae.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:ae.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:ae.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:ae.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:ae.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:ae.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:ae.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:ae.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:ae.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Le.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};Ss.create=t=>new Ss({checks:[],typeName:O.ZodNumber,coerce:t?.coerce||!1,...Ee(t)});var Is=class t extends Pe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==ee.bigint)return this._getInvalidInput(e);let n,i=new Xt;for(let o of this._def.checks)o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(n=this._getOrReturnCtx(e,n),W(n,{code:L.too_small,type:"bigint",minimum:o.value,inclusive:o.inclusive,message:o.message}),i.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(n=this._getOrReturnCtx(e,n),W(n,{code:L.too_big,type:"bigint",maximum:o.value,inclusive:o.inclusive,message:o.message}),i.dirty()):o.kind==="multipleOf"?e.data%o.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),W(n,{code:L.not_multiple_of,multipleOf:o.value,message:o.message}),i.dirty()):Le.assertNever(o);return{status:i.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return W(r,{code:L.invalid_type,expected:ee.bigint,received:r.parsedType}),fe}gte(e,r){return this.setLimit("min",e,!0,ae.toString(r))}gt(e,r){return this.setLimit("min",e,!1,ae.toString(r))}lte(e,r){return this.setLimit("max",e,!0,ae.toString(r))}lt(e,r){return this.setLimit("max",e,!1,ae.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:ae.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:ae.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:ae.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:ae.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:ae.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:ae.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Is.create=t=>new Is({checks:[],typeName:O.ZodBigInt,coerce:t?.coerce??!1,...Ee(t)});var ks=class extends Pe{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==ee.boolean){let n=this._getOrReturnCtx(e);return W(n,{code:L.invalid_type,expected:ee.boolean,received:n.parsedType}),fe}return sr(e.data)}};ks.create=t=>new ks({typeName:O.ZodBoolean,coerce:t?.coerce||!1,...Ee(t)});var Es=class t extends Pe{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==ee.date){let o=this._getOrReturnCtx(e);return W(o,{code:L.invalid_type,expected:ee.date,received:o.parsedType}),fe}if(Number.isNaN(e.data.getTime())){let o=this._getOrReturnCtx(e);return W(o,{code:L.invalid_date}),fe}let n=new Xt,i;for(let o of this._def.checks)o.kind==="min"?e.data.getTime()<o.value&&(i=this._getOrReturnCtx(e,i),W(i,{code:L.too_small,message:o.message,inclusive:!0,exact:!1,minimum:o.value,type:"date"}),n.dirty()):o.kind==="max"?e.data.getTime()>o.value&&(i=this._getOrReturnCtx(e,i),W(i,{code:L.too_big,message:o.message,inclusive:!0,exact:!1,maximum:o.value,type:"date"}),n.dirty()):Le.assertNever(o);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:ae.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:ae.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};Es.create=t=>new Es({checks:[],coerce:t?.coerce||!1,typeName:O.ZodDate,...Ee(t)});var yu=class extends Pe{_parse(e){if(this._getType(e)!==ee.symbol){let n=this._getOrReturnCtx(e);return W(n,{code:L.invalid_type,expected:ee.symbol,received:n.parsedType}),fe}return sr(e.data)}};yu.create=t=>new yu({typeName:O.ZodSymbol,...Ee(t)});var As=class extends Pe{_parse(e){if(this._getType(e)!==ee.undefined){let n=this._getOrReturnCtx(e);return W(n,{code:L.invalid_type,expected:ee.undefined,received:n.parsedType}),fe}return sr(e.data)}};As.create=t=>new As({typeName:O.ZodUndefined,...Ee(t)});var Ts=class extends Pe{_parse(e){if(this._getType(e)!==ee.null){let n=this._getOrReturnCtx(e);return W(n,{code:L.invalid_type,expected:ee.null,received:n.parsedType}),fe}return sr(e.data)}};Ts.create=t=>new Ts({typeName:O.ZodNull,...Ee(t)});var Sa=class extends Pe{constructor(){super(...arguments),this._any=!0}_parse(e){return sr(e.data)}};Sa.create=t=>new Sa({typeName:O.ZodAny,...Ee(t)});var wo=class extends Pe{constructor(){super(...arguments),this._unknown=!0}_parse(e){return sr(e.data)}};wo.create=t=>new wo({typeName:O.ZodUnknown,...Ee(t)});var Hn=class extends Pe{_parse(e){let r=this._getOrReturnCtx(e);return W(r,{code:L.invalid_type,expected:ee.never,received:r.parsedType}),fe}};Hn.create=t=>new Hn({typeName:O.ZodNever,...Ee(t)});var vu=class extends Pe{_parse(e){if(this._getType(e)!==ee.undefined){let n=this._getOrReturnCtx(e);return W(n,{code:L.invalid_type,expected:ee.void,received:n.parsedType}),fe}return sr(e.data)}};vu.create=t=>new vu({typeName:O.ZodVoid,...Ee(t)});var xo=class t extends Pe{_parse(e){let{ctx:r,status:n}=this._processInputParams(e),i=this._def;if(r.parsedType!==ee.array)return W(r,{code:L.invalid_type,expected:ee.array,received:r.parsedType}),fe;if(i.exactLength!==null){let a=r.data.length>i.exactLength.value,s=r.data.length<i.exactLength.value;(a||s)&&(W(r,{code:a?L.too_big:L.too_small,minimum:s?i.exactLength.value:void 0,maximum:a?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),n.dirty())}if(i.minLength!==null&&r.data.length<i.minLength.value&&(W(r,{code:L.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),n.dirty()),i.maxLength!==null&&r.data.length>i.maxLength.value&&(W(r,{code:L.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((a,s)=>i.type._parseAsync(new Tn(r,a,r.path,s)))).then(a=>Xt.mergeArray(n,a));let o=[...r.data].map((a,s)=>i.type._parseSync(new Tn(r,a,r.path,s)));return Xt.mergeArray(n,o)}get element(){return this._def.type}min(e,r){return new t({...this._def,minLength:{value:e,message:ae.toString(r)}})}max(e,r){return new t({...this._def,maxLength:{value:e,message:ae.toString(r)}})}length(e,r){return new t({...this._def,exactLength:{value:e,message:ae.toString(r)}})}nonempty(e){return this.min(1,e)}};xo.create=(t,e)=>new xo({type:t,minLength:null,maxLength:null,exactLength:null,typeName:O.ZodArray,...Ee(e)});function _u(t){if(t instanceof Gr){let e={};for(let r in t.shape){let n=t.shape[r];e[r]=An.create(_u(n))}return new Gr({...t._def,shape:()=>e})}else return t instanceof xo?new xo({...t._def,type:_u(t.element)}):t instanceof An?An.create(_u(t.unwrap())):t instanceof Ci?Ci.create(_u(t.unwrap())):t instanceof Oi?Oi.create(t.items.map(e=>_u(e))):t}var Gr=class t extends Pe{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),r=Le.objectKeys(e);return this._cached={shape:e,keys:r},this._cached}_parse(e){if(this._getType(e)!==ee.object){let u=this._getOrReturnCtx(e);return W(u,{code:L.invalid_type,expected:ee.object,received:u.parsedType}),fe}let{status:n,ctx:i}=this._processInputParams(e),{shape:o,keys:a}=this._getCached(),s=[];if(!(this._def.catchall instanceof Hn&&this._def.unknownKeys==="strip"))for(let u in i.data)a.includes(u)||s.push(u);let c=[];for(let u of a){let l=o[u],p=i.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new Tn(i,p,i.path,u)),alwaysSet:u in i.data})}if(this._def.catchall instanceof Hn){let u=this._def.unknownKeys;if(u==="passthrough")for(let l of s)c.push({key:{status:"valid",value:l},value:{status:"valid",value:i.data[l]}});else if(u==="strict")s.length>0&&(W(i,{code:L.unrecognized_keys,keys:s}),n.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let u=this._def.catchall;for(let l of s){let p=i.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new Tn(i,p,i.path,l)),alwaysSet:l in i.data})}}return i.common.async?Promise.resolve().then(async()=>{let u=[];for(let l of c){let p=await l.key,f=await l.value;u.push({key:p,value:f,alwaysSet:l.alwaysSet})}return u}).then(u=>Xt.mergeObjectSync(n,u)):Xt.mergeObjectSync(n,c)}get shape(){return this._def.shape()}strict(e){return ae.errToObj,new t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,n)=>{let i=this._def.errorMap?.(r,n).message??n.defaultError;return r.code==="unrecognized_keys"?{message:ae.errToObj(e).message??i}:{message:i}}}:{}})}strip(){return new t({...this._def,unknownKeys:"strip"})}passthrough(){return new t({...this._def,unknownKeys:"passthrough"})}extend(e){return new t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:O.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new t({...this._def,catchall:e})}pick(e){let r={};for(let n of Le.objectKeys(e))e[n]&&this.shape[n]&&(r[n]=this.shape[n]);return new t({...this._def,shape:()=>r})}omit(e){let r={};for(let n of Le.objectKeys(this.shape))e[n]||(r[n]=this.shape[n]);return new t({...this._def,shape:()=>r})}deepPartial(){return _u(this)}partial(e){let r={};for(let n of Le.objectKeys(this.shape)){let i=this.shape[n];e&&!e[n]?r[n]=i:r[n]=i.optional()}return new t({...this._def,shape:()=>r})}required(e){let r={};for(let n of Le.objectKeys(this.shape))if(e&&!e[n])r[n]=this.shape[n];else{let o=this.shape[n];for(;o instanceof An;)o=o._def.innerType;r[n]=o}return new t({...this._def,shape:()=>r})}keyof(){return L1(Le.objectKeys(this.shape))}};Gr.create=(t,e)=>new Gr({shape:()=>t,unknownKeys:"strip",catchall:Hn.create(),typeName:O.ZodObject,...Ee(e)});Gr.strictCreate=(t,e)=>new Gr({shape:()=>t,unknownKeys:"strict",catchall:Hn.create(),typeName:O.ZodObject,...Ee(e)});Gr.lazycreate=(t,e)=>new Gr({shape:t,unknownKeys:"strip",catchall:Hn.create(),typeName:O.ZodObject,...Ee(e)});var $s=class extends Pe{_parse(e){let{ctx:r}=this._processInputParams(e),n=this._def.options;function i(o){for(let s of o)if(s.result.status==="valid")return s.result;for(let s of o)if(s.result.status==="dirty")return r.common.issues.push(...s.ctx.common.issues),s.result;let a=o.map(s=>new Zr(s.ctx.common.issues));return W(r,{code:L.invalid_union,unionErrors:a}),fe}if(r.common.async)return Promise.all(n.map(async o=>{let a={...r,common:{...r.common,issues:[]},parent:null};return{result:await o._parseAsync({data:r.data,path:r.path,parent:a}),ctx:a}})).then(i);{let o,a=[];for(let c of n){let u={...r,common:{...r.common,issues:[]},parent:null},l=c._parseSync({data:r.data,path:r.path,parent:u});if(l.status==="valid")return l;l.status==="dirty"&&!o&&(o={result:l,ctx:u}),u.common.issues.length&&a.push(u.common.issues)}if(o)return r.common.issues.push(...o.ctx.common.issues),o.result;let s=a.map(c=>new Zr(c));return W(r,{code:L.invalid_union,unionErrors:s}),fe}}get options(){return this._def.options}};$s.create=(t,e)=>new $s({options:t,typeName:O.ZodUnion,...Ee(e)});var bo=t=>t instanceof Cs?bo(t.schema):t instanceof $n?bo(t.innerType()):t instanceof Ps?[t.value]:t instanceof Ns?t.options:t instanceof Rs?Le.objectValues(t.enum):t instanceof Ms?bo(t._def.innerType):t instanceof As?[void 0]:t instanceof Ts?[null]:t instanceof An?[void 0,...bo(t.unwrap())]:t instanceof Ci?[null,...bo(t.unwrap())]:t instanceof rd||t instanceof js?bo(t.unwrap()):t instanceof zs?bo(t._def.innerType):[],vg=class t extends Pe{_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==ee.object)return W(r,{code:L.invalid_type,expected:ee.object,received:r.parsedType}),fe;let n=this.discriminator,i=r.data[n],o=this.optionsMap.get(i);return o?r.common.async?o._parseAsync({data:r.data,path:r.path,parent:r}):o._parseSync({data:r.data,path:r.path,parent:r}):(W(r,{code:L.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),fe)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,n){let i=new Map;for(let o of r){let a=bo(o.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let s of a){if(i.has(s))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(s)}`);i.set(s,o)}}return new t({typeName:O.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:i,...Ee(n)})}};function qS(t,e){let r=$i(t),n=$i(e);if(t===e)return{valid:!0,data:t};if(r===ee.object&&n===ee.object){let i=Le.objectKeys(e),o=Le.objectKeys(t).filter(s=>i.indexOf(s)!==-1),a={...t,...e};for(let s of o){let c=qS(t[s],e[s]);if(!c.valid)return{valid:!1};a[s]=c.data}return{valid:!0,data:a}}else if(r===ee.array&&n===ee.array){if(t.length!==e.length)return{valid:!1};let i=[];for(let o=0;o<t.length;o++){let a=t[o],s=e[o],c=qS(a,s);if(!c.valid)return{valid:!1};i.push(c.data)}return{valid:!0,data:i}}else return r===ee.date&&n===ee.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var Os=class extends Pe{_parse(e){let{status:r,ctx:n}=this._processInputParams(e),i=(o,a)=>{if(_g(o)||_g(a))return fe;let s=qS(o.value,a.value);return s.valid?((yg(o)||yg(a))&&r.dirty(),{status:r.value,value:s.data}):(W(n,{code:L.invalid_intersection_types}),fe)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([o,a])=>i(o,a)):i(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};Os.create=(t,e,r)=>new Os({left:t,right:e,typeName:O.ZodIntersection,...Ee(r)});var Oi=class t extends Pe{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==ee.array)return W(n,{code:L.invalid_type,expected:ee.array,received:n.parsedType}),fe;if(n.data.length<this._def.items.length)return W(n,{code:L.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),fe;!this._def.rest&&n.data.length>this._def.items.length&&(W(n,{code:L.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());let o=[...n.data].map((a,s)=>{let c=this._def.items[s]||this._def.rest;return c?c._parse(new Tn(n,a,n.path,s)):null}).filter(a=>!!a);return n.common.async?Promise.all(o).then(a=>Xt.mergeArray(r,a)):Xt.mergeArray(r,o)}get items(){return this._def.items}rest(e){return new t({...this._def,rest:e})}};Oi.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Oi({items:t,typeName:O.ZodTuple,rest:null,...Ee(e)})};var bg=class t extends Pe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==ee.object)return W(n,{code:L.invalid_type,expected:ee.object,received:n.parsedType}),fe;let i=[],o=this._def.keyType,a=this._def.valueType;for(let s in n.data)i.push({key:o._parse(new Tn(n,s,n.path,s)),value:a._parse(new Tn(n,n.data[s],n.path,s)),alwaysSet:s in n.data});return n.common.async?Xt.mergeObjectAsync(r,i):Xt.mergeObjectSync(r,i)}get element(){return this._def.valueType}static create(e,r,n){return r instanceof Pe?new t({keyType:e,valueType:r,typeName:O.ZodRecord,...Ee(n)}):new t({keyType:xa.create(),valueType:e,typeName:O.ZodRecord,...Ee(r)})}},bu=class extends Pe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==ee.map)return W(n,{code:L.invalid_type,expected:ee.map,received:n.parsedType}),fe;let i=this._def.keyType,o=this._def.valueType,a=[...n.data.entries()].map(([s,c],u)=>({key:i._parse(new Tn(n,s,n.path,[u,"key"])),value:o._parse(new Tn(n,c,n.path,[u,"value"]))}));if(n.common.async){let s=new Map;return Promise.resolve().then(async()=>{for(let c of a){let u=await c.key,l=await c.value;if(u.status==="aborted"||l.status==="aborted")return fe;(u.status==="dirty"||l.status==="dirty")&&r.dirty(),s.set(u.value,l.value)}return{status:r.value,value:s}})}else{let s=new Map;for(let c of a){let u=c.key,l=c.value;if(u.status==="aborted"||l.status==="aborted")return fe;(u.status==="dirty"||l.status==="dirty")&&r.dirty(),s.set(u.value,l.value)}return{status:r.value,value:s}}}};bu.create=(t,e,r)=>new bu({valueType:e,keyType:t,typeName:O.ZodMap,...Ee(r)});var wu=class t extends Pe{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==ee.set)return W(n,{code:L.invalid_type,expected:ee.set,received:n.parsedType}),fe;let i=this._def;i.minSize!==null&&n.data.size<i.minSize.value&&(W(n,{code:L.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),r.dirty()),i.maxSize!==null&&n.data.size>i.maxSize.value&&(W(n,{code:L.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),r.dirty());let o=this._def.valueType;function a(c){let u=new Set;for(let l of c){if(l.status==="aborted")return fe;l.status==="dirty"&&r.dirty(),u.add(l.value)}return{status:r.value,value:u}}let s=[...n.data.values()].map((c,u)=>o._parse(new Tn(n,c,n.path,u)));return n.common.async?Promise.all(s).then(c=>a(c)):a(s)}min(e,r){return new t({...this._def,minSize:{value:e,message:ae.toString(r)}})}max(e,r){return new t({...this._def,maxSize:{value:e,message:ae.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}};wu.create=(t,e)=>new wu({valueType:t,minSize:null,maxSize:null,typeName:O.ZodSet,...Ee(e)});var wg=class t extends Pe{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==ee.function)return W(r,{code:L.invalid_type,expected:ee.function,received:r.parsedType}),fe;function n(s,c){return td({data:s,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,hu(),vo].filter(u=>!!u),issueData:{code:L.invalid_arguments,argumentsError:c}})}function i(s,c){return td({data:s,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,hu(),vo].filter(u=>!!u),issueData:{code:L.invalid_return_type,returnTypeError:c}})}let o={errorMap:r.common.contextualErrorMap},a=r.data;if(this._def.returns instanceof Ia){let s=this;return sr(async function(...c){let u=new Zr([]),l=await s._def.args.parseAsync(c,o).catch(m=>{throw u.addIssue(n(c,m)),u}),p=await Reflect.apply(a,this,l);return await s._def.returns._def.type.parseAsync(p,o).catch(m=>{throw u.addIssue(i(p,m)),u})})}else{let s=this;return sr(function(...c){let u=s._def.args.safeParse(c,o);if(!u.success)throw new Zr([n(c,u.error)]);let l=Reflect.apply(a,this,u.data),p=s._def.returns.safeParse(l,o);if(!p.success)throw new Zr([i(l,p.error)]);return p.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t({...this._def,args:Oi.create(e).rest(wo.create())})}returns(e){return new t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,n){return new t({args:e||Oi.create([]).rest(wo.create()),returns:r||wo.create(),typeName:O.ZodFunction,...Ee(n)})}},Cs=class extends Pe{get schema(){return this._def.getter()}_parse(e){let{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}};Cs.create=(t,e)=>new Cs({getter:t,typeName:O.ZodLazy,...Ee(e)});var Ps=class extends Pe{_parse(e){if(e.data!==this._def.value){let r=this._getOrReturnCtx(e);return W(r,{received:r.data,code:L.invalid_literal,expected:this._def.value}),fe}return{status:"valid",value:e.data}}get value(){return this._def.value}};Ps.create=(t,e)=>new Ps({value:t,typeName:O.ZodLiteral,...Ee(e)});function L1(t,e){return new Ns({values:t,typeName:O.ZodEnum,...Ee(e)})}var Ns=class t extends Pe{_parse(e){if(typeof e.data!="string"){let r=this._getOrReturnCtx(e),n=this._def.values;return W(r,{expected:Le.joinValues(n),received:r.parsedType,code:L.invalid_type}),fe}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let r=this._getOrReturnCtx(e),n=this._def.values;return W(r,{received:r.data,code:L.invalid_enum_value,options:n}),fe}return sr(e.data)}get options(){return this._def.values}get enum(){let e={};for(let r of this._def.values)e[r]=r;return e}get Values(){let e={};for(let r of this._def.values)e[r]=r;return e}get Enum(){let e={};for(let r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return t.create(e,{...this._def,...r})}exclude(e,r=this._def){return t.create(this.options.filter(n=>!e.includes(n)),{...this._def,...r})}};Ns.create=L1;var Rs=class extends Pe{_parse(e){let r=Le.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==ee.string&&n.parsedType!==ee.number){let i=Le.objectValues(r);return W(n,{expected:Le.joinValues(i),received:n.parsedType,code:L.invalid_type}),fe}if(this._cache||(this._cache=new Set(Le.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let i=Le.objectValues(r);return W(n,{received:n.data,code:L.invalid_enum_value,options:i}),fe}return sr(e.data)}get enum(){return this._def.values}};Rs.create=(t,e)=>new Rs({values:t,typeName:O.ZodNativeEnum,...Ee(e)});var Ia=class extends Pe{unwrap(){return this._def.type}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==ee.promise&&r.common.async===!1)return W(r,{code:L.invalid_type,expected:ee.promise,received:r.parsedType}),fe;let n=r.parsedType===ee.promise?r.data:Promise.resolve(r.data);return sr(n.then(i=>this._def.type.parseAsync(i,{path:r.path,errorMap:r.common.contextualErrorMap})))}};Ia.create=(t,e)=>new Ia({type:t,typeName:O.ZodPromise,...Ee(e)});var $n=class extends Pe{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===O.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:r,ctx:n}=this._processInputParams(e),i=this._def.effect||null,o={addIssue:a=>{W(n,a),a.fatal?r.abort():r.dirty()},get path(){return n.path}};if(o.addIssue=o.addIssue.bind(o),i.type==="preprocess"){let a=i.transform(n.data,o);if(n.common.async)return Promise.resolve(a).then(async s=>{if(r.value==="aborted")return fe;let c=await this._def.schema._parseAsync({data:s,path:n.path,parent:n});return c.status==="aborted"?fe:c.status==="dirty"?xs(c.value):r.value==="dirty"?xs(c.value):c});{if(r.value==="aborted")return fe;let s=this._def.schema._parseSync({data:a,path:n.path,parent:n});return s.status==="aborted"?fe:s.status==="dirty"?xs(s.value):r.value==="dirty"?xs(s.value):s}}if(i.type==="refinement"){let a=s=>{let c=i.refinement(s,o);if(n.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return s};if(n.common.async===!1){let s=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?fe:(s.status==="dirty"&&r.dirty(),a(s.value),{status:r.value,value:s.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(s=>s.status==="aborted"?fe:(s.status==="dirty"&&r.dirty(),a(s.value).then(()=>({status:r.value,value:s.value}))))}if(i.type==="transform")if(n.common.async===!1){let a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!wa(a))return fe;let s=i.transform(a.value,o);if(s instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:s}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>wa(a)?Promise.resolve(i.transform(a.value,o)).then(s=>({status:r.value,value:s})):fe);Le.assertNever(i)}};$n.create=(t,e,r)=>new $n({schema:t,typeName:O.ZodEffects,effect:e,...Ee(r)});$n.createWithPreprocess=(t,e,r)=>new $n({schema:e,effect:{type:"preprocess",transform:t},typeName:O.ZodEffects,...Ee(r)});var An=class extends Pe{_parse(e){return this._getType(e)===ee.undefined?sr(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};An.create=(t,e)=>new An({innerType:t,typeName:O.ZodOptional,...Ee(e)});var Ci=class extends Pe{_parse(e){return this._getType(e)===ee.null?sr(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Ci.create=(t,e)=>new Ci({innerType:t,typeName:O.ZodNullable,...Ee(e)});var Ms=class extends Pe{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return r.parsedType===ee.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}};Ms.create=(t,e)=>new Ms({innerType:t,typeName:O.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Ee(e)});var zs=class extends Pe{_parse(e){let{ctx:r}=this._processInputParams(e),n={...r,common:{...r.common,issues:[]}},i=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return gu(i)?i.then(o=>({status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new Zr(n.common.issues)},input:n.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Zr(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};zs.create=(t,e)=>new zs({innerType:t,typeName:O.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Ee(e)});var xu=class extends Pe{_parse(e){if(this._getType(e)!==ee.nan){let n=this._getOrReturnCtx(e);return W(n,{code:L.invalid_type,expected:ee.nan,received:n.parsedType}),fe}return{status:"valid",value:e.data}}};xu.create=t=>new xu({typeName:O.ZodNaN,...Ee(t)});var _G=Symbol("zod_brand"),rd=class extends Pe{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}},nd=class t extends Pe{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let o=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?fe:o.status==="dirty"?(r.dirty(),xs(o.value)):this._def.out._parseAsync({data:o.value,path:n.path,parent:n})})();{let i=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?fe:i.status==="dirty"?(r.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:n.path,parent:n})}}static create(e,r){return new t({in:e,out:r,typeName:O.ZodPipeline})}},js=class extends Pe{_parse(e){let r=this._def.innerType._parse(e),n=i=>(wa(i)&&(i.value=Object.freeze(i.value)),i);return gu(r)?r.then(i=>n(i)):n(r)}unwrap(){return this._def.innerType}};js.create=(t,e)=>new js({innerType:t,typeName:O.ZodReadonly,...Ee(e)});function M1(t,e){let r=typeof t=="function"?t(e):typeof t=="string"?{message:t}:t;return typeof r=="string"?{message:r}:r}function U1(t,e={},r){return t?Sa.create().superRefine((n,i)=>{let o=t(n);if(o instanceof Promise)return o.then(a=>{if(!a){let s=M1(e,n),c=s.fatal??r??!0;i.addIssue({code:"custom",...s,fatal:c})}});if(!o){let a=M1(e,n),s=a.fatal??r??!0;i.addIssue({code:"custom",...a,fatal:s})}}):Sa.create()}var yG={object:Gr.lazycreate},O;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(O||(O={}));var vG=(t,e={message:`Input not instance of ${t.name}`})=>U1(r=>r instanceof t,e),F1=xa.create,B1=Ss.create,bG=xu.create,wG=Is.create,V1=ks.create,xG=Es.create,SG=yu.create,IG=As.create,kG=Ts.create,EG=Sa.create,AG=wo.create,TG=Hn.create,$G=vu.create,OG=xo.create,CG=Gr.create,PG=Gr.strictCreate,NG=$s.create,RG=vg.create,MG=Os.create,zG=Oi.create,jG=bg.create,DG=bu.create,LG=wu.create,UG=wg.create,FG=Cs.create,BG=Ps.create,VG=Ns.create,ZG=Rs.create,GG=Ia.create,HG=$n.create,qG=An.create,KG=Ci.create,WG=$n.createWithPreprocess,JG=nd.create,XG=()=>F1().optional(),YG=()=>B1().optional(),QG=()=>V1().optional(),eH={string:(t=>xa.create({...t,coerce:!0})),number:(t=>Ss.create({...t,coerce:!0})),boolean:(t=>ks.create({...t,coerce:!0})),bigint:(t=>Is.create({...t,coerce:!0})),date:(t=>Es.create({...t,coerce:!0}))};var tH=fe;function Z1(t,e){let r={type:"array"};return t.type?._def&&t.type?._def?.typeName!==O.ZodAny&&(r.items=ge(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&Be(r,"minItems",t.minLength.value,t.minLength.message,e),t.maxLength&&Be(r,"maxItems",t.maxLength.value,t.maxLength.message,e),t.exactLength&&(Be(r,"minItems",t.exactLength.value,t.exactLength.message,e),Be(r,"maxItems",t.exactLength.value,t.exactLength.message,e)),r}function G1(t,e){let r={type:"integer",format:"int64"};if(!t.checks)return r;for(let n of t.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?Be(r,"minimum",n.value,n.message,e):Be(r,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(r.exclusiveMinimum=!0),Be(r,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Be(r,"maximum",n.value,n.message,e):Be(r,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(r.exclusiveMaximum=!0),Be(r,"maximum",n.value,n.message,e));break;case"multipleOf":Be(r,"multipleOf",n.value,n.message,e);break}return r}function H1(){return{type:"boolean"}}function xg(t,e){return ge(t.type._def,e)}var q1=(t,e)=>ge(t.innerType._def,e);function KS(t,e,r){let n=r??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map(i=>KS(t,e,i))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return rH(t,e)}}var rH=(t,e)=>{let r={type:"integer",format:"unix-time"};if(e.target==="openApi3")return r;for(let n of t.checks)switch(n.kind){case"min":Be(r,"minimum",n.value,n.message,e);break;case"max":Be(r,"maximum",n.value,n.message,e);break}return r};function K1(t,e){return{...ge(t.innerType._def,e),default:t.defaultValue()}}function W1(t,e){return e.effectStrategy==="input"?ge(t.schema._def,e):mt(e)}function J1(t){return{type:"string",enum:Array.from(t.values)}}var nH=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function X1(t,e){let r=[ge(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),ge(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(o=>!!o),n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,i=[];return r.forEach(o=>{if(nH(o))i.push(...o.allOf),o.unevaluatedProperties===void 0&&(n=void 0);else{let a=o;if("additionalProperties"in o&&o.additionalProperties===!1){let{additionalProperties:s,...c}=o;a=c}else n=void 0;i.push(a)}}),i.length?{allOf:i,...n}:void 0}function Y1(t,e){let r=typeof t.value;return r!=="bigint"&&r!=="number"&&r!=="boolean"&&r!=="string"?{type:Array.isArray(t.value)?"array":"object"}:e.target==="openApi3"?{type:r==="bigint"?"integer":r,enum:[t.value]}:{type:r==="bigint"?"integer":r,const:t.value}}var WS,qn={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(WS===void 0&&(WS=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),WS),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Sg(t,e){let r={type:"string"};if(t.checks)for(let n of t.checks)switch(n.kind){case"min":Be(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value,n.message,e);break;case"max":Be(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value,n.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Kn(r,"email",n.message,e);break;case"format:idn-email":Kn(r,"idn-email",n.message,e);break;case"pattern:zod":Ar(r,qn.email,n.message,e);break}break;case"url":Kn(r,"uri",n.message,e);break;case"uuid":Kn(r,"uuid",n.message,e);break;case"regex":Ar(r,n.regex,n.message,e);break;case"cuid":Ar(r,qn.cuid,n.message,e);break;case"cuid2":Ar(r,qn.cuid2,n.message,e);break;case"startsWith":Ar(r,RegExp(`^${JS(n.value,e)}`),n.message,e);break;case"endsWith":Ar(r,RegExp(`${JS(n.value,e)}$`),n.message,e);break;case"datetime":Kn(r,"date-time",n.message,e);break;case"date":Kn(r,"date",n.message,e);break;case"time":Kn(r,"time",n.message,e);break;case"duration":Kn(r,"duration",n.message,e);break;case"length":Be(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value,n.message,e),Be(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value,n.message,e);break;case"includes":Ar(r,RegExp(JS(n.value,e)),n.message,e);break;case"ip":n.version!=="v6"&&Kn(r,"ipv4",n.message,e),n.version!=="v4"&&Kn(r,"ipv6",n.message,e);break;case"base64url":Ar(r,qn.base64url,n.message,e);break;case"jwt":Ar(r,qn.jwt,n.message,e);break;case"cidr":n.version!=="v6"&&Ar(r,qn.ipv4Cidr,n.message,e),n.version!=="v4"&&Ar(r,qn.ipv6Cidr,n.message,e);break;case"emoji":Ar(r,qn.emoji(),n.message,e);break;case"ulid":Ar(r,qn.ulid,n.message,e);break;case"base64":switch(e.base64Strategy){case"format:binary":Kn(r,"binary",n.message,e);break;case"contentEncoding:base64":Be(r,"contentEncoding","base64",n.message,e);break;case"pattern:zod":Ar(r,qn.base64,n.message,e);break}break;case"nanoid":Ar(r,qn.nanoid,n.message,e);break;case"toLowerCase":case"toUpperCase":case"trim":break;default:}return r}function JS(t,e){return e.patternStrategy==="escape"?oH(t):t}var iH=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function oH(t){let e="";for(let r=0;r<t.length;r++)iH.has(t[r])||(e+="\\"),e+=t[r];return e}function Kn(t,e,r,n){t.format||t.anyOf?.some(i=>i.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format,...t.errorMessage&&n.errorMessages&&{errorMessage:{format:t.errorMessage.format}}}),delete t.format,t.errorMessage&&(delete t.errorMessage.format,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.anyOf.push({format:e,...r&&n.errorMessages&&{errorMessage:{format:r}}})):Be(t,"format",e,r,n)}function Ar(t,e,r,n){t.pattern||t.allOf?.some(i=>i.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern,...t.errorMessage&&n.errorMessages&&{errorMessage:{pattern:t.errorMessage.pattern}}}),delete t.pattern,t.errorMessage&&(delete t.errorMessage.pattern,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.allOf.push({pattern:Q1(e,n),...r&&n.errorMessages&&{errorMessage:{pattern:r}}})):Be(t,"pattern",Q1(e,n),r,n)}function Q1(t,e){if(!e.applyRegexFlags||!t.flags)return t.source;let r={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},n=r.i?t.source.toLowerCase():t.source,i="",o=!1,a=!1,s=!1;for(let c=0;c<n.length;c++){if(o){i+=n[c],o=!1;continue}if(r.i){if(a){if(n[c].match(/[a-z]/)){s?(i+=n[c],i+=`${n[c-2]}-${n[c]}`.toUpperCase(),s=!1):n[c+1]==="-"&&n[c+2]?.match(/[a-z]/)?(i+=n[c],s=!0):i+=`${n[c]}${n[c].toUpperCase()}`;continue}}else if(n[c].match(/[a-z]/)){i+=`[${n[c]}${n[c].toUpperCase()}]`;continue}}if(r.m){if(n[c]==="^"){i+=`(^|(?<=[\r
]))`;continue}else if(n[c]==="$"){i+=`($|(?=[\r
]))`;continue}}if(r.s&&n[c]==="."){i+=a?`${n[c]}\r
`:`[${n[c]}\r
]`;continue}i+=n[c],n[c]==="\\"?o=!0:a&&n[c]==="]"?a=!1:!a&&n[c]==="["&&(a=!0)}try{new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return i}function Ig(t,e){if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&t.keyType?._def.typeName===O.ZodEnum)return{type:"object",required:t.keyType._def.values,properties:t.keyType._def.values.reduce((n,i)=>({...n,[i]:ge(t.valueType._def,{...e,currentPath:[...e.currentPath,"properties",i]})??mt(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};let r={type:"object",additionalProperties:ge(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return r;if(t.keyType?._def.typeName===O.ZodString&&t.keyType._def.checks?.length){let{type:n,...i}=Sg(t.keyType._def,e);return{...r,propertyNames:i}}else{if(t.keyType?._def.typeName===O.ZodEnum)return{...r,propertyNames:{enum:t.keyType._def.values}};if(t.keyType?._def.typeName===O.ZodBranded&&t.keyType._def.type._def.typeName===O.ZodString&&t.keyType._def.type._def.checks?.length){let{type:n,...i}=xg(t.keyType._def,e);return{...r,propertyNames:i}}}return r}function eM(t,e){if(e.mapStrategy==="record")return Ig(t,e);let r=ge(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||mt(e),n=ge(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||mt(e);return{type:"array",maxItems:125,items:{type:"array",items:[r,n],minItems:2,maxItems:2}}}function tM(t){let e=t.values,n=Object.keys(t.values).filter(o=>typeof e[e[o]]!="number").map(o=>e[o]),i=Array.from(new Set(n.map(o=>typeof o)));return{type:i.length===1?i[0]==="string"?"string":"number":["string","number"],enum:n}}function rM(t){return t.target==="openAi"?void 0:{not:mt({...t,currentPath:[...t.currentPath,"not"]})}}function nM(t){return t.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var id={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function oM(t,e){if(e.target==="openApi3")return iM(t,e);let r=t.options instanceof Map?Array.from(t.options.values()):t.options;if(r.every(n=>n._def.typeName in id&&(!n._def.checks||!n._def.checks.length))){let n=r.reduce((i,o)=>{let a=id[o._def.typeName];return a&&!i.includes(a)?[...i,a]:i},[]);return{type:n.length>1?n:n[0]}}else if(r.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){let n=r.reduce((i,o)=>{let a=typeof o._def.value;switch(a){case"string":case"number":case"boolean":return[...i,a];case"bigint":return[...i,"integer"];case"object":return o._def.value===null?[...i,"null"]:i;default:return i}},[]);if(n.length===r.length){let i=n.filter((o,a,s)=>s.indexOf(o)===a);return{type:i.length>1?i:i[0],enum:r.reduce((o,a)=>o.includes(a._def.value)?o:[...o,a._def.value],[])}}}else if(r.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:r.reduce((n,i)=>[...n,...i._def.values.filter(o=>!n.includes(o))],[])};return iM(t,e)}var iM=(t,e)=>{let r=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((n,i)=>ge(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${i}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return r.length?{anyOf:r}:void 0};function aM(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return e.target==="openApi3"?{type:id[t.innerType._def.typeName],nullable:!0}:{type:[id[t.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let n=ge(t.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}let r=ge(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}function sM(t,e){let r={type:"number"};if(!t.checks)return r;for(let n of t.checks)switch(n.kind){case"int":r.type="integer",ZS(r,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?Be(r,"minimum",n.value,n.message,e):Be(r,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(r.exclusiveMinimum=!0),Be(r,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Be(r,"maximum",n.value,n.message,e):Be(r,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(r.exclusiveMaximum=!0),Be(r,"maximum",n.value,n.message,e));break;case"multipleOf":Be(r,"multipleOf",n.value,n.message,e);break}return r}function cM(t,e){let r=e.target==="openAi",n={type:"object",properties:{}},i=[],o=t.shape();for(let s in o){let c=o[s];if(c===void 0||c._def===void 0)continue;let u=sH(c);u&&r&&(c._def.typeName==="ZodOptional"&&(c=c._def.innerType),c.isNullable()||(c=c.nullable()),u=!1);let l=ge(c._def,{...e,currentPath:[...e.currentPath,"properties",s],propertyPath:[...e.currentPath,"properties",s]});l!==void 0&&(n.properties[s]=l,u||i.push(s))}i.length&&(n.required=i);let a=aH(t,e);return a!==void 0&&(n.additionalProperties=a),n}function aH(t,e){if(t.catchall._def.typeName!=="ZodNever")return ge(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(t.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function sH(t){try{return t.isOptional()}catch{return!0}}var uM=(t,e)=>{if(e.currentPath.toString()===e.propertyPath?.toString())return ge(t.innerType._def,e);let r=ge(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return r?{anyOf:[{not:mt(e)},r]}:mt(e)};var lM=(t,e)=>{if(e.pipeStrategy==="input")return ge(t.in._def,e);if(e.pipeStrategy==="output")return ge(t.out._def,e);let r=ge(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=ge(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,n].filter(i=>i!==void 0)}};function pM(t,e){return ge(t.type._def,e)}function dM(t,e){let n={type:"array",uniqueItems:!0,items:ge(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&Be(n,"minItems",t.minSize.value,t.minSize.message,e),t.maxSize&&Be(n,"maxItems",t.maxSize.value,t.maxSize.message,e),n}function fM(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((r,n)=>ge(r._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[]),additionalItems:ge(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((r,n)=>ge(r._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[])}}function mM(t){return{not:mt(t)}}function hM(t){return mt(t)}var gM=(t,e)=>ge(t.innerType._def,e);var _M=(t,e,r)=>{switch(e){case O.ZodString:return Sg(t,r);case O.ZodNumber:return sM(t,r);case O.ZodObject:return cM(t,r);case O.ZodBigInt:return G1(t,r);case O.ZodBoolean:return H1();case O.ZodDate:return KS(t,r);case O.ZodUndefined:return mM(r);case O.ZodNull:return nM(r);case O.ZodArray:return Z1(t,r);case O.ZodUnion:case O.ZodDiscriminatedUnion:return oM(t,r);case O.ZodIntersection:return X1(t,r);case O.ZodTuple:return fM(t,r);case O.ZodRecord:return Ig(t,r);case O.ZodLiteral:return Y1(t,r);case O.ZodEnum:return J1(t);case O.ZodNativeEnum:return tM(t);case O.ZodNullable:return aM(t,r);case O.ZodOptional:return uM(t,r);case O.ZodMap:return eM(t,r);case O.ZodSet:return dM(t,r);case O.ZodLazy:return()=>t.getter()._def;case O.ZodPromise:return pM(t,r);case O.ZodNaN:case O.ZodNever:return rM(r);case O.ZodEffects:return W1(t,r);case O.ZodAny:return mt(r);case O.ZodUnknown:return hM(r);case O.ZodDefault:return K1(t,r);case O.ZodBranded:return xg(t,r);case O.ZodReadonly:return gM(t,r);case O.ZodCatch:return q1(t,r);case O.ZodPipeline:return lM(t,r);case O.ZodFunction:case O.ZodVoid:case O.ZodSymbol:return;default:return(n=>{})(e)}};function ge(t,e,r=!1){let n=e.seen.get(t);if(e.override){let s=e.override?.(t,e,n,r);if(s!==O1)return s}if(n&&!r){let s=cH(n,e);if(s!==void 0)return s}let i={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,i);let o=_M(t,t.typeName,e),a=typeof o=="function"?ge(o(),e):o;if(a&&uH(t,e,a),e.postProcess){let s=e.postProcess(a,t,e);return i.jsonSchema=a,s}return i.jsonSchema=a,a}var cH=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:gg(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((r,n)=>e.currentPath[n]===r)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),mt(e)):e.$refStrategy==="seen"?mt(e):void 0}},uH=(t,e,r)=>(t.description&&(r.description=t.description,e.markdownDescription&&(r.markdownDescription=t.description)),r);var yM=(t,e)=>{let r=P1(e),n=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((c,[u,l])=>({...c,[u]:ge(l._def,{...r,currentPath:[...r.basePath,r.definitionPath,u]},!0)??mt(r)}),{}):void 0,i=typeof e=="string"?e:e?.nameStrategy==="title"?void 0:e?.name,o=ge(t._def,i===void 0?r:{...r,currentPath:[...r.basePath,r.definitionPath,i]},!1)??mt(r),a=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;a!==void 0&&(o.title=a),r.flags.hasReferencedOpenAiAnyType&&(n||(n={}),n[r.openAiAnyTypeName]||(n[r.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:r.$refStrategy==="relative"?"1":[...r.basePath,r.definitionPath,r.openAiAnyTypeName].join("/")}}));let s=i===void 0?n?{...o,[r.definitionPath]:n}:o:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,i].join("/"),[r.definitionPath]:{...n,[i]:o}};return r.target==="jsonSchema7"?s.$schema="http://json-schema.org/draft-07/schema#":(r.target==="jsonSchema2019-09"||r.target==="openAi")&&(s.$schema="https://json-schema.org/draft/2019-09/schema#"),r.target==="openAi"&&("anyOf"in s||"oneOf"in s||"allOf"in s||"type"in s&&Array.isArray(s.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),s};function Pi(t,e){let r=typeof t;if(r!==typeof e)return!1;if(Array.isArray(t)){if(!Array.isArray(e))return!1;let n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(!Pi(t[i],e[i]))return!1;return!0}if(r==="object"){if(!t||!e)return t===e;let n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(let a of n)if(!Pi(t[a],e[a]))return!1;return!0}return t===e}function on(t){return encodeURI(lH(t))}function lH(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}var pH={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},dH={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},fH={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0},mH=typeof self<"u"&&self.location&&self.location.origin!=="null"?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");function Wn(t,e=Object.create(null),r=mH,n=""){if(t&&typeof t=="object"&&!Array.isArray(t)){let o=t.$id||t.id;if(o){let a=new URL(o,r.href);a.hash.length>1?e[a.href]=t:(a.hash="",n===""?r=a:Wn(t,e,r))}}else if(t!==!0&&t!==!1)return e;let i=r.href+(n?"#"+n:"");if(e[i]!==void 0)throw new Error(`Duplicate schema URI "${i}".`);if(e[i]=t,t===!0||t===!1)return e;if(t.__absolute_uri__===void 0&&Object.defineProperty(t,"__absolute_uri__",{enumerable:!1,value:i}),t.$ref&&t.__absolute_ref__===void 0){let o=new URL(t.$ref,r.href);o.hash=o.hash,Object.defineProperty(t,"__absolute_ref__",{enumerable:!1,value:o.href})}if(t.$recursiveRef&&t.__absolute_recursive_ref__===void 0){let o=new URL(t.$recursiveRef,r.href);o.hash=o.hash,Object.defineProperty(t,"__absolute_recursive_ref__",{enumerable:!1,value:o.href})}if(t.$anchor){let o=new URL("#"+t.$anchor,r.href);e[o.href]=t}for(let o in t){if(fH[o])continue;let a=`${n}/${on(o)}`,s=t[o];if(Array.isArray(s)){if(pH[o]){let c=s.length;for(let u=0;u<c;u++)Wn(s[u],e,r,`${a}/${u}`)}}else if(dH[o])for(let c in s)Wn(s[c],e,r,`${a}/${on(c)}`);else Wn(s,e,r,a)}return e}var hH=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,gH=[0,31,28,31,30,31,30,31,31,30,31,30,31],_H=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,yH=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,vH=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,bH=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,wH=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,xH=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,SH=/^(?:\/(?:[^~/]|~0|~1)*)*$/,IH=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,kH=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,EH=t=>{if(t[0]==='"')return!1;let[e,r,...n]=t.split("@");return!e||!r||n.length!==0||e.length>64||r.length>253||e[0]==="."||e.endsWith(".")||e.includes("..")||!/^[a-z0-9.-]+$/i.test(r)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(e)?!1:r.split(".").every(i=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(i))},AH=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,TH=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,$H=t=>t.length>1&&t.length<80&&(/^P\d+([.,]\d+)?W$/.test(t)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(t)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(t));function Ni(t){return t.test.bind(t)}var XS={date:vM,time:bM.bind(void 0,!1),"date-time":PH,duration:$H,uri:MH,"uri-reference":Ni(vH),"uri-template":Ni(bH),url:Ni(wH),email:EH,hostname:Ni(yH),ipv4:Ni(AH),ipv6:Ni(TH),regex:jH,uuid:Ni(xH),"json-pointer":Ni(SH),"json-pointer-uri-fragment":Ni(IH),"relative-json-pointer":Ni(kH)};function OH(t){return t%4===0&&(t%100!==0||t%400===0)}function vM(t){let e=t.match(hH);if(!e)return!1;let r=+e[1],n=+e[2],i=+e[3];return n>=1&&n<=12&&i>=1&&i<=(n==2&&OH(r)?29:gH[n])}function bM(t,e){let r=e.match(_H);if(!r)return!1;let n=+r[1],i=+r[2],o=+r[3],a=!!r[5];return(n<=23&&i<=59&&o<=59||n==23&&i==59&&o==60)&&(!t||a)}var CH=/t|\s/i;function PH(t){let e=t.split(CH);return e.length==2&&vM(e[0])&&bM(!0,e[1])}var NH=/\/|:/,RH=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function MH(t){return NH.test(t)&&RH.test(t)}var zH=/[^\\]\\Z/;function jH(t){if(zH.test(t))return!1;try{return new RegExp(t,"u"),!0}catch{return!1}}var wM;(function(t){t[t.Flag=1]="Flag",t[t.Basic=2]="Basic",t[t.Detailed=4]="Detailed"})(wM||(wM={}));function xM(t){let e=0,r=t.length,n=0,i;for(;n<r;)e++,i=t.charCodeAt(n++),i>=55296&&i<=56319&&n<r&&(i=t.charCodeAt(n),(i&64512)==56320&&n++);return e}function nt(t,e,r="2019-09",n=Wn(e),i=!0,o=null,a="#",s="#",c=Object.create(null)){if(e===!0)return{valid:!0,errors:[]};if(e===!1)return{valid:!1,errors:[{instanceLocation:a,keyword:"false",keywordLocation:a,error:"False boolean schema."}]};let u=typeof t,l;switch(u){case"boolean":case"number":case"string":l=u;break;case"object":t===null?l="null":Array.isArray(t)?l="array":l="object";break;default:throw new Error(`Instances of "${u}" type are not supported.`)}let{$ref:p,$recursiveRef:f,$recursiveAnchor:m,type:h,const:g,enum:x,required:y,not:v,anyOf:S,allOf:k,oneOf:T,if:N,then:U,else:w,format:V,properties:F,patternProperties:R,additionalProperties:ve,unevaluatedProperties:We,minProperties:Ze,maxProperties:Qt,propertyNames:Fe,dependentRequired:Jr,dependentSchemas:eo,dependencies:to,prefixItems:zn,items:ro,additionalItems:Jl,unevaluatedItems:Xl,contains:Yl,minContains:jn,maxContains:b,minItems:_,maxItems:M,uniqueItems:E,minimum:De,maximum:et,exclusiveMinimum:at,exclusiveMaximum:Tt,multipleOf:Kt,minLength:Dn,maxLength:_t,pattern:hn,__absolute_ref__:$c,__absolute_recursive_ref__:Nf}=e,Q=[];if(m===!0&&o===null&&(o=e),f==="#"){let _e=o===null?n[Nf]:o,ue=`${s}/$recursiveRef`,xe=nt(t,o===null?e:o,r,n,i,_e,a,ue,c);xe.valid||Q.push({instanceLocation:a,keyword:"$recursiveRef",keywordLocation:ue,error:"A subschema had errors."},...xe.errors)}if(p!==void 0){let ue=n[$c||p];if(ue===void 0){let X=`Unresolved $ref "${p}".`;throw $c&&$c!==p&&(X+=`  Absolute URI "${$c}".`),X+=`
Known schemas:
- ${Object.keys(n).join(`
- `)}`,new Error(X)}let xe=`${s}/$ref`,ne=nt(t,ue,r,n,i,o,a,xe,c);if(ne.valid||Q.push({instanceLocation:a,keyword:"$ref",keywordLocation:xe,error:"A subschema had errors."},...ne.errors),r==="4"||r==="7")return{valid:Q.length===0,errors:Q}}if(Array.isArray(h)){let _e=h.length,ue=!1;for(let xe=0;xe<_e;xe++)if(l===h[xe]||h[xe]==="integer"&&l==="number"&&t%1===0&&t===t){ue=!0;break}ue||Q.push({instanceLocation:a,keyword:"type",keywordLocation:`${s}/type`,error:`Instance type "${l}" is invalid. Expected "${h.join('", "')}".`})}else h==="integer"?(l!=="number"||t%1||t!==t)&&Q.push({instanceLocation:a,keyword:"type",keywordLocation:`${s}/type`,error:`Instance type "${l}" is invalid. Expected "${h}".`}):h!==void 0&&l!==h&&Q.push({instanceLocation:a,keyword:"type",keywordLocation:`${s}/type`,error:`Instance type "${l}" is invalid. Expected "${h}".`});if(g!==void 0&&(l==="object"||l==="array"?Pi(t,g)||Q.push({instanceLocation:a,keyword:"const",keywordLocation:`${s}/const`,error:`Instance does not match ${JSON.stringify(g)}.`}):t!==g&&Q.push({instanceLocation:a,keyword:"const",keywordLocation:`${s}/const`,error:`Instance does not match ${JSON.stringify(g)}.`})),x!==void 0&&(l==="object"||l==="array"?x.some(_e=>Pi(t,_e))||Q.push({instanceLocation:a,keyword:"enum",keywordLocation:`${s}/enum`,error:`Instance does not match any of ${JSON.stringify(x)}.`}):x.some(_e=>t===_e)||Q.push({instanceLocation:a,keyword:"enum",keywordLocation:`${s}/enum`,error:`Instance does not match any of ${JSON.stringify(x)}.`})),v!==void 0){let _e=`${s}/not`;nt(t,v,r,n,i,o,a,_e).valid&&Q.push({instanceLocation:a,keyword:"not",keywordLocation:_e,error:'Instance matched "not" schema.'})}let es=[];if(S!==void 0){let _e=`${s}/anyOf`,ue=Q.length,xe=!1;for(let ne=0;ne<S.length;ne++){let X=S[ne],be=Object.create(c),ye=nt(t,X,r,n,i,m===!0?o:null,a,`${_e}/${ne}`,be);Q.push(...ye.errors),xe=xe||ye.valid,ye.valid&&es.push(be)}xe?Q.length=ue:Q.splice(ue,0,{instanceLocation:a,keyword:"anyOf",keywordLocation:_e,error:"Instance does not match any subschemas."})}if(k!==void 0){let _e=`${s}/allOf`,ue=Q.length,xe=!0;for(let ne=0;ne<k.length;ne++){let X=k[ne],be=Object.create(c),ye=nt(t,X,r,n,i,m===!0?o:null,a,`${_e}/${ne}`,be);Q.push(...ye.errors),xe=xe&&ye.valid,ye.valid&&es.push(be)}xe?Q.length=ue:Q.splice(ue,0,{instanceLocation:a,keyword:"allOf",keywordLocation:_e,error:"Instance does not match every subschema."})}if(T!==void 0){let _e=`${s}/oneOf`,ue=Q.length,xe=T.filter((ne,X)=>{let be=Object.create(c),ye=nt(t,ne,r,n,i,m===!0?o:null,a,`${_e}/${X}`,be);return Q.push(...ye.errors),ye.valid&&es.push(be),ye.valid}).length;xe===1?Q.length=ue:Q.splice(ue,0,{instanceLocation:a,keyword:"oneOf",keywordLocation:_e,error:`Instance does not match exactly one subschema (${xe} matches).`})}if((l==="object"||l==="array")&&Object.assign(c,...es),N!==void 0){let _e=`${s}/if`;if(nt(t,N,r,n,i,o,a,_e,c).valid){if(U!==void 0){let xe=nt(t,U,r,n,i,o,a,`${s}/then`,c);xe.valid||Q.push({instanceLocation:a,keyword:"if",keywordLocation:_e,error:'Instance does not match "then" schema.'},...xe.errors)}}else if(w!==void 0){let xe=nt(t,w,r,n,i,o,a,`${s}/else`,c);xe.valid||Q.push({instanceLocation:a,keyword:"if",keywordLocation:_e,error:'Instance does not match "else" schema.'},...xe.errors)}}if(l==="object"){if(y!==void 0)for(let ne of y)ne in t||Q.push({instanceLocation:a,keyword:"required",keywordLocation:`${s}/required`,error:`Instance does not have required property "${ne}".`});let _e=Object.keys(t);if(Ze!==void 0&&_e.length<Ze&&Q.push({instanceLocation:a,keyword:"minProperties",keywordLocation:`${s}/minProperties`,error:`Instance does not have at least ${Ze} properties.`}),Qt!==void 0&&_e.length>Qt&&Q.push({instanceLocation:a,keyword:"maxProperties",keywordLocation:`${s}/maxProperties`,error:`Instance does not have at least ${Qt} properties.`}),Fe!==void 0){let ne=`${s}/propertyNames`;for(let X in t){let be=`${a}/${on(X)}`,ye=nt(X,Fe,r,n,i,o,be,ne);ye.valid||Q.push({instanceLocation:a,keyword:"propertyNames",keywordLocation:ne,error:`Property name "${X}" does not match schema.`},...ye.errors)}}if(Jr!==void 0){let ne=`${s}/dependantRequired`;for(let X in Jr)if(X in t){let be=Jr[X];for(let ye of be)ye in t||Q.push({instanceLocation:a,keyword:"dependentRequired",keywordLocation:ne,error:`Instance has "${X}" but does not have "${ye}".`})}}if(eo!==void 0)for(let ne in eo){let X=`${s}/dependentSchemas`;if(ne in t){let be=nt(t,eo[ne],r,n,i,o,a,`${X}/${on(ne)}`,c);be.valid||Q.push({instanceLocation:a,keyword:"dependentSchemas",keywordLocation:X,error:`Instance has "${ne}" but does not match dependant schema.`},...be.errors)}}if(to!==void 0){let ne=`${s}/dependencies`;for(let X in to)if(X in t){let be=to[X];if(Array.isArray(be))for(let ye of be)ye in t||Q.push({instanceLocation:a,keyword:"dependencies",keywordLocation:ne,error:`Instance has "${X}" but does not have "${ye}".`});else{let ye=nt(t,be,r,n,i,o,a,`${ne}/${on(X)}`);ye.valid||Q.push({instanceLocation:a,keyword:"dependencies",keywordLocation:ne,error:`Instance has "${X}" but does not match dependant schema.`},...ye.errors)}}}let ue=Object.create(null),xe=!1;if(F!==void 0){let ne=`${s}/properties`;for(let X in F){if(!(X in t))continue;let be=`${a}/${on(X)}`,ye=nt(t[X],F[X],r,n,i,o,be,`${ne}/${on(X)}`);if(ye.valid)c[X]=ue[X]=!0;else if(xe=i,Q.push({instanceLocation:a,keyword:"properties",keywordLocation:ne,error:`Property "${X}" does not match schema.`},...ye.errors),xe)break}}if(!xe&&R!==void 0){let ne=`${s}/patternProperties`;for(let X in R){let be=new RegExp(X,"u"),ye=R[X];for(let zr in t){if(!be.test(zr))continue;let a$=`${a}/${on(zr)}`,s$=nt(t[zr],ye,r,n,i,o,a$,`${ne}/${on(X)}`);s$.valid?c[zr]=ue[zr]=!0:(xe=i,Q.push({instanceLocation:a,keyword:"patternProperties",keywordLocation:ne,error:`Property "${zr}" matches pattern "${X}" but does not match associated schema.`},...s$.errors))}}}if(!xe&&ve!==void 0){let ne=`${s}/additionalProperties`;for(let X in t){if(ue[X])continue;let be=`${a}/${on(X)}`,ye=nt(t[X],ve,r,n,i,o,be,ne);ye.valid?c[X]=!0:(xe=i,Q.push({instanceLocation:a,keyword:"additionalProperties",keywordLocation:ne,error:`Property "${X}" does not match additional properties schema.`},...ye.errors))}}else if(!xe&&We!==void 0){let ne=`${s}/unevaluatedProperties`;for(let X in t)if(!c[X]){let be=`${a}/${on(X)}`,ye=nt(t[X],We,r,n,i,o,be,ne);ye.valid?c[X]=!0:Q.push({instanceLocation:a,keyword:"unevaluatedProperties",keywordLocation:ne,error:`Property "${X}" does not match unevaluated properties schema.`},...ye.errors)}}}else if(l==="array"){M!==void 0&&t.length>M&&Q.push({instanceLocation:a,keyword:"maxItems",keywordLocation:`${s}/maxItems`,error:`Array has too many items (${t.length} > ${M}).`}),_!==void 0&&t.length<_&&Q.push({instanceLocation:a,keyword:"minItems",keywordLocation:`${s}/minItems`,error:`Array has too few items (${t.length} < ${_}).`});let _e=t.length,ue=0,xe=!1;if(zn!==void 0){let ne=`${s}/prefixItems`,X=Math.min(zn.length,_e);for(;ue<X;ue++){let be=nt(t[ue],zn[ue],r,n,i,o,`${a}/${ue}`,`${ne}/${ue}`);if(c[ue]=!0,!be.valid&&(xe=i,Q.push({instanceLocation:a,keyword:"prefixItems",keywordLocation:ne,error:"Items did not match schema."},...be.errors),xe))break}}if(ro!==void 0){let ne=`${s}/items`;if(Array.isArray(ro)){let X=Math.min(ro.length,_e);for(;ue<X;ue++){let be=nt(t[ue],ro[ue],r,n,i,o,`${a}/${ue}`,`${ne}/${ue}`);if(c[ue]=!0,!be.valid&&(xe=i,Q.push({instanceLocation:a,keyword:"items",keywordLocation:ne,error:"Items did not match schema."},...be.errors),xe))break}}else for(;ue<_e;ue++){let X=nt(t[ue],ro,r,n,i,o,`${a}/${ue}`,ne);if(c[ue]=!0,!X.valid&&(xe=i,Q.push({instanceLocation:a,keyword:"items",keywordLocation:ne,error:"Items did not match schema."},...X.errors),xe))break}if(!xe&&Jl!==void 0){let X=`${s}/additionalItems`;for(;ue<_e;ue++){let be=nt(t[ue],Jl,r,n,i,o,`${a}/${ue}`,X);c[ue]=!0,be.valid||(xe=i,Q.push({instanceLocation:a,keyword:"additionalItems",keywordLocation:X,error:"Items did not match additional items schema."},...be.errors))}}}if(Yl!==void 0)if(_e===0&&jn===void 0)Q.push({instanceLocation:a,keyword:"contains",keywordLocation:`${s}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(jn!==void 0&&_e<jn)Q.push({instanceLocation:a,keyword:"minContains",keywordLocation:`${s}/minContains`,error:`Array has less items (${_e}) than minContains (${jn}).`});else{let ne=`${s}/contains`,X=Q.length,be=0;for(let ye=0;ye<_e;ye++){let zr=nt(t[ye],Yl,r,n,i,o,`${a}/${ye}`,ne);zr.valid?(c[ye]=!0,be++):Q.push(...zr.errors)}be>=(jn||0)&&(Q.length=X),jn===void 0&&b===void 0&&be===0?Q.splice(X,0,{instanceLocation:a,keyword:"contains",keywordLocation:ne,error:"Array does not contain item matching schema."}):jn!==void 0&&be<jn?Q.push({instanceLocation:a,keyword:"minContains",keywordLocation:`${s}/minContains`,error:`Array must contain at least ${jn} items matching schema. Only ${be} items were found.`}):b!==void 0&&be>b&&Q.push({instanceLocation:a,keyword:"maxContains",keywordLocation:`${s}/maxContains`,error:`Array may contain at most ${b} items matching schema. ${be} items were found.`})}if(!xe&&Xl!==void 0){let ne=`${s}/unevaluatedItems`;for(ue;ue<_e;ue++){if(c[ue])continue;let X=nt(t[ue],Xl,r,n,i,o,`${a}/${ue}`,ne);c[ue]=!0,X.valid||Q.push({instanceLocation:a,keyword:"unevaluatedItems",keywordLocation:ne,error:"Items did not match unevaluated items schema."},...X.errors)}}if(E)for(let ne=0;ne<_e;ne++){let X=t[ne],be=typeof X=="object"&&X!==null;for(let ye=0;ye<_e;ye++){if(ne===ye)continue;let zr=t[ye];(X===zr||be&&(typeof zr=="object"&&zr!==null)&&Pi(X,zr))&&(Q.push({instanceLocation:a,keyword:"uniqueItems",keywordLocation:`${s}/uniqueItems`,error:`Duplicate items at indexes ${ne} and ${ye}.`}),ne=Number.MAX_SAFE_INTEGER,ye=Number.MAX_SAFE_INTEGER)}}}else if(l==="number"){if(r==="4"?(De!==void 0&&(at===!0&&t<=De||t<De)&&Q.push({instanceLocation:a,keyword:"minimum",keywordLocation:`${s}/minimum`,error:`${t} is less than ${at?"or equal to ":""} ${De}.`}),et!==void 0&&(Tt===!0&&t>=et||t>et)&&Q.push({instanceLocation:a,keyword:"maximum",keywordLocation:`${s}/maximum`,error:`${t} is greater than ${Tt?"or equal to ":""} ${et}.`})):(De!==void 0&&t<De&&Q.push({instanceLocation:a,keyword:"minimum",keywordLocation:`${s}/minimum`,error:`${t} is less than ${De}.`}),et!==void 0&&t>et&&Q.push({instanceLocation:a,keyword:"maximum",keywordLocation:`${s}/maximum`,error:`${t} is greater than ${et}.`}),at!==void 0&&t<=at&&Q.push({instanceLocation:a,keyword:"exclusiveMinimum",keywordLocation:`${s}/exclusiveMinimum`,error:`${t} is less than ${at}.`}),Tt!==void 0&&t>=Tt&&Q.push({instanceLocation:a,keyword:"exclusiveMaximum",keywordLocation:`${s}/exclusiveMaximum`,error:`${t} is greater than or equal to ${Tt}.`})),Kt!==void 0){let _e=t%Kt;Math.abs(0-_e)>=11920929e-14&&Math.abs(Kt-_e)>=11920929e-14&&Q.push({instanceLocation:a,keyword:"multipleOf",keywordLocation:`${s}/multipleOf`,error:`${t} is not a multiple of ${Kt}.`})}}else if(l==="string"){let _e=Dn===void 0&&_t===void 0?0:xM(t);Dn!==void 0&&_e<Dn&&Q.push({instanceLocation:a,keyword:"minLength",keywordLocation:`${s}/minLength`,error:`String is too short (${_e} < ${Dn}).`}),_t!==void 0&&_e>_t&&Q.push({instanceLocation:a,keyword:"maxLength",keywordLocation:`${s}/maxLength`,error:`String is too long (${_e} > ${_t}).`}),hn!==void 0&&!new RegExp(hn,"u").test(t)&&Q.push({instanceLocation:a,keyword:"pattern",keywordLocation:`${s}/pattern`,error:"String does not match pattern."}),V!==void 0&&XS[V]&&!XS[V](t)&&Q.push({instanceLocation:a,keyword:"format",keywordLocation:`${s}/format`,error:`String does not match format "${V}".`})}return{valid:Q.length===0,errors:Q}}var kg=class{constructor(e,r="2019-09",n=!0){d(this,"schema");d(this,"draft");d(this,"shortCircuit");d(this,"lookup");this.schema=e,this.draft=r,this.shortCircuit=n,this.lookup=Wn(e)}validate(e){return nt(e,this.schema,this.draft,this.lookup,this.shortCircuit)}addSchema(e,r){r&&(e={...e,$id:r}),Wn(e,this.lookup)}};var YS={};z(YS,{Validator:()=>kg,deepCompareStrict:()=>Pi,toJsonSchema:()=>it,validatesOnlyStrings:()=>Su});function it(t,e){if(rt(t)){let r=mg(t,!0);if(En(r)){let n=pu(r,!0);return _o(n,e)}else return _o(t,e)}return lt(t)?yM(t):t}function Su(t){if(!t||typeof t!="object"||Object.keys(t).length===0||Array.isArray(t))return!1;if("type"in t)return typeof t.type=="string"?t.type==="string":Array.isArray(t.type)?t.type.every(e=>e==="string"):!1;if("enum"in t)return Array.isArray(t.enum)&&t.enum.length>0&&t.enum.every(e=>typeof e=="string");if("const"in t)return typeof t.const=="string";if("allOf"in t&&Array.isArray(t.allOf))return t.allOf.some(e=>Su(e));if("anyOf"in t&&Array.isArray(t.anyOf)||"oneOf"in t&&Array.isArray(t.oneOf)){let e="anyOf"in t?t.anyOf:t.oneOf;return e.length>0&&e.every(r=>Su(r))}if("not"in t)return!1;if("$ref"in t&&typeof t.$ref=="string"){let e=t.$ref,r=Wn(t);return r[e]?Su(r[e]):!1}return!1}function od(t){return t?t.lc_runnable:!1}var SM=class{constructor(t){d(this,"includeNames");d(this,"includeTypes");d(this,"includeTags");d(this,"excludeNames");d(this,"excludeTypes");d(this,"excludeTags");this.includeNames=t.includeNames,this.includeTypes=t.includeTypes,this.includeTags=t.includeTags,this.excludeNames=t.excludeNames,this.excludeTypes=t.excludeTypes,this.excludeTags=t.excludeTags}includeEvent(t,e){let r=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0,n=t.tags??[];return this.includeNames!==void 0&&(r=r||this.includeNames.includes(t.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e)),this.includeTags!==void 0&&(r=r||n.some(i=>this.includeTags?.includes(i))),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(t.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e)),this.excludeTags!==void 0&&(r=r&&n.every(i=>!this.excludeTags?.includes(i))),r}},IM=t=>btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");function QS(t){return t.replace(/[^a-zA-Z-_0-9]/g,"_")}var DH=["*","_","`"];function LH(t){let e="";for(let[r,n]of Object.entries(t))e+=`	classDef ${r} ${n};
`;return e}function kM(t,e,r){let{firstNode:n,lastNode:i,nodeColors:o,withStyles:a=!0,curveStyle:s="linear",wrapLabelNWords:c=9}=r??{},u=a?`%%{init: {'flowchart': {'curve': '${s}'}}}%%
graph TD;
`:`graph TD;
`;if(a){let h="default",g={[h]:"{0}({1})"};n!==void 0&&(g[n]="{0}([{1}]):::first"),i!==void 0&&(g[i]="{0}([{1}]):::last");for(let[x,y]of Object.entries(t)){let v=y.name.split(":").pop()??"",k=DH.some(N=>v.startsWith(N)&&v.endsWith(N))?`<p>${v}</p>`:v;Object.keys(y.metadata??{}).length&&(k+=`<hr/><small><em>${Object.entries(y.metadata??{}).map(([N,U])=>`${N} = ${U}`).join(`
`)}</em></small>`);let T=(g[x]??g[h]).replace("{0}",QS(x)).replace("{1}",k);u+=`	${T}
`}}let l={};for(let h of e){let g=h.source.split(":"),x=h.target.split(":"),y=g.filter((v,S)=>v===x[S]).join(":");l[y]||(l[y]=[]),l[y].push(h)}let p=new Set;function f(h){return[...h].sort((g,x)=>g.split(":").length-x.split(":").length)}function m(h,g){let x=h.length===1&&h[0].source===h[0].target;if(g&&!x){let v=g.split(":").pop();if(p.has(g))throw new Error(`Found duplicate subgraph '${v}' at '${g} -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);p.add(g),u+=`	subgraph ${v}
`}let y=f(Object.keys(l).filter(v=>v.startsWith(`${g}:`)&&v!==g&&v.split(":").length===g.split(":").length+1));for(let v of y)m(l[v],v);for(let v of h){let{source:S,target:k,data:T,conditional:N}=v,U="";if(T!==void 0){let w=T,V=w.split(" ");V.length>c&&(w=Array.from({length:Math.ceil(V.length/c)},(F,R)=>V.slice(R*c,(R+1)*c).join(" ")).join("&nbsp;<br>&nbsp;")),U=N?` -. &nbsp;${w}&nbsp; .-> `:` -- &nbsp;${w}&nbsp; --> `}else U=N?" -.-> ":" --> ";u+=`	${QS(S)}${U}${QS(k)};
`}g&&!x&&(u+=`	end
`)}m(l[""]??[],"");for(let h in l)!h.includes(":")&&h!==""&&m(l[h],h);return a&&(u+=LH(o??{})),u}async function EM(t,e){let r=e?.backgroundColor??"white",n=e?.imageType??"png",i=IM(t);r!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(r)||(r=`!${r}`));let o=`https://mermaid.ink/img/${i}?bgColor=${r}&type=${n}`,a=await fetch(o);if(!a.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${a.status}`,`Status text: ${a.statusText}`].join(`
`));return await a.blob()}var eI={};z(eI,{Graph:()=>Ds});function UH(t,e){if(t!==void 0&&!Un(t))return t;if(od(e))try{let r=e.getName();return r=r.startsWith("Runnable")?r.slice(8):r,r}catch{return e.getName()}else return e.name??"UnknownSchema"}function FH(t){return od(t.data)?{type:"runnable",data:{id:t.data.lc_id,name:t.data.getName()}}:{type:"schema",data:{...it(t.data.schema),title:t.data.name}}}var Ds=class $M{constructor(e){d(this,"nodes",{});d(this,"edges",[]);this.nodes=e?.nodes??this.nodes,this.edges=e?.edges??this.edges}toJSON(){let e={};return Object.values(this.nodes).forEach((r,n)=>{e[r.id]=Un(r.id)?n:r.id}),{nodes:Object.values(this.nodes).map(r=>({id:e[r.id],...FH(r)})),edges:this.edges.map(r=>{let n={source:e[r.source],target:e[r.target]};return typeof r.data<"u"&&(n.data=r.data),typeof r.conditional<"u"&&(n.conditional=r.conditional),n})}}addNode(e,r,n){if(r!==void 0&&this.nodes[r]!==void 0)throw new Error(`Node with id ${r} already exists`);let i=r??Dr(),o={id:i,data:e,name:UH(r,e),metadata:n};return this.nodes[i]=o,o}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(r=>r.source!==e.id&&r.target!==e.id)}addEdge(e,r,n,i){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[r.id]===void 0)throw new Error(`Target node ${r.id} not in graph`);let o={source:e.id,target:r.id,data:n,conditional:i};return this.edges.push(o),o}firstNode(){return AM(this)}lastNode(){return TM(this)}extend(e,r=""){let n=r;Object.values(e.nodes).map(u=>u.id).every(Un)&&(n="");let o=u=>n?`${n}:${u}`:u;Object.entries(e.nodes).forEach(([u,l])=>{this.nodes[o(u)]={...l,id:o(u)}});let a=e.edges.map(u=>({...u,source:o(u.source),target:o(u.target)}));this.edges=[...this.edges,...a];let s=e.firstNode(),c=e.lastNode();return[s?{id:o(s.id),data:s.data}:void 0,c?{id:o(c.id),data:c.data}:void 0]}trimFirstNode(){let e=this.firstNode();e&&AM(this,[e.id])&&this.removeNode(e)}trimLastNode(){let e=this.lastNode();e&&TM(this,[e.id])&&this.removeNode(e)}reid(){let e=Object.fromEntries(Object.values(this.nodes).map(i=>[i.id,i.name])),r=new Map;Object.values(e).forEach(i=>{r.set(i,(r.get(i)||0)+1)});let n=i=>{let o=e[i];return Un(i)&&r.get(o)===1?o:i};return new $M({nodes:Object.fromEntries(Object.entries(this.nodes).map(([i,o])=>[n(i),{...o,id:n(i)}])),edges:this.edges.map(i=>({...i,source:n(i.source),target:n(i.target)}))})}drawMermaid(e){let{withStyles:r,curveStyle:n,nodeColors:i={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:o}=e??{},a=this.reid(),s=a.firstNode(),c=a.lastNode();return kM(a.nodes,a.edges,{firstNode:s?.id,lastNode:c?.id,withStyles:r,curveStyle:n,nodeColors:i,wrapLabelNWords:o})}async drawMermaidPng(e){let r=this.drawMermaid(e);return EM(r,{backgroundColor:e?.backgroundColor})}};function AM(t,e=[]){let r=new Set(t.edges.filter(i=>!e.includes(i.source)).map(i=>i.target)),n=[];for(let i of Object.values(t.nodes))!e.includes(i.id)&&!r.has(i.id)&&n.push(i);return n.length===1?n[0]:void 0}function TM(t,e=[]){let r=new Set(t.edges.filter(i=>!e.includes(i.target)).map(i=>i.source)),n=[];for(let i of Object.values(t.nodes))!e.includes(i.id)&&!r.has(i.id)&&n.push(i);return n.length===1?n[0]:void 0}function Eg({name:t,serialized:e}){return t!==void 0?t:e?.name!==void 0?e.name:e?.id!==void 0&&Array.isArray(e?.id)?e.id[e.id.length-1]:"Unnamed"}var OM=t=>t.name==="event_stream_tracer",CM=class extends Jt{constructor(e){super({_awaitHandler:!0,...e});d(this,"autoClose",!0);d(this,"includeNames");d(this,"includeTypes");d(this,"includeTags");d(this,"excludeNames");d(this,"excludeTypes");d(this,"excludeTags");d(this,"runInfoMap",new Map);d(this,"tappedPromises",new Map);d(this,"transformStream");d(this,"writer");d(this,"receiveStream");d(this,"readableStreamClosed",!1);d(this,"name","event_stream_tracer");d(this,"lc_prefer_streaming",!0);this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream({flush:()=>{this.readableStreamClosed=!0}}),this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Ct.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){let r=e.tags??[],n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(n=n||r.find(i=>this.includeTags?.includes(i))!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(n=n&&r.every(i=>!this.excludeTags?.includes(i))),n}async*tapOutputIterable(e,r){let n=await r.next();if(n.done)return;let i=this.runInfoMap.get(e);if(i===void 0){yield n.value;return}function o(s,c){return s==="llm"&&typeof c=="string"?new Ii({text:c}):c}let a=this.tappedPromises.get(e);if(a===void 0){let s;a=new Promise(c=>{s=c}),this.tappedPromises.set(e,a);try{let c={event:`on_${i.runType}_stream`,run_id:e,name:i.name,tags:i.tags,metadata:i.metadata,data:{}};await this.send({...c,data:{chunk:o(i.runType,n.value)}},i),yield n.value;for await(let u of r)i.runType!=="tool"&&i.runType!=="retriever"&&await this.send({...c,data:{chunk:o(i.runType,u)}},i),yield u}finally{s?.()}}else{yield n.value;for await(let s of r)yield s}}async send(e,r){this.readableStreamClosed||this._includeRun(r)&&await this.writer.write(e)}async sendEndEvent(e,r){let n=this.tappedPromises.get(e.run_id);n!==void 0?n.then(()=>{this.send(e,r)}):await this.send(e,r)}async onLLMStart(e){let r=Eg(e),n=e.inputs.messages!==void 0?"chat_model":"llm",i={tags:e.tags??[],metadata:e.extra?.metadata??{},name:r,runType:n,inputs:e.inputs};this.runInfoMap.set(e.id,i);let o=`on_${n}_start`;await this.send({event:o,data:{input:e.inputs},name:r,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},i)}async onLLMNewToken(e,r,n){let i=this.runInfoMap.get(e.id),o,a;if(i===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(i.runType==="chat_model")a="on_chat_model_stream",n?.chunk===void 0?o=new st({content:r,id:`run-${e.id}`}):o=n.chunk.message;else if(i.runType==="llm")a="on_llm_stream",n?.chunk===void 0?o=new Ii({text:r}):o=n.chunk;else throw new Error(`Unexpected run type ${i.runType}`);await this.send({event:a,data:{chunk:o},run_id:e.id,name:i.name,tags:i.tags,metadata:i.metadata},i)}}async onLLMEnd(e){let r=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let n;if(r===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);let i=e.outputs?.generations,o;if(r.runType==="chat_model"){for(let a of i??[]){if(o!==void 0)break;o=a[0]?.message}n="on_chat_model_end"}else if(r.runType==="llm")o={generations:i?.map(a=>a.map(s=>({text:s.text,generationInfo:s.generationInfo}))),llmOutput:e.outputs?.llmOutput??{}},n="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${r.runType}`);await this.sendEndEvent({event:n,data:{output:o,input:r.inputs},run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata},r)}async onChainStart(e){let r=Eg(e),n=e.run_type??"chain",i={tags:e.tags??[],metadata:e.extra?.metadata??{},name:r,runType:e.run_type},o={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(o={},i.inputs={}):e.inputs.input!==void 0?(o.input=e.inputs.input,i.inputs=e.inputs.input):(o.input=e.inputs,i.inputs=e.inputs),this.runInfoMap.set(e.id,i),await this.send({event:`on_${n}_start`,data:o,name:r,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},i)}async onChainEnd(e){let r=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),r===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);let n=`on_${e.run_type}_end`,i=e.inputs??r.inputs??{},a={output:e.outputs?.output??e.outputs,input:i};i.input&&Object.keys(i).length===1&&(a.input=i.input,r.inputs=i.input),await this.sendEndEvent({event:n,data:a,run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata??{}},r)}async onToolStart(e){let r=Eg(e),n={tags:e.tags??[],metadata:e.extra?.metadata??{},name:r,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,n),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:r,run_id:e.id,tags:e.tags??[],metadata:e.extra?.metadata??{}},n)}async onToolEnd(e){let r=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),r===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(r.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);let n=e.outputs?.output===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:n,input:r.inputs},run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata},r)}async onRetrieverStart(e){let r=Eg(e),i={tags:e.tags??[],metadata:e.extra?.metadata??{},name:r,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,i),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:r,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},i)}async onRetrieverEnd(e){let r=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),r===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:e.outputs?.documents??e.outputs,input:r.inputs},run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata},r)}async handleCustomEvent(e,r,n){let i=this.runInfoMap.get(n);if(i===void 0)throw new Error(`handleCustomEvent: Run ID ${n} not found in run map.`);await this.send({event:"on_custom_event",run_id:n,name:e,tags:i.tags,metadata:i.metadata,data:r},i)}async finish(){let e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}};var tI=class extends Jt{constructor({config:e,onStart:r,onEnd:n,onError:i}){super({_awaitHandler:!0});d(this,"name","RootListenersTracer");d(this,"rootId");d(this,"config");d(this,"argOnStart");d(this,"argOnEnd");d(this,"argOnError");this.config=e,this.argOnStart=r,this.argOnEnd=n,this.argOnError=i}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}};function PM(t){let e=new TextEncoder,r=new ReadableStream({async start(n){for await(let i of t)n.enqueue(e.encode(`event: data
data: ${JSON.stringify(i)}

`));n.enqueue(e.encode(`event: end

`)),n.close()}});return Ct.fromReadableStream(r)}function rI(t){return typeof t=="object"&&t!==null&&typeof t[Symbol.iterator]=="function"&&typeof t.next=="function"}var NM=t=>t!=null&&typeof t=="object"&&"next"in t&&typeof t.next=="function";function Ag(t){return typeof t=="object"&&t!==null&&typeof t[Symbol.asyncIterator]=="function"}function*nI(t,e){for(;;){let{value:r,done:n}=Ge.runWithConfig(xr(t),e.next.bind(e),!0);if(n)break;yield r}}async function*Tg(t,e){let r=e[Symbol.asyncIterator]();for(;;){let{value:n,done:i}=await Ge.runWithConfig(xr(t),r.next.bind(e),!0);if(i)break;yield n}}function Pt(t,e){return t&&!Array.isArray(t)&&!(t instanceof Date)&&typeof t=="object"?t:{[e]:t}}var pe=class extends It{constructor(){super(...arguments);d(this,"lc_runnable",!0);d(this,"name")}getName(e){let r=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${r}${e}`:r}withRetry(e){return new Og({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new On({bound:this,config:e,kwargs:{}})}withFallbacks(e){let r=Array.isArray(e)?e:e.fallbacks;return new iI({runnable:this,fallbacks:r})}_getOptionsList(e,r=0){if(Array.isArray(e)&&e.length!==r)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${r} inputs`);if(Array.isArray(e))return e.map(Re);if(r>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");let n=Object.fromEntries(Object.entries(e).filter(([i])=>i!=="runId"));return Array.from({length:r},(i,o)=>Re(o===0?e:n))}return Array.from({length:r},()=>Re(e))}async batch(e,r,n){let i=this._getOptionsList(r??{},e.length),o=i[0]?.maxConcurrency??n?.maxConcurrency,a=new mo({maxConcurrency:o,onFailedAttempt:c=>{throw c}}),s=e.map((c,u)=>a.call(async()=>{try{return await this.invoke(c,i[u])}catch(l){if(n?.returnExceptions)return l;throw l}}));return Promise.all(s)}async*_streamIterator(e,r){yield this.invoke(e,r)}async stream(e,r){let n=Re(r),i=new sa({generator:this._streamIterator(e,n),config:n});return await i.setup,Ct.fromAsyncGenerator(i)}_separateRunnableConfigFromCallOptions(e){let r;e===void 0?r=Re(e):r=Re({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});let n={...e};return delete n.callbacks,delete n.tags,delete n.metadata,delete n.runName,delete n.configurable,delete n.recursionLimit,delete n.maxConcurrency,delete n.runId,delete n.timeout,delete n.signal,[r,n]}async _callWithConfig(e,r,n){let i=Re(n),a=await(await Ft(i))?.handleChainStart(this.toJSON(),Pt(r,"input"),i.runId,i?.runType,void 0,void 0,i?.runName??this.getName());delete i.runId;let s;try{let c=e.call(this,r,i,a);s=await Sn(c,n?.signal)}catch(c){throw await a?.handleChainError(c),c}return await a?.handleChainEnd(Pt(s,"output")),s}async _batchWithConfig(e,r,n,i){let o=this._getOptionsList(n??{},r.length),a=await Promise.all(o.map(Ft)),s=await Promise.all(a.map(async(u,l)=>{let p=await u?.handleChainStart(this.toJSON(),Pt(r[l],"input"),o[l].runId,o[l].runType,void 0,void 0,o[l].runName??this.getName());return delete o[l].runId,p})),c;try{let u=e.call(this,r,o,s,i);c=await Sn(u,o?.[0]?.signal)}catch(u){throw await Promise.all(s.map(l=>l?.handleChainError(u))),u}return await Promise.all(s.map(u=>u?.handleChainEnd(Pt(c,"output")))),c}_concatOutputChunks(e,r){return en(e,r)}async*_transformStreamWithConfig(e,r,n){let i,o=!0,a,s=!0,c=Re(n),u=await Ft(c),l=this;async function*p(){for await(let m of e){if(o)if(i===void 0)i=m;else try{i=l._concatOutputChunks(i,m)}catch{i=void 0,o=!1}yield m}}let f;try{let m=await qb(r.bind(this),p(),async()=>u?.handleChainStart(this.toJSON(),{input:""},c.runId,c.runType,void 0,void 0,c.runName??this.getName(),void 0,{lc_defers_inputs:!0}),n?.signal,c);delete c.runId,f=m.setup;let h=f?.handlers.find(OM),g=m.output;h!==void 0&&f!==void 0&&(g=h.tapOutputIterable(f.runId,g));let x=f?.handlers.find(Yb);x!==void 0&&f!==void 0&&(g=x.tapOutputIterable(f.runId,g));for await(let y of g)if(yield y,s)if(a===void 0)a=y;else try{a=this._concatOutputChunks(a,y)}catch{a=void 0,s=!1}}catch(m){throw await f?.handleChainError(m,void 0,void 0,void 0,{inputs:Pt(i,"input")}),m}await f?.handleChainEnd(a??{},void 0,void 0,void 0,{inputs:Pt(i,"input")})}getGraph(e){let r=new Ds,n=r.addNode({name:`${this.getName()}Input`,schema:Vt.any()}),i=r.addNode(this),o=r.addNode({name:`${this.getName()}Output`,schema:Vt.any()});return r.addEdge(n,i),r.addEdge(i,o),r}pipe(e){return new Tr({first:this,last:ht(e)})}pick(e){return this.pipe(new oI(e))}assign(e){return this.pipe(new sd(new ka({steps:e})))}async*transform(e,r){let n;for await(let i of e)n===void 0?n=i:n=this._concatOutputChunks(n,i);yield*this._streamIterator(n,Re(r))}async*streamLog(e,r,n){let i=new nh({...n,autoClose:!1,_schemaFormat:"original"}),o=Re(r);yield*this._streamLog(e,i,o)}async*_streamLog(e,r,n){let{callbacks:i}=n;if(i===void 0)n.callbacks=[r];else if(Array.isArray(i))n.callbacks=i.concat([r]);else{let c=i.copy();c.addHandler(r,!0),n.callbacks=c}let o=this.stream(e,n);async function a(){try{let c=await o;for await(let u of c){let l=new Si({ops:[{op:"add",path:"/streamed_output/-",value:u}]});await r.writer.write(l)}}finally{await r.writer.close()}}let s=a();try{for await(let c of r)yield c}finally{await s}}streamEvents(e,r,n){let i;if(r.version==="v1")i=this._streamEventsV1(e,r,n);else if(r.version==="v2")i=this._streamEventsV2(e,r,n);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return r.encoding==="text/event-stream"?PM(i):Ct.fromAsyncGenerator(i)}async*_streamEventsV2(e,r,n){let i=new CM({...n,autoClose:!1}),o=Re(r),a=o.runId??Dr();o.runId=a;let s=o.callbacks;if(s===void 0)o.callbacks=[i];else if(Array.isArray(s))o.callbacks=s.concat(i);else{let h=s.copy();h.addHandler(i,!0),o.callbacks=h}let c=new AbortController,u=this;async function l(){let h,g=null;try{r?.signal?"any"in AbortSignal?h=AbortSignal.any([c.signal,r.signal]):(h=r.signal,g=()=>{c.abort()},r.signal.addEventListener("abort",g,{once:!0})):h=c.signal;let x=await u.stream(e,{...o,signal:h}),y=i.tapOutputIterable(a,x);for await(let v of y)if(c.signal.aborted)break}finally{await i.finish(),h&&g&&h.removeEventListener("abort",g)}}let p=l(),f=!1,m;try{for await(let h of i){if(!f){h.data.input=e,f=!0,m=h.run_id,yield h;continue}h.run_id===m&&h.event.endsWith("_end")&&h.data?.input&&delete h.data.input,yield h}}finally{c.abort(),await p}}async*_streamEventsV1(e,r,n){let i,o=!1,a=Re(r),s=a.tags??[],c=a.metadata??{},u=a.runName??this.getName(),l=new nh({...n,autoClose:!1,_schemaFormat:"streaming_events"}),p=new SM({...n}),f=this._streamLog(e,l,a);for await(let h of f){if(i?i=i.concat(h):i=rh.fromRunLogPatch(h),i.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!o){o=!0;let v={...i.state},S={run_id:v.id,event:`on_${v.type}_start`,name:u,tags:s,metadata:c,data:{input:e}};p.includeEvent(S,v.type)&&(yield S)}let g=h.ops.filter(v=>v.path.startsWith("/logs/")).map(v=>v.path.split("/")[2]),x=[...new Set(g)];for(let v of x){let S,k={},T=i.state.logs[v];if(T.end_time===void 0?T.streamed_output.length>0?S="stream":S="start":S="end",S==="start")T.inputs!==void 0&&(k.input=T.inputs);else if(S==="end")T.inputs!==void 0&&(k.input=T.inputs),k.output=T.final_output;else if(S==="stream"){let N=T.streamed_output.length;if(N!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${N} instead. Encountered in: "${T.name}"`);k={chunk:T.streamed_output[0]},T.streamed_output=[]}yield{event:`on_${T.type}_${S}`,name:T.name,run_id:T.id,tags:T.tags,metadata:T.metadata,data:k}}let{state:y}=i;if(y.streamed_output.length>0){let v=y.streamed_output.length;if(v!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${v} instead. Encountered in: "${y.name}"`);let S={chunk:y.streamed_output[0]};y.streamed_output=[];let k={event:`on_${y.type}_stream`,run_id:y.id,tags:s,metadata:c,name:u,data:S};p.includeEvent(k,y.type)&&(yield k)}}let m=i?.state;if(m!==void 0){let h={event:`on_${m.type}_end`,name:u,run_id:m.id,tags:s,metadata:c,data:{output:m.final_output}};p.includeEvent(h,m.type)&&(yield h)}}static isRunnable(e){return od(e)}withListeners({onStart:e,onEnd:r,onError:n}){return new On({bound:this,config:{},configFactories:[i=>({callbacks:[new tI({config:i,onStart:e,onEnd:r,onError:n})]})]})}asTool(e){return ZH(this,e)}},On=class RM extends pe{constructor(r){super(r);d(this,"lc_namespace",["langchain_core","runnables"]);d(this,"lc_serializable",!0);d(this,"bound");d(this,"config");d(this,"kwargs");d(this,"configFactories");this.bound=r.bound,this.kwargs=r.kwargs,this.config=r.config,this.configFactories=r.configFactories}static lc_name(){return"RunnableBinding"}getName(r){return this.bound.getName(r)}async _mergeConfig(...r){let n=Bt(this.config,...r);return Bt(n,...this.configFactories?await Promise.all(this.configFactories.map(async i=>await i(n))):[])}withConfig(r){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...r}})}withRetry(r){return new Og({bound:this.bound,kwargs:this.kwargs,config:this.config,maxAttemptNumber:r?.stopAfterAttempt,...r})}async invoke(r,n){return this.bound.invoke(r,await this._mergeConfig(n,this.kwargs))}async batch(r,n,i){let o=Array.isArray(n)?await Promise.all(n.map(async a=>this._mergeConfig(Re(a),this.kwargs))):await this._mergeConfig(Re(n),this.kwargs);return this.bound.batch(r,o,i)}_concatOutputChunks(r,n){return this.bound._concatOutputChunks(r,n)}async*_streamIterator(r,n){yield*this.bound._streamIterator(r,await this._mergeConfig(Re(n),this.kwargs))}async stream(r,n){return this.bound.stream(r,await this._mergeConfig(Re(n),this.kwargs))}async*transform(r,n){yield*this.bound.transform(r,await this._mergeConfig(Re(n),this.kwargs))}streamEvents(r,n,i){let o=this,a=async function*(){yield*o.bound.streamEvents(r,{...await o._mergeConfig(Re(n),o.kwargs),version:n.version},i)};return Ct.fromAsyncGenerator(a())}static isRunnableBinding(r){return r.bound&&pe.isRunnable(r.bound)}withListeners({onStart:r,onEnd:n,onError:i}){return new RM({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[o=>({callbacks:[new tI({config:o,onStart:r,onEnd:n,onError:i})]})]})}},MM=class zM extends pe{constructor(r){super(r);d(this,"lc_serializable",!0);d(this,"lc_namespace",["langchain_core","runnables"]);d(this,"bound");this.bound=r.bound}static lc_name(){return"RunnableEach"}async invoke(r,n){return this._callWithConfig(this._invoke.bind(this),r,n)}async _invoke(r,n,i){return this.bound.batch(r,ze(n,{callbacks:i?.getChild()}))}withListeners({onStart:r,onEnd:n,onError:i}){return new zM({bound:this.bound.withListeners({onStart:r,onEnd:n,onError:i})})}},Og=class extends On{constructor(e){super(e);d(this,"lc_namespace",["langchain_core","runnables"]);d(this,"maxAttemptNumber",3);d(this,"onFailedAttempt",()=>{});this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}static lc_name(){return"RunnableRetry"}_patchConfigForRetry(e,r,n){let i=e>1?`retry:attempt:${e}`:void 0;return ze(r,{callbacks:n?.getChild(i)})}async _invoke(e,r,n){return $p(i=>super.invoke(e,this._patchConfigForRetry(i,r,n)),{onFailedAttempt:({error:i})=>this.onFailedAttempt(i,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,r){return this._callWithConfig(this._invoke.bind(this),e,r)}async _batch(e,r,n,i){let o={};try{await $p(async a=>{let s=e.map((f,m)=>m).filter(f=>o[f.toString()]===void 0||o[f.toString()]instanceof Error),c=s.map(f=>e[f]),u=s.map(f=>this._patchConfigForRetry(a,r?.[f],n?.[f])),l=await super.batch(c,u,{...i,returnExceptions:!0}),p;for(let f=0;f<l.length;f+=1){let m=l[f],h=s[f];m instanceof Error&&p===void 0&&(p=m,p.input=c[f]),o[h.toString()]=m}if(p)throw p;return l},{onFailedAttempt:({error:a})=>this.onFailedAttempt(a,a.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(a){if(i?.returnExceptions!==!0)throw a}return Object.keys(o).sort((a,s)=>parseInt(a,10)-parseInt(s,10)).map(a=>o[parseInt(a,10)])}async batch(e,r,n){return this._batchWithConfig(this._batch.bind(this),e,r,n)}},Tr=class ad extends pe{constructor(r){super(r);d(this,"first");d(this,"middle",[]);d(this,"last");d(this,"omitSequenceTags",!1);d(this,"lc_serializable",!0);d(this,"lc_namespace",["langchain_core","runnables"]);this.first=r.first,this.middle=r.middle??this.middle,this.last=r.last,this.name=r.name,this.omitSequenceTags=r.omitSequenceTags??this.omitSequenceTags}static lc_name(){return"RunnableSequence"}get steps(){return[this.first,...this.middle,this.last]}async invoke(r,n){let i=Re(n),a=await(await Ft(i))?.handleChainStart(this.toJSON(),Pt(r,"input"),i.runId,void 0,void 0,void 0,i?.runName);delete i.runId;let s=r,c;try{let u=[this.first,...this.middle];for(let l=0;l<u.length;l+=1){let f=u[l].invoke(s,ze(i,{callbacks:a?.getChild(this.omitSequenceTags?void 0:`seq:step:${l+1}`)}));s=await Sn(f,n?.signal)}if(n?.signal?.aborted)throw aa(n.signal);c=await this.last.invoke(s,ze(i,{callbacks:a?.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(u){throw await a?.handleChainError(u),u}return await a?.handleChainEnd(Pt(c,"output")),c}async batch(r,n,i){let o=this._getOptionsList(n??{},r.length),a=await Promise.all(o.map(Ft)),s=await Promise.all(a.map(async(u,l)=>{let p=await u?.handleChainStart(this.toJSON(),Pt(r[l],"input"),o[l].runId,void 0,void 0,void 0,o[l].runName);return delete o[l].runId,p})),c=r;try{for(let u=0;u<this.steps.length;u+=1){let p=this.steps[u].batch(c,s.map((f,m)=>{let h=f?.getChild(this.omitSequenceTags?void 0:`seq:step:${u+1}`);return ze(o[m],{callbacks:h})}),i);c=await Sn(p,o[0]?.signal)}}catch(u){throw await Promise.all(s.map(l=>l?.handleChainError(u))),u}return await Promise.all(s.map(u=>u?.handleChainEnd(Pt(c,"output")))),c}_concatOutputChunks(r,n){return this.last._concatOutputChunks(r,n)}async*_streamIterator(r,n){let i=await Ft(n),{runId:o,...a}=n??{},s=await i?.handleChainStart(this.toJSON(),Pt(r,"input"),o,void 0,void 0,void 0,a?.runName),c=[this.first,...this.middle,this.last],u=!0,l;async function*p(){yield r}try{let f=c[0].transform(p(),ze(a,{callbacks:s?.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let m=1;m<c.length;m+=1)f=await c[m].transform(f,ze(a,{callbacks:s?.getChild(this.omitSequenceTags?void 0:`seq:step:${m+1}`)}));for await(let m of f)if(n?.signal?.throwIfAborted(),yield m,u)if(l===void 0)l=m;else try{l=this._concatOutputChunks(l,m)}catch{l=void 0,u=!1}}catch(f){throw await s?.handleChainError(f),f}await s?.handleChainEnd(Pt(l,"output"))}getGraph(r){let n=new Ds,i=null;return this.steps.forEach((o,a)=>{let s=o.getGraph(r);a!==0&&s.trimFirstNode(),a!==this.steps.length-1&&s.trimLastNode(),n.extend(s);let c=s.firstNode();if(!c)throw new Error(`Runnable ${o} has no first node`);i&&n.addEdge(i,c),i=s.lastNode()}),n}pipe(r){return ad.isRunnableSequence(r)?new ad({first:this.first,middle:this.middle.concat([this.last,r.first,...r.middle]),last:r.last,name:this.name??r.name}):new ad({first:this.first,middle:[...this.middle,this.last],last:ht(r),name:this.name})}static isRunnableSequence(r){return Array.isArray(r.middle)&&pe.isRunnable(r)}static from([r,...n],i){let o={};return typeof i=="string"?o.name=i:i!==void 0&&(o=i),new ad({...o,first:ht(r),middle:n.slice(0,-1).map(ht),last:ht(n[n.length-1])})}},ka=class jM extends pe{constructor(r){super(r);d(this,"lc_namespace",["langchain_core","runnables"]);d(this,"lc_serializable",!0);d(this,"steps");this.steps={};for(let[n,i]of Object.entries(r.steps))this.steps[n]=ht(i)}static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}static from(r){return new jM({steps:r})}async invoke(r,n){let i=Re(n),a=await(await Ft(i))?.handleChainStart(this.toJSON(),{input:r},i.runId,void 0,void 0,void 0,i?.runName);delete i.runId;let s={};try{let c=Object.entries(this.steps).map(async([u,l])=>{s[u]=await l.invoke(r,ze(i,{callbacks:a?.getChild(`map:key:${u}`)}))});await Sn(Promise.all(c),n?.signal)}catch(c){throw await a?.handleChainError(c),c}return await a?.handleChainEnd(s),s}async*_transform(r,n,i){let o={...this.steps},a=qm(r,Object.keys(o).length),s=new Map(Object.entries(o).map(([c,u],l)=>{let p=u.transform(a[l],ze(i,{callbacks:n?.getChild(`map:key:${c}`)}));return[c,p.next().then(f=>({key:c,gen:p,result:f}))]}));for(;s.size;){let c=Promise.race(s.values()),{key:u,result:l,gen:p}=await Sn(c,i?.signal);s.delete(u),l.done||(yield{[u]:l.value},s.set(u,p.next().then(f=>({key:u,gen:p,result:f}))))}}transform(r,n){return this._transformStreamWithConfig(r,this._transform.bind(this),n)}async stream(r,n){async function*i(){yield r}let o=Re(n),a=new sa({generator:this.transform(i(),o),config:o});return await a.setup,Ct.fromAsyncGenerator(a)}},BH=class DM extends pe{constructor(r){super(r);d(this,"lc_serializable",!1);d(this,"lc_namespace",["langchain_core","runnables"]);d(this,"func");if(!jm(r.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=r.func}async invoke(r,n){let[i]=this._getOptionsList(n??{},1),o=await Ft(i),a=this.func(ze(i,{callbacks:o}),r);return Sn(a,i?.signal)}async*_streamIterator(r,n){let[i]=this._getOptionsList(n??{},1),o=await this.invoke(r,n);if(Ag(o)){for await(let a of o)i?.signal?.throwIfAborted(),yield a;return}if(NM(o)){for(;;){i?.signal?.throwIfAborted();let a=o.next();if(a.done)break;yield a.value}return}yield o}static from(r){return new DM({func:r})}};function VH(t){if(jm(t))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}var cr=class LM extends pe{constructor(r){if(jm(r.func))return BH.from(r.func);super(r);d(this,"lc_namespace",["langchain_core","runnables"]);d(this,"func");VH(r.func),this.func=r.func}static lc_name(){return"RunnableLambda"}static from(r){return new LM({func:r})}async _invoke(r,n,i){return new Promise((o,a)=>{let s=ze(n,{callbacks:i?.getChild(),recursionLimit:(n?.recursionLimit??Hm)-1});Ge.runWithConfig(xr(s),async()=>{try{let c=await this.func(r,{...s});if(c&&pe.isRunnable(c)){if(n?.recursionLimit===0)throw new Error("Recursion limit reached.");c=await c.invoke(r,{...s,recursionLimit:(s.recursionLimit??Hm)-1})}else if(Ag(c)){let u;for await(let l of Tg(s,c))if(n?.signal?.throwIfAborted(),u===void 0)u=l;else try{u=this._concatOutputChunks(u,l)}catch{u=l}c=u}else if(rI(c)){let u;for(let l of nI(s,c))if(n?.signal?.throwIfAborted(),u===void 0)u=l;else try{u=this._concatOutputChunks(u,l)}catch{u=l}c=u}o(c)}catch(c){a(c)}})})}async invoke(r,n){return this._callWithConfig(this._invoke.bind(this),r,n)}async*_transform(r,n,i){let o;for await(let c of r)if(o===void 0)o=c;else try{o=this._concatOutputChunks(o,c)}catch{o=c}let a=ze(i,{callbacks:n?.getChild(),recursionLimit:(i?.recursionLimit??Hm)-1}),s=await new Promise((c,u)=>{Ge.runWithConfig(xr(a),async()=>{try{let l=await this.func(o,{...a,config:a});c(l)}catch(l){u(l)}})});if(s&&pe.isRunnable(s)){if(i?.recursionLimit===0)throw new Error("Recursion limit reached.");let c=await s.stream(o,a);for await(let u of c)yield u}else if(Ag(s))for await(let c of Tg(a,s))i?.signal?.throwIfAborted(),yield c;else if(rI(s))for(let c of nI(a,s))i?.signal?.throwIfAborted(),yield c;else yield s}transform(r,n){return this._transformStreamWithConfig(r,this._transform.bind(this),n)}async stream(r,n){async function*i(){yield r}let o=Re(n),a=new sa({generator:this.transform(i(),o),config:o});return await a.setup,Ct.fromAsyncGenerator(a)}},UM=class extends ka{},iI=class extends pe{constructor(e){super(e);d(this,"lc_namespace",["langchain_core","runnables"]);d(this,"lc_serializable",!0);d(this,"runnable");d(this,"fallbacks");this.runnable=e.runnable,this.fallbacks=e.fallbacks}static lc_name(){return"RunnableWithFallbacks"}*runnables(){yield this.runnable;for(let e of this.fallbacks)yield e}async invoke(e,r){let n=Re(r),i=await Ft(n),{runId:o,...a}=n,s=await i?.handleChainStart(this.toJSON(),Pt(e,"input"),o,void 0,void 0,void 0,a?.runName),c=ze(a,{callbacks:s?.getChild()});return await Ge.runWithConfig(c,async()=>{let l;for(let p of this.runnables()){n?.signal?.throwIfAborted();try{let f=await p.invoke(e,c);return await s?.handleChainEnd(Pt(f,"output")),f}catch(f){l===void 0&&(l=f)}}throw l===void 0?new Error("No error stored at end of fallback."):(await s?.handleChainError(l),l)})}async*_streamIterator(e,r){let n=Re(r),i=await Ft(n),{runId:o,...a}=n,s=await i?.handleChainStart(this.toJSON(),Pt(e,"input"),o,void 0,void 0,void 0,a?.runName),c,u;for(let p of this.runnables()){n?.signal?.throwIfAborted();let f=ze(a,{callbacks:s?.getChild()});try{let m=await p.stream(e,f);u=Tg(f,m);break}catch(m){c===void 0&&(c=m)}}if(u===void 0){let p=c??new Error("No error stored at end of fallback.");throw await s?.handleChainError(p),p}let l;try{for await(let p of u){yield p;try{l=l===void 0?l:this._concatOutputChunks(l,p)}catch{l=void 0}}}catch(p){throw await s?.handleChainError(p),p}await s?.handleChainEnd(Pt(l,"output"))}async batch(e,r,n){if(n?.returnExceptions)throw new Error("Not implemented.");let i=this._getOptionsList(r??{},e.length),o=await Promise.all(i.map(c=>Ft(c))),a=await Promise.all(o.map(async(c,u)=>{let l=await c?.handleChainStart(this.toJSON(),Pt(e[u],"input"),i[u].runId,void 0,void 0,void 0,i[u].runName);return delete i[u].runId,l})),s;for(let c of this.runnables()){i[0].signal?.throwIfAborted();try{let u=await c.batch(e,a.map((l,p)=>ze(i[p],{callbacks:l?.getChild()})),n);return await Promise.all(a.map((l,p)=>l?.handleChainEnd(Pt(u[p],"output")))),u}catch(u){s===void 0&&(s=u)}}throw s?(await Promise.all(a.map(c=>c?.handleChainError(s))),s):new Error("No error stored at end of fallbacks.")}};function ht(t){if(typeof t=="function")return new cr({func:t});if(pe.isRunnable(t))return t;if(!Array.isArray(t)&&typeof t=="object"){let e={};for(let[r,n]of Object.entries(t))e[r]=ht(n);return new ka({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}var sd=class extends pe{constructor(e){e instanceof ka&&(e={mapper:e});super(e);d(this,"lc_namespace",["langchain_core","runnables"]);d(this,"lc_serializable",!0);d(this,"mapper");this.mapper=e.mapper}static lc_name(){return"RunnableAssign"}async invoke(e,r){let n=await this.mapper.invoke(e,r);return{...e,...n}}async*_transform(e,r,n){let i=this.mapper.getStepsKeys(),[o,a]=qm(e),s=this.mapper.transform(a,ze(n,{callbacks:r?.getChild()})),c=s.next();for await(let u of o){if(typeof u!="object"||Array.isArray(u))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof u}`);let l=Object.fromEntries(Object.entries(u).filter(([p])=>!i.includes(p)));Object.keys(l).length>0&&(yield l)}yield(await c).value;for await(let u of s)yield u}transform(e,r){return this._transformStreamWithConfig(e,this._transform.bind(this),r)}async stream(e,r){async function*n(){yield e}let i=Re(r),o=new sa({generator:this.transform(n(),i),config:i});return await o.setup,Ct.fromAsyncGenerator(o)}},oI=class extends pe{constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e});super(e);d(this,"lc_namespace",["langchain_core","runnables"]);d(this,"lc_serializable",!0);d(this,"keys");this.keys=e.keys}static lc_name(){return"RunnablePick"}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{let r=this.keys.map(n=>[n,e[n]]).filter(n=>n[1]!==void 0);return r.length===0?void 0:Object.fromEntries(r)}}async invoke(e,r){return this._callWithConfig(this._pick.bind(this),e,r)}async*_transform(e){for await(let r of e){let n=await this._pick(r);n!==void 0&&(yield n)}}transform(e,r){return this._transformStreamWithConfig(e,this._transform.bind(this),r)}async stream(e,r){async function*n(){yield e}let i=Re(r),o=new sa({generator:this.transform(n(),i),config:i});return await o.setup,Ct.fromAsyncGenerator(o)}},$g=class extends On{constructor(e){let r=Tr.from([cr.from(async n=>{let i;if(ta(n))try{i=await ba(this.schema,n.args)}catch{throw new Rc("Received tool input did not match expected schema",JSON.stringify(n.args))}else i=n;return i}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:r,config:e.config??{}});d(this,"name");d(this,"description");d(this,"schema");this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}};function ZH(t,e){let r=e.name??t.getName(),n=e.description??Gn(e.schema);return fu(e.schema)?new $g({name:r,description:n,schema:Vt.object({input:Vt.string()}).transform(i=>i.input),bound:t}):new $g({name:r,description:n,schema:e.schema,bound:t})}var Cg=(t,e)=>{let r=[...new Set(e?.map(i=>{if(typeof i=="string")return i;let o=new i({});if(!("getType"in o)||typeof o.getType!="function")throw new Error("Invalid type provided.");return o.getType()}))],n=t.getType();return r.some(i=>i===n)};function GM(t,e){return Array.isArray(t)?FM(t,e):cr.from(r=>FM(r,t))}function FM(t,e={}){let{includeNames:r,excludeNames:n,includeTypes:i,excludeTypes:o,includeIds:a,excludeIds:s}=e,c=[];for(let u of t)if(!(n&&u.name&&n.includes(u.name))){{if(o&&Cg(u,o))continue;if(s&&u.id&&s.includes(u.id))continue}i||a||r?(r&&u.name&&r.some(l=>l===u.name)||i&&Cg(u,i)||a&&u.id&&a.some(l=>l===u.id))&&c.push(u):c.push(u)}return c}function HM(t){return Array.isArray(t)?BM(t):cr.from(BM)}function BM(t){if(!t.length)return[];let e=[];for(let r of t){let n=r,i=e.pop();if(!i)e.push(n);else if(n.getType()==="tool"||n.getType()!==i.getType())e.push(i,n);else{let o=ns(i),a=ns(n),s=o.concat(a);typeof o.content=="string"&&typeof a.content=="string"&&(s.content=`${o.content}
${a.content}`),e.push(HH(s))}}return e}function qM(t,e){if(Array.isArray(t)){let r=t;if(!e)throw new Error("Options parameter is required when providing messages.");return VM(r,e)}else{let r=t;return cr.from(n=>VM(n,r)).withConfig({runName:"trim_messages"})}}async function VM(t,e){let{maxTokens:r,tokenCounter:n,strategy:i="last",allowPartial:o=!1,endOn:a,startOn:s,includeSystem:c=!1,textSplitter:u}=e;if(s&&i==="first")throw new Error("`startOn` should only be specified if `strategy` is 'last'.");if(c&&i==="first")throw new Error("`includeSystem` should only be specified if `strategy` is 'last'.");let l;"getNumTokens"in n?l=async f=>(await Promise.all(f.map(h=>n.getNumTokens(h.content)))).reduce((h,g)=>h+g,0):l=async f=>n(f);let p=sI;if(u&&("splitText"in u?p=u.splitText:p=async f=>u(f)),i==="first")return KM(t,{maxTokens:r,tokenCounter:l,textSplitter:p,partialStrategy:o?"first":void 0,endOn:a});if(i==="last")return GH(t,{maxTokens:r,tokenCounter:l,textSplitter:p,allowPartial:o,includeSystem:c,startOn:s,endOn:a});throw new Error(`Unrecognized strategy: '${i}'. Must be one of 'first' or 'last'.`)}async function KM(t,e){let{maxTokens:r,tokenCounter:n,textSplitter:i,partialStrategy:o,endOn:a}=e,s=[...t],c=0;for(let u=0;u<s.length;u+=1){let l=u>0?s.slice(0,-u):s;if(await n(l)<=r){c=s.length-u;break}}if(c<s.length&&o){let u=!1;if(Array.isArray(s[c].content)){let l=s[c];if(typeof l.content=="string")throw new Error("Expected content to be an array.");let p=l.content.length,f=o==="last"?[...l.content].reverse():l.content;for(let m=1;m<=p;m+=1){let h=o==="first"?f.slice(0,m):f.slice(-m),g=Object.fromEntries(Object.entries(l).filter(([v])=>v!=="type"&&!v.startsWith("lc_"))),x=aI(l.getType(),{...g,content:h}),y=[...s.slice(0,c),x];if(await n(y)<=r)s=y,c+=1,u=!0;else break}u&&o==="last"&&(l.content=[...f].reverse())}if(!u){let l=s[c],p;if(Array.isArray(l.content)&&l.content.some(f=>typeof f=="string"||f.type==="text")?p=l.content.find(m=>m.type==="text"&&m.text)?.text:typeof l.content=="string"&&(p=l.content),p){let f=await i(p),m=f.length;o==="last"&&f.reverse();for(let h=0;h<m-1;h+=1)if(f.pop(),l.content=f.join(""),await n([...s.slice(0,c),l])<=r){o==="last"&&(l.content=[...f].reverse().join("")),s=[...s.slice(0,c),l],c+=1;break}}}}if(a){let u=Array.isArray(a)?a:[a];for(;c>0&&!Cg(s[c-1],u);)c-=1}return s.slice(0,c)}async function GH(t,e){let{allowPartial:r=!1,includeSystem:n=!1,endOn:i,startOn:o,...a}=e,s=t.map(l=>{let p=Object.fromEntries(Object.entries(l).filter(([f])=>f!=="type"&&!f.startsWith("lc_")));return aI(l.getType(),p,io(l))});if(i){let l=Array.isArray(i)?i:[i];for(;s.length>0&&!Cg(s[s.length-1],l);)s=s.slice(0,-1)}let c=n&&s[0]?.getType()==="system",u=c?s.slice(0,1).concat(s.slice(1).reverse()):s.reverse();return u=await KM(u,{...a,partialStrategy:r?"last":void 0,endOn:o}),c?[u[0],...u.slice(1).reverse()]:u.reverse()}var ZM={human:{message:$t,messageChunk:so},ai:{message:Ue,messageChunk:st},system:{message:Yr,messageChunk:gn},developer:{message:Yr,messageChunk:gn},tool:{message:rr,messageChunk:Qo},function:{message:rs,messageChunk:ao},generic:{message:_r,messageChunk:oo},remove:{message:Ln,messageChunk:Ln}};function aI(t,e,r){let n,i;switch(t){case"human":r?n=new so(e):i=new $t(e);break;case"ai":if(r){let o={...e};"tool_calls"in o&&(o={...o,tool_call_chunks:o.tool_calls?.map(a=>({...a,type:"tool_call_chunk",index:void 0,args:JSON.stringify(a.args)}))}),n=new st(o)}else i=new Ue(e);break;case"system":r?n=new gn(e):i=new Yr(e);break;case"developer":r?n=new gn({...e,additional_kwargs:{...e.additional_kwargs,__openai_role__:"developer"}}):i=new Yr({...e,additional_kwargs:{...e.additional_kwargs,__openai_role__:"developer"}});break;case"tool":if("tool_call_id"in e)r?n=new Qo(e):i=new rr(e);else throw new Error("Can not convert ToolMessage to ToolMessageChunk if 'tool_call_id' field is not defined.");break;case"function":if(r)n=new ao(e);else{if(!e.name)throw new Error("FunctionMessage must have a 'name' field");i=new rs(e)}break;case"generic":if("role"in e)r?n=new oo(e):i=new _r(e);else throw new Error("Can not convert ChatMessage to ChatMessageChunk if 'role' field is not defined.");break;default:throw new Error(`Unrecognized message type ${t}`)}if(r&&n)return n;if(i)return i;throw new Error(`Unrecognized message type ${t}`)}function HH(t){let e=t.getType(),r,n=Object.fromEntries(Object.entries(t).filter(([i])=>!["type","tool_call_chunks"].includes(i)&&!i.startsWith("lc_")));if(e in ZM&&(r=aI(e,n)),!r)throw new Error(`Unrecognized message chunk class ${e}. Supported classes are ${Object.keys(ZM)}`);return r}function sI(t){let e=t.split(`
`);return Promise.resolve([...e.slice(0,-1).map(r=>`${r}
`),e[e.length-1]])}var WM=["tool_call","tool_call_chunk","invalid_tool_call","server_tool_call","server_tool_call_chunk","server_tool_call_result"];var JM=["image","video","audio","text-plain","file"];var XM=["text","reasoning",...WM,...JM];var cI={};z(cI,{AIMessage:()=>Ue,AIMessageChunk:()=>st,BaseMessage:()=>kt,BaseMessageChunk:()=>gr,ChatMessage:()=>_r,ChatMessageChunk:()=>oo,DEFAULT_MERGE_IGNORE_KEYS:()=>av,FunctionMessage:()=>rs,FunctionMessageChunk:()=>ao,HumanMessage:()=>$t,HumanMessageChunk:()=>so,KNOWN_BLOCK_TYPES:()=>XM,RemoveMessage:()=>Ln,SystemMessage:()=>Yr,SystemMessageChunk:()=>gn,ToolMessage:()=>rr,ToolMessageChunk:()=>Qo,_isMessageFieldWithRole:()=>Hf,_mergeDicts:()=>pt,_mergeLists:()=>ts,_mergeObj:()=>Gf,_mergeStatus:()=>Zf,coerceMessageLikeToMessage:()=>nr,collapseToolCallChunks:()=>Wf,convertToChunk:()=>ns,convertToOpenAIImageBlock:()=>Uf,convertToProviderContentBlock:()=>Nc,defaultTextSplitter:()=>sI,defaultToolCallParser:()=>tp,filterMessages:()=>GM,getBufferString:()=>zc,iife:()=>Jf,isAIMessage:()=>ra,isAIMessageChunk:()=>ip,isBase64ContentBlock:()=>Pc,isBaseMessage:()=>dt,isBaseMessageChunk:()=>io,isChatMessage:()=>F$,isChatMessageChunk:()=>B$,isDataContentBlock:()=>jr,isDirectToolOutput:()=>ep,isFunctionMessage:()=>V$,isFunctionMessageChunk:()=>Z$,isHumanMessage:()=>G$,isHumanMessageChunk:()=>H$,isIDContentBlock:()=>Lf,isMessage:()=>Vf,isOpenAIToolCallArray:()=>j$,isPlainTextContentBlock:()=>k$,isSystemMessage:()=>q$,isSystemMessageChunk:()=>K$,isToolMessage:()=>rp,isToolMessageChunk:()=>cv,isURLContentBlock:()=>Cc,mapChatMessagesToStoredMessages:()=>pO,mapStoredMessageToChatMessage:()=>op,mapStoredMessagesToChatMessages:()=>lO,mergeContent:()=>tr,mergeMessageRuns:()=>HM,mergeResponseMetadata:()=>Kf,mergeUsageMetadata:()=>Mc,parseBase64DataUrl:()=>Yo,parseMimeType:()=>Ql,trimMessages:()=>qM});var uI={};z(uI,{BaseChatMessageHistory:()=>lI,BaseListChatMessageHistory:()=>Pg,InMemoryChatMessageHistory:()=>qH});var lI=class extends It{async addMessages(t){for(let e of t)await this.addMessage(e)}},Pg=class extends It{addUserMessage(t){return this.addMessage(new $t(t))}addAIMessage(t){return this.addMessage(new Ue(t))}async addMessages(t){for(let e of t)await this.addMessage(e)}clear(){throw new Error("Not implemented.")}},qH=class extends Pg{constructor(e){super(...arguments);d(this,"lc_namespace",["langchain","stores","message","in_memory"]);d(this,"messages",[]);this.messages=e??[]}async getMessages(){return this.messages}async addMessage(e){this.messages.push(e)}async clear(){this.messages=[]}};var pI={};z(pI,{Embeddings:()=>cd});var cd=class{constructor(t){d(this,"caller");this.caller=new mo(t??{})}};var YM={};var dI={};z(dI,{BaseMemory:()=>KH,getInputValue:()=>WH,getOutputValue:()=>JH,getPromptInputKey:()=>XH});var KH=class{},QM=(t,e)=>{if(e!==void 0)return t[e];let r=Object.keys(t);if(r.length===1)return t[r[0]]},WH=(t,e)=>{let r=QM(t,e);if(!r){let n=Object.keys(t);throw new Error(`input values have ${n.length} keys, you must specify an input key or pass only 1 key as input`)}return r},JH=(t,e)=>{let r=QM(t,e);if(!r&&r!==""){let n=Object.keys(t);throw new Error(`output values have ${n.length} keys, you must specify an output key or pass only 1 key as output`)}return r};function XH(t,e){let r=Object.keys(t).filter(n=>!e.includes(n)&&n!=="stop");if(r.length!==1)throw new Error(`One input key expected, but got ${r.length}`);return r[0]}var fI={};z(fI,{BasePromptValue:()=>Ng,ChatPromptValue:()=>ld,ImagePromptValue:()=>mI,StringPromptValue:()=>ud});var Ng=class extends It{},ud=class extends Ng{constructor(e){super({value:e});d(this,"lc_namespace",["langchain_core","prompt_values"]);d(this,"lc_serializable",!0);d(this,"value");this.value=e}static lc_name(){return"StringPromptValue"}toString(){return this.value}toChatMessages(){return[new $t(this.value)]}},ld=class extends Ng{constructor(e){Array.isArray(e)&&(e={messages:e});super(e);d(this,"lc_namespace",["langchain_core","prompt_values"]);d(this,"lc_serializable",!0);d(this,"messages");this.messages=e.messages}static lc_name(){return"ChatPromptValue"}toString(){return zc(this.messages)}toChatMessages(){return this.messages}},mI=class extends Ng{constructor(e){"imageUrl"in e||(e={imageUrl:e});super(e);d(this,"lc_namespace",["langchain_core","prompt_values"]);d(this,"lc_serializable",!0);d(this,"imageUrl");d(this,"value");this.imageUrl=e.imageUrl}static lc_name(){return"ImagePromptValue"}toString(){return this.imageUrl.url}toChatMessages(){return[new $t({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}};var hI={};z(hI,{BaseStore:()=>ez,InMemoryStore:()=>YH});var ez=class extends It{},YH=class extends ez{constructor(){super(...arguments);d(this,"lc_namespace",["langchain","storage"]);d(this,"store",{})}async mget(e){return e.map(r=>this.store[r])}async mset(e){for(let[r,n]of e)this.store[r]=n}async mdelete(e){for(let r of e)delete this.store[r]}async*yieldKeys(e){let r=Object.keys(this.store);for(let n of r)(e===void 0||n.startsWith(e))&&(yield n)}};var gI={};z(gI,{BaseRetriever:()=>pd});var pd=class extends pe{constructor(e){super(e);d(this,"callbacks");d(this,"tags");d(this,"metadata");d(this,"verbose");this.callbacks=e?.callbacks,this.tags=e?.tags??[],this.metadata=e?.metadata??{},this.verbose=e?.verbose??!1}_getRelevantDocuments(e,r){throw new Error("Not implemented!")}async invoke(e,r){let n=Re(cs(r)),o=await(await Et.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}))?.handleRetrieverStart(this.toJSON(),e,n.runId,void 0,void 0,void 0,n.runName);try{let a=await this._getRelevantDocuments(e,o);return await o?.handleRetrieverEnd(a),a}catch(a){throw await o?.handleRetrieverError(a),a}}};var _I={};z(_I,{SaveableVectorStore:()=>QH,VectorStore:()=>Mg,VectorStoreRetriever:()=>Rg});var Rg=class extends pd{constructor(e){super(e);d(this,"vectorStore");d(this,"k",4);d(this,"searchType","similarity");d(this,"searchKwargs");d(this,"filter");this.vectorStore=e.vectorStore,this.k=e.k??this.k,this.searchType=e.searchType??this.searchType,this.filter=e.filter,e.searchType==="mmr"&&(this.searchKwargs=e.searchKwargs)}static lc_name(){return"VectorStoreRetriever"}get lc_namespace(){return["langchain_core","vectorstores"]}_vectorstoreType(){return this.vectorStore._vectorstoreType()}async _getRelevantDocuments(e,r){if(this.searchType==="mmr"){if(typeof this.vectorStore.maxMarginalRelevanceSearch!="function")throw new Error(`The vector store backing this retriever, ${this._vectorstoreType()} does not support max marginal relevance search.`);return this.vectorStore.maxMarginalRelevanceSearch(e,{k:this.k,filter:this.filter,...this.searchKwargs},r?.getChild("vectorstore"))}return this.vectorStore.similaritySearch(e,this.k,this.filter,r?.getChild("vectorstore"))}async addDocuments(e,r){return this.vectorStore.addDocuments(e,r)}},Mg=class extends It{constructor(e,r){super(r);d(this,"lc_namespace",["langchain","vectorstores",this._vectorstoreType()]);d(this,"embeddings");this.embeddings=e}async delete(e){throw new Error("Not implemented.")}async similaritySearch(e,r=4,n=void 0,i=void 0){return(await this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),r,n)).map(a=>a[0])}async similaritySearchWithScore(e,r=4,n=void 0,i=void 0){return this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),r,n)}static fromTexts(e,r,n,i){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}static fromDocuments(e,r,n){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}asRetriever(e,r,n,i,o,a){if(typeof e=="number")return new Rg({vectorStore:this,k:e,filter:r,tags:[...i??[],this._vectorstoreType()],metadata:o,verbose:a,callbacks:n});{let s={vectorStore:this,k:e?.k,filter:e?.filter,tags:[...e?.tags??[],this._vectorstoreType()],metadata:e?.metadata,verbose:e?.verbose,callbacks:e?.callbacks,searchType:e?.searchType};return e?.searchType==="mmr"?new Rg({...s,searchKwargs:e.searchKwargs}):new Rg({...s})}}},QH=class extends Mg{static load(t,e){throw new Error("Not implemented")}};var ie="0123456789abcdef".split(""),eq=[-2147483648,8388608,32768,128],Jn=[24,16,8,0],zg=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],Zt=[];function Xn(t,e){e?(Zt[0]=Zt[16]=Zt[1]=Zt[2]=Zt[3]=Zt[4]=Zt[5]=Zt[6]=Zt[7]=Zt[8]=Zt[9]=Zt[10]=Zt[11]=Zt[12]=Zt[13]=Zt[14]=Zt[15]=0,this.blocks=Zt):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=t}Xn.prototype.update=function(t){if(!this.finalized){var e,r=typeof t;if(r!=="string"){if(r==="object"){if(t===null)throw new Error(ERROR);if(ARRAY_BUFFER&&t.constructor===ArrayBuffer)t=new Uint8Array(t);else if(!Array.isArray(t)&&(!ARRAY_BUFFER||!ArrayBuffer.isView(t)))throw new Error(ERROR)}else throw new Error(ERROR);e=!0}for(var n,i=0,o,a=t.length,s=this.blocks;i<a;){if(this.hashed&&(this.hashed=!1,s[0]=this.block,this.block=s[16]=s[1]=s[2]=s[3]=s[4]=s[5]=s[6]=s[7]=s[8]=s[9]=s[10]=s[11]=s[12]=s[13]=s[14]=s[15]=0),e)for(o=this.start;i<a&&o<64;++i)s[o>>>2]|=t[i]<<Jn[o++&3];else for(o=this.start;i<a&&o<64;++i)n=t.charCodeAt(i),n<128?s[o>>>2]|=n<<Jn[o++&3]:n<2048?(s[o>>>2]|=(192|n>>>6)<<Jn[o++&3],s[o>>>2]|=(128|n&63)<<Jn[o++&3]):n<55296||n>=57344?(s[o>>>2]|=(224|n>>>12)<<Jn[o++&3],s[o>>>2]|=(128|n>>>6&63)<<Jn[o++&3],s[o>>>2]|=(128|n&63)<<Jn[o++&3]):(n=65536+((n&1023)<<10|t.charCodeAt(++i)&1023),s[o>>>2]|=(240|n>>>18)<<Jn[o++&3],s[o>>>2]|=(128|n>>>12&63)<<Jn[o++&3],s[o>>>2]|=(128|n>>>6&63)<<Jn[o++&3],s[o>>>2]|=(128|n&63)<<Jn[o++&3]);this.lastByteIndex=o,this.bytes+=o-this.start,o>=64?(this.block=s[16],this.start=o-64,this.hash(),this.hashed=!0):this.start=o}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};Xn.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var t=this.blocks,e=this.lastByteIndex;t[16]=this.block,t[e>>>2]|=eq[e&3],this.block=t[16],e>=56&&(this.hashed||this.hash(),t[0]=this.block,t[16]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=t[9]=t[10]=t[11]=t[12]=t[13]=t[14]=t[15]=0),t[14]=this.hBytes<<3|this.bytes>>>29,t[15]=this.bytes<<3,this.hash()}};Xn.prototype.hash=function(){var t=this.h0,e=this.h1,r=this.h2,n=this.h3,i=this.h4,o=this.h5,a=this.h6,s=this.h7,c=this.blocks,u,l,p,f,m,h,g,x,y,v,S;for(u=16;u<64;++u)m=c[u-15],l=(m>>>7|m<<25)^(m>>>18|m<<14)^m>>>3,m=c[u-2],p=(m>>>17|m<<15)^(m>>>19|m<<13)^m>>>10,c[u]=c[u-16]+l+c[u-7]+p<<0;for(S=e&r,u=0;u<64;u+=4)this.first?(this.is224?(x=300032,m=c[0]-1413257819,s=m-150054599<<0,n=m+24177077<<0):(x=704751109,m=c[0]-210244248,s=m-1521486534<<0,n=m+143694565<<0),this.first=!1):(l=(t>>>2|t<<30)^(t>>>13|t<<19)^(t>>>22|t<<10),p=(i>>>6|i<<26)^(i>>>11|i<<21)^(i>>>25|i<<7),x=t&e,f=x^t&r^S,g=i&o^~i&a,m=s+p+g+zg[u]+c[u],h=l+f,s=n+m<<0,n=m+h<<0),l=(n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10),p=(s>>>6|s<<26)^(s>>>11|s<<21)^(s>>>25|s<<7),y=n&t,f=y^n&e^x,g=a&s^~a&i,m=o+p+g+zg[u+1]+c[u+1],h=l+f,a=r+m<<0,r=m+h<<0,l=(r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10),p=(a>>>6|a<<26)^(a>>>11|a<<21)^(a>>>25|a<<7),v=r&n,f=v^r&t^y,g=o&a^~o&s,m=i+p+g+zg[u+2]+c[u+2],h=l+f,o=e+m<<0,e=m+h<<0,l=(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10),p=(o>>>6|o<<26)^(o>>>11|o<<21)^(o>>>25|o<<7),S=e&r,f=S^e&n^v,g=o&a^~o&s,m=i+p+g+zg[u+3]+c[u+3],h=l+f,i=t+m<<0,t=m+h<<0,this.chromeBugWorkAround=!0;this.h0=this.h0+t<<0,this.h1=this.h1+e<<0,this.h2=this.h2+r<<0,this.h3=this.h3+n<<0,this.h4=this.h4+i<<0,this.h5=this.h5+o<<0,this.h6=this.h6+a<<0,this.h7=this.h7+s<<0};Xn.prototype.hex=function(){this.finalize();var t=this.h0,e=this.h1,r=this.h2,n=this.h3,i=this.h4,o=this.h5,a=this.h6,s=this.h7,c=ie[t>>>28&15]+ie[t>>>24&15]+ie[t>>>20&15]+ie[t>>>16&15]+ie[t>>>12&15]+ie[t>>>8&15]+ie[t>>>4&15]+ie[t&15]+ie[e>>>28&15]+ie[e>>>24&15]+ie[e>>>20&15]+ie[e>>>16&15]+ie[e>>>12&15]+ie[e>>>8&15]+ie[e>>>4&15]+ie[e&15]+ie[r>>>28&15]+ie[r>>>24&15]+ie[r>>>20&15]+ie[r>>>16&15]+ie[r>>>12&15]+ie[r>>>8&15]+ie[r>>>4&15]+ie[r&15]+ie[n>>>28&15]+ie[n>>>24&15]+ie[n>>>20&15]+ie[n>>>16&15]+ie[n>>>12&15]+ie[n>>>8&15]+ie[n>>>4&15]+ie[n&15]+ie[i>>>28&15]+ie[i>>>24&15]+ie[i>>>20&15]+ie[i>>>16&15]+ie[i>>>12&15]+ie[i>>>8&15]+ie[i>>>4&15]+ie[i&15]+ie[o>>>28&15]+ie[o>>>24&15]+ie[o>>>20&15]+ie[o>>>16&15]+ie[o>>>12&15]+ie[o>>>8&15]+ie[o>>>4&15]+ie[o&15]+ie[a>>>28&15]+ie[a>>>24&15]+ie[a>>>20&15]+ie[a>>>16&15]+ie[a>>>12&15]+ie[a>>>8&15]+ie[a>>>4&15]+ie[a&15];return this.is224||(c+=ie[s>>>28&15]+ie[s>>>24&15]+ie[s>>>20&15]+ie[s>>>16&15]+ie[s>>>12&15]+ie[s>>>8&15]+ie[s>>>4&15]+ie[s&15]),c};Xn.prototype.toString=Xn.prototype.hex;Xn.prototype.digest=function(){this.finalize();var t=this.h0,e=this.h1,r=this.h2,n=this.h3,i=this.h4,o=this.h5,a=this.h6,s=this.h7,c=[t>>>24&255,t>>>16&255,t>>>8&255,t&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255,r>>>24&255,r>>>16&255,r>>>8&255,r&255,n>>>24&255,n>>>16&255,n>>>8&255,n&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255,o>>>24&255,o>>>16&255,o>>>8&255,o&255,a>>>24&255,a>>>16&255,a>>>8&255,a&255];return this.is224||c.push(s>>>24&255,s>>>16&255,s>>>8&255,s&255),c};Xn.prototype.array=Xn.prototype.digest;Xn.prototype.arrayBuffer=function(){this.finalize();var t=new ArrayBuffer(this.is224?28:32),e=new DataView(t);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),e.setUint32(20,this.h5),e.setUint32(24,this.h6),this.is224||e.setUint32(28,this.h7),t};var Iu=(...t)=>new Xn(!1,!0).update(t.join("")).hex();var yI={};z(yI,{sha256:()=>Iu});var vI={};z(vI,{BaseCache:()=>rz,InMemoryCache:()=>bI,defaultHashKeyEncoder:()=>tz,deserializeStoredGeneration:()=>tq,serializeGeneration:()=>rq});var tz=(...t)=>Iu(t.join("_"));function tq(t){return t.message!==void 0?{text:t.text,message:op(t.message)}:{text:t.text}}function rq(t){let e={text:t.text};return t.message!==void 0&&(e.message=t.message.toDict()),e}var rz=class{constructor(){d(this,"keyEncoder",tz)}makeDefaultKeyEncoder(t){this.keyEncoder=t}},nq=new Map,bI=class nz extends rz{constructor(r){super();d(this,"cache");this.cache=r??new Map}lookup(r,n){return Promise.resolve(this.cache.get(this.keyEncoder(r,n))??null)}async update(r,n,i){this.cache.set(this.keyEncoder(r,n),i)}static global(){return new nz(nq)}};var wI={};z(wI,{BaseDocumentLoader:()=>xI});var xI=class{};var SI={};z(SI,{LangSmithLoader:()=>iq});var iq=class extends xI{constructor(e){super();d(this,"datasetId");d(this,"datasetName");d(this,"exampleIds");d(this,"asOf");d(this,"splits");d(this,"inlineS3Urls");d(this,"offset");d(this,"limit");d(this,"metadata");d(this,"filter");d(this,"contentKey");d(this,"formatContent");d(this,"client");if(e.client&&e.clientConfig)throw new Error("client and clientConfig cannot both be provided.");this.client=e.client??new uo(e?.clientConfig),this.contentKey=e.contentKey?e.contentKey.split("."):[],this.formatContent=e.formatContent??oq,this.datasetId=e.datasetId,this.datasetName=e.datasetName,this.exampleIds=e.exampleIds,this.asOf=e.asOf,this.splits=e.splits,this.inlineS3Urls=e.inlineS3Urls,this.offset=e.offset,this.limit=e.limit,this.metadata=e.metadata,this.filter=e.filter}async load(){let e=[];for await(let r of this.client.listExamples({datasetId:this.datasetId,datasetName:this.datasetName,exampleIds:this.exampleIds,asOf:this.asOf,splits:this.splits,inlineS3Urls:this.inlineS3Urls,offset:this.offset,limit:this.limit,metadata:this.metadata,filter:this.filter})){let n=r.inputs;for(let a of this.contentKey)n=n[a];let i=this.formatContent(n),o=r;["created_at","modified_at"].forEach(a=>{a in o&&typeof o[a]=="object"&&(o[a]=o[a].toString())}),e.push({pageContent:i,metadata:o})}return e}};function oq(t){if(typeof t=="string")return t;try{return JSON.stringify(t,null,2)}catch{return String(t)}}var an=class{constructor(t){d(this,"pageContent");d(this,"metadata");d(this,"id");this.pageContent=t.pageContent!==void 0?t.pageContent.toString():"",this.metadata=t.metadata??{},this.id=t.id}};var II=class extends pe{constructor(){super(...arguments);d(this,"lc_namespace",["langchain_core","documents","transformers"])}invoke(e,r){return this.transformDocuments(e)}},iz=class extends II{async transformDocuments(t){let e=[];for(let r of t){let n=await this._transformDocument(r);e.push(n)}return e}};var kI={};z(kI,{BaseDocumentTransformer:()=>II,Document:()=>an,MappingDocumentTransformer:()=>iz});var ku=class extends It{constructor(){super(...arguments);d(this,"lc_namespace",["langchain_core","example_selectors","base"])}};var EI=class{async getPromptAsync(t,e){return this.getPrompt(t).partial(e?.partialVariables??{})}},oz=class extends EI{constructor(e,r=[]){super();d(this,"defaultPrompt");d(this,"conditionals");this.defaultPrompt=e,this.conditionals=r}getPrompt(e){for(let[r,n]of this.conditionals)if(r(e))return n;return this.defaultPrompt}};function az(t){return t._modelType()==="base_llm"}function sz(t){return t._modelType()==="base_chat_model"}function cz(t){return t.split(/\n| /).length}var uz=class lz extends ku{constructor(r){super(r);d(this,"examples",[]);d(this,"examplePrompt");d(this,"getTextLength",cz);d(this,"maxLength",2048);d(this,"exampleTextLengths",[]);this.examplePrompt=r.examplePrompt,this.maxLength=r.maxLength??2048,this.getTextLength=r.getTextLength??cz}async addExample(r){this.examples.push(r);let n=await this.examplePrompt.format(r);this.exampleTextLengths.push(this.getTextLength(n))}async calculateExampleTextLengths(r,n){if(r.length>0)return r;let{examples:i,examplePrompt:o}=n;return(await Promise.all(i.map(s=>o.format(s)))).map(s=>this.getTextLength(s))}async selectExamples(r){let n=Object.values(r).join(" "),i=this.maxLength-this.getTextLength(n),o=0,a=[];for(;i>0&&o<this.examples.length;){let s=i-this.exampleTextLengths[o];if(s<0)break;a.push(this.examples[o]),i=s,o+=1}return a}static async fromExamples(r,n){let i=new lz(n);return await Promise.all(r.map(o=>i.addExample(o))),i}};function AI(t){return Object.keys(t).sort().map(e=>t[e])}var pz=class dz extends ku{constructor(r){super(r);d(this,"vectorStoreRetriever");d(this,"exampleKeys");d(this,"inputKeys");if(this.exampleKeys=r.exampleKeys,this.inputKeys=r.inputKeys,r.vectorStore!==void 0)this.vectorStoreRetriever=r.vectorStore.asRetriever({k:r.k??4,filter:r.filter});else if(r.vectorStoreRetriever)this.vectorStoreRetriever=r.vectorStoreRetriever;else throw new Error('You must specify one of "vectorStore" and "vectorStoreRetriever".')}async addExample(r){let n=this.inputKeys??Object.keys(r),i=AI(n.reduce((o,a)=>({...o,[a]:r[a]}),{})).join(" ");await this.vectorStoreRetriever.addDocuments([new an({pageContent:i,metadata:r})])}async selectExamples(r){let n=this.inputKeys??Object.keys(r),i=AI(n.reduce((s,c)=>({...s,[c]:r[c]}),{})).join(" "),a=(await this.vectorStoreRetriever.invoke(i)).map(s=>s.metadata);return this.exampleKeys?a.map(s=>this.exampleKeys.reduce((c,u)=>({...c,[u]:s[u]}),{})):a}static async fromExamples(r,n,i,o={}){let a=o.inputKeys??null,s=r.map(u=>AI(a?a.reduce((l,p)=>({...l,[p]:u[p]}),{}):u).join(" ")),c=await i.fromTexts(s,r,n,o);return new dz({vectorStore:c,k:o.k??4,exampleKeys:o.exampleKeys,inputKeys:o.inputKeys})}};var TI={};z(TI,{BaseExampleSelector:()=>ku,BasePromptSelector:()=>EI,ConditionalPromptSelector:()=>oz,LengthBasedExampleSelector:()=>uz,SemanticSimilarityExampleSelector:()=>pz,isChatModel:()=>sz,isLLM:()=>az});var dd="10f90ea3-90a4-4962-bf75-83a0f3c1c62a",fz=class extends It{constructor(){super(...arguments);d(this,"lc_namespace",["langchain","recordmanagers"])}};var $I=class{constructor(t){d(this,"uid");d(this,"hash_");d(this,"contentHash");d(this,"metadataHash");d(this,"pageContent");d(this,"metadata");d(this,"keyEncoder",Iu);this.uid=t.uid,this.pageContent=t.pageContent,this.metadata=t.metadata}makeDefaultKeyEncoder(t){this.keyEncoder=t}calculateHashes(){let t=["hash_","content_hash","metadata_hash"];for(let r of t)if(r in this.metadata)throw new Error(`Metadata cannot contain key ${r} as it is reserved for internal use. Restricted keys: [${t.join(", ")}]`);let e=this._hashStringToUUID(this.pageContent);try{let r=this._hashNestedDictToUUID(this.metadata);this.contentHash=e,this.metadataHash=r}catch(r){throw new Error(`Failed to hash metadata: ${r}. Please use a dict that can be serialized using json.`)}this.hash_=this._hashStringToUUID(this.contentHash+this.metadataHash),this.uid||(this.uid=this.hash_)}toDocument(){return new an({pageContent:this.pageContent,metadata:this.metadata})}static fromDocument(t,e){let r=new this({pageContent:t.pageContent,metadata:t.metadata,uid:e||t.uid});return r.calculateHashes(),r}_hashStringToUUID(t){let e=this.keyEncoder(t);return yn(e,dd)}_hashNestedDictToUUID(t){let e=JSON.stringify(t,Object.keys(t).sort()),r=this.keyEncoder(e);return yn(r,dd)}};function OI(t,e){let r=[],n=[];return e.forEach(i=>{n.push(i),n.length>=t&&(r.push(n),n=[])}),n.length>0&&r.push(n),r}function CI(t){let e=new Set,r=[];for(let n of t){if(!n.hash_)throw new Error("Hashed document does not have a hash");e.has(n.hash_)||(e.add(n.hash_),r.push(n))}return r}function PI(t){if(t===null)return e=>null;if(typeof t=="string")return e=>e.metadata[t];if(typeof t=="function")return t;throw new Error(`sourceIdKey should be null, a string or a function, got ${typeof t}`)}var NI=t=>"load"in t&&typeof t.load=="function"&&"loadAndSplit"in t&&typeof t.loadAndSplit=="function";async function mz(t){let{docsSource:e,recordManager:r,vectorStore:n,options:i}=t,{batchSize:o=100,cleanup:a,sourceIdKey:s,cleanupBatchSize:c=1e3,forceUpdate:u=!1}=i??{};if(a==="incremental"&&!s)throw new Error("sourceIdKey is required when cleanup mode is incremental. Please provide through 'options.sourceIdKey'.");let l=NI(e)?await e.load():e,p=PI(s??null),f=await r.getTime(),m=0,h=0,g=0,x=0,y=OI(o??100,l);for(let v of y){let S=CI(v.map(F=>$I.fromDocument(F))),k=S.map(F=>p(F));a==="incremental"&&S.forEach((F,R)=>{if(k[R]===null)throw new Error("sourceIdKey must be provided when cleanup is incremental")});let T=await r.exists(S.map(F=>F.uid)),N=[],U=[],w=[],V=new Set;if(S.forEach((F,R)=>{if(T[R])if(u)V.add(F.uid);else{w.push(F.uid);return}N.push(F.uid),U.push(F.toDocument())}),w.length>0&&(await r.update(w,{timeAtLeast:f}),x+=w.length),U.length>0&&(await n.addDocuments(U,{ids:N}),m+=U.length-V.size,g+=V.size),await r.update(S.map(F=>F.uid),{timeAtLeast:f,groupIds:k}),a==="incremental"){k.forEach(R=>{if(!R)throw new Error("Source id cannot be null")});let F=await r.listKeys({before:f,groupIds:k});F.length>0&&(await n.delete({ids:F}),await r.deleteKeys(F),h+=F.length)}}if(a==="full"){let v=await r.listKeys({before:f,limit:c});for(;v.length>0;)await n.delete({ids:v}),await r.deleteKeys(v),h+=v.length,v=await r.listKeys({before:f,limit:c})}return{numAdded:m,numDeleted:h,numUpdated:g,numSkipped:x}}var RI={};z(RI,{RecordManager:()=>fz,UUIDV5_NAMESPACE:()=>dd,_HashedDocument:()=>$I,_batch:()=>OI,_deduplicateInOrder:()=>CI,_getSourceIdAssigner:()=>PI,_isBaseDocumentLoader:()=>NI,index:()=>mz});var yz=Wo(_z(),1);var fq=Object.defineProperty,mq=(t,e,r)=>e in t?fq(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,hq=(t,e,r)=>(mq(t,typeof e!="symbol"?e+"":e,r),r);function gq(t,e){let r=Array.from({length:t.length},(n,i)=>({start:i,end:i+1}));for(;r.length>1;){let n=null;for(let i=0;i<r.length-1;i++){let o=t.slice(r[i].start,r[i+1].end),a=e.get(o.join(","));a!=null&&(n==null||a<n[0])&&(n=[a,i])}if(n!=null){let i=n[1];r[i]={start:r[i].start,end:r[i+1].end},r.splice(i+1,1)}else break}return r}function _q(t,e){return t.length===1?[e.get(t.join(","))]:gq(t,e).map(r=>e.get(t.slice(r.start,r.end).join(","))).filter(r=>r!=null)}function yq(t){return t.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var zI=class{constructor(t,e){d(this,"specialTokens");d(this,"inverseSpecialTokens");d(this,"patStr");d(this,"textEncoder",new TextEncoder);d(this,"textDecoder",new TextDecoder("utf-8"));d(this,"rankMap",new Map);d(this,"textMap",new Map);this.patStr=t.pat_str;let r=t.bpe_ranks.split(`
`).filter(Boolean).reduce((n,i)=>{let[o,a,...s]=i.split(" "),c=Number.parseInt(a,10);return s.forEach((u,l)=>n[u]=c+l),n},{});for(let[n,i]of Object.entries(r)){let o=yz.default.toByteArray(n);this.rankMap.set(o.join(","),i),this.textMap.set(i,o)}this.specialTokens={...t.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((n,[i,o])=>(n[o]=this.textEncoder.encode(i),n),{})}encode(t,e=[],r="all"){let n=new RegExp(this.patStr,"ug"),i=zI.specialTokenRegex(Object.keys(this.specialTokens)),o=[],a=new Set(e==="all"?Object.keys(this.specialTokens):e),s=new Set(r==="all"?Object.keys(this.specialTokens).filter(u=>!a.has(u)):r);if(s.size>0){let u=zI.specialTokenRegex([...s]),l=t.match(u);if(l!=null)throw new Error(`The text contains a special token that is not allowed: ${l[0]}`)}let c=0;for(;;){let u=null,l=c;for(;i.lastIndex=l,u=i.exec(t),!(u==null||a.has(u[0]));)l=u.index+1;let p=u?.index??t.length;for(let m of t.substring(c,p).matchAll(n)){let h=this.textEncoder.encode(m[0]),g=this.rankMap.get(h.join(","));if(g!=null){o.push(g);continue}o.push(..._q(h,this.rankMap))}if(u==null)break;let f=this.specialTokens[u[0]];o.push(f),c=u.index+u[0].length}return o}decode(t){let e=[],r=0;for(let o=0;o<t.length;++o){let a=t[o],s=this.textMap.get(a)??this.inverseSpecialTokens[a];s!=null&&(e.push(s),r+=s.length)}let n=new Uint8Array(r),i=0;for(let o of e)n.set(o,i),i+=o.length;return this.textDecoder.decode(n)}},Dg=zI;hq(Dg,"specialTokenRegex",t=>new RegExp(t.map(e=>yq(e)).join("|"),"g"));function jI(t){switch(t){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":case"gpt-5":case"gpt-5-2025-08-07":case"gpt-5-nano":case"gpt-5-nano-2025-08-07":case"gpt-5-mini":case"gpt-5-mini-2025-08-07":case"gpt-5-chat-latest":return"o200k_base";default:throw new Error("Unknown model")}}var DI={};z(DI,{encodingForModel:()=>Ug,getEncoding:()=>vz});var Lg={},vq=new mo({});async function vz(t){return t in Lg||(Lg[t]=vq.fetch(`https://tiktoken.pages.dev/js/${t}.json`).then(e=>e.json()).then(e=>new Dg(e)).catch(e=>{throw delete Lg[t],e})),await Lg[t]}async function Ug(t){return vz(jI(t))}var LI={};z(LI,{BaseLangChain:()=>Bg,BaseLanguageModel:()=>md,calculateMaxTokens:()=>wz,getEmbeddingContextSize:()=>bq,getModelContextSize:()=>bz,getModelNameForTiktoken:()=>Fg,isOpenAITool:()=>fd});var Fg=t=>t.startsWith("gpt-5")?"gpt-5":t.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":t.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":t.startsWith("gpt-4-32k")?"gpt-4-32k":t.startsWith("gpt-4-")?"gpt-4":t.startsWith("gpt-4o")?"gpt-4o":t,bq=t=>t==="text-embedding-ada-002"?8191:2046,bz=t=>{switch(Fg(t)){case"gpt-5":case"gpt-5-turbo":case"gpt-5-turbo-preview":return 4e5;case"gpt-4o":case"gpt-4o-mini":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":return 128e3;case"gpt-4-turbo":case"gpt-4-turbo-preview":case"gpt-4-turbo-2024-04-09":case"gpt-4-0125-preview":case"gpt-4-1106-preview":return 128e3;case"gpt-4-32k":case"gpt-4-32k-0314":case"gpt-4-32k-0613":return 32768;case"gpt-4":case"gpt-4-0314":case"gpt-4-0613":return 8192;case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-16k-0613":return 16384;case"gpt-3.5-turbo":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-1106":case"gpt-3.5-turbo-0125":return 4096;case"text-davinci-003":case"text-davinci-002":return 4097;case"text-davinci-001":return 2049;case"text-curie-001":case"text-babbage-001":case"text-ada-001":return 2048;case"code-davinci-002":case"code-davinci-001":return 8e3;case"code-cushman-001":return 2048;case"claude-3-5-sonnet-20241022":case"claude-3-5-sonnet-20240620":case"claude-3-opus-20240229":case"claude-3-sonnet-20240229":case"claude-3-haiku-20240307":case"claude-2.1":return 2e5;case"claude-2.0":case"claude-instant-1.2":return 1e5;case"gemini-1.5-pro":case"gemini-1.5-pro-latest":case"gemini-1.5-flash":case"gemini-1.5-flash-latest":return 1e6;case"gemini-pro":case"gemini-pro-vision":return 32768;default:return 4097}};function fd(t){return typeof t!="object"||!t?!1:!!("type"in t&&t.type==="function"&&"function"in t&&typeof t.function=="object"&&t.function&&"name"in t.function&&"parameters"in t.function)}var wz=async({prompt:t,modelName:e})=>{let r;try{r=(await Ug(Fg(e))).encode(t).length}catch{console.warn("Failed to calculate number of tokens, falling back to approximate count"),r=Math.ceil(t.length/4)}return bz(e)-r},wq=()=>!1,Bg=class extends pe{constructor(e){super(e);d(this,"verbose");d(this,"callbacks");d(this,"tags");d(this,"metadata");this.verbose=e.verbose??wq(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}get lc_attributes(){return{callbacks:void 0,verbose:void 0}}},md=class extends Bg{constructor({callbacks:e,callbackManager:r,...n}){let{cache:i,...o}=n;super({callbacks:e??r,...o});d(this,"caller");d(this,"cache");d(this,"_encoding");typeof i=="object"?this.cache=i:i?this.cache=bI.global():this.cache=void 0,this.caller=new mo(n??{})}get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}async getNumTokens(e){let r;typeof e=="string"?r=e:r=e.map(i=>typeof i=="string"?i:i.type==="text"&&"text"in i?i.text:"").join("");let n=Math.ceil(r.length/4);if(!this._encoding)try{this._encoding=await Ug("modelName"in this?Fg(this.modelName):"gpt2")}catch(i){console.warn("Failed to calculate number of tokens, falling back to approximate count",i)}if(this._encoding)try{n=this._encoding.encode(r).length}catch(i){console.warn("Failed to calculate number of tokens, falling back to approximate count",i)}return n}static _convertInputToPromptValue(e){return typeof e=="string"?new ud(e):Array.isArray(e)?new ld(e.map(nr)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...r}){let n={...this._identifyingParams(),...r,_type:this._llmType(),_model:this._modelType()};return Object.entries(n).filter(([a,s])=>s!==void 0).map(([a,s])=>`${a}:${JSON.stringify(s)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}get profile(){return{}}};var Pn=class extends pe{constructor(e){super(e);d(this,"lc_namespace",["langchain_core","runnables"]);d(this,"lc_serializable",!0);d(this,"func");e&&(this.func=e.func)}static lc_name(){return"RunnablePassthrough"}async invoke(e,r){let n=Re(r);return this.func&&await this.func(e,n),this._callWithConfig(i=>Promise.resolve(i),e,n)}async*transform(e,r){let n=Re(r),i,o=!0;for await(let a of this._transformStreamWithConfig(e,s=>s,n))if(yield a,o)if(i===void 0)i=a;else try{i=en(i,a)}catch{i=void 0,o=!1}this.func&&i!==void 0&&await this.func(i,n)}static assign(e){return new sd(new ka({steps:e}))}};var xz=t=>t();function Vg(t){let e=t.constructor;return new e({...t,content:t.contentBlocks,response_metadata:{...t.response_metadata,output_version:"v1"}})}var FI={};z(FI,{BaseChatModel:()=>Ea,SimpleChatModel:()=>xq});function UI(t){let e=[];for(let r of t){let n=r;if(Array.isArray(r.content))for(let i=0;i<r.content.length;i++){let o=r.content[i];(Cc(o)||Pc(o))&&n===r&&(n=new r.constructor({...n,content:[...r.content.slice(0,i),Uf(o),...r.content.slice(i+1)]}))}e.push(n)}return e}var Ea=class Us extends md{constructor(r){super(r);d(this,"lc_namespace",["langchain","chat_models",this._llmType()]);d(this,"disableStreaming",!1);d(this,"outputVersion");this.outputVersion=xz(()=>{let n=r.outputVersion??ft("LC_OUTPUT_VERSION");return n&&["v0","v1"].includes(n)?n:"v0"})}get callKeys(){return[...super.callKeys,"outputVersion"]}_separateRunnableConfigFromCallOptionsCompat(r){let[n,i]=super._separateRunnableConfigFromCallOptions(r);return i.signal=n.signal,[n,i]}async invoke(r,n){let i=Us._convertInputToPromptValue(r);return(await this.generatePrompt([i],n,n?.callbacks)).generations[0][0].message}async*_streamResponseChunks(r,n,i){throw new Error("Not implemented.")}async*_streamIterator(r,n){if(this._streamResponseChunks===Us.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(r,n);else{let o=Us._convertInputToPromptValue(r).toChatMessages(),[a,s]=this._separateRunnableConfigFromCallOptionsCompat(n),c={...a.metadata,...this.getLsParams(s)},u=await Et.configure(a.callbacks,this.callbacks,a.tags,this.tags,c,this.metadata,{verbose:this.verbose}),l={options:s,invocation_params:this?.invocationParams(s),batch_size:1},p=s.outputVersion??this.outputVersion,f=await u?.handleChatModelStart(this.toJSON(),[UI(o)],a.runId,void 0,l,void 0,void 0,a.runName),m,h;try{for await(let g of this._streamResponseChunks(o,s,f?.[0])){if(g.message.id==null){let x=f?.at(0)?.runId;x!=null&&g.message._updateId(`run-${x}`)}g.message.response_metadata={...g.generationInfo,...g.message.response_metadata},p==="v1"?yield Vg(g.message):yield g.message,m?m=m.concat(g):m=g,ip(g.message)&&g.message.usage_metadata!==void 0&&(h={tokenUsage:{promptTokens:g.message.usage_metadata.input_tokens,completionTokens:g.message.usage_metadata.output_tokens,totalTokens:g.message.usage_metadata.total_tokens}})}}catch(g){throw await Promise.all((f??[]).map(x=>x?.handleLLMError(g))),g}await Promise.all((f??[]).map(g=>g?.handleLLMEnd({generations:[[m]],llmOutput:h})))}}getLsParams(r){let n=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:r.stop,ls_provider:n}}async _generateUncached(r,n,i,o){let a=r.map(m=>m.map(nr)),s;if(o!==void 0&&o.length===a.length)s=o;else{let m={...i.metadata,...this.getLsParams(n)},h=await Et.configure(i.callbacks,this.callbacks,i.tags,this.tags,m,this.metadata,{verbose:this.verbose}),g={options:n,invocation_params:this?.invocationParams(n),batch_size:1};s=await h?.handleChatModelStart(this.toJSON(),a.map(UI),i.runId,void 0,g,void 0,void 0,i.runName)}let c=n.outputVersion??this.outputVersion,u=[],l=[];if(!!s?.[0].handlers.find(ap)&&!this.disableStreaming&&a.length===1&&this._streamResponseChunks!==Us.prototype._streamResponseChunks)try{let m=await this._streamResponseChunks(a[0],n,s?.[0]),h,g;for await(let x of m){if(x.message.id==null){let y=s?.at(0)?.runId;y!=null&&x.message._updateId(`run-${y}`)}h===void 0?h=x:h=en(h,x),ip(x.message)&&x.message.usage_metadata!==void 0&&(g={tokenUsage:{promptTokens:x.message.usage_metadata.input_tokens,completionTokens:x.message.usage_metadata.output_tokens,totalTokens:x.message.usage_metadata.total_tokens}})}if(h===void 0)throw new Error("Received empty response from chat model call.");u.push([h]),await s?.[0].handleLLMEnd({generations:u,llmOutput:g})}catch(m){throw await s?.[0].handleLLMError(m),m}else{let m=await Promise.allSettled(a.map(async(h,g)=>{let x=await this._generate(h,{...n,promptIndex:g},s?.[g]);if(c==="v1")for(let y of x.generations)y.message=Vg(y.message);return x}));await Promise.all(m.map(async(h,g)=>{if(h.status==="fulfilled"){let x=h.value;for(let y of x.generations){if(y.message.id==null){let v=s?.at(0)?.runId;v!=null&&y.message._updateId(`run-${v}`)}y.message.response_metadata={...y.generationInfo,...y.message.response_metadata}}return x.generations.length===1&&(x.generations[0].message.response_metadata={...x.llmOutput,...x.generations[0].message.response_metadata}),u[g]=x.generations,l[g]=x.llmOutput,s?.[g]?.handleLLMEnd({generations:[x.generations],llmOutput:x.llmOutput})}else return await s?.[g]?.handleLLMError(h.reason),Promise.reject(h.reason)}))}let f={generations:u,llmOutput:l.length?this._combineLLMOutput?.(...l):void 0};return Object.defineProperty(f,ps,{value:s?{runIds:s?.map(m=>m.runId)}:void 0,configurable:!0}),f}async _generateCached({messages:r,cache:n,llmStringKey:i,parsedOptions:o,handledOptions:a}){let s=r.map(v=>v.map(nr)),c={...a.metadata,...this.getLsParams(o)},u=await Et.configure(a.callbacks,this.callbacks,a.tags,this.tags,c,this.metadata,{verbose:this.verbose}),l={options:o,invocation_params:this?.invocationParams(o),batch_size:1},p=await u?.handleChatModelStart(this.toJSON(),s.map(UI),a.runId,void 0,l,void 0,void 0,a.runName),f=[],h=(await Promise.allSettled(s.map(async(v,S)=>{let k=Us._convertInputToPromptValue(v).toString(),T=await n.lookup(k,i);return T==null&&f.push(S),T}))).map((v,S)=>({result:v,runManager:p?.[S]})).filter(({result:v})=>v.status==="fulfilled"&&v.value!=null||v.status==="rejected"),g=o.outputVersion??this.outputVersion,x=[];await Promise.all(h.map(async({result:v,runManager:S},k)=>{if(v.status==="fulfilled"){let T=v.value;return x[k]=T.map(N=>("message"in N&&dt(N.message)&&ra(N.message)&&(N.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0},g==="v1"&&(N.message=Vg(N.message))),N.generationInfo={...N.generationInfo,tokenUsage:{}},N)),T.length&&await S?.handleLLMNewToken(T[0].text),S?.handleLLMEnd({generations:[T]},void 0,void 0,void 0,{cached:!0})}else return await S?.handleLLMError(v.reason,void 0,void 0,void 0,{cached:!0}),Promise.reject(v.reason)}));let y={generations:x,missingPromptIndices:f,startedRunManagers:p};return Object.defineProperty(y,ps,{value:p?{runIds:p?.map(v=>v.runId)}:void 0,configurable:!0}),y}async generate(r,n,i){let o;Array.isArray(n)?o={stop:n}:o=n;let a=r.map(g=>g.map(nr)),[s,c]=this._separateRunnableConfigFromCallOptionsCompat(o);if(s.callbacks=s.callbacks??i,!this.cache)return this._generateUncached(a,c,s);let{cache:u}=this,l=this._getSerializedCacheKeyParametersForCall(c),{generations:p,missingPromptIndices:f,startedRunManagers:m}=await this._generateCached({messages:a,cache:u,llmStringKey:l,parsedOptions:c,handledOptions:s}),h={};if(f.length>0){let g=await this._generateUncached(f.map(x=>a[x]),c,s,m!==void 0?f.map(x=>m?.[x]):void 0);await Promise.all(g.generations.map(async(x,y)=>{let v=f[y];p[v]=x;let S=Us._convertInputToPromptValue(a[v]).toString();return u.update(S,l,x)})),h=g.llmOutput??{}}return{generations:p,llmOutput:h}}invocationParams(r){return{}}_modelType(){return"base_chat_model"}async generatePrompt(r,n,i){let o=r.map(a=>a.toChatMessages());return this.generate(o,n,i)}withStructuredOutput(r,n){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(n?.strict)throw new Error('"strict" mode is not supported for this model by default.');let i=r,o=n?.name,a=Gn(i)??"A function available to call.",s=n?.method,c=n?.includeRaw;if(s==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let u=o??"extract",l;Er(i)?l=[{type:"function",function:{name:u,description:a,parameters:it(i)}}]:("name"in i&&(u=i.name),l=[{type:"function",function:{name:u,description:a,parameters:i}}]);let p=this.bindTools(l),f=cr.from(x=>{if(!st.isInstance(x))throw new Error("Input is not an AIMessageChunk.");if(!x.tool_calls||x.tool_calls.length===0)throw new Error("No tool calls found in the response.");let y=x.tool_calls.find(v=>v.name===u);if(!y)throw new Error(`No tool call found with name ${u}.`);return y.args});if(!c)return p.pipe(f).withConfig({runName:"StructuredOutput"});let m=Pn.assign({parsed:(x,y)=>f.invoke(x.raw,y)}),h=Pn.assign({parsed:()=>null}),g=m.withFallbacks({fallbacks:[h]});return Tr.from([{raw:p},g]).withConfig({runName:"StructuredOutputRunnable"})}},xq=class extends Ea{async _generate(t,e,r){let n=await this._call(t,e,r),i=new Ue(n);if(typeof i.content!="string")throw new Error("Cannot generate with a simple chat model when output is not a string.");return{generations:[{text:i.content,message:i}]}}};var BI={};z(BI,{BaseLLM:()=>VI,LLM:()=>Zg});var VI=class hd extends md{constructor(){super(...arguments);d(this,"lc_namespace",["langchain","llms",this._llmType()])}async invoke(r,n){let i=hd._convertInputToPromptValue(r);return(await this.generatePrompt([i],n,n?.callbacks)).generations[0][0].text}async*_streamResponseChunks(r,n,i){throw new Error("Not implemented.")}_separateRunnableConfigFromCallOptionsCompat(r){let[n,i]=super._separateRunnableConfigFromCallOptions(r);return i.signal=n.signal,[n,i]}async*_streamIterator(r,n){if(this._streamResponseChunks===hd.prototype._streamResponseChunks)yield this.invoke(r,n);else{let i=hd._convertInputToPromptValue(r),[o,a]=this._separateRunnableConfigFromCallOptionsCompat(n),s=await Et.configure(o.callbacks,this.callbacks,o.tags,this.tags,o.metadata,this.metadata,{verbose:this.verbose}),c={options:a,invocation_params:this?.invocationParams(a),batch_size:1},u=await s?.handleLLMStart(this.toJSON(),[i.toString()],o.runId,void 0,c,void 0,void 0,o.runName),l=new Ii({text:""});try{for await(let p of this._streamResponseChunks(i.toString(),a,u?.[0]))l?l=l.concat(p):l=p,typeof p.text=="string"&&(yield p.text)}catch(p){throw await Promise.all((u??[]).map(f=>f?.handleLLMError(p))),p}await Promise.all((u??[]).map(p=>p?.handleLLMEnd({generations:[[l]]})))}}async generatePrompt(r,n,i){let o=r.map(a=>a.toString());return this.generate(o,n,i)}invocationParams(r){return{}}_flattenLLMResult(r){let n=[];for(let i=0;i<r.generations.length;i+=1){let o=r.generations[i];if(i===0)n.push({generations:[o],llmOutput:r.llmOutput});else{let a=r.llmOutput?{...r.llmOutput,tokenUsage:{}}:void 0;n.push({generations:[o],llmOutput:a})}}return n}async _generateUncached(r,n,i,o){let a;if(o!==void 0&&o.length===r.length)a=o;else{let l=await Et.configure(i.callbacks,this.callbacks,i.tags,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),p={options:n,invocation_params:this?.invocationParams(n),batch_size:r.length};a=await l?.handleLLMStart(this.toJSON(),r,i.runId,void 0,p,void 0,void 0,i?.runName)}let s=!!a?.[0].handlers.find(ap),c;if(s&&r.length===1&&this._streamResponseChunks!==hd.prototype._streamResponseChunks)try{let l=await this._streamResponseChunks(r[0],n,a?.[0]),p;for await(let f of l)p===void 0?p=f:p=en(p,f);if(p===void 0)throw new Error("Received empty response from chat model call.");c={generations:[[p]],llmOutput:{}},await a?.[0].handleLLMEnd(c)}catch(l){throw await a?.[0].handleLLMError(l),l}else{try{c=await this._generate(r,n,a?.[0])}catch(p){throw await Promise.all((a??[]).map(f=>f?.handleLLMError(p))),p}let l=this._flattenLLMResult(c);await Promise.all((a??[]).map((p,f)=>p?.handleLLMEnd(l[f])))}let u=a?.map(l=>l.runId)||void 0;return Object.defineProperty(c,ps,{value:u?{runIds:u}:void 0,configurable:!0}),c}async _generateCached({prompts:r,cache:n,llmStringKey:i,parsedOptions:o,handledOptions:a,runId:s}){let c=await Et.configure(a.callbacks,this.callbacks,a.tags,this.tags,a.metadata,this.metadata,{verbose:this.verbose}),u={options:o,invocation_params:this?.invocationParams(o),batch_size:r.length},l=await c?.handleLLMStart(this.toJSON(),r,s,void 0,u,void 0,void 0,a?.runName),p=[],m=(await Promise.allSettled(r.map(async(x,y)=>{let v=await n.lookup(x,i);return v==null&&p.push(y),v}))).map((x,y)=>({result:x,runManager:l?.[y]})).filter(({result:x})=>x.status==="fulfilled"&&x.value!=null||x.status==="rejected"),h=[];await Promise.all(m.map(async({result:x,runManager:y},v)=>{if(x.status==="fulfilled"){let S=x.value;return h[v]=S.map(k=>(k.generationInfo={...k.generationInfo,tokenUsage:{}},k)),S.length&&await y?.handleLLMNewToken(S[0].text),y?.handleLLMEnd({generations:[S]},void 0,void 0,void 0,{cached:!0})}else return await y?.handleLLMError(x.reason,void 0,void 0,void 0,{cached:!0}),Promise.reject(x.reason)}));let g={generations:h,missingPromptIndices:p,startedRunManagers:l};return Object.defineProperty(g,ps,{value:l?{runIds:l?.map(x=>x.runId)}:void 0,configurable:!0}),g}async generate(r,n,i){if(!Array.isArray(r))throw new Error("Argument 'prompts' is expected to be a string[]");let o;Array.isArray(n)?o={stop:n}:o=n;let[a,s]=this._separateRunnableConfigFromCallOptionsCompat(o);if(a.callbacks=a.callbacks??i,!this.cache)return this._generateUncached(r,s,a);let{cache:c}=this,u=this._getSerializedCacheKeyParametersForCall(s),{generations:l,missingPromptIndices:p,startedRunManagers:f}=await this._generateCached({prompts:r,cache:c,llmStringKey:u,parsedOptions:s,handledOptions:a,runId:a.runId}),m={};if(p.length>0){let h=await this._generateUncached(p.map(g=>r[g]),s,a,f!==void 0?p.map(g=>f?.[g]):void 0);await Promise.all(h.generations.map(async(g,x)=>{let y=p[x];return l[y]=g,c.update(r[y],u,g)})),m=h.llmOutput??{}}return{generations:l,llmOutput:m}}_identifyingParams(){return{}}_modelType(){return"base_llm"}},Zg=class extends VI{async _generate(t,e,r){return{generations:await Promise.all(t.map((i,o)=>this._call(i,{...e,promptIndex:o},r).then(a=>[{text:a}])))}}};var Sz={};var Iz=class extends pe{constructor(e){super(e);d(this,"lc_namespace",["langchain_core","runnables"]);d(this,"lc_serializable",!0);d(this,"runnables");this.runnables=e.runnables}static lc_name(){return"RouterRunnable"}async invoke(e,r){let{key:n,input:i}=e,o=this.runnables[n];if(o===void 0)throw new Error(`No runnable associated with key "${n}".`);return o.invoke(i,Re(r))}async batch(e,r,n){let i=e.map(f=>f.key),o=e.map(f=>f.input);if(i.find(f=>this.runnables[f]===void 0)!==void 0)throw new Error("One or more keys do not have a corresponding runnable.");let s=i.map(f=>this.runnables[f]),c=this._getOptionsList(r??{},e.length),u=c[0]?.maxConcurrency??n?.maxConcurrency,l=u&&u>0?u:e.length,p=[];for(let f=0;f<o.length;f+=l){let m=o.slice(f,f+l).map((g,x)=>s[x].invoke(g,c[x])),h=await Promise.all(m);p.push(h)}return p.flat()}async stream(e,r){let{key:n,input:i}=e,o=this.runnables[n];if(o===void 0)throw new Error(`No runnable associated with key "${n}".`);return o.stream(i,r)}};var kz=class extends pe{constructor(e){super(e);d(this,"lc_namespace",["langchain_core","runnables"]);d(this,"lc_serializable",!0);d(this,"default");d(this,"branches");this.branches=e.branches,this.default=e.default}static lc_name(){return"RunnableBranch"}static from(e){if(e.length<1)throw new Error("RunnableBranch requires at least one branch");let n=e.slice(0,-1).map(([o,a])=>[ht(o),ht(a)]),i=ht(e[e.length-1]);return new this({branches:n,default:i})}async _invoke(e,r,n){let i;for(let o=0;o<this.branches.length;o+=1){let[a,s]=this.branches[o];if(await a.invoke(e,ze(r,{callbacks:n?.getChild(`condition:${o+1}`)}))){i=await s.invoke(e,ze(r,{callbacks:n?.getChild(`branch:${o+1}`)}));break}}return i||(i=await this.default.invoke(e,ze(r,{callbacks:n?.getChild("branch:default")}))),i}async invoke(e,r={}){return this._callWithConfig(this._invoke,e,r)}async*_streamIterator(e,r){let i=await(await Ft(r))?.handleChainStart(this.toJSON(),Pt(e,"input"),r?.runId,void 0,void 0,void 0,r?.runName),o,a=!0,s;try{for(let c=0;c<this.branches.length;c+=1){let[u,l]=this.branches[c];if(await u.invoke(e,ze(r,{callbacks:i?.getChild(`condition:${c+1}`)}))){s=await l.stream(e,ze(r,{callbacks:i?.getChild(`branch:${c+1}`)}));for await(let f of s)if(yield f,a)if(o===void 0)o=f;else try{o=en(o,f)}catch{o=void 0,a=!1}break}}if(s===void 0){s=await this.default.stream(e,ze(r,{callbacks:i?.getChild("branch:default")}));for await(let c of s)if(yield c,a)if(o===void 0)o=c;else try{o=en(o,c)}catch{o=void 0,a=!1}}}catch(c){throw await i?.handleChainError(c),c}await i?.handleChainEnd(o??{})}};var Ez=class extends On{constructor(e){let r=cr.from((a,s)=>this._enterHistory(a,s??{})).withConfig({runName:"loadHistory"}),n=e.historyMessagesKey??e.inputMessagesKey;n&&(r=Pn.assign({[n]:r}).withConfig({runName:"insertHistory"}));let i=r.pipe(e.runnable.withListeners({onEnd:(a,s)=>this._exitHistory(a,s??{})})).withConfig({runName:"RunnableWithMessageHistory"}),o=e.config??{};super({...e,config:o,bound:i});d(this,"runnable");d(this,"inputMessagesKey");d(this,"outputMessagesKey");d(this,"historyMessagesKey");d(this,"getMessageHistory");this.runnable=e.runnable,this.getMessageHistory=e.getMessageHistory,this.inputMessagesKey=e.inputMessagesKey,this.outputMessagesKey=e.outputMessagesKey,this.historyMessagesKey=e.historyMessagesKey}_getInputMessages(e){let r;if(typeof e=="object"&&!Array.isArray(e)&&!dt(e)){let n;this.inputMessagesKey?n=this.inputMessagesKey:Object.keys(e).length===1?n=Object.keys(e)[0]:n="input",Array.isArray(e[n])&&Array.isArray(e[n][0])?r=e[n][0]:r=e[n]}else r=e;if(typeof r=="string")return[new $t(r)];if(Array.isArray(r))return r;if(dt(r))return[r];throw new Error(`Expected a string, BaseMessage, or array of BaseMessages.
Got ${JSON.stringify(r,null,2)}`)}_getOutputMessages(e){let r;if(!Array.isArray(e)&&!dt(e)&&typeof e!="string"){let n;this.outputMessagesKey!==void 0?n=this.outputMessagesKey:Object.keys(e).length===1?n=Object.keys(e)[0]:n="output",e.generations!==void 0?r=e.generations[0][0].message:r=e[n]}else r=e;if(typeof r=="string")return[new Ue(r)];if(Array.isArray(r))return r;if(dt(r))return[r];throw new Error(`Expected a string, BaseMessage, or array of BaseMessages. Received: ${JSON.stringify(r,null,2)}`)}async _enterHistory(e,r){let i=await(r?.configurable?.messageHistory).getMessages();return this.historyMessagesKey===void 0?i.concat(this._getInputMessages(e)):i}async _exitHistory(e,r){let n=r.configurable?.messageHistory,i;Array.isArray(e.inputs)&&Array.isArray(e.inputs[0])?i=e.inputs[0]:i=e.inputs;let o=this._getInputMessages(i);if(this.historyMessagesKey===void 0){let c=await n.getMessages();o=o.slice(c.length)}let a=e.outputs;if(!a)throw new Error(`Output values from 'Run' undefined. Run: ${JSON.stringify(e,null,2)}`);let s=this._getOutputMessages(a);await n.addMessages([...o,...s])}async _mergeConfig(...e){let r=await super._mergeConfig(...e);if(!r.configurable||!r.configurable.sessionId){let i={[this.inputMessagesKey??"input"]:"foo"},o={configurable:{sessionId:"123"}};throw new Error(`sessionId is required. Pass it in as part of the config argument to .invoke() or .stream()
eg. chain.invoke(${JSON.stringify(i)}, ${JSON.stringify(o)})`)}let{sessionId:n}=r.configurable;return r.configurable.messageHistory=await this.getMessageHistory(n),r}};var ZI={};z(ZI,{RouterRunnable:()=>Iz,Runnable:()=>pe,RunnableAssign:()=>sd,RunnableBinding:()=>On,RunnableBranch:()=>kz,RunnableEach:()=>MM,RunnableLambda:()=>cr,RunnableMap:()=>ka,RunnableParallel:()=>UM,RunnablePassthrough:()=>Pn,RunnablePick:()=>oI,RunnableRetry:()=>Og,RunnableSequence:()=>Tr,RunnableToolLike:()=>$g,RunnableWithFallbacks:()=>iI,RunnableWithMessageHistory:()=>Ez,_coerceToRunnable:()=>ht,ensureConfig:()=>Re,getCallbackManagerForConfig:()=>Ft,mergeConfigs:()=>Bt,patchConfig:()=>ze,pickRunnableConfigKeys:()=>xr,raceWithSignal:()=>Sn});var GI={};z(GI,{applyPatch:()=>ca,compare:()=>ua});var Eu=class extends pe{parseResultWithPrompt(t,e,r){return this.parseResult(t,r)}_baseMessageToString(t){return typeof t.content=="string"?t.content:this._baseMessageContentToString(t.content)}_baseMessageContentToString(t){return JSON.stringify(t)}async invoke(t,e){return typeof t=="string"?this._callWithConfig(async(r,n)=>this.parseResult([{text:r}],n?.callbacks),t,{...e,runType:"parser"}):this._callWithConfig(async(r,n)=>this.parseResult([{message:r,text:this._baseMessageToString(r)}],n?.callbacks),t,{...e,runType:"parser"})}},So=class extends Eu{parseResult(t,e){return this.parse(t[0].text,e)}async parseWithPrompt(t,e,r){return this.parse(t,r)}_type(){throw new Error("_type not implemented")}},sn=class extends Error{constructor(e,r,n,i=!1){super(e);d(this,"llmOutput");d(this,"observation");d(this,"sendToLLM");if(this.llmOutput=r,this.observation=n,this.sendToLLM=i,i&&(n===void 0||r===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");ea(this,"OUTPUT_PARSING_FAILURE")}};var Io=class extends So{async*_transform(t){for await(let e of t)typeof e=="string"?yield this.parseResult([{text:e}]):yield this.parseResult([{message:e,text:this._baseMessageToString(e)}])}async*transform(t,e){yield*this._transformStreamWithConfig(t,this._transform.bind(this),{...e,runType:"parser"})}},Mi=class extends Io{constructor(e){super(e);d(this,"diff",!1);this.diff=e?.diff??this.diff}async*_transform(e){let r,n;for await(let i of e){if(typeof i!="string"&&typeof i.content!="string")throw new Error("Cannot handle non-string output.");let o;if(io(i)){if(typeof i.content!="string")throw new Error("Cannot handle non-string message output.");o=new tn({message:i,text:i.content})}else if(dt(i)){if(typeof i.content!="string")throw new Error("Cannot handle non-string message output.");o=new tn({message:ns(i),text:i.content})}else o=new Ii({text:i});n===void 0?n=o:n=n.concat(o);let a=await this.parsePartialResult([n]);a!=null&&!Pi(a,r)&&(this.diff?yield this._diff(r,a):yield a,r=a)}}getFormatInstructions(){return""}};var Az=class extends Io{constructor(){super(...arguments);d(this,"lc_namespace",["langchain_core","output_parsers","bytes"]);d(this,"lc_serializable",!0);d(this,"textEncoder",new TextEncoder)}static lc_name(){return"BytesOutputParser"}parse(e){return Promise.resolve(this.textEncoder.encode(e))}getFormatInstructions(){return""}};var Au=class extends Io{constructor(){super(...arguments);d(this,"re")}async*_transform(e){let r="";for await(let n of e)if(typeof n=="string"?r+=n:r+=n.content,this.re){let i=[...r.matchAll(this.re)];if(i.length>1){let o=0;for(let a of i.slice(0,-1))yield[a[1]],o+=(a.index??0)+a[0].length;r=r.slice(o)}}else{let i=await this.parse(r);if(i.length>1){for(let o of i.slice(0,-1))yield[o];r=i[i.length-1]}}for(let n of await this.parse(r))yield[n]}},Tz=class extends Au{constructor(){super(...arguments);d(this,"lc_namespace",["langchain_core","output_parsers","list"]);d(this,"lc_serializable",!0)}static lc_name(){return"CommaSeparatedListOutputParser"}async parse(e){try{return e.trim().split(",").map(r=>r.trim())}catch{throw new sn(`Could not parse output: ${e}`,e)}}getFormatInstructions(){return"Your response should be a list of comma separated values, eg: `foo, bar, baz`"}},$z=class extends Au{constructor({length:e,separator:r}){super(...arguments);d(this,"lc_namespace",["langchain_core","output_parsers","list"]);d(this,"length");d(this,"separator");this.length=e,this.separator=r||","}async parse(e){try{let r=e.trim().split(this.separator).map(n=>n.trim());if(this.length!==void 0&&r.length!==this.length)throw new sn(`Incorrect number of items. Expected ${this.length}, got ${r.length}.`);return r}catch(r){throw Object.getPrototypeOf(r)===sn.prototype?r:new sn(`Could not parse output: ${e}`)}}getFormatInstructions(){return`Your response should be a list of ${this.length===void 0?"":`${this.length} `}items separated by "${this.separator}" (eg: \`foo${this.separator} bar${this.separator} baz\`)`}},Oz=class extends Au{constructor(){super(...arguments);d(this,"lc_namespace",["langchain_core","output_parsers","list"]);d(this,"lc_serializable",!0);d(this,"re",/\d+\.\s([^\n]+)/g)}static lc_name(){return"NumberedListOutputParser"}getFormatInstructions(){return`Your response should be a numbered list with each item on a new line. For example: 

1. foo

2. bar

3. baz`}async parse(e){return[...e.matchAll(this.re)??[]].map(r=>r[1])}},Cz=class extends Au{constructor(){super(...arguments);d(this,"lc_namespace",["langchain_core","output_parsers","list"]);d(this,"lc_serializable",!0);d(this,"re",/^\s*[-*]\s([^\n]+)$/gm)}static lc_name(){return"NumberedListOutputParser"}getFormatInstructions(){return`Your response should be a numbered list with each item on a new line. For example: 

1. foo

2. bar

3. baz`}async parse(e){return[...e.matchAll(this.re)??[]].map(r=>r[1])}};var Pz=class extends Io{constructor(){super(...arguments);d(this,"lc_namespace",["langchain_core","output_parsers","string"]);d(this,"lc_serializable",!0)}static lc_name(){return"StrOutputParser"}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}_textContentToString(e){return e.text}_imageUrlContentToString(e){throw new Error('Cannot coerce a multimodal "image_url" message part into a string.')}_messageContentToString(e){switch(e.type){case"text":case"text_delta":if("text"in e)return this._textContentToString(e);break;case"image_url":if("image_url"in e)return this._imageUrlContentToString(e);break;default:throw new Error(`Cannot coerce "${e.type}" message part into a string.`)}throw new Error(`Invalid content type: ${e.type}`)}_baseMessageContentToString(e){return e.reduce((r,n)=>r+this._messageContentToString(n),"")}};var Tu=class extends So{constructor(e){super(e);d(this,"lc_namespace",["langchain","output_parsers","structured"]);this.schema=e}static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){let r=Vt.object(Object.fromEntries(Object.entries(e).map(([n,i])=>[n,Vt.string().describe(i)])));return new this(r)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(it(this.schema))}
\`\`\`
`}async parse(e){try{let r=e.trim(),i=(r.match(/^```(?:json)?\s*([\s\S]*?)```/)?.[1]||r.match(/```json\s*([\s\S]*?)```/)?.[1]||r).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(o,a)=>`"${a.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await ba(this.schema,JSON.parse(i))}catch(r){throw new sn(`Failed to parse. Text: "${e}". Error: ${r}`,e)}}},HI=class extends Tu{static lc_name(){return"JsonMarkdownStructuredOutputParser"}getFormatInstructions(t){let e=t?.interpolationDepth??1;if(e<1)throw new Error("f string interpolation depth must be at least 1");return`Return a markdown code snippet with a JSON object formatted to look like:
\`\`\`json
${this._schemaToInstruction(it(this.schema)).replaceAll("{","{".repeat(e)).replaceAll("}","}".repeat(e))}
\`\`\``}_schemaToInstruction(t,e=2){let r=t;if("type"in r){let n=!1,i;if(Array.isArray(r.type)){let s=r.type.findIndex(c=>c==="null");s!==-1&&(n=!0,r.type.splice(s,1)),i=r.type.join(" | ")}else i=r.type;if(r.type==="object"&&r.properties){let s=r.description?` // ${r.description}`:"";return`{
${Object.entries(r.properties).map(([u,l])=>{let p=r.required?.includes(u)?"":" (optional)";return`${" ".repeat(e)}"${u}": ${this._schemaToInstruction(l,e+2)}${p}`}).join(`
`)}
${" ".repeat(e-2)}}${s}`}if(r.type==="array"&&r.items){let s=r.description?` // ${r.description}`:"";return`array[
${" ".repeat(e)}${this._schemaToInstruction(r.items,e+2)}
${" ".repeat(e-2)}] ${s}`}let o=n?" (nullable)":"",a=r.description?` // ${r.description}`:"";return`${i}${a}${o}`}if("anyOf"in r)return r.anyOf.map(n=>this._schemaToInstruction(n,e)).join(`
${" ".repeat(e-2)}`);throw new Error("unsupported schema type")}static fromZodSchema(t){return new this(t)}static fromNamesAndDescriptions(t){let e=Vt.object(Object.fromEntries(Object.entries(t).map(([r,n])=>[r,Vt.string().describe(n)])));return new this(e)}},Nz=class extends So{constructor({inputSchema:e}){super(...arguments);d(this,"structuredInputParser");this.structuredInputParser=new HI(e)}async parse(e){let r;try{r=await this.structuredInputParser.parse(e)}catch(n){throw new sn(`Failed to parse. Text: "${e}". Error: ${n}`,e)}return this.outputProcessor(r)}getFormatInstructions(){return this.structuredInputParser.getFormatInstructions()}};var gd=class extends Mi{constructor(){super(...arguments);d(this,"lc_namespace",["langchain_core","output_parsers"]);d(this,"lc_serializable",!0)}static lc_name(){return"JsonOutputParser"}_concatOutputChunks(e,r){return this.diff?super._concatOutputChunks(e,r):r}_diff(e,r){if(r)return e?ua(e,r):[{op:"replace",path:"",value:r}]}async parsePartialResult(e){return np(e[0].text)}async parse(e){return np(e,JSON.parse)}getFormatInstructions(){return""}_baseMessageToString(e){return e.text}};var Sq=function(){let t={};t.parser=function(b,_){return new r(b,_)},t.SAXParser=r,t.SAXStream=u,t.createStream=c,t.MAX_BUFFER_LENGTH=65536;let e=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];t.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function r(b,_){if(!(this instanceof r))return new r(b,_);var M=this;i(M),M.q=M.c="",M.bufferCheckPosition=t.MAX_BUFFER_LENGTH,M.opt=_||{},M.opt.lowercase=M.opt.lowercase||M.opt.lowercasetags,M.looseCase=M.opt.lowercase?"toLowerCase":"toUpperCase",M.tags=[],M.closed=M.closedRoot=M.sawRoot=!1,M.tag=M.error=null,M.strict=!!b,M.noscript=!!(b||M.opt.noscript),M.state=w.BEGIN,M.strictEntities=M.opt.strictEntities,M.ENTITIES=M.strictEntities?Object.create(t.XML_ENTITIES):Object.create(t.ENTITIES),M.attribList=[],M.opt.xmlns&&(M.ns=Object.create(h)),M.trackPosition=M.opt.position!==!1,M.trackPosition&&(M.position=M.line=M.column=0),F(M,"onready")}Object.create||(Object.create=function(b){function _(){}_.prototype=b;var M=new _;return M}),Object.keys||(Object.keys=function(b){var _=[];for(var M in b)b.hasOwnProperty(M)&&_.push(M);return _});function n(b){for(var _=Math.max(t.MAX_BUFFER_LENGTH,10),M=0,E=0,De=e.length;E<De;E++){var et=b[e[E]].length;if(et>_)switch(e[E]){case"textNode":ve(b);break;case"cdata":R(b,"oncdata",b.cdata),b.cdata="";break;case"script":R(b,"onscript",b.script),b.script="";break;default:Ze(b,"Max buffer length exceeded: "+e[E])}M=Math.max(M,et)}var at=t.MAX_BUFFER_LENGTH-M;b.bufferCheckPosition=at+b.position}function i(b){for(var _=0,M=e.length;_<M;_++)b[e[_]]=""}function o(b){ve(b),b.cdata!==""&&(R(b,"oncdata",b.cdata),b.cdata=""),b.script!==""&&(R(b,"onscript",b.script),b.script="")}r.prototype={end:function(){Qt(this)},write:jn,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){o(this)}};var a=ReadableStream;a||(a=function(){});var s=t.EVENTS.filter(function(b){return b!=="error"&&b!=="end"});function c(b,_){return new u(b,_)}function u(b,_){if(!(this instanceof u))return new u(b,_);a.apply(this),this._parser=new r(b,_),this.writable=!0,this.readable=!0;var M=this;this._parser.onend=function(){M.emit("end")},this._parser.onerror=function(E){M.emit("error",E),M._parser.error=null},this._decoder=null,s.forEach(function(E){Object.defineProperty(M,"on"+E,{get:function(){return M._parser["on"+E]},set:function(De){if(!De)return M.removeAllListeners(E),M._parser["on"+E]=De,De;M.on(E,De)},enumerable:!0,configurable:!1})})}u.prototype=Object.create(a.prototype,{constructor:{value:u}}),u.prototype.write=function(b){return this._parser.write(b.toString()),this.emit("data",b),!0},u.prototype.end=function(b){return b&&b.length&&this.write(b),this._parser.end(),!0},u.prototype.on=function(b,_){var M=this;return!M._parser["on"+b]&&s.indexOf(b)!==-1&&(M._parser["on"+b]=function(){var E=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);E.splice(0,0,b),M.emit.apply(M,E)}),a.prototype.on.call(M,b,_)};var l="[CDATA[",p="DOCTYPE",f="http://www.w3.org/XML/1998/namespace",m="http://www.w3.org/2000/xmlns/",h={xml:f,xmlns:m},g=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,x=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,y=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,v=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function S(b){return b===" "||b===`
`||b==="\r"||b==="	"}function k(b){return b==='"'||b==="'"}function T(b){return b===">"||S(b)}function N(b,_){return b.test(_)}function U(b,_){return!N(b,_)}var w=0;t.STATE={BEGIN:w++,BEGIN_WHITESPACE:w++,TEXT:w++,TEXT_ENTITY:w++,OPEN_WAKA:w++,SGML_DECL:w++,SGML_DECL_QUOTED:w++,DOCTYPE:w++,DOCTYPE_QUOTED:w++,DOCTYPE_DTD:w++,DOCTYPE_DTD_QUOTED:w++,COMMENT_STARTING:w++,COMMENT:w++,COMMENT_ENDING:w++,COMMENT_ENDED:w++,CDATA:w++,CDATA_ENDING:w++,CDATA_ENDING_2:w++,PROC_INST:w++,PROC_INST_BODY:w++,PROC_INST_ENDING:w++,OPEN_TAG:w++,OPEN_TAG_SLASH:w++,ATTRIB:w++,ATTRIB_NAME:w++,ATTRIB_NAME_SAW_WHITE:w++,ATTRIB_VALUE:w++,ATTRIB_VALUE_QUOTED:w++,ATTRIB_VALUE_CLOSED:w++,ATTRIB_VALUE_UNQUOTED:w++,ATTRIB_VALUE_ENTITY_Q:w++,ATTRIB_VALUE_ENTITY_U:w++,CLOSE_TAG:w++,CLOSE_TAG_SAW_WHITE:w++,SCRIPT:w++,SCRIPT_ENDING:w++},t.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},t.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(t.ENTITIES).forEach(function(b){var _=t.ENTITIES[b],M=typeof _=="number"?String.fromCharCode(_):_;t.ENTITIES[b]=M});for(var V in t.STATE)t.STATE[t.STATE[V]]=V;w=t.STATE;function F(b,_,M){b[_]&&b[_](M)}function R(b,_,M){b.textNode&&ve(b),F(b,_,M)}function ve(b){b.textNode=We(b.opt,b.textNode),b.textNode&&F(b,"ontext",b.textNode),b.textNode=""}function We(b,_){return b.trim&&(_=_.trim()),b.normalize&&(_=_.replace(/\s+/g," ")),_}function Ze(b,_){return ve(b),b.trackPosition&&(_+=`
Line: `+b.line+`
Column: `+b.column+`
Char: `+b.c),_=new Error(_),b.error=_,F(b,"onerror",_),b}function Qt(b){return b.sawRoot&&!b.closedRoot&&Fe(b,"Unclosed root tag"),b.state!==w.BEGIN&&b.state!==w.BEGIN_WHITESPACE&&b.state!==w.TEXT&&Ze(b,"Unexpected end"),ve(b),b.c="",b.closed=!0,F(b,"onend"),r.call(b,b.strict,b.opt),b}function Fe(b,_){if(typeof b!="object"||!(b instanceof r))throw new Error("bad call to strictFail");b.strict&&Ze(b,_)}function Jr(b){b.strict||(b.tagName=b.tagName[b.looseCase]());var _=b.tags[b.tags.length-1]||b,M=b.tag={name:b.tagName,attributes:{}};b.opt.xmlns&&(M.ns=_.ns),b.attribList.length=0,R(b,"onopentagstart",M)}function eo(b,_){var M=b.indexOf(":"),E=M<0?["",b]:b.split(":"),De=E[0],et=E[1];return _&&b==="xmlns"&&(De="xmlns",et=""),{prefix:De,local:et}}function to(b){if(b.strict||(b.attribName=b.attribName[b.looseCase]()),b.attribList.indexOf(b.attribName)!==-1||b.tag.attributes.hasOwnProperty(b.attribName)){b.attribName=b.attribValue="";return}if(b.opt.xmlns){var _=eo(b.attribName,!0),M=_.prefix,E=_.local;if(M==="xmlns")if(E==="xml"&&b.attribValue!==f)Fe(b,"xml: prefix must be bound to "+f+`
Actual: `+b.attribValue);else if(E==="xmlns"&&b.attribValue!==m)Fe(b,"xmlns: prefix must be bound to "+m+`
Actual: `+b.attribValue);else{var De=b.tag,et=b.tags[b.tags.length-1]||b;De.ns===et.ns&&(De.ns=Object.create(et.ns)),De.ns[E]=b.attribValue}b.attribList.push([b.attribName,b.attribValue])}else b.tag.attributes[b.attribName]=b.attribValue,R(b,"onattribute",{name:b.attribName,value:b.attribValue});b.attribName=b.attribValue=""}function zn(b,_){if(b.opt.xmlns){var M=b.tag,E=eo(b.tagName);M.prefix=E.prefix,M.local=E.local,M.uri=M.ns[E.prefix]||"",M.prefix&&!M.uri&&(Fe(b,"Unbound namespace prefix: "+JSON.stringify(b.tagName)),M.uri=E.prefix);var De=b.tags[b.tags.length-1]||b;M.ns&&De.ns!==M.ns&&Object.keys(M.ns).forEach(function(es){R(b,"onopennamespace",{prefix:es,uri:M.ns[es]})});for(var et=0,at=b.attribList.length;et<at;et++){var Tt=b.attribList[et],Kt=Tt[0],Dn=Tt[1],_t=eo(Kt,!0),hn=_t.prefix,$c=_t.local,Nf=hn===""?"":M.ns[hn]||"",Q={name:Kt,value:Dn,prefix:hn,local:$c,uri:Nf};hn&&hn!=="xmlns"&&!Nf&&(Fe(b,"Unbound namespace prefix: "+JSON.stringify(hn)),Q.uri=hn),b.tag.attributes[Kt]=Q,R(b,"onattribute",Q)}b.attribList.length=0}b.tag.isSelfClosing=!!_,b.sawRoot=!0,b.tags.push(b.tag),R(b,"onopentag",b.tag),_||(!b.noscript&&b.tagName.toLowerCase()==="script"?b.state=w.SCRIPT:b.state=w.TEXT,b.tag=null,b.tagName=""),b.attribName=b.attribValue="",b.attribList.length=0}function ro(b){if(!b.tagName){Fe(b,"Weird empty close tag."),b.textNode+="</>",b.state=w.TEXT;return}if(b.script){if(b.tagName!=="script"){b.script+="</"+b.tagName+">",b.tagName="",b.state=w.SCRIPT;return}R(b,"onscript",b.script),b.script=""}var _=b.tags.length,M=b.tagName;b.strict||(M=M[b.looseCase]());for(var E=M;_--;){var De=b.tags[_];if(De.name!==E)Fe(b,"Unexpected close tag");else break}if(_<0){Fe(b,"Unmatched closing tag: "+b.tagName),b.textNode+="</"+b.tagName+">",b.state=w.TEXT;return}b.tagName=M;for(var et=b.tags.length;et-- >_;){var at=b.tag=b.tags.pop();b.tagName=b.tag.name,R(b,"onclosetag",b.tagName);var Tt={};for(var Kt in at.ns)Tt[Kt]=at.ns[Kt];var Dn=b.tags[b.tags.length-1]||b;b.opt.xmlns&&at.ns!==Dn.ns&&Object.keys(at.ns).forEach(function(_t){var hn=at.ns[_t];R(b,"onclosenamespace",{prefix:_t,uri:hn})})}_===0&&(b.closedRoot=!0),b.tagName=b.attribValue=b.attribName="",b.attribList.length=0,b.state=w.TEXT}function Jl(b){var _=b.entity,M=_.toLowerCase(),E,De="";return b.ENTITIES[_]?b.ENTITIES[_]:b.ENTITIES[M]?b.ENTITIES[M]:(_=M,_.charAt(0)==="#"&&(_.charAt(1)==="x"?(_=_.slice(2),E=parseInt(_,16),De=E.toString(16)):(_=_.slice(1),E=parseInt(_,10),De=E.toString(10))),_=_.replace(/^0+/,""),isNaN(E)||De.toLowerCase()!==_?(Fe(b,"Invalid character entity"),"&"+b.entity+";"):String.fromCodePoint(E))}function Xl(b,_){_==="<"?(b.state=w.OPEN_WAKA,b.startTagPosition=b.position):S(_)||(Fe(b,"Non-whitespace before first tag."),b.textNode=_,b.state=w.TEXT)}function Yl(b,_){var M="";return _<b.length&&(M=b.charAt(_)),M}function jn(b){var _=this;if(this.error)throw this.error;if(_.closed)return Ze(_,"Cannot write after close. Assign an onready handler.");if(b===null)return Qt(_);typeof b=="object"&&(b=b.toString());for(var M=0,E="";E=Yl(b,M++),_.c=E,!!E;)switch(_.trackPosition&&(_.position++,E===`
`?(_.line++,_.column=0):_.column++),_.state){case w.BEGIN:if(_.state=w.BEGIN_WHITESPACE,E==="\uFEFF")continue;Xl(_,E);continue;case w.BEGIN_WHITESPACE:Xl(_,E);continue;case w.TEXT:if(_.sawRoot&&!_.closedRoot){for(var De=M-1;E&&E!=="<"&&E!=="&";)E=Yl(b,M++),E&&_.trackPosition&&(_.position++,E===`
`?(_.line++,_.column=0):_.column++);_.textNode+=b.substring(De,M-1)}E==="<"&&!(_.sawRoot&&_.closedRoot&&!_.strict)?(_.state=w.OPEN_WAKA,_.startTagPosition=_.position):(!S(E)&&(!_.sawRoot||_.closedRoot)&&Fe(_,"Text data outside of root node."),E==="&"?_.state=w.TEXT_ENTITY:_.textNode+=E);continue;case w.SCRIPT:E==="<"?_.state=w.SCRIPT_ENDING:_.script+=E;continue;case w.SCRIPT_ENDING:E==="/"?_.state=w.CLOSE_TAG:(_.script+="<"+E,_.state=w.SCRIPT);continue;case w.OPEN_WAKA:if(E==="!")_.state=w.SGML_DECL,_.sgmlDecl="";else if(!S(E))if(N(g,E))_.state=w.OPEN_TAG,_.tagName=E;else if(E==="/")_.state=w.CLOSE_TAG,_.tagName="";else if(E==="?")_.state=w.PROC_INST,_.procInstName=_.procInstBody="";else{if(Fe(_,"Unencoded <"),_.startTagPosition+1<_.position){var et=_.position-_.startTagPosition;E=new Array(et).join(" ")+E}_.textNode+="<"+E,_.state=w.TEXT}continue;case w.SGML_DECL:(_.sgmlDecl+E).toUpperCase()===l?(R(_,"onopencdata"),_.state=w.CDATA,_.sgmlDecl="",_.cdata=""):_.sgmlDecl+E==="--"?(_.state=w.COMMENT,_.comment="",_.sgmlDecl=""):(_.sgmlDecl+E).toUpperCase()===p?(_.state=w.DOCTYPE,(_.doctype||_.sawRoot)&&Fe(_,"Inappropriately located doctype declaration"),_.doctype="",_.sgmlDecl=""):E===">"?(R(_,"onsgmldeclaration",_.sgmlDecl),_.sgmlDecl="",_.state=w.TEXT):(k(E)&&(_.state=w.SGML_DECL_QUOTED),_.sgmlDecl+=E);continue;case w.SGML_DECL_QUOTED:E===_.q&&(_.state=w.SGML_DECL,_.q=""),_.sgmlDecl+=E;continue;case w.DOCTYPE:E===">"?(_.state=w.TEXT,R(_,"ondoctype",_.doctype),_.doctype=!0):(_.doctype+=E,E==="["?_.state=w.DOCTYPE_DTD:k(E)&&(_.state=w.DOCTYPE_QUOTED,_.q=E));continue;case w.DOCTYPE_QUOTED:_.doctype+=E,E===_.q&&(_.q="",_.state=w.DOCTYPE);continue;case w.DOCTYPE_DTD:_.doctype+=E,E==="]"?_.state=w.DOCTYPE:k(E)&&(_.state=w.DOCTYPE_DTD_QUOTED,_.q=E);continue;case w.DOCTYPE_DTD_QUOTED:_.doctype+=E,E===_.q&&(_.state=w.DOCTYPE_DTD,_.q="");continue;case w.COMMENT:E==="-"?_.state=w.COMMENT_ENDING:_.comment+=E;continue;case w.COMMENT_ENDING:E==="-"?(_.state=w.COMMENT_ENDED,_.comment=We(_.opt,_.comment),_.comment&&R(_,"oncomment",_.comment),_.comment=""):(_.comment+="-"+E,_.state=w.COMMENT);continue;case w.COMMENT_ENDED:E!==">"?(Fe(_,"Malformed comment"),_.comment+="--"+E,_.state=w.COMMENT):_.state=w.TEXT;continue;case w.CDATA:E==="]"?_.state=w.CDATA_ENDING:_.cdata+=E;continue;case w.CDATA_ENDING:E==="]"?_.state=w.CDATA_ENDING_2:(_.cdata+="]"+E,_.state=w.CDATA);continue;case w.CDATA_ENDING_2:E===">"?(_.cdata&&R(_,"oncdata",_.cdata),R(_,"onclosecdata"),_.cdata="",_.state=w.TEXT):E==="]"?_.cdata+="]":(_.cdata+="]]"+E,_.state=w.CDATA);continue;case w.PROC_INST:E==="?"?_.state=w.PROC_INST_ENDING:S(E)?_.state=w.PROC_INST_BODY:_.procInstName+=E;continue;case w.PROC_INST_BODY:if(!_.procInstBody&&S(E))continue;E==="?"?_.state=w.PROC_INST_ENDING:_.procInstBody+=E;continue;case w.PROC_INST_ENDING:E===">"?(R(_,"onprocessinginstruction",{name:_.procInstName,body:_.procInstBody}),_.procInstName=_.procInstBody="",_.state=w.TEXT):(_.procInstBody+="?"+E,_.state=w.PROC_INST_BODY);continue;case w.OPEN_TAG:N(x,E)?_.tagName+=E:(Jr(_),E===">"?zn(_):E==="/"?_.state=w.OPEN_TAG_SLASH:(S(E)||Fe(_,"Invalid character in tag name"),_.state=w.ATTRIB));continue;case w.OPEN_TAG_SLASH:E===">"?(zn(_,!0),ro(_)):(Fe(_,"Forward-slash in opening tag not followed by >"),_.state=w.ATTRIB);continue;case w.ATTRIB:if(S(E))continue;E===">"?zn(_):E==="/"?_.state=w.OPEN_TAG_SLASH:N(g,E)?(_.attribName=E,_.attribValue="",_.state=w.ATTRIB_NAME):Fe(_,"Invalid attribute name");continue;case w.ATTRIB_NAME:E==="="?_.state=w.ATTRIB_VALUE:E===">"?(Fe(_,"Attribute without value"),_.attribValue=_.attribName,to(_),zn(_)):S(E)?_.state=w.ATTRIB_NAME_SAW_WHITE:N(x,E)?_.attribName+=E:Fe(_,"Invalid attribute name");continue;case w.ATTRIB_NAME_SAW_WHITE:if(E==="=")_.state=w.ATTRIB_VALUE;else{if(S(E))continue;Fe(_,"Attribute without value"),_.tag.attributes[_.attribName]="",_.attribValue="",R(_,"onattribute",{name:_.attribName,value:""}),_.attribName="",E===">"?zn(_):N(g,E)?(_.attribName=E,_.state=w.ATTRIB_NAME):(Fe(_,"Invalid attribute name"),_.state=w.ATTRIB)}continue;case w.ATTRIB_VALUE:if(S(E))continue;k(E)?(_.q=E,_.state=w.ATTRIB_VALUE_QUOTED):(Fe(_,"Unquoted attribute value"),_.state=w.ATTRIB_VALUE_UNQUOTED,_.attribValue=E);continue;case w.ATTRIB_VALUE_QUOTED:if(E!==_.q){E==="&"?_.state=w.ATTRIB_VALUE_ENTITY_Q:_.attribValue+=E;continue}to(_),_.q="",_.state=w.ATTRIB_VALUE_CLOSED;continue;case w.ATTRIB_VALUE_CLOSED:S(E)?_.state=w.ATTRIB:E===">"?zn(_):E==="/"?_.state=w.OPEN_TAG_SLASH:N(g,E)?(Fe(_,"No whitespace between attributes"),_.attribName=E,_.attribValue="",_.state=w.ATTRIB_NAME):Fe(_,"Invalid attribute name");continue;case w.ATTRIB_VALUE_UNQUOTED:if(!T(E)){E==="&"?_.state=w.ATTRIB_VALUE_ENTITY_U:_.attribValue+=E;continue}to(_),E===">"?zn(_):_.state=w.ATTRIB;continue;case w.CLOSE_TAG:if(_.tagName)E===">"?ro(_):N(x,E)?_.tagName+=E:_.script?(_.script+="</"+_.tagName,_.tagName="",_.state=w.SCRIPT):(S(E)||Fe(_,"Invalid tagname in closing tag"),_.state=w.CLOSE_TAG_SAW_WHITE);else{if(S(E))continue;U(g,E)?_.script?(_.script+="</"+E,_.state=w.SCRIPT):Fe(_,"Invalid tagname in closing tag."):_.tagName=E}continue;case w.CLOSE_TAG_SAW_WHITE:if(S(E))continue;E===">"?ro(_):Fe(_,"Invalid characters in closing tag");continue;case w.TEXT_ENTITY:case w.ATTRIB_VALUE_ENTITY_Q:case w.ATTRIB_VALUE_ENTITY_U:var at,Tt;switch(_.state){case w.TEXT_ENTITY:at=w.TEXT,Tt="textNode";break;case w.ATTRIB_VALUE_ENTITY_Q:at=w.ATTRIB_VALUE_QUOTED,Tt="attribValue";break;case w.ATTRIB_VALUE_ENTITY_U:at=w.ATTRIB_VALUE_UNQUOTED,Tt="attribValue";break}if(E===";")if(_.opt.unparsedEntities){var Kt=Jl(_);_.entity="",_.state=at,_.write(Kt)}else _[Tt]+=Jl(_),_.entity="",_.state=at;else N(_.entity.length?v:y,E)?_.entity+=E:(Fe(_,"Invalid character in entity name"),_[Tt]+="&"+_.entity+E,_.entity="",_.state=at);continue;default:throw new Error(_,"Unknown state: "+_.state)}return _.position>=_.bufferCheckPosition&&n(_),_}return String.fromCodePoint||(function(){var b=String.fromCharCode,_=Math.floor,M=function(){var E=16384,De=[],et,at,Tt=-1,Kt=arguments.length;if(!Kt)return"";for(var Dn="";++Tt<Kt;){var _t=Number(arguments[Tt]);if(!isFinite(_t)||_t<0||_t>1114111||_(_t)!==_t)throw RangeError("Invalid code point: "+_t);_t<=65535?De.push(_t):(_t-=65536,et=(_t>>10)+55296,at=_t%1024+56320,De.push(et,at)),(Tt+1===Kt||De.length>E)&&(Dn+=b.apply(null,De),De.length=0)}return Dn};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:M,configurable:!0,writable:!0}):String.fromCodePoint=M})(),t},Rz=Sq();var Gg=`The output should be formatted as a XML file.
1. Output should conform to the tags below. 
2. If tags are not given, make them on your own.
3. Remember to always open and close all the tags.

As an example, for the tags ["foo", "bar", "baz"]:
1. String "<foo>
   <bar>
      <baz></baz>
   </bar>
</foo>" is a well-formatted instance of the schema. 
2. String "<foo>
   <bar>
   </foo>" is a badly-formatted instance.
3. String "<foo>
   <tag>
   </tag>
</foo>" is a badly-formatted instance.

Here are the output tags:
\`\`\`
{tags}
\`\`\``,Mz=class extends Mi{constructor(e){super(e);d(this,"tags");d(this,"lc_namespace",["langchain_core","output_parsers"]);d(this,"lc_serializable",!0);this.tags=e?.tags}static lc_name(){return"XMLOutputParser"}_diff(e,r){if(r)return e?ua(e,r):[{op:"replace",path:"",value:r}]}async parsePartialResult(e){return Hg(e[0].text)}async parse(e){return Hg(e)}getFormatInstructions(){return!!(this.tags&&this.tags.length>0)?Gg.replace("{tags}",this.tags?.join(", ")??""):Gg}},Iq=t=>t.split(`
`).map(e=>e.replace(/^\s+/,"")).join(`
`).trim(),zz=t=>{if(Object.keys(t).length===0)return{};let e={};return t.children.length>0?(e[t.name]=t.children.map(zz),e):(e[t.name]=t.text??void 0,e)};function Hg(t){let e=Iq(t),r=Rz.parser(!0),n={},i=[];r.onopentag=s=>{let c={name:s.name,attributes:s.attributes,children:[],text:"",isSelfClosing:s.isSelfClosing};i.length>0?i[i.length-1].children.push(c):n=c,s.isSelfClosing||i.push(c)},r.onclosetag=()=>{if(i.length>0){let s=i.pop();i.length===0&&s&&(n=s)}},r.ontext=s=>{if(i.length>0){let c=i[i.length-1];c.text+=s}},r.onattribute=s=>{if(i.length>0){let c=i[i.length-1];c.attributes[s.name]=s.value}};let o=/```(xml)?(.*)```/s.exec(e),a=o?o[2]:e;return r.write(a).close(),n&&n.name==="?xml"&&(n=n.children[0]),zz(n)}var qI={};z(qI,{AsymmetricStructuredOutputParser:()=>Nz,BaseCumulativeTransformOutputParser:()=>Mi,BaseLLMOutputParser:()=>Eu,BaseOutputParser:()=>So,BaseTransformOutputParser:()=>Io,BytesOutputParser:()=>Az,CommaSeparatedListOutputParser:()=>Tz,CustomListOutputParser:()=>$z,JsonMarkdownStructuredOutputParser:()=>HI,JsonOutputParser:()=>gd,ListOutputParser:()=>Au,MarkdownListOutputParser:()=>Cz,NumberedListOutputParser:()=>Oz,OutputParserException:()=>sn,StringOutputParser:()=>Pz,StructuredOutputParser:()=>Tu,XMLOutputParser:()=>Mz,XML_FORMAT_INSTRUCTIONS:()=>Gg,parseJsonMarkdown:()=>np,parsePartialJson:()=>gi,parseXMLMarkdown:()=>Hg});var KI=class extends Eu{constructor(e){super();d(this,"lc_namespace",["langchain","output_parsers","openai_functions"]);d(this,"lc_serializable",!0);d(this,"argsOnly",!0);this.argsOnly=e?.argsOnly??this.argsOnly}static lc_name(){return"OutputFunctionsParser"}async parseResult(e){if("message"in e[0]){let n=e[0].message.additional_kwargs.function_call;if(!n)throw new Error(`No function_call in message ${JSON.stringify(e)}`);if(!n.arguments)throw new Error(`No arguments in function_call ${JSON.stringify(e)}`);return this.argsOnly?n.arguments:JSON.stringify(n)}else throw new Error(`No message in generations ${JSON.stringify(e)}`)}},WI=class extends Mi{constructor(e){super(e);d(this,"lc_namespace",["langchain","output_parsers","openai_functions"]);d(this,"lc_serializable",!0);d(this,"outputParser");d(this,"argsOnly",!0);this.argsOnly=e?.argsOnly??this.argsOnly,this.outputParser=new KI(e)}static lc_name(){return"JsonOutputFunctionsParser"}_diff(e,r){return r?ua(e??{},r):void 0}async parsePartialResult(e){let r=e[0];if(!r.message)return;let{message:n}=r,i=n.additional_kwargs.function_call;if(i)return this.argsOnly?gi(i.arguments):{...i,arguments:gi(i.arguments)}}async parseResult(e){let r=await this.outputParser.parseResult(e);if(!r)throw new Error(`No result from "OutputFunctionsParser" ${JSON.stringify(e)}`);return this.parse(r)}async parse(e){let r=JSON.parse(e);return this.argsOnly||(r.arguments=JSON.parse(r.arguments)),r}getFormatInstructions(){return""}},jz=class extends Eu{constructor(e){super(e);d(this,"lc_namespace",["langchain","output_parsers","openai_functions"]);d(this,"lc_serializable",!0);d(this,"outputParser",new WI);d(this,"attrName");this.attrName=e.attrName}static lc_name(){return"JsonKeyOutputFunctionsParser"}get lc_aliases(){return{attrName:"key_name"}}async parseResult(e){return(await this.outputParser.parseResult(e))[this.attrName]}};var JI={};z(JI,{JsonKeyOutputFunctionsParser:()=>jz,JsonOutputFunctionsParser:()=>WI,OutputFunctionsParser:()=>KI});function Fs(t,e){if(t.function===void 0)return;let r;if(e?.partial)try{r=gi(t.function.arguments??"{}")}catch{return}else try{r=JSON.parse(t.function.arguments)}catch(i){throw new sn([`Function "${t.function.name}" arguments:`,"",t.function.arguments,"","are not valid JSON.",`Error: ${i.message}`].join(`
`))}let n={name:t.function.name,args:r,type:"tool_call"};return e?.returnId&&(n.id=t.id),n}function qg(t){if(t.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:t.id,type:"function",function:{name:t.name,arguments:JSON.stringify(t.args)}}}function Aa(t,e){return{name:t.function?.name,args:t.function?.arguments,id:t.id,error:e,type:"invalid_tool_call"}}var XI=class extends Mi{constructor(e){super(e);d(this,"returnId",!1);d(this,"lc_namespace",["langchain","output_parsers","openai_tools"]);d(this,"lc_serializable",!0);this.returnId=e?.returnId??this.returnId}static lc_name(){return"JsonOutputToolsParser"}_diff(){throw new Error("Not supported.")}async parse(){throw new Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,r=!0){let n=e[0].message,i;if(ra(n)&&n.tool_calls?.length?i=n.tool_calls.map(a=>{let{id:s,...c}=a;return this.returnId?{id:s,...c}:c}):n.additional_kwargs.tool_calls!==void 0&&(i=JSON.parse(JSON.stringify(n.additional_kwargs.tool_calls)).map(s=>Fs(s,{returnId:this.returnId,partial:r}))),!i)return[];let o=[];for(let a of i)if(a!==void 0){let s={type:a.name,args:a.args,id:a.id};o.push(s)}return o}},_d=class extends XI{constructor(e){super(e);d(this,"lc_namespace",["langchain","output_parsers","openai_tools"]);d(this,"lc_serializable",!0);d(this,"returnId",!1);d(this,"keyName");d(this,"returnSingle",!1);d(this,"zodSchema");this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}static lc_name(){return"JsonOutputKeyToolsParser"}async _validateResult(e){if(this.zodSchema===void 0)return e;let r=await lg(this.zodSchema,e);if(r.success)return r.data;throw new sn(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(r.error?.issues)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){let n=(await super.parsePartialResult(e)).filter(o=>o.type===this.keyName),i=n;if(n.length)return this.returnId||(i=n.map(o=>o.args)),this.returnSingle?i[0]:i}async parseResult(e){let n=(await super.parsePartialResult(e,!1)).filter(a=>a.type===this.keyName),i=n;return n.length?(this.returnId||(i=n.map(a=>a.args)),this.returnSingle?this._validateResult(i[0]):await Promise.all(i.map(a=>this._validateResult(a)))):void 0}};var YI={};z(YI,{JsonOutputKeyToolsParser:()=>_d,JsonOutputToolsParser:()=>XI,convertLangChainToolCallToOpenAI:()=>qg,makeInvalidToolCall:()=>Aa,parseToolCall:()=>Fs});var zi=class extends pe{constructor(e){super(e);d(this,"lc_serializable",!0);d(this,"lc_namespace",["langchain_core","prompts",this._getPromptType()]);d(this,"inputVariables");d(this,"outputParser");d(this,"partialVariables");d(this,"metadata");d(this,"tags");let{inputVariables:r}=e;if(r.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}get lc_attributes(){return{partialVariables:void 0}}async mergePartialAndUserVariables(e){let r=this.partialVariables??{},n={};for(let[o,a]of Object.entries(r))typeof a=="string"?n[o]=a:n[o]=await a();return{...n,...e}}async invoke(e,r){let n={...this.metadata,...r?.metadata},i=[...this.tags??[],...r?.tags??[]];return this._callWithConfig(o=>this.formatPromptValue(o),e,{...r,tags:i,metadata:n,runType:"prompt"})}};var ko=class extends zi{async formatPromptValue(t){let e=await this.format(t);return new ud(e)}};var kq=Object.prototype.toString,Ou=Array.isArray||function(e){return kq.call(e)==="[object Array]"};function ek(t){return typeof t=="function"}function Eq(t){return Ou(t)?"array":typeof t}function QI(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Dz(t,e){return t!=null&&typeof t=="object"&&e in t}function Aq(t,e){return t!=null&&typeof t!="object"&&t.hasOwnProperty&&t.hasOwnProperty(e)}var Tq=RegExp.prototype.test;function $q(t,e){return Tq.call(t,e)}var Oq=/\S/;function Cq(t){return!$q(Oq,t)}var Pq={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function Nq(t){return String(t).replace(/[&<>"'`=\/]/g,function(r){return Pq[r]})}var Rq=/\s*/,Mq=/\s+/,Lz=/\s*=/,zq=/\s*\}/,jq=/#|\^|\/|>|\{|&|=|!/;function Dq(t,e){if(!t)return[];var r=!1,n=[],i=[],o=[],a=!1,s=!1,c="",u=0;function l(){if(a&&!s)for(;o.length;)delete i[o.pop()];else o=[];a=!1,s=!1}var p,f,m;function h(w){if(typeof w=="string"&&(w=w.split(Mq,2)),!Ou(w)||w.length!==2)throw new Error("Invalid tags: "+w);p=new RegExp(QI(w[0])+"\\s*"),f=new RegExp("\\s*"+QI(w[1])),m=new RegExp("\\s*"+QI("}"+w[1]))}h(e||Nn.tags);for(var g=new vd(t),x,y,v,S,k,T;!g.eos();){if(x=g.pos,v=g.scanUntil(p),v)for(var N=0,U=v.length;N<U;++N)S=v.charAt(N),Cq(S)?(o.push(i.length),c+=S):(s=!0,r=!0,c+=" "),i.push(["text",S,x,x+1]),x+=1,S===`
`&&(l(),c="",u=0,r=!1);if(!g.scan(p))break;if(a=!0,y=g.scan(jq)||"name",g.scan(Rq),y==="="?(v=g.scanUntil(Lz),g.scan(Lz),g.scanUntil(f)):y==="{"?(v=g.scanUntil(m),g.scan(zq),g.scanUntil(f),y="&"):v=g.scanUntil(f),!g.scan(f))throw new Error("Unclosed tag at "+g.pos);if(y==">"?k=[y,v,x,g.pos,c,u,r]:k=[y,v,x,g.pos],u++,i.push(k),y==="#"||y==="^")n.push(k);else if(y==="/"){if(T=n.pop(),!T)throw new Error('Unopened section "'+v+'" at '+x);if(T[1]!==v)throw new Error('Unclosed section "'+T[1]+'" at '+x)}else y==="name"||y==="{"||y==="&"?s=!0:y==="="&&h(v)}if(l(),T=n.pop(),T)throw new Error('Unclosed section "'+T[1]+'" at '+g.pos);return Uq(Lq(i))}function Lq(t){for(var e=[],r,n,i=0,o=t.length;i<o;++i)r=t[i],r&&(r[0]==="text"&&n&&n[0]==="text"?(n[1]+=r[1],n[3]=r[3]):(e.push(r),n=r));return e}function Uq(t){for(var e=[],r=e,n=[],i,o,a=0,s=t.length;a<s;++a)switch(i=t[a],i[0]){case"#":case"^":r.push(i),n.push(i),r=i[4]=[];break;case"/":o=n.pop(),o[5]=i[2],r=n.length>0?n[n.length-1][4]:e;break;default:r.push(i)}return e}function vd(t){this.string=t,this.tail=t,this.pos=0}vd.prototype.eos=function(){return this.tail===""};vd.prototype.scan=function(e){var r=this.tail.match(e);if(!r||r.index!==0)return"";var n=r[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n};vd.prototype.scanUntil=function(e){var r=this.tail.search(e),n;switch(r){case-1:n=this.tail,this.tail="";break;case 0:n="";break;default:n=this.tail.substring(0,r),this.tail=this.tail.substring(r)}return this.pos+=n.length,n};function $u(t,e){this.view=t,this.cache={".":this.view},this.parent=e}$u.prototype.push=function(e){return new $u(e,this)};$u.prototype.lookup=function(e){var r=this.cache,n;if(r.hasOwnProperty(e))n=r[e];else{for(var i=this,o,a,s,c=!1;i;){if(e.indexOf(".")>0)for(o=i.view,a=e.split("."),s=0;o!=null&&s<a.length;)s===a.length-1&&(c=Dz(o,a[s])||Aq(o,a[s])),o=o[a[s++]];else o=i.view[e],c=Dz(i.view,e);if(c){n=o;break}i=i.parent}r[e]=n}return ek(n)&&(n=n.call(this.view)),n};function $r(){this.templateCache={_cache:{},set:function(e,r){this._cache[e]=r},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}$r.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};$r.prototype.parse=function(e,r){var n=this.templateCache,i=e+":"+(r||Nn.tags).join(":"),o=typeof n<"u",a=o?n.get(i):void 0;return a==null&&(a=Dq(e,r),o&&n.set(i,a)),a};$r.prototype.render=function(e,r,n,i){var o=this.getConfigTags(i),a=this.parse(e,o),s=r instanceof $u?r:new $u(r,void 0);return this.renderTokens(a,s,n,e,i)};$r.prototype.renderTokens=function(e,r,n,i,o){for(var a="",s,c,u,l=0,p=e.length;l<p;++l)u=void 0,s=e[l],c=s[0],c==="#"?u=this.renderSection(s,r,n,i,o):c==="^"?u=this.renderInverted(s,r,n,i,o):c===">"?u=this.renderPartial(s,r,n,o):c==="&"?u=this.unescapedValue(s,r):c==="name"?u=this.escapedValue(s,r,o):c==="text"&&(u=this.rawValue(s)),u!==void 0&&(a+=u);return a};$r.prototype.renderSection=function(e,r,n,i,o){var a=this,s="",c=r.lookup(e[1]);function u(f){return a.render(f,r,n,o)}if(c){if(Ou(c))for(var l=0,p=c.length;l<p;++l)s+=this.renderTokens(e[4],r.push(c[l]),n,i,o);else if(typeof c=="object"||typeof c=="string"||typeof c=="number")s+=this.renderTokens(e[4],r.push(c),n,i,o);else if(ek(c)){if(typeof i!="string")throw new Error("Cannot use higher-order sections without the original template");c=c.call(r.view,i.slice(e[3],e[5]),u),c!=null&&(s+=c)}else s+=this.renderTokens(e[4],r,n,i,o);return s}};$r.prototype.renderInverted=function(e,r,n,i,o){var a=r.lookup(e[1]);if(!a||Ou(a)&&a.length===0)return this.renderTokens(e[4],r,n,i,o)};$r.prototype.indentPartial=function(e,r,n){for(var i=r.replace(/[^ \t]/g,""),o=e.split(`
`),a=0;a<o.length;a++)o[a].length&&(a>0||!n)&&(o[a]=i+o[a]);return o.join(`
`)};$r.prototype.renderPartial=function(e,r,n,i){if(n){var o=this.getConfigTags(i),a=ek(n)?n(e[1]):n[e[1]];if(a!=null){var s=e[6],c=e[5],u=e[4],l=a;c==0&&u&&(l=this.indentPartial(a,u,s));var p=this.parse(l,o);return this.renderTokens(p,r,n,l,i)}}};$r.prototype.unescapedValue=function(e,r){var n=r.lookup(e[1]);if(n!=null)return n};$r.prototype.escapedValue=function(e,r,n){var i=this.getConfigEscape(n)||Nn.escape,o=r.lookup(e[1]);if(o!=null)return typeof o=="number"&&i===Nn.escape?String(o):i(o)};$r.prototype.rawValue=function(e){return e[1]};$r.prototype.getConfigTags=function(e){return Ou(e)?e:e&&typeof e=="object"?e.tags:void 0};$r.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!Ou(e))return e.escape};var Nn={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(t){yd.templateCache=t},get templateCache(){return yd.templateCache}},yd=new $r;Nn.clearCache=function(){return yd.clearCache()};Nn.parse=function(e,r){return yd.parse(e,r)};Nn.render=function(e,r,n,i){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+Eq(e)+'" was given as the first argument for mustache#render(template, view, partials)');return yd.render(e,r,n,i)};Nn.escape=Nq;Nn.Scanner=vd;Nn.Context=$u;Nn.Writer=$r;var Kg=Nn;function Uz(){Kg.escape=t=>t}var Bs=t=>{let e=t.split(""),r=[],n=(o,a)=>{for(let s=a;s<e.length;s+=1)if(o.includes(e[s]))return s;return-1},i=0;for(;i<e.length;)if(e[i]==="{"&&i+1<e.length&&e[i+1]==="{")r.push({type:"literal",text:"{"}),i+=2;else if(e[i]==="}"&&i+1<e.length&&e[i+1]==="}")r.push({type:"literal",text:"}"}),i+=2;else if(e[i]==="{"){let o=n("}",i);if(o<0)throw new Error("Unclosed '{' in template.");r.push({type:"variable",name:e.slice(i+1,o).join("")}),i=o+1}else{if(e[i]==="}")throw new Error("Single '}' in template.");{let o=n("{}",i),a=(o<0?e.slice(i):e.slice(i,o)).join("");r.push({type:"literal",text:a}),i=o<0?e.length:o}}return r},Fz=(t,e=[])=>{let r=[];for(let n of t)if(n[0]==="name"){let i=n[1].includes(".")?n[1].split(".")[0]:n[1];r.push({type:"variable",name:i})}else if(["#","&","^",">"].includes(n[0])){if(r.push({type:"variable",name:n[1]}),n[0]==="#"&&n.length>4&&Array.isArray(n[4])){let i=[...e,n[1]],o=Fz(n[4],i);r.push(...o)}}else r.push({type:"literal",text:n[1]});return r},Cu=t=>{Uz();let e=Kg.parse(t);return Fz(e)},tk=(t,e)=>Bs(t).reduce((r,n)=>{if(n.type==="variable"){if(n.name in e){let i=typeof e[n.name]=="string"?e[n.name]:JSON.stringify(e[n.name]);return r+i}throw new Error(`(f-string) Missing value for input ${n.name}`)}return r+n.text},""),rk=(t,e)=>(Uz(),Kg.render(t,e)),bd={"f-string":tk,mustache:rk},nk={"f-string":Bs,mustache:Cu},ur=(t,e,r)=>{try{return bd[e](t,r)}catch(n){throw ea(n,"INVALID_PROMPT_INPUT")}},Vs=(t,e)=>nk[e](t),Eo=(t,e,r)=>{if(!(e in bd)){let n=Object.keys(bd);throw new Error(`Invalid template format. Got \`${e}\`;
                         should be one of ${n}`)}try{let n=Object.fromEntries(r.map(i=>[i,"foo"]));Array.isArray(t)?t.forEach(i=>{if(i.type==="text"&&"text"in i&&typeof i.text=="string")ur(i.text,e,n);else if(i.type==="image_url"){if(typeof i.image_url=="string")ur(i.image_url,e,n);else if(typeof i.image_url=="object"&&i.image_url!==null&&"url"in i.image_url&&typeof i.image_url.url=="string"){let o=i.image_url.url;ur(o,e,n)}}else throw new Error(`Invalid message template received. ${JSON.stringify(i,null,2)}`)}):ur(t,e,n)}catch(n){throw new Error(`Invalid prompt schema: ${n.message}`)}};var Yn=class wd extends ko{constructor(r){super(r);d(this,"template");d(this,"templateFormat","f-string");d(this,"validateTemplate",!0);d(this,"additionalContentFields");if(r.templateFormat==="mustache"&&r.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,r),this.validateTemplate){if(this.templateFormat==="mustache")throw new Error("Mustache templates cannot be validated.");let n=this.inputVariables;this.partialVariables&&(n=n.concat(Object.keys(this.partialVariables))),Eo(this.template,this.templateFormat,n)}}static lc_name(){return"PromptTemplate"}_getPromptType(){return"prompt"}async format(r){let n=await this.mergePartialAndUserVariables(r);return ur(this.template,this.templateFormat,n)}static fromExamples(r,n,i,o=`

`,a=""){let s=[a,...r,n].join(o);return new wd({inputVariables:i,template:s})}static fromTemplate(r,n){let{templateFormat:i="f-string",...o}=n??{},a=new Set;return Vs(r,i).forEach(s=>{s.type==="variable"&&a.add(s.name)}),new wd({inputVariables:[...a],templateFormat:i,template:r,...o})}async partial(r){let n=this.inputVariables.filter(a=>!(a in r)),i={...this.partialVariables??{},...r},o={...this,inputVariables:n,partialVariables:i};return new wd(o)}serialize(){if(this.outputParser!==void 0)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(r){if(!r.template)throw new Error("Prompt template must have a template");return new wd({inputVariables:r.input_variables,template:r.template,templateFormat:r.template_format})}};var Pu=class Bz extends zi{constructor(r){super(r);d(this,"lc_namespace",["langchain_core","prompts","image"]);d(this,"template");d(this,"templateFormat","f-string");d(this,"validateTemplate",!0);d(this,"additionalContentFields");if(this.template=r.template,this.templateFormat=r.templateFormat??this.templateFormat,this.validateTemplate=r.validateTemplate??this.validateTemplate,this.additionalContentFields=r.additionalContentFields,this.validateTemplate){let n=this.inputVariables;this.partialVariables&&(n=n.concat(Object.keys(this.partialVariables))),Eo([{type:"image_url",image_url:this.template}],this.templateFormat,n)}}static lc_name(){return"ImagePromptTemplate"}_getPromptType(){return"prompt"}async partial(r){let n=this.inputVariables.filter(a=>!(a in r)),i={...this.partialVariables??{},...r},o={...this,inputVariables:n,partialVariables:i};return new Bz(o)}async format(r){let n={};for(let[s,c]of Object.entries(this.template))typeof c=="string"?n[s]=ur(c,this.templateFormat,r):n[s]=c;let i=r.url||n.url,o=r.detail||n.detail;if(!i)throw new Error("Must provide either an image URL.");if(typeof i!="string")throw new Error("url must be a string.");let a={url:i};return o&&(a.detail=o),a}async formatPromptValue(r){let n=await this.format(r);return new mI(n)}};var xd=class extends pe{constructor(e){let r=e.templateFormat??"f-string",n=ik(e.template,r);super({inputVariables:n,...e});d(this,"lc_namespace",["langchain_core","prompts","dict"]);d(this,"lc_serializable",!0);d(this,"template");d(this,"templateFormat");d(this,"inputVariables");this.template=e.template,this.templateFormat=r,this.inputVariables=n}static lc_name(){return"DictPromptTemplate"}async format(e){return ok(this.template,e,this.templateFormat)}async invoke(e){return await this._callWithConfig(this.format.bind(this),e,{runType:"prompt"})}};function ik(t,e){let r=[];for(let n of Object.values(t))if(typeof n=="string")Vs(n,e).forEach(i=>{i.type==="variable"&&r.push(i.name)});else if(Array.isArray(n))for(let i of n)typeof i=="string"?Vs(i,e).forEach(o=>{o.type==="variable"&&r.push(o.name)}):typeof i=="object"&&r.push(...ik(i,e));else typeof n=="object"&&n!==null&&r.push(...ik(n,e));return Array.from(new Set(r))}function ok(t,e,r){let n={};for(let[i,o]of Object.entries(t))if(typeof o=="string")n[i]=ur(o,r,e);else if(Array.isArray(o)){let a=[];for(let s of o)typeof s=="string"?a.push(ur(s,r,e)):typeof s=="object"&&a.push(ok(s,e,r));n[i]=a}else typeof o=="object"&&o!==null?n[i]=ok(o,e,r):n[i]=o;return n}var Sd=class extends pe{constructor(){super(...arguments);d(this,"lc_namespace",["langchain_core","prompts","chat"]);d(this,"lc_serializable",!0)}async invoke(e,r){return this._callWithConfig(n=>this.formatMessages(n),e,{...r,runType:"prompt"})}},Jg=class extends Sd{constructor(e){typeof e=="string"&&(e={variableName:e});super(e);d(this,"variableName");d(this,"optional");this.variableName=e.variableName,this.optional=e.optional??!1}static lc_name(){return"MessagesPlaceholder"}get inputVariables(){return[this.variableName]}async formatMessages(e){let r=e[this.variableName];if(this.optional&&!r)return[];if(!r){let i=new Error(`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages as an input value. Received: undefined`);throw i.name="InputFormatError",i}let n;try{Array.isArray(r)?n=r.map(nr):n=[nr(r)]}catch(i){let o=typeof r=="string"?r:JSON.stringify(r,null,2),a=new Error([`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages or coerceable values as input.`,`Received value: ${o}`,`Additional message: ${i.message}`].join(`

`));throw a.name="InputFormatError",a.lc_error_code=i.lc_error_code,a}return n}},ak=class extends Sd{constructor(e){"prompt"in e||(e={prompt:e});super(e);d(this,"prompt");this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}},Id=class extends zi{constructor(t){super(t)}async format(t){return(await this.formatPromptValue(t)).toString()}async formatPromptValue(t){let e=await this.formatMessages(t);return new ld(e)}},sk=class extends ak{constructor(e,r){"prompt"in e||(e={prompt:e,role:r});super(e);d(this,"role");this.role=e.role}static lc_name(){return"ChatMessagePromptTemplate"}async format(e){return new _r(await this.prompt.format(e),this.role)}static fromTemplate(e,r,n){return new this(Yn.fromTemplate(e,{templateFormat:n?.templateFormat}),r)}};function Fq(t){return t===null||typeof t!="object"||Array.isArray(t)?!1:Object.keys(t).length===1&&"text"in t&&typeof t.text=="string"}function Bq(t){return t===null||typeof t!="object"||Array.isArray(t)?!1:"image_url"in t&&(typeof t.image_url=="string"||typeof t.image_url=="object"&&t.image_url!==null&&"url"in t.image_url&&typeof t.image_url.url=="string")}var ck=class extends Sd{constructor(e,r){"prompt"in e||(e={prompt:e});super(e);d(this,"lc_namespace",["langchain_core","prompts","chat"]);d(this,"lc_serializable",!0);d(this,"inputVariables",[]);d(this,"additionalOptions",{});d(this,"prompt");d(this,"messageClass");d(this,"chatMessageClass");if(this.prompt=e.prompt,Array.isArray(this.prompt)){let n=[];this.prompt.forEach(i=>{"inputVariables"in i&&(n=n.concat(i.inputVariables))}),this.inputVariables=n}else this.inputVariables=this.prompt.inputVariables;this.additionalOptions=r??this.additionalOptions}static _messageClass(){throw new Error("Can not invoke _messageClass from inside _StringImageMessagePromptTemplate")}createMessage(e){let r=this.constructor;if(r._messageClass()){let n=r._messageClass();return new n({content:e})}else if(r.chatMessageClass){let n=r.chatMessageClass();return new n({content:e,role:this.getRoleFromMessageClass(n.lc_name())})}else throw new Error("No message class defined")}getRoleFromMessageClass(e){switch(e){case"HumanMessage":return"human";case"AIMessage":return"ai";case"SystemMessage":return"system";case"ChatMessage":return"chat";default:throw new Error("Invalid message class name")}}static fromTemplate(e,r){if(typeof e=="string")return new this(Yn.fromTemplate(e,r));let n=[];for(let i of e)if(typeof i=="string")n.push(Yn.fromTemplate(i,r));else if(i!==null)if(Fq(i)){let o="";typeof i.text=="string"&&(o=i.text??"");let a={...r,additionalContentFields:i};n.push(Yn.fromTemplate(o,a))}else if(Bq(i)){let o=i.image_url??"",a,s=[];if(typeof o=="string"){let c;r?.templateFormat==="mustache"?c=Cu(o):c=Bs(o);let u=c.flatMap(l=>l.type==="variable"?[l.name]:[]);if((u?.length??0)>0){if(u.length>1)throw new Error(`Only one format variable allowed per image template.
Got: ${u}
From: ${o}`);s=[u[0]]}else s=[];o={url:o},a=new Pu({template:o,inputVariables:s,templateFormat:r?.templateFormat,additionalContentFields:i})}else if(typeof o=="object"){if("url"in o){let c;r?.templateFormat==="mustache"?c=Cu(o.url):c=Bs(o.url),s=c.flatMap(u=>u.type==="variable"?[u.name]:[])}else s=[];a=new Pu({template:o,inputVariables:s,templateFormat:r?.templateFormat,additionalContentFields:i})}else throw new Error("Invalid image template");n.push(a)}else typeof i=="object"&&n.push(new xd({template:i,templateFormat:r?.templateFormat}));return new this({prompt:n,additionalOptions:r})}async format(e){if(this.prompt instanceof ko){let r=await this.prompt.format(e);return this.createMessage(r)}else{let r=[];for(let n of this.prompt){let i={};if(!("inputVariables"in n))throw new Error(`Prompt ${n} does not have inputVariables defined.`);for(let o of n.inputVariables)i||(i={[o]:e[o]}),i={...i,[o]:e[o]};if(n instanceof ko){let o=await n.format(i),a;"additionalContentFields"in n&&(a=n.additionalContentFields),o!==""&&r.push({...a,type:"text",text:o})}else if(n instanceof Pu){let o=await n.format(i),a;"additionalContentFields"in n&&(a=n.additionalContentFields),r.push({...a,type:"image_url",image_url:o})}else if(n instanceof xd){let o=await n.format(i),a;"additionalContentFields"in n&&(a=n.additionalContentFields),r.push({...a,...o})}}return this.createMessage(r)}}async formatMessages(e){return[await this.format(e)]}},Xg=class extends ck{static _messageClass(){return $t}static lc_name(){return"HumanMessagePromptTemplate"}},uk=class extends ck{static _messageClass(){return Ue}static lc_name(){return"AIMessagePromptTemplate"}},lk=class extends ck{static _messageClass(){return Yr}static lc_name(){return"SystemMessagePromptTemplate"}};function Vq(t){return typeof t.formatMessages=="function"}function Zq(t,e){if(Vq(t)||dt(t))return t;if(Array.isArray(t)&&t[0]==="placeholder"){let i=t[1];if(e?.templateFormat==="mustache"&&typeof i=="string"&&i.slice(0,2)==="{{"&&i.slice(-2)==="}}"){let o=i.slice(2,-2);return new Jg({variableName:o,optional:!0})}else if(typeof i=="string"&&i[0]==="{"&&i[i.length-1]==="}"){let o=i.slice(1,-1);return new Jg({variableName:o,optional:!0})}throw new Error(`Invalid placeholder template for format ${e?.templateFormat??'"f-string"'}: "${t[1]}". Expected a variable name surrounded by ${e?.templateFormat==="mustache"?"double":"single"} curly braces.`)}let r=nr(t),n;if(typeof r.content=="string"?n=r.content:n=r.content.map(i=>"text"in i?{...i,text:i.text}:"image_url"in i?{...i,image_url:i.image_url}:i),r._getType()==="human")return Xg.fromTemplate(n,e);if(r._getType()==="ai")return uk.fromTemplate(n,e);if(r._getType()==="system")return lk.fromTemplate(n,e);if(_r.isInstance(r))return sk.fromTemplate(r.content,r.role,e);throw new Error(`Could not coerce message prompt template from input. Received message type: "${r._getType()}".`)}function Gq(t){return t.constructor.lc_name()==="MessagesPlaceholder"}var Nu=class Wg extends Id{constructor(r){super(r);d(this,"promptMessages");d(this,"validateTemplate",!0);d(this,"templateFormat","f-string");if(r.templateFormat==="mustache"&&r.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,r),this.validateTemplate){let n=new Set;for(let c of this.promptMessages)if(!(c instanceof kt))for(let u of c.inputVariables)n.add(u);let i=this.inputVariables,o=new Set(this.partialVariables?i.concat(Object.keys(this.partialVariables)):i),a=new Set([...o].filter(c=>!n.has(c)));if(a.size>0)throw new Error(`Input variables \`${[...a]}\` are not used in any of the prompt messages.`);let s=new Set([...n].filter(c=>!o.has(c)));if(s.size>0)throw new Error(`Input variables \`${[...s]}\` are used in prompt messages but not in the prompt template.`)}}static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}_getPromptType(){return"chat"}async _parseImagePrompts(r,n){if(typeof r.content=="string")return r;let i=await Promise.all(r.content.map(async o=>{if(o.type!=="image_url")return o;let a="";typeof o.image_url=="string"?a=o.image_url:typeof o.image_url=="object"&&o.image_url!==null&&"url"in o.image_url&&typeof o.image_url.url=="string"&&(a=o.image_url.url);let c=await Yn.fromTemplate(a,{templateFormat:this.templateFormat}).format(n);return typeof o.image_url=="object"&&o.image_url!==null&&"url"in o.image_url?o.image_url.url=c:o.image_url=c,o}));return r.content=i,r}async formatMessages(r){let n=await this.mergePartialAndUserVariables(r),i=[];for(let o of this.promptMessages)if(o instanceof kt)i.push(await this._parseImagePrompts(o,n));else{let a;this.templateFormat==="mustache"?a={...n}:a=o.inputVariables.reduce((c,u)=>{if(!(u in n)&&!(Gq(o)&&o.optional))throw ea(new Error(`Missing value for input variable \`${u.toString()}\``),"INVALID_PROMPT_INPUT");return c[u]=n[u],c},{});let s=await o.formatMessages(a);i=i.concat(s)}return i}async partial(r){let n=this.inputVariables.filter(a=>!(a in r)),i={...this.partialVariables??{},...r},o={...this,inputVariables:n,partialVariables:i};return new Wg(o)}static fromTemplate(r,n){let i=Yn.fromTemplate(r,n),o=new Xg({prompt:i});return this.fromMessages([o])}static fromMessages(r,n){let i=r.reduce((s,c)=>s.concat(c instanceof Wg?c.promptMessages:[Zq(c,n)]),[]),o=r.reduce((s,c)=>c instanceof Wg?Object.assign(s,c.partialVariables):s,Object.create(null)),a=new Set;for(let s of i)if(!(s instanceof kt))for(let c of s.inputVariables)c in o||a.add(c);return new this({...n,inputVariables:[...a],promptMessages:i,partialVariables:o,templateFormat:n?.templateFormat})}};var Vz=class pk extends ko{constructor(r){super(r);d(this,"lc_serializable",!1);d(this,"examples");d(this,"exampleSelector");d(this,"examplePrompt");d(this,"suffix","");d(this,"exampleSeparator",`

`);d(this,"prefix","");d(this,"templateFormat","f-string");d(this,"validateTemplate",!0);if(Object.assign(this,r),this.examples!==void 0&&this.exampleSelector!==void 0)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(this.examples===void 0&&this.exampleSelector===void 0)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let n=this.inputVariables;this.partialVariables&&(n=n.concat(Object.keys(this.partialVariables))),Eo(this.prefix+this.suffix,this.templateFormat,n)}}_getPromptType(){return"few_shot"}static lc_name(){return"FewShotPromptTemplate"}async getExamples(r){if(this.examples!==void 0)return this.examples;if(this.exampleSelector!==void 0)return this.exampleSelector.selectExamples(r);throw new Error("One of 'examples' and 'example_selector' should be provided")}async partial(r){let n=this.inputVariables.filter(a=>!(a in r)),i={...this.partialVariables??{},...r},o={...this,inputVariables:n,partialVariables:i};return new pk(o)}async format(r){let n=await this.mergePartialAndUserVariables(r),i=await this.getExamples(n),o=await Promise.all(i.map(s=>this.examplePrompt.format(s))),a=[this.prefix,...o,this.suffix].join(this.exampleSeparator);return ur(a,this.templateFormat,n)}serialize(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(this.outputParser!==void 0)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(r){let{example_prompt:n}=r;if(!n)throw new Error("Missing example prompt");let i=await Yn.deserialize(n),o;if(Array.isArray(r.examples))o=r.examples;else throw new Error("Invalid examples format. Only list or string are supported.");return new pk({inputVariables:r.input_variables,examplePrompt:i,examples:o,exampleSeparator:r.example_separator,prefix:r.prefix,suffix:r.suffix,templateFormat:r.template_format})}},Zz=class Gz extends Id{constructor(r){super(r);d(this,"lc_serializable",!0);d(this,"examples");d(this,"exampleSelector");d(this,"examplePrompt");d(this,"suffix","");d(this,"exampleSeparator",`

`);d(this,"prefix","");d(this,"templateFormat","f-string");d(this,"validateTemplate",!0);if(this.examples=r.examples,this.examplePrompt=r.examplePrompt,this.exampleSeparator=r.exampleSeparator??`

`,this.exampleSelector=r.exampleSelector,this.prefix=r.prefix??"",this.suffix=r.suffix??"",this.templateFormat=r.templateFormat??"f-string",this.validateTemplate=r.validateTemplate??!0,this.examples!==void 0&&this.exampleSelector!==void 0)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(this.examples===void 0&&this.exampleSelector===void 0)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let n=this.inputVariables;this.partialVariables&&(n=n.concat(Object.keys(this.partialVariables))),Eo(this.prefix+this.suffix,this.templateFormat,n)}}_getPromptType(){return"few_shot_chat"}static lc_name(){return"FewShotChatMessagePromptTemplate"}async getExamples(r){if(this.examples!==void 0)return this.examples;if(this.exampleSelector!==void 0)return this.exampleSelector.selectExamples(r);throw new Error("One of 'examples' and 'example_selector' should be provided")}async formatMessages(r){let n=await this.mergePartialAndUserVariables(r),i=await this.getExamples(n);i=i.map(a=>{let s={};return this.examplePrompt.inputVariables.forEach(c=>{s[c]=a[c]}),s});let o=[];for(let a of i){let s=await this.examplePrompt.formatMessages(a);o.push(...s)}return o}async format(r){let n=await this.mergePartialAndUserVariables(r),i=await this.getExamples(n),a=(await Promise.all(i.map(c=>this.examplePrompt.formatMessages(c)))).flat().map(c=>c.content),s=[this.prefix,...a,this.suffix].join(this.exampleSeparator);return ur(s,this.templateFormat,n)}async partial(r){let n=this.inputVariables.filter(a=>!(a in r)),i={...this.partialVariables??{},...r},o={...this,inputVariables:n,partialVariables:i};return new Gz(o)}};var Hz=class Yg extends zi{constructor(r){super({...r,inputVariables:[]});d(this,"pipelinePrompts");d(this,"finalPrompt");this.pipelinePrompts=r.pipelinePrompts,this.finalPrompt=r.finalPrompt,this.inputVariables=this.computeInputValues()}static lc_name(){return"PipelinePromptTemplate"}computeInputValues(){let r=this.pipelinePrompts.map(i=>i.name),n=this.pipelinePrompts.map(i=>i.prompt.inputVariables.filter(o=>!r.includes(o))).flat();return[...new Set(n)]}static extractRequiredInputValues(r,n){return n.reduce((i,o)=>(i[o]=r[o],i),{})}async formatPipelinePrompts(r){let n=await this.mergePartialAndUserVariables(r);for(let{name:i,prompt:o}of this.pipelinePrompts){let a=Yg.extractRequiredInputValues(n,o.inputVariables);o instanceof Nu?n[i]=await o.formatMessages(a):n[i]=await o.format(a)}return Yg.extractRequiredInputValues(n,this.finalPrompt.inputVariables)}async formatPromptValue(r){return this.finalPrompt.formatPromptValue(await this.formatPipelinePrompts(r))}async format(r){return this.finalPrompt.format(await this.formatPipelinePrompts(r))}async partial(r){let n={...this};return n.inputVariables=this.inputVariables.filter(i=>!(i in r)),n.partialVariables={...this.partialVariables??{},...r},new Yg(n)}serialize(){throw new Error("Not implemented.")}_getPromptType(){return"pipeline"}};function qz(t){return typeof t=="object"&&t!=null&&"withStructuredOutput"in t&&typeof t.withStructuredOutput=="function"}function Hq(t){return typeof t=="object"&&t!=null&&"lc_id"in t&&Array.isArray(t.lc_id)&&t.lc_id.join("/")==="langchain_core/runnables/RunnableBinding"}var Kz=class Wz extends Nu{constructor(r){super(r);d(this,"schema");d(this,"method");d(this,"lc_namespace",["langchain_core","prompts","structured"]);this.schema=r.schema,this.method=r.method}get lc_aliases(){return{...super.lc_aliases,schema:"schema_"}}pipe(r){if(qz(r))return super.pipe(r.withStructuredOutput(this.schema));if(Hq(r)&&qz(r.bound))return super.pipe(new On({bound:r.bound.withStructuredOutput(this.schema,...this.method?[{method:this.method}]:[]),kwargs:r.kwargs??{},config:r.config,configFactories:r.configFactories}));throw new Error('Structured prompts need to be piped to a language model that supports the "withStructuredOutput()" method.')}static fromMessagesAndSchema(r,n,i){return Wz.fromMessages(r,{schema:n,method:i})}};var dk={};z(dk,{AIMessagePromptTemplate:()=>uk,BaseChatPromptTemplate:()=>Id,BaseMessagePromptTemplate:()=>Sd,BaseMessageStringPromptTemplate:()=>ak,BasePromptTemplate:()=>zi,BaseStringPromptTemplate:()=>ko,ChatMessagePromptTemplate:()=>sk,ChatPromptTemplate:()=>Nu,DEFAULT_FORMATTER_MAPPING:()=>bd,DEFAULT_PARSER_MAPPING:()=>nk,DictPromptTemplate:()=>xd,FewShotChatMessagePromptTemplate:()=>Zz,FewShotPromptTemplate:()=>Vz,HumanMessagePromptTemplate:()=>Xg,ImagePromptTemplate:()=>Pu,MessagesPlaceholder:()=>Jg,PipelinePromptTemplate:()=>Hz,PromptTemplate:()=>Yn,StructuredPrompt:()=>Kz,SystemMessagePromptTemplate:()=>lk,checkValidTemplate:()=>Eo,interpolateFString:()=>tk,interpolateMustache:()=>rk,parseFString:()=>Bs,parseMustache:()=>Cu,parseTemplate:()=>Vs,renderTemplate:()=>ur});var fk={};z(fk,{BaseDocumentCompressor:()=>qq});var qq=class{static isBaseDocumentCompressor(t){return t?.compressDocuments!==void 0}};var Qn={and:"and",or:"or",not:"not"},je={eq:"eq",ne:"ne",lt:"lt",gt:"gt",lte:"lte",gte:"gte"},Qg=class{},e_=class{accept(t){if(this.exprName==="Operation")return t.visitOperation(this);if(this.exprName==="Comparison")return t.visitComparison(this);if(this.exprName==="StructuredQuery")return t.visitStructuredQuery(this);throw new Error("Unknown Expression type")}},t_=class extends e_{},Jz=class extends t_{constructor(e,r,n){super();d(this,"exprName","Comparison");this.comparator=e,this.attribute=r,this.value=n}},Xz=class extends t_{constructor(e,r){super();d(this,"exprName","Operation");this.operator=e,this.args=r}},Yz=class extends e_{constructor(e,r){super();d(this,"exprName","StructuredQuery");this.query=e,this.filter=r}};function mk(t){return t&&typeof t=="object"&&!Array.isArray(t)}function Hr(t){return t?typeof t=="string"&&t.length>0||typeof t=="function"?!1:mk(t)&&Object.keys(t).length===0:!0}function hk(t){if(typeof t=="number")return t%1===0;if(typeof t=="string"){let e=parseInt(t,10);return!Number.isNaN(e)&&e%1===0&&e.toString()===t}return!1}function gk(t){if(typeof t=="number")return t%1!==0;if(typeof t=="string"){let e=parseFloat(t);return!Number.isNaN(e)&&e%1!==0&&e.toString()===t}return!1}function _k(t){return typeof t=="string"&&(Number.isNaN(parseFloat(t))||parseFloat(t).toString()!==t)}function yk(t){return typeof t=="boolean"}function Ru(t){let e;if(_k(t))e=t;else if(hk(t))e=parseInt(t,10);else if(gk(t))e=parseFloat(t);else if(yk(t))e=!!t;else throw new Error("Unsupported value type");return e}var kd=class extends Qg{},Qz=class extends kd{constructor(e){super();d(this,"allowedOperators");d(this,"allowedComparators");this.allowedOperators=e?.allowedOperators??[Qn.and,Qn.or],this.allowedComparators=e?.allowedComparators??[je.eq,je.ne,je.gt,je.gte,je.lt,je.lte]}formatFunction(e){if(e in je){if(this.allowedComparators.length>0&&this.allowedComparators.indexOf(e)===-1)throw new Error(`Comparator ${e} not allowed. Allowed comparators: ${this.allowedComparators.join(", ")}`)}else if(e in Qn){if(this.allowedOperators.length>0&&this.allowedOperators.indexOf(e)===-1)throw new Error(`Operator ${e} not allowed. Allowed operators: ${this.allowedOperators.join(", ")}`)}else throw new Error("Unknown comparator or operator");return`$${e}`}visitOperation(e){let r=e.args?.map(n=>n.accept(this));return{[this.formatFunction(e.operator)]:r}}visitComparison(e){return{[e.attribute]:{[this.formatFunction(e.comparator)]:Ru(e.value)}}}visitStructuredQuery(e){let r={};return e.filter&&(r={filter:e.filter.accept(this)}),r}mergeFilters(e,r,n="and",i=!1){if(!(Hr(e)&&Hr(r))){if(Hr(e)||n==="replace")return Hr(r)?void 0:r;if(Hr(r))return i?e:n==="and"?void 0:e;if(n==="and")return{$and:[e,r]};if(n==="or")return{$or:[e,r]};throw new Error("Unknown merge type")}}};var ej=class extends kd{constructor(){super(...arguments);d(this,"allowedOperators",[Qn.and,Qn.or]);d(this,"allowedComparators",[je.eq,je.ne,je.gt,je.gte,je.lt,je.lte])}formatFunction(){throw new Error("Not implemented")}getAllowedComparatorsForType(e){switch(e){case"string":return[je.eq,je.ne,je.gt,je.gte,je.lt,je.lte];case"number":return[je.eq,je.ne,je.gt,je.gte,je.lt,je.lte];case"boolean":return[je.eq,je.ne];default:throw new Error(`Unsupported data type: ${e}`)}}getComparatorFunction(e){switch(e){case je.eq:return(r,n)=>r===n;case je.ne:return(r,n)=>r!==n;case je.gt:return(r,n)=>r>n;case je.gte:return(r,n)=>r>=n;case je.lt:return(r,n)=>r<n;case je.lte:return(r,n)=>r<=n;default:throw new Error("Unknown comparator")}}getOperatorFunction(e){switch(e){case Qn.and:return(r,n)=>r&&n;case Qn.or:return(r,n)=>r||n;default:throw new Error("Unknown operator")}}visitOperation(e){let{operator:r,args:n}=e;if(this.allowedOperators.includes(r)){let i=this.getOperatorFunction(r);return o=>n?n.reduce((a,s)=>{let c=s.accept(this);if(typeof c=="function")return i(a,c(o));throw new Error("Filter is not a function")},!0):!0}else throw new Error("Operator not allowed")}visitComparison(e){let{comparator:r,attribute:n,value:i}=e,o=[je.ne];if(this.allowedComparators.includes(r)){if(!this.getAllowedComparatorsForType(typeof i).includes(r))throw new Error(`'${r}' comparator not allowed to be used with ${typeof i}`);let a=this.getComparatorFunction(r);return s=>{let c=s.metadata[n];return c===void 0?!!o.includes(r):a(c,Ru(i))}}else throw new Error("Comparator not allowed")}visitStructuredQuery(e){if(!e.filter)return{};let r=e.filter?.accept(this);if(typeof r!="function")throw new Error("Structured query filter is not a function");return{filter:r}}mergeFilters(e,r,n="and"){if(!(Hr(e)&&Hr(r))){if(Hr(e)||n==="replace")return Hr(r)?void 0:r;if(Hr(r))return n==="and"?void 0:e;if(n==="and")return i=>e(i)&&r(i);if(n==="or")return i=>e(i)||r(i);throw new Error("Unknown merge type")}}};var vk={};z(vk,{BaseTranslator:()=>kd,BasicTranslator:()=>Qz,Comparators:()=>je,Comparison:()=>Jz,Expression:()=>e_,FilterDirective:()=>t_,FunctionalTranslator:()=>ej,Operation:()=>Xz,Operators:()=>Qn,StructuredQuery:()=>Yz,Visitor:()=>Qg,castValue:()=>Ru,isBoolean:()=>yk,isFilterEmpty:()=>Hr,isFloat:()=>gk,isInt:()=>hk,isObject:()=>mk,isString:()=>_k});function Ed(t){return t!==void 0&&Array.isArray(t.lc_namespace)}function Ad(t){return t!==void 0&&pe.isRunnable(t)&&"lc_name"in t.constructor&&typeof t.constructor.lc_name=="function"&&t.constructor.lc_name()==="RunnableToolLike"}function Td(t){return!!t&&typeof t=="object"&&"name"in t&&"schema"in t&&(Er(t.schema)||t.schema!=null&&typeof t.schema=="object"&&"type"in t.schema&&typeof t.schema.type=="string"&&["null","boolean","object","array","number","string"].includes(t.schema.type))}function Zs(t){return Td(t)||Ad(t)||Ed(t)}var K={};hi(K,{$brand:()=>ah,$input:()=>y0,$output:()=>_0,NEVER:()=>tw,TimePrecision:()=>x0,ZodAny:()=>Vk,ZodArray:()=>qk,ZodBase64:()=>x_,ZodBase64URL:()=>S_,ZodBigInt:()=>Fu,ZodBigIntFormat:()=>E_,ZodBoolean:()=>Uu,ZodCIDRv4:()=>b_,ZodCIDRv6:()=>w_,ZodCUID:()=>f_,ZodCUID2:()=>m_,ZodCatch:()=>hE,ZodCodec:()=>R_,ZodCustom:()=>Ud,ZodCustomStringFormat:()=>Du,ZodDate:()=>Md,ZodDefault:()=>uE,ZodDiscriminatedUnion:()=>Wk,ZodE164:()=>I_,ZodEmail:()=>l_,ZodEmoji:()=>p_,ZodEnum:()=>zu,ZodError:()=>Kq,ZodExactOptional:()=>aE,ZodFile:()=>iE,ZodFirstPartyTypeKind:()=>AE,ZodFunction:()=>IE,ZodGUID:()=>Od,ZodIPv4:()=>y_,ZodIPv6:()=>v_,ZodISODate:()=>i_,ZodISODateTime:()=>n_,ZodISODuration:()=>a_,ZodISOTime:()=>o_,ZodIntersection:()=>Jk,ZodIssueCode:()=>Jq,ZodJWT:()=>k_,ZodKSUID:()=>__,ZodLazy:()=>wE,ZodLiteral:()=>nE,ZodMAC:()=>zk,ZodMap:()=>tE,ZodNaN:()=>_E,ZodNanoID:()=>d_,ZodNever:()=>Gk,ZodNonOptional:()=>P_,ZodNull:()=>Fk,ZodNullable:()=>cE,ZodNumber:()=>Lu,ZodNumberFormat:()=>Hs,ZodObject:()=>jd,ZodOptional:()=>C_,ZodPipe:()=>N_,ZodPrefault:()=>pE,ZodPromise:()=>SE,ZodReadonly:()=>yE,ZodRealError:()=>qr,ZodRecord:()=>Ld,ZodSet:()=>rE,ZodString:()=>ju,ZodStringFormat:()=>Ye,ZodSuccess:()=>mE,ZodSymbol:()=>Lk,ZodTemplateLiteral:()=>bE,ZodTransform:()=>oE,ZodTuple:()=>Yk,ZodType:()=>Ae,ZodULID:()=>h_,ZodURL:()=>Rd,ZodUUID:()=>ji,ZodUndefined:()=>Uk,ZodUnion:()=>Dd,ZodUnknown:()=>Zk,ZodVoid:()=>Hk,ZodXID:()=>g_,ZodXor:()=>Kk,_ZodString:()=>u_,_default:()=>lE,_function:()=>sD,any:()=>Lj,array:()=>zd,base64:()=>xj,base64url:()=>Sj,bigint:()=>Rj,boolean:()=>Dk,catch:()=>gE,check:()=>cD,cidrv4:()=>bj,cidrv6:()=>wj,clone:()=>ut,codec:()=>iD,coerce:()=>TE,config:()=>bt,core:()=>yo,cuid:()=>dj,cuid2:()=>fj,custom:()=>uD,date:()=>Fj,decode:()=>$k,decodeAsync:()=>Ck,describe:()=>lD,discriminatedUnion:()=>qj,e164:()=>Ij,email:()=>rj,emoji:()=>lj,encode:()=>Tk,encodeAsync:()=>Ok,endsWith:()=>ru,enum:()=>$_,exactOptional:()=>sE,file:()=>eD,flattenError:()=>Dp,float32:()=>Oj,float64:()=>Cj,formatError:()=>Lp,fromJSONSchema:()=>_D,function:()=>sD,getErrorMap:()=>Yq,globalRegistry:()=>qe,gt:()=>Ai,gte:()=>Ir,guid:()=>nj,hash:()=>$j,hex:()=>Tj,hostname:()=>Aj,httpUrl:()=>uj,includes:()=>eu,instanceof:()=>dD,int:()=>c_,int32:()=>Pj,int64:()=>Mj,intersection:()=>Xk,ipv4:()=>_j,ipv6:()=>vj,iso:()=>Mu,json:()=>mD,jwt:()=>kj,keyof:()=>Bj,ksuid:()=>gj,lazy:()=>xE,length:()=>vs,literal:()=>Qj,locales:()=>Wp,looseObject:()=>Gj,looseRecord:()=>Wj,lowercase:()=>Yc,lt:()=>Ei,lte:()=>nn,mac:()=>yj,map:()=>Jj,maxLength:()=>ys,maxSize:()=>ga,meta:()=>pD,mime:()=>nu,minLength:()=>go,minSize:()=>Ti,multipleOf:()=>ha,nan:()=>nD,nanoid:()=>pj,nativeEnum:()=>Yj,negative:()=>tg,never:()=>A_,nonnegative:()=>ng,nonoptional:()=>fE,nonpositive:()=>rg,normalize:()=>iu,null:()=>Bk,nullable:()=>Pd,nullish:()=>tD,number:()=>jk,object:()=>Vj,optional:()=>Cd,overwrite:()=>Zn,parse:()=>Ik,parseAsync:()=>kk,partialRecord:()=>Kj,pipe:()=>Nd,positive:()=>eg,prefault:()=>dE,preprocess:()=>hD,prettifyError:()=>fw,promise:()=>aD,property:()=>ig,readonly:()=>vE,record:()=>eE,refine:()=>kE,regex:()=>Xc,regexes:()=>kn,registry:()=>Nh,safeDecode:()=>Nk,safeDecodeAsync:()=>Mk,safeEncode:()=>Pk,safeEncodeAsync:()=>Rk,safeParse:()=>Ek,safeParseAsync:()=>Ak,set:()=>Xj,setErrorMap:()=>Xq,size:()=>_s,slugify:()=>cu,startsWith:()=>tu,strictObject:()=>Zj,string:()=>s_,stringFormat:()=>Ej,stringbool:()=>fD,success:()=>rD,superRefine:()=>EE,symbol:()=>jj,templateLiteral:()=>oD,toJSONSchema:()=>_o,toLowerCase:()=>au,toUpperCase:()=>su,transform:()=>O_,treeifyError:()=>dw,trim:()=>ou,tuple:()=>Qk,uint32:()=>Nj,uint64:()=>zj,ulid:()=>mj,undefined:()=>Dj,union:()=>T_,unknown:()=>Gs,uppercase:()=>Qc,url:()=>cj,util:()=>D,uuid:()=>ij,uuidv4:()=>oj,uuidv6:()=>aj,uuidv7:()=>sj,void:()=>Uj,xid:()=>hj,xor:()=>Hj});var $d={};hi($d,{ZodAny:()=>Vk,ZodArray:()=>qk,ZodBase64:()=>x_,ZodBase64URL:()=>S_,ZodBigInt:()=>Fu,ZodBigIntFormat:()=>E_,ZodBoolean:()=>Uu,ZodCIDRv4:()=>b_,ZodCIDRv6:()=>w_,ZodCUID:()=>f_,ZodCUID2:()=>m_,ZodCatch:()=>hE,ZodCodec:()=>R_,ZodCustom:()=>Ud,ZodCustomStringFormat:()=>Du,ZodDate:()=>Md,ZodDefault:()=>uE,ZodDiscriminatedUnion:()=>Wk,ZodE164:()=>I_,ZodEmail:()=>l_,ZodEmoji:()=>p_,ZodEnum:()=>zu,ZodExactOptional:()=>aE,ZodFile:()=>iE,ZodFunction:()=>IE,ZodGUID:()=>Od,ZodIPv4:()=>y_,ZodIPv6:()=>v_,ZodIntersection:()=>Jk,ZodJWT:()=>k_,ZodKSUID:()=>__,ZodLazy:()=>wE,ZodLiteral:()=>nE,ZodMAC:()=>zk,ZodMap:()=>tE,ZodNaN:()=>_E,ZodNanoID:()=>d_,ZodNever:()=>Gk,ZodNonOptional:()=>P_,ZodNull:()=>Fk,ZodNullable:()=>cE,ZodNumber:()=>Lu,ZodNumberFormat:()=>Hs,ZodObject:()=>jd,ZodOptional:()=>C_,ZodPipe:()=>N_,ZodPrefault:()=>pE,ZodPromise:()=>SE,ZodReadonly:()=>yE,ZodRecord:()=>Ld,ZodSet:()=>rE,ZodString:()=>ju,ZodStringFormat:()=>Ye,ZodSuccess:()=>mE,ZodSymbol:()=>Lk,ZodTemplateLiteral:()=>bE,ZodTransform:()=>oE,ZodTuple:()=>Yk,ZodType:()=>Ae,ZodULID:()=>h_,ZodURL:()=>Rd,ZodUUID:()=>ji,ZodUndefined:()=>Uk,ZodUnion:()=>Dd,ZodUnknown:()=>Zk,ZodVoid:()=>Hk,ZodXID:()=>g_,ZodXor:()=>Kk,_ZodString:()=>u_,_default:()=>lE,_function:()=>sD,any:()=>Lj,array:()=>zd,base64:()=>xj,base64url:()=>Sj,bigint:()=>Rj,boolean:()=>Dk,catch:()=>gE,check:()=>cD,cidrv4:()=>bj,cidrv6:()=>wj,codec:()=>iD,cuid:()=>dj,cuid2:()=>fj,custom:()=>uD,date:()=>Fj,describe:()=>lD,discriminatedUnion:()=>qj,e164:()=>Ij,email:()=>rj,emoji:()=>lj,enum:()=>$_,exactOptional:()=>sE,file:()=>eD,float32:()=>Oj,float64:()=>Cj,function:()=>sD,guid:()=>nj,hash:()=>$j,hex:()=>Tj,hostname:()=>Aj,httpUrl:()=>uj,instanceof:()=>dD,int:()=>c_,int32:()=>Pj,int64:()=>Mj,intersection:()=>Xk,ipv4:()=>_j,ipv6:()=>vj,json:()=>mD,jwt:()=>kj,keyof:()=>Bj,ksuid:()=>gj,lazy:()=>xE,literal:()=>Qj,looseObject:()=>Gj,looseRecord:()=>Wj,mac:()=>yj,map:()=>Jj,meta:()=>pD,nan:()=>nD,nanoid:()=>pj,nativeEnum:()=>Yj,never:()=>A_,nonoptional:()=>fE,null:()=>Bk,nullable:()=>Pd,nullish:()=>tD,number:()=>jk,object:()=>Vj,optional:()=>Cd,partialRecord:()=>Kj,pipe:()=>Nd,prefault:()=>dE,preprocess:()=>hD,promise:()=>aD,readonly:()=>vE,record:()=>eE,refine:()=>kE,set:()=>Xj,strictObject:()=>Zj,string:()=>s_,stringFormat:()=>Ej,stringbool:()=>fD,success:()=>rD,superRefine:()=>EE,symbol:()=>jj,templateLiteral:()=>oD,transform:()=>O_,tuple:()=>Qk,uint32:()=>Nj,uint64:()=>zj,ulid:()=>mj,undefined:()=>Dj,union:()=>T_,unknown:()=>Gs,url:()=>cj,uuid:()=>ij,uuidv4:()=>oj,uuidv6:()=>aj,uuidv7:()=>sj,void:()=>Uj,xid:()=>hj,xor:()=>Hj});var r_={};hi(r_,{endsWith:()=>ru,gt:()=>Ai,gte:()=>Ir,includes:()=>eu,length:()=>vs,lowercase:()=>Yc,lt:()=>Ei,lte:()=>nn,maxLength:()=>ys,maxSize:()=>ga,mime:()=>nu,minLength:()=>go,minSize:()=>Ti,multipleOf:()=>ha,negative:()=>tg,nonnegative:()=>ng,nonpositive:()=>rg,normalize:()=>iu,overwrite:()=>Zn,positive:()=>eg,property:()=>ig,regex:()=>Xc,size:()=>_s,slugify:()=>cu,startsWith:()=>tu,toLowerCase:()=>au,toUpperCase:()=>su,trim:()=>ou,uppercase:()=>Qc});var Mu={};hi(Mu,{ZodISODate:()=>i_,ZodISODateTime:()=>n_,ZodISODuration:()=>a_,ZodISOTime:()=>o_,date:()=>wk,datetime:()=>bk,duration:()=>Sk,time:()=>xk});var n_=I("ZodISODateTime",(t,e)=>{wx.init(t,e),Ye.init(t,e)});function bk(t){return S0(n_,t)}var i_=I("ZodISODate",(t,e)=>{xx.init(t,e),Ye.init(t,e)});function wk(t){return I0(i_,t)}var o_=I("ZodISOTime",(t,e)=>{Sx.init(t,e),Ye.init(t,e)});function xk(t){return k0(o_,t)}var a_=I("ZodISODuration",(t,e)=>{Ix.init(t,e),Ye.init(t,e)});function Sk(t){return E0(a_,t)}var tj=(t,e)=>{jp.init(t,e),t.name="ZodError",Object.defineProperties(t,{format:{value:r=>Lp(t,r)},flatten:{value:r=>Dp(t,r)},addIssue:{value:r=>{t.issues.push(r),t.message=JSON.stringify(t.issues,Bc,2)}},addIssues:{value:r=>{t.issues.push(...r),t.message=JSON.stringify(t.issues,Bc,2)}},isEmpty:{get(){return t.issues.length===0}}})},Kq=I("ZodError",tj),qr=I("ZodError",tj,{Parent:Error});var Ik=Gc(qr),kk=Hc(qr),Ek=qc(qr),Ak=Kc(qr),Tk=uh(qr),$k=lh(qr),Ok=ph(qr),Ck=dh(qr),Pk=fh(qr),Nk=mh(qr),Rk=hh(qr),Mk=gh(qr);var Ae=I("ZodType",(t,e)=>(we.init(t,e),Object.assign(t["~standard"],{jsonSchema:{input:lu(t,"input"),output:lu(t,"output")}}),t.toJSONSchema=rS(t,{}),t.def=e,t.type=e.type,Object.defineProperty(t,"_def",{value:e}),t.check=(...r)=>t.clone(D.mergeDefs(e,{checks:[...e.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]}),{parent:!0}),t.with=t.check,t.clone=(r,n)=>ut(t,r,n),t.brand=()=>t,t.register=((r,n)=>(r.add(t,n),t)),t.parse=(r,n)=>Ik(t,r,n,{callee:t.parse}),t.safeParse=(r,n)=>Ek(t,r,n),t.parseAsync=async(r,n)=>kk(t,r,n,{callee:t.parseAsync}),t.safeParseAsync=async(r,n)=>Ak(t,r,n),t.spa=t.safeParseAsync,t.encode=(r,n)=>Tk(t,r,n),t.decode=(r,n)=>$k(t,r,n),t.encodeAsync=async(r,n)=>Ok(t,r,n),t.decodeAsync=async(r,n)=>Ck(t,r,n),t.safeEncode=(r,n)=>Pk(t,r,n),t.safeDecode=(r,n)=>Nk(t,r,n),t.safeEncodeAsync=async(r,n)=>Rk(t,r,n),t.safeDecodeAsync=async(r,n)=>Mk(t,r,n),t.refine=(r,n)=>t.check(kE(r,n)),t.superRefine=r=>t.check(EE(r)),t.overwrite=r=>t.check(Zn(r)),t.optional=()=>Cd(t),t.exactOptional=()=>sE(t),t.nullable=()=>Pd(t),t.nullish=()=>Cd(Pd(t)),t.nonoptional=r=>fE(t,r),t.array=()=>zd(t),t.or=r=>T_([t,r]),t.and=r=>Xk(t,r),t.transform=r=>Nd(t,O_(r)),t.default=r=>lE(t,r),t.prefault=r=>dE(t,r),t.catch=r=>gE(t,r),t.pipe=r=>Nd(t,r),t.readonly=()=>vE(t),t.describe=r=>{let n=t.clone();return qe.add(n,{description:r}),n},Object.defineProperty(t,"description",{get(){return qe.get(t)?.description},configurable:!0}),t.meta=(...r)=>{if(r.length===0)return qe.get(t);let n=t.clone();return qe.add(n,r[0]),n},t.isOptional=()=>t.safeParse(void 0).success,t.isNullable=()=>t.safeParse(null).success,t.apply=r=>r(t),t)),u_=I("_ZodString",(t,e)=>{hs.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(n,i,o)=>nS(t,n,i,o);let r=t._zod.bag;t.format=r.format??null,t.minLength=r.minimum??null,t.maxLength=r.maximum??null,t.regex=(...n)=>t.check(Xc(...n)),t.includes=(...n)=>t.check(eu(...n)),t.startsWith=(...n)=>t.check(tu(...n)),t.endsWith=(...n)=>t.check(ru(...n)),t.min=(...n)=>t.check(go(...n)),t.max=(...n)=>t.check(ys(...n)),t.length=(...n)=>t.check(vs(...n)),t.nonempty=(...n)=>t.check(go(1,...n)),t.lowercase=n=>t.check(Yc(n)),t.uppercase=n=>t.check(Qc(n)),t.trim=()=>t.check(ou()),t.normalize=(...n)=>t.check(iu(...n)),t.toLowerCase=()=>t.check(au()),t.toUpperCase=()=>t.check(su()),t.slugify=()=>t.check(cu())}),ju=I("ZodString",(t,e)=>{hs.init(t,e),u_.init(t,e),t.email=r=>t.check(Rh(l_,r)),t.url=r=>t.check(Xp(Rd,r)),t.jwt=r=>t.check(Qh(k_,r)),t.emoji=r=>t.check(Lh(p_,r)),t.guid=r=>t.check(Jp(Od,r)),t.uuid=r=>t.check(Mh(ji,r)),t.uuidv4=r=>t.check(zh(ji,r)),t.uuidv6=r=>t.check(jh(ji,r)),t.uuidv7=r=>t.check(Dh(ji,r)),t.nanoid=r=>t.check(Uh(d_,r)),t.guid=r=>t.check(Jp(Od,r)),t.cuid=r=>t.check(Fh(f_,r)),t.cuid2=r=>t.check(Bh(m_,r)),t.ulid=r=>t.check(Vh(h_,r)),t.base64=r=>t.check(Jh(x_,r)),t.base64url=r=>t.check(Xh(S_,r)),t.xid=r=>t.check(Zh(g_,r)),t.ksuid=r=>t.check(Gh(__,r)),t.ipv4=r=>t.check(Hh(y_,r)),t.ipv6=r=>t.check(qh(v_,r)),t.cidrv4=r=>t.check(Kh(b_,r)),t.cidrv6=r=>t.check(Wh(w_,r)),t.e164=r=>t.check(Yh(I_,r)),t.datetime=r=>t.check(bk(r)),t.date=r=>t.check(wk(r)),t.time=r=>t.check(xk(r)),t.duration=r=>t.check(Sk(r))});function s_(t){return v0(ju,t)}var Ye=I("ZodStringFormat",(t,e)=>{Xe.init(t,e),u_.init(t,e)}),l_=I("ZodEmail",(t,e)=>{dx.init(t,e),Ye.init(t,e)});function rj(t){return Rh(l_,t)}var Od=I("ZodGUID",(t,e)=>{lx.init(t,e),Ye.init(t,e)});function nj(t){return Jp(Od,t)}var ji=I("ZodUUID",(t,e)=>{px.init(t,e),Ye.init(t,e)});function ij(t){return Mh(ji,t)}function oj(t){return zh(ji,t)}function aj(t){return jh(ji,t)}function sj(t){return Dh(ji,t)}var Rd=I("ZodURL",(t,e)=>{fx.init(t,e),Ye.init(t,e)});function cj(t){return Xp(Rd,t)}function uj(t){return Xp(Rd,{protocol:/^https?$/,hostname:kn.domain,...D.normalizeParams(t)})}var p_=I("ZodEmoji",(t,e)=>{mx.init(t,e),Ye.init(t,e)});function lj(t){return Lh(p_,t)}var d_=I("ZodNanoID",(t,e)=>{hx.init(t,e),Ye.init(t,e)});function pj(t){return Uh(d_,t)}var f_=I("ZodCUID",(t,e)=>{gx.init(t,e),Ye.init(t,e)});function dj(t){return Fh(f_,t)}var m_=I("ZodCUID2",(t,e)=>{_x.init(t,e),Ye.init(t,e)});function fj(t){return Bh(m_,t)}var h_=I("ZodULID",(t,e)=>{yx.init(t,e),Ye.init(t,e)});function mj(t){return Vh(h_,t)}var g_=I("ZodXID",(t,e)=>{vx.init(t,e),Ye.init(t,e)});function hj(t){return Zh(g_,t)}var __=I("ZodKSUID",(t,e)=>{bx.init(t,e),Ye.init(t,e)});function gj(t){return Gh(__,t)}var y_=I("ZodIPv4",(t,e)=>{kx.init(t,e),Ye.init(t,e)});function _j(t){return Hh(y_,t)}var zk=I("ZodMAC",(t,e)=>{Ax.init(t,e),Ye.init(t,e)});function yj(t){return w0(zk,t)}var v_=I("ZodIPv6",(t,e)=>{Ex.init(t,e),Ye.init(t,e)});function vj(t){return qh(v_,t)}var b_=I("ZodCIDRv4",(t,e)=>{Tx.init(t,e),Ye.init(t,e)});function bj(t){return Kh(b_,t)}var w_=I("ZodCIDRv6",(t,e)=>{$x.init(t,e),Ye.init(t,e)});function wj(t){return Wh(w_,t)}var x_=I("ZodBase64",(t,e)=>{Cx.init(t,e),Ye.init(t,e)});function xj(t){return Jh(x_,t)}var S_=I("ZodBase64URL",(t,e)=>{Px.init(t,e),Ye.init(t,e)});function Sj(t){return Xh(S_,t)}var I_=I("ZodE164",(t,e)=>{Nx.init(t,e),Ye.init(t,e)});function Ij(t){return Yh(I_,t)}var k_=I("ZodJWT",(t,e)=>{Rx.init(t,e),Ye.init(t,e)});function kj(t){return Qh(k_,t)}var Du=I("ZodCustomStringFormat",(t,e)=>{Mx.init(t,e),Ye.init(t,e)});function Ej(t,e,r={}){return uu(Du,t,e,r)}function Aj(t){return uu(Du,"hostname",kn.hostname,t)}function Tj(t){return uu(Du,"hex",kn.hex,t)}function $j(t,e){let r=e?.enc??"hex",n=`${t}_${r}`,i=kn[n];if(!i)throw new Error(`Unrecognized hash format: ${n}`);return uu(Du,n,i,e)}var Lu=I("ZodNumber",(t,e)=>{Eh.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(n,i,o)=>iS(t,n,i,o),t.gt=(n,i)=>t.check(Ai(n,i)),t.gte=(n,i)=>t.check(Ir(n,i)),t.min=(n,i)=>t.check(Ir(n,i)),t.lt=(n,i)=>t.check(Ei(n,i)),t.lte=(n,i)=>t.check(nn(n,i)),t.max=(n,i)=>t.check(nn(n,i)),t.int=n=>t.check(c_(n)),t.safe=n=>t.check(c_(n)),t.positive=n=>t.check(Ai(0,n)),t.nonnegative=n=>t.check(Ir(0,n)),t.negative=n=>t.check(Ei(0,n)),t.nonpositive=n=>t.check(nn(0,n)),t.multipleOf=(n,i)=>t.check(ha(n,i)),t.step=(n,i)=>t.check(ha(n,i)),t.finite=()=>t;let r=t._zod.bag;t.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,t.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,t.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),t.isFinite=!0,t.format=r.format??null});function jk(t){return A0(Lu,t)}var Hs=I("ZodNumberFormat",(t,e)=>{zx.init(t,e),Lu.init(t,e)});function c_(t){return $0(Hs,t)}function Oj(t){return O0(Hs,t)}function Cj(t){return C0(Hs,t)}function Pj(t){return P0(Hs,t)}function Nj(t){return N0(Hs,t)}var Uu=I("ZodBoolean",(t,e)=>{Vp.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>oS(t,r,n,i)});function Dk(t){return R0(Uu,t)}var Fu=I("ZodBigInt",(t,e)=>{Ah.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(n,i,o)=>aS(t,n,i,o),t.gte=(n,i)=>t.check(Ir(n,i)),t.min=(n,i)=>t.check(Ir(n,i)),t.gt=(n,i)=>t.check(Ai(n,i)),t.gte=(n,i)=>t.check(Ir(n,i)),t.min=(n,i)=>t.check(Ir(n,i)),t.lt=(n,i)=>t.check(Ei(n,i)),t.lte=(n,i)=>t.check(nn(n,i)),t.max=(n,i)=>t.check(nn(n,i)),t.positive=n=>t.check(Ai(BigInt(0),n)),t.negative=n=>t.check(Ei(BigInt(0),n)),t.nonpositive=n=>t.check(nn(BigInt(0),n)),t.nonnegative=n=>t.check(Ir(BigInt(0),n)),t.multipleOf=(n,i)=>t.check(ha(n,i));let r=t._zod.bag;t.minValue=r.minimum??null,t.maxValue=r.maximum??null,t.format=r.format??null});function Rj(t){return z0(Fu,t)}var E_=I("ZodBigIntFormat",(t,e)=>{jx.init(t,e),Fu.init(t,e)});function Mj(t){return D0(E_,t)}function zj(t){return L0(E_,t)}var Lk=I("ZodSymbol",(t,e)=>{Dx.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>sS(t,r,n,i)});function jj(t){return U0(Lk,t)}var Uk=I("ZodUndefined",(t,e)=>{Lx.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>uS(t,r,n,i)});function Dj(t){return F0(Uk,t)}var Fk=I("ZodNull",(t,e)=>{Ux.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>cS(t,r,n,i)});function Bk(t){return B0(Fk,t)}var Vk=I("ZodAny",(t,e)=>{Fx.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>dS(t,r,n,i)});function Lj(){return V0(Vk)}var Zk=I("ZodUnknown",(t,e)=>{Zp.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>fS(t,r,n,i)});function Gs(){return Yp(Zk)}var Gk=I("ZodNever",(t,e)=>{Gp.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>pS(t,r,n,i)});function A_(t){return Qp(Gk,t)}var Hk=I("ZodVoid",(t,e)=>{Bx.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>lS(t,r,n,i)});function Uj(t){return Z0(Hk,t)}var Md=I("ZodDate",(t,e)=>{Vx.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(n,i,o)=>mS(t,n,i,o),t.min=(n,i)=>t.check(Ir(n,i)),t.max=(n,i)=>t.check(nn(n,i));let r=t._zod.bag;t.minDate=r.minimum?new Date(r.minimum):null,t.maxDate=r.maximum?new Date(r.maximum):null});function Fj(t){return G0(Md,t)}var qk=I("ZodArray",(t,e)=>{Zx.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>ES(t,r,n,i),t.element=e.element,t.min=(r,n)=>t.check(go(r,n)),t.nonempty=r=>t.check(go(1,r)),t.max=(r,n)=>t.check(ys(r,n)),t.length=(r,n)=>t.check(vs(r,n)),t.unwrap=()=>t.element});function zd(t,e){return K0(qk,t,e)}function Bj(t){let e=t._zod.def.shape;return $_(Object.keys(e))}var jd=I("ZodObject",(t,e)=>{Gx.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>AS(t,r,n,i),D.defineLazy(t,"shape",()=>e.shape),t.keyof=()=>$_(Object.keys(t._zod.def.shape)),t.catchall=r=>t.clone({...t._zod.def,catchall:r}),t.passthrough=()=>t.clone({...t._zod.def,catchall:Gs()}),t.loose=()=>t.clone({...t._zod.def,catchall:Gs()}),t.strict=()=>t.clone({...t._zod.def,catchall:A_()}),t.strip=()=>t.clone({...t._zod.def,catchall:void 0}),t.extend=r=>D.extend(t,r),t.safeExtend=r=>D.safeExtend(t,r),t.merge=r=>D.merge(t,r),t.pick=r=>D.pick(t,r),t.omit=r=>D.omit(t,r),t.partial=(...r)=>D.partial(C_,t,r[0]),t.required=(...r)=>D.required(P_,t,r[0])});function Vj(t,e){let r={type:"object",shape:t??{},...D.normalizeParams(e)};return new jd(r)}function Zj(t,e){return new jd({type:"object",shape:t,catchall:A_(),...D.normalizeParams(e)})}function Gj(t,e){return new jd({type:"object",shape:t,catchall:Gs(),...D.normalizeParams(e)})}var Dd=I("ZodUnion",(t,e)=>{Hp.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>ag(t,r,n,i),t.options=e.options});function T_(t,e){return new Dd({type:"union",options:t,...D.normalizeParams(e)})}var Kk=I("ZodXor",(t,e)=>{Dd.init(t,e),Hx.init(t,e),t._zod.processJSONSchema=(r,n,i)=>ag(t,r,n,i),t.options=e.options});function Hj(t,e){return new Kk({type:"union",options:t,inclusive:!1,...D.normalizeParams(e)})}var Wk=I("ZodDiscriminatedUnion",(t,e)=>{Dd.init(t,e),qx.init(t,e)});function qj(t,e,r){return new Wk({type:"union",options:e,discriminator:t,...D.normalizeParams(r)})}var Jk=I("ZodIntersection",(t,e)=>{Kx.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>TS(t,r,n,i)});function Xk(t,e){return new Jk({type:"intersection",left:t,right:e})}var Yk=I("ZodTuple",(t,e)=>{Th.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>$S(t,r,n,i),t.rest=r=>t.clone({...t._zod.def,rest:r})});function Qk(t,e,r){let n=e instanceof we,i=n?r:e,o=n?e:null;return new Yk({type:"tuple",items:t,rest:o,...D.normalizeParams(i)})}var Ld=I("ZodRecord",(t,e)=>{Wx.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>OS(t,r,n,i),t.keyType=e.keyType,t.valueType=e.valueType});function eE(t,e,r){return new Ld({type:"record",keyType:t,valueType:e,...D.normalizeParams(r)})}function Kj(t,e,r){let n=ut(t);return n._zod.values=void 0,new Ld({type:"record",keyType:n,valueType:e,...D.normalizeParams(r)})}function Wj(t,e,r){return new Ld({type:"record",keyType:t,valueType:e,mode:"loose",...D.normalizeParams(r)})}var tE=I("ZodMap",(t,e)=>{Jx.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>IS(t,r,n,i),t.keyType=e.keyType,t.valueType=e.valueType,t.min=(...r)=>t.check(Ti(...r)),t.nonempty=r=>t.check(Ti(1,r)),t.max=(...r)=>t.check(ga(...r)),t.size=(...r)=>t.check(_s(...r))});function Jj(t,e,r){return new tE({type:"map",keyType:t,valueType:e,...D.normalizeParams(r)})}var rE=I("ZodSet",(t,e)=>{Xx.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>kS(t,r,n,i),t.min=(...r)=>t.check(Ti(...r)),t.nonempty=r=>t.check(Ti(1,r)),t.max=(...r)=>t.check(ga(...r)),t.size=(...r)=>t.check(_s(...r))});function Xj(t,e){return new rE({type:"set",valueType:t,...D.normalizeParams(e)})}var zu=I("ZodEnum",(t,e)=>{Yx.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(n,i,o)=>hS(t,n,i,o),t.enum=e.entries,t.options=Object.values(e.entries);let r=new Set(Object.keys(e.entries));t.extract=(n,i)=>{let o={};for(let a of n)if(r.has(a))o[a]=e.entries[a];else throw new Error(`Key ${a} not found in enum`);return new zu({...e,checks:[],...D.normalizeParams(i),entries:o})},t.exclude=(n,i)=>{let o={...e.entries};for(let a of n)if(r.has(a))delete o[a];else throw new Error(`Key ${a} not found in enum`);return new zu({...e,checks:[],...D.normalizeParams(i),entries:o})}});function $_(t,e){let r=Array.isArray(t)?Object.fromEntries(t.map(n=>[n,n])):t;return new zu({type:"enum",entries:r,...D.normalizeParams(e)})}function Yj(t,e){return new zu({type:"enum",entries:t,...D.normalizeParams(e)})}var nE=I("ZodLiteral",(t,e)=>{Qx.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>gS(t,r,n,i),t.values=new Set(e.values),Object.defineProperty(t,"value",{get(){if(e.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return e.values[0]}})});function Qj(t,e){return new nE({type:"literal",values:Array.isArray(t)?t:[t],...D.normalizeParams(e)})}var iE=I("ZodFile",(t,e)=>{e0.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>vS(t,r,n,i),t.min=(r,n)=>t.check(Ti(r,n)),t.max=(r,n)=>t.check(ga(r,n)),t.mime=(r,n)=>t.check(nu(Array.isArray(r)?r:[r],n))});function eD(t){return W0(iE,t)}var oE=I("ZodTransform",(t,e)=>{t0.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>SS(t,r,n,i),t._zod.parse=(r,n)=>{if(n.direction==="backward")throw new la(t.constructor.name);r.addIssue=o=>{if(typeof o=="string")r.issues.push(D.issue(o,r.value,e));else{let a=o;a.fatal&&(a.continue=!1),a.code??(a.code="custom"),a.input??(a.input=r.value),a.inst??(a.inst=t),r.issues.push(D.issue(a))}};let i=e.transform(r.value,r);return i instanceof Promise?i.then(o=>(r.value=o,r)):(r.value=i,r)}});function O_(t){return new oE({type:"transform",transform:t})}var C_=I("ZodOptional",(t,e)=>{gs.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>sg(t,r,n,i),t.unwrap=()=>t._zod.def.innerType});function Cd(t){return new C_({type:"optional",innerType:t})}var aE=I("ZodExactOptional",(t,e)=>{r0.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>sg(t,r,n,i),t.unwrap=()=>t._zod.def.innerType});function sE(t){return new aE({type:"optional",innerType:t})}var cE=I("ZodNullable",(t,e)=>{n0.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>CS(t,r,n,i),t.unwrap=()=>t._zod.def.innerType});function Pd(t){return new cE({type:"nullable",innerType:t})}function tD(t){return Cd(Pd(t))}var uE=I("ZodDefault",(t,e)=>{i0.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>NS(t,r,n,i),t.unwrap=()=>t._zod.def.innerType,t.removeDefault=t.unwrap});function lE(t,e){return new uE({type:"default",innerType:t,get defaultValue(){return typeof e=="function"?e():D.shallowClone(e)}})}var pE=I("ZodPrefault",(t,e)=>{o0.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>RS(t,r,n,i),t.unwrap=()=>t._zod.def.innerType});function dE(t,e){return new pE({type:"prefault",innerType:t,get defaultValue(){return typeof e=="function"?e():D.shallowClone(e)}})}var P_=I("ZodNonOptional",(t,e)=>{a0.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>PS(t,r,n,i),t.unwrap=()=>t._zod.def.innerType});function fE(t,e){return new P_({type:"nonoptional",innerType:t,...D.normalizeParams(e)})}var mE=I("ZodSuccess",(t,e)=>{s0.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>bS(t,r,n,i),t.unwrap=()=>t._zod.def.innerType});function rD(t){return new mE({type:"success",innerType:t})}var hE=I("ZodCatch",(t,e)=>{c0.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>MS(t,r,n,i),t.unwrap=()=>t._zod.def.innerType,t.removeCatch=t.unwrap});function gE(t,e){return new hE({type:"catch",innerType:t,catchValue:typeof e=="function"?e:()=>e})}var _E=I("ZodNaN",(t,e)=>{u0.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>_S(t,r,n,i)});function nD(t){return q0(_E,t)}var N_=I("ZodPipe",(t,e)=>{l0.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>zS(t,r,n,i),t.in=e.in,t.out=e.out});function Nd(t,e){return new N_({type:"pipe",in:t,out:e})}var R_=I("ZodCodec",(t,e)=>{N_.init(t,e),qp.init(t,e)});function iD(t,e,r){return new R_({type:"pipe",in:t,out:e,transform:r.decode,reverseTransform:r.encode})}var yE=I("ZodReadonly",(t,e)=>{p0.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>jS(t,r,n,i),t.unwrap=()=>t._zod.def.innerType});function vE(t){return new yE({type:"readonly",innerType:t})}var bE=I("ZodTemplateLiteral",(t,e)=>{d0.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>yS(t,r,n,i)});function oD(t,e){return new bE({type:"template_literal",parts:t,...D.normalizeParams(e)})}var wE=I("ZodLazy",(t,e)=>{h0.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>LS(t,r,n,i),t.unwrap=()=>t._zod.def.getter()});function xE(t){return new wE({type:"lazy",getter:t})}var SE=I("ZodPromise",(t,e)=>{m0.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>DS(t,r,n,i),t.unwrap=()=>t._zod.def.innerType});function aD(t){return new SE({type:"promise",innerType:t})}var IE=I("ZodFunction",(t,e)=>{f0.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>xS(t,r,n,i)});function sD(t){return new IE({type:"function",input:Array.isArray(t?.input)?Qk(t?.input):t?.input??zd(Gs()),output:t?.output??Gs()})}var Ud=I("ZodCustom",(t,e)=>{g0.init(t,e),Ae.init(t,e),t._zod.processJSONSchema=(r,n,i)=>wS(t,r,n,i)});function cD(t){let e=new tt({check:"custom"});return e._zod.check=t,e}function uD(t,e){return J0(Ud,t??(()=>!0),e)}function kE(t,e={}){return X0(Ud,t,e)}function EE(t){return Y0(t)}var lD=Q0,pD=eS;function dD(t,e={}){let r=new Ud({type:"custom",check:"custom",fn:n=>n instanceof t,abort:!0,...D.normalizeParams(e)});return r._zod.bag.Class=t,r._zod.check=n=>{n.value instanceof t||n.issues.push({code:"invalid_type",expected:t.name,input:n.value,inst:r,path:[...r._zod.def.path??[]]})},r}var fD=(...t)=>tS({Codec:R_,Boolean:Uu,String:ju},...t);function mD(t){let e=xE(()=>T_([s_(t),jk(),Dk(),Bk(),zd(e),eE(s_(),e)]));return e}function hD(t,e){return Nd(O_(t),e)}var Jq={invalid_type:"invalid_type",too_big:"too_big",too_small:"too_small",invalid_format:"invalid_format",not_multiple_of:"not_multiple_of",unrecognized_keys:"unrecognized_keys",invalid_union:"invalid_union",invalid_key:"invalid_key",invalid_element:"invalid_element",invalid_value:"invalid_value",custom:"custom"};function Xq(t){bt({customError:t})}function Yq(){return bt().customError}var AE;AE||(AE={});var J={...$d,...r_,iso:Mu},Qq=new Set(["$schema","$ref","$defs","definitions","$id","id","$comment","$anchor","$vocabulary","$dynamicRef","$dynamicAnchor","type","enum","const","anyOf","oneOf","allOf","not","properties","required","additionalProperties","patternProperties","propertyNames","minProperties","maxProperties","items","prefixItems","additionalItems","minItems","maxItems","uniqueItems","contains","minContains","maxContains","minLength","maxLength","pattern","format","minimum","maximum","exclusiveMinimum","exclusiveMaximum","multipleOf","description","default","contentEncoding","contentMediaType","contentSchema","unevaluatedItems","unevaluatedProperties","if","then","else","dependentSchemas","dependentRequired","nullable","readOnly"]);function eK(t,e){let r=t.$schema;return r==="https://json-schema.org/draft/2020-12/schema"?"draft-2020-12":r==="http://json-schema.org/draft-07/schema#"?"draft-7":r==="http://json-schema.org/draft-04/schema#"?"draft-4":e??"draft-2020-12"}function tK(t,e){if(!t.startsWith("#"))throw new Error("External $ref is not supported, only local refs (#/...) are allowed");let r=t.slice(1).split("/").filter(Boolean);if(r.length===0)return e.rootSchema;let n=e.version==="draft-2020-12"?"$defs":"definitions";if(r[0]===n){let i=r[1];if(!i||!e.defs[i])throw new Error(`Reference not found: ${t}`);return e.defs[i]}throw new Error(`Reference not found: ${t}`)}function gD(t,e){if(t.not!==void 0){if(typeof t.not=="object"&&Object.keys(t.not).length===0)return J.never();throw new Error("not is not supported in Zod (except { not: {} } for never)")}if(t.unevaluatedItems!==void 0)throw new Error("unevaluatedItems is not supported");if(t.unevaluatedProperties!==void 0)throw new Error("unevaluatedProperties is not supported");if(t.if!==void 0||t.then!==void 0||t.else!==void 0)throw new Error("Conditional schemas (if/then/else) are not supported");if(t.dependentSchemas!==void 0||t.dependentRequired!==void 0)throw new Error("dependentSchemas and dependentRequired are not supported");if(t.$ref){let i=t.$ref;if(e.refs.has(i))return e.refs.get(i);if(e.processing.has(i))return J.lazy(()=>{if(!e.refs.has(i))throw new Error(`Circular reference not resolved: ${i}`);return e.refs.get(i)});e.processing.add(i);let o=tK(i,e),a=lr(o,e);return e.refs.set(i,a),e.processing.delete(i),a}if(t.enum!==void 0){let i=t.enum;if(e.version==="openapi-3.0"&&t.nullable===!0&&i.length===1&&i[0]===null)return J.null();if(i.length===0)return J.never();if(i.length===1)return J.literal(i[0]);if(i.every(a=>typeof a=="string"))return J.enum(i);let o=i.map(a=>J.literal(a));return o.length<2?o[0]:J.union([o[0],o[1],...o.slice(2)])}if(t.const!==void 0)return J.literal(t.const);let r=t.type;if(Array.isArray(r)){let i=r.map(o=>{let a={...t,type:o};return gD(a,e)});return i.length===0?J.never():i.length===1?i[0]:J.union(i)}if(!r)return J.any();let n;switch(r){case"string":{let i=J.string();if(t.format){let o=t.format;o==="email"?i=i.check(J.email()):o==="uri"||o==="uri-reference"?i=i.check(J.url()):o==="uuid"||o==="guid"?i=i.check(J.uuid()):o==="date-time"?i=i.check(J.iso.datetime()):o==="date"?i=i.check(J.iso.date()):o==="time"?i=i.check(J.iso.time()):o==="duration"?i=i.check(J.iso.duration()):o==="ipv4"?i=i.check(J.ipv4()):o==="ipv6"?i=i.check(J.ipv6()):o==="mac"?i=i.check(J.mac()):o==="cidr"?i=i.check(J.cidrv4()):o==="cidr-v6"?i=i.check(J.cidrv6()):o==="base64"?i=i.check(J.base64()):o==="base64url"?i=i.check(J.base64url()):o==="e164"?i=i.check(J.e164()):o==="jwt"?i=i.check(J.jwt()):o==="emoji"?i=i.check(J.emoji()):o==="nanoid"?i=i.check(J.nanoid()):o==="cuid"?i=i.check(J.cuid()):o==="cuid2"?i=i.check(J.cuid2()):o==="ulid"?i=i.check(J.ulid()):o==="xid"?i=i.check(J.xid()):o==="ksuid"&&(i=i.check(J.ksuid()))}typeof t.minLength=="number"&&(i=i.min(t.minLength)),typeof t.maxLength=="number"&&(i=i.max(t.maxLength)),t.pattern&&(i=i.regex(new RegExp(t.pattern))),n=i;break}case"number":case"integer":{let i=r==="integer"?J.number().int():J.number();typeof t.minimum=="number"&&(i=i.min(t.minimum)),typeof t.maximum=="number"&&(i=i.max(t.maximum)),typeof t.exclusiveMinimum=="number"?i=i.gt(t.exclusiveMinimum):t.exclusiveMinimum===!0&&typeof t.minimum=="number"&&(i=i.gt(t.minimum)),typeof t.exclusiveMaximum=="number"?i=i.lt(t.exclusiveMaximum):t.exclusiveMaximum===!0&&typeof t.maximum=="number"&&(i=i.lt(t.maximum)),typeof t.multipleOf=="number"&&(i=i.multipleOf(t.multipleOf)),n=i;break}case"boolean":{n=J.boolean();break}case"null":{n=J.null();break}case"object":{let i={},o=t.properties||{},a=new Set(t.required||[]);for(let[c,u]of Object.entries(o)){let l=lr(u,e);i[c]=a.has(c)?l:l.optional()}if(t.propertyNames){let c=lr(t.propertyNames,e),u=t.additionalProperties&&typeof t.additionalProperties=="object"?lr(t.additionalProperties,e):J.any();if(Object.keys(i).length===0){n=J.record(c,u);break}let l=J.object(i).passthrough(),p=J.looseRecord(c,u);n=J.intersection(l,p);break}if(t.patternProperties){let c=t.patternProperties,u=Object.keys(c),l=[];for(let f of u){let m=lr(c[f],e),h=J.string().regex(new RegExp(f));l.push(J.looseRecord(h,m))}let p=[];if(Object.keys(i).length>0&&p.push(J.object(i).passthrough()),p.push(...l),p.length===0)n=J.object({}).passthrough();else if(p.length===1)n=p[0];else{let f=J.intersection(p[0],p[1]);for(let m=2;m<p.length;m++)f=J.intersection(f,p[m]);n=f}break}let s=J.object(i);t.additionalProperties===!1?n=s.strict():typeof t.additionalProperties=="object"?n=s.catchall(lr(t.additionalProperties,e)):n=s.passthrough();break}case"array":{let i=t.prefixItems,o=t.items;if(i&&Array.isArray(i)){let a=i.map(c=>lr(c,e)),s=o&&typeof o=="object"&&!Array.isArray(o)?lr(o,e):void 0;s?n=J.tuple(a).rest(s):n=J.tuple(a),typeof t.minItems=="number"&&(n=n.check(J.minLength(t.minItems))),typeof t.maxItems=="number"&&(n=n.check(J.maxLength(t.maxItems)))}else if(Array.isArray(o)){let a=o.map(c=>lr(c,e)),s=t.additionalItems&&typeof t.additionalItems=="object"?lr(t.additionalItems,e):void 0;s?n=J.tuple(a).rest(s):n=J.tuple(a),typeof t.minItems=="number"&&(n=n.check(J.minLength(t.minItems))),typeof t.maxItems=="number"&&(n=n.check(J.maxLength(t.maxItems)))}else if(o!==void 0){let a=lr(o,e),s=J.array(a);typeof t.minItems=="number"&&(s=s.min(t.minItems)),typeof t.maxItems=="number"&&(s=s.max(t.maxItems)),n=s}else n=J.array(J.any());break}default:throw new Error(`Unsupported type: ${r}`)}return t.description&&(n=n.describe(t.description)),t.default!==void 0&&(n=n.default(t.default)),n}function lr(t,e){if(typeof t=="boolean")return t?J.any():J.never();let r=gD(t,e),n=t.type||t.enum!==void 0||t.const!==void 0;if(t.anyOf&&Array.isArray(t.anyOf)){let s=t.anyOf.map(u=>lr(u,e)),c=J.union(s);r=n?J.intersection(r,c):c}if(t.oneOf&&Array.isArray(t.oneOf)){let s=t.oneOf.map(u=>lr(u,e)),c=J.xor(s);r=n?J.intersection(r,c):c}if(t.allOf&&Array.isArray(t.allOf))if(t.allOf.length===0)r=n?r:J.any();else{let s=n?r:lr(t.allOf[0],e),c=n?0:1;for(let u=c;u<t.allOf.length;u++)s=J.intersection(s,lr(t.allOf[u],e));r=s}t.nullable===!0&&e.version==="openapi-3.0"&&(r=J.nullable(r)),t.readOnly===!0&&(r=J.readonly(r));let i={},o=["$id","id","$comment","$anchor","$vocabulary","$dynamicRef","$dynamicAnchor"];for(let s of o)s in t&&(i[s]=t[s]);let a=["contentEncoding","contentMediaType","contentSchema"];for(let s of a)s in t&&(i[s]=t[s]);for(let s of Object.keys(t))Qq.has(s)||(i[s]=t[s]);return Object.keys(i).length>0&&e.registry.add(r,i),r}function _D(t,e){if(typeof t=="boolean")return t?J.any():J.never();let r=eK(t,e?.defaultTarget),n=t.$defs||t.definitions||{},i={version:r,defs:n,refs:new Map,processing:new Set,rootSchema:t,registry:e?.registry??qe};return lr(t,i)}var TE={};hi(TE,{bigint:()=>oK,boolean:()=>iK,date:()=>aK,number:()=>nK,string:()=>rK});function rK(t){return b0(ju,t)}function nK(t){return T0(Lu,t)}function iK(t){return M0(Uu,t)}function oK(t){return j0(Fu,t)}function aK(t){return H0(Md,t)}bt($h());var $E={};z($E,{BaseToolkit:()=>cK,DynamicStructuredTool:()=>yD,DynamicTool:()=>CE,StructuredTool:()=>Fd,Tool:()=>OE,ToolInputParsingException:()=>Rc,isLangChainTool:()=>Zs,isRunnableToolLike:()=>Ad,isStructuredTool:()=>Ed,isStructuredToolParams:()=>Td,tool:()=>Bd});var Fd=class extends Bg{constructor(e){super(e??{});d(this,"extras");d(this,"returnDirect",!1);d(this,"verboseParsingErrors",!1);d(this,"responseFormat","content");d(this,"defaultConfig");this.verboseParsingErrors=e?.verboseParsingErrors??this.verboseParsingErrors,this.responseFormat=e?.responseFormat??this.responseFormat,this.defaultConfig=e?.defaultConfig??this.defaultConfig,this.metadata=e?.metadata??this.metadata,this.extras=e?.extras??this.extras}get lc_namespace(){return["langchain","tools"]}async invoke(e,r){let n,i=Re(Bt(this.defaultConfig,r));return ta(e)?(n=e.args,i={...i,toolCall:e}):n=e,this.call(n,i)}async call(e,r,n){let i=ta(e)?e.args:e,o;if(Er(this.schema))try{o=await ba(this.schema,i)}catch(h){let g="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(g=`${g}
Details: ${h.message}`),hg(h)&&(g=`${g}

${K.prettifyError(h)}`),new Rc(g,JSON.stringify(e))}else{let h=nt(i,this.schema);if(!h.valid){let g="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(g=`${g}
Details: ${h.errors.map(x=>`${x.keywordLocation}: ${x.error}`).join(`
`)}`),new Rc(g,JSON.stringify(e))}o=i}let a=cs(r),c=await Et.configure(a.callbacks,this.callbacks,a.tags||n,this.tags,a.metadata,this.metadata,{verbose:this.verbose})?.handleToolStart(this.toJSON(),typeof e=="string"?e:JSON.stringify(e),a.runId,void 0,void 0,void 0,a.runName);delete a.runId;let u;try{u=await this._call(o,c,a)}catch(h){throw await c?.handleToolError(h),h}let l,p;if(this.responseFormat==="content_and_artifact")if(Array.isArray(u)&&u.length===2)[l,p]=u;else throw new Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(u)}`);else l=u;let f;ta(e)&&(f=e.id),!f&&L$(a)&&(f=a.toolCall.id);let m=uK({content:l,artifact:p,toolCallId:f,name:this.name,metadata:this.metadata});return await c?.handleToolEnd(m),m}},OE=class extends Fd{constructor(e){super(e);d(this,"schema",Vt.object({input:Vt.string().optional()}).transform(e=>e.input))}call(e,r){let n=typeof e=="string"||e==null?{input:e}:e;return super.call(n,r)}},CE=class extends OE{constructor(e){super(e);d(this,"name");d(this,"description");d(this,"func");this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect}static lc_name(){return"DynamicTool"}async call(e,r){let n=cs(r);return n.runName===void 0&&(n.runName=this.name),super.call(e,n)}async _call(e,r,n){return this.func(e,r,n)}},yD=class extends Fd{constructor(e){super(e);d(this,"description");d(this,"func");d(this,"schema");this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect,this.schema=e.schema}static lc_name(){return"DynamicStructuredTool"}async call(e,r,n){let i=cs(r);return i.runName===void 0&&(i.runName=this.name),super.call(e,i,n)}_call(e,r,n){return this.func(e,r,n)}},cK=class{getTools(){return this.tools}};function Bd(t,e){let r=fu(e.schema),n=Su(e.schema);if(!e.schema||r||n)return new CE({...e,description:e.description??e.schema?.description??`${e.name} tool`,func:async(a,s,c)=>new Promise((u,l)=>{let p=ze(c,{callbacks:s?.getChild()});Ge.runWithConfig(xr(p),async()=>{try{u(t(a,p))}catch(f){l(f)}})})});let i=e.schema,o=e.description??e.schema.description??`${e.name} tool`;return new yD({...e,description:o,schema:i,func:async(a,s,c)=>new Promise((u,l)=>{let p,f=()=>{c?.signal&&p&&c.signal.removeEventListener("abort",p)};c?.signal&&(p=()=>{f(),l(aa(c.signal))},c.signal.addEventListener("abort",p));let m=ze(c,{callbacks:s?.getChild()});Ge.runWithConfig(xr(m),async()=>{try{let h=await t(a,m);if(c?.signal?.aborted){f();return}f(),u(h)}catch(h){f(),l(h)}})})})}function uK(t){let{content:e,artifact:r,toolCallId:n,metadata:i}=t;return n&&!ep(e)?typeof e=="string"||Array.isArray(e)&&e.every(o=>typeof o=="object")?new rr({status:"success",content:e,artifact:r,tool_call_id:n,name:t.name,metadata:i}):new rr({status:"success",content:lK(e),artifact:r,tool_call_id:n,name:t.name,metadata:i}):e}function lK(t){try{return JSON.stringify(t,null,2)??""}catch{return`${t}`}}var PE={};z(PE,{RunCollectorCallbackHandler:()=>pK});var pK=class extends Jt{constructor({exampleId:e}={}){super({_awaitHandler:!0});d(this,"name","run_collector");d(this,"exampleId");d(this,"tracedRuns");this.exampleId=e,this.tracedRuns=[]}async persistRun(e){let r={...e};r.reference_example_id=this.exampleId,this.tracedRuns.push(r)}};var vD={};var NE={};z(NE,{chunkArray:()=>RE});var RE=(t,e)=>t.reduce((r,n,i)=>{let o=Math.floor(i/e),a=r[o]||[];return r[o]=a.concat([n]),r},[]);var ME={};z(ME,{context:()=>dK});function dK(t,...e){let r=t.raw,n="";for(let i=0;i<r.length;i++){let o=r[i].replace(/\\\n[ \t]*/g,"").replace(/\\`/g,"`").replace(/\\\$/g,"$").replace(/\\\{/g,"{");if(n+=o,i<e.length){let a=fK(e[i],n);n+=typeof a=="string"?a:JSON.stringify(a)}}return n=mK(n),n=n.trim(),n=n.replace(/\\n/g,`
`),n}function fK(t,e){if(typeof t!="string"||!t.includes(`
`))return t;let n=e.slice(e.lastIndexOf(`
`)+1).match(/^(\s+)/);if(n){let i=n[1];return t.replace(/\n/g,`
${i}`)}return t}function mK(t){let e=t.split(`
`),r=null;for(let n of e){let i=n.match(/^(\s+)\S+/);if(i){let o=i[1].length;r===null?r=o:r=Math.min(r,o)}}return r===null?t:e.map(n=>n[0]===" "||n[0]==="	"?n.slice(r):n).join(`
`)}var jE={};z(jE,{EventStreamContentType:()=>hK,convertEventStreamToIterableReadableDataStream:()=>_K,getBytes:()=>bD,getLines:()=>wD,getMessages:()=>xD});var hK="text/event-stream";async function bD(t,e){if(t instanceof ReadableStream){let r=t.getReader();for(;;){let n=await r.read();if(n.done){e(new Uint8Array,!0);break}e(n.value)}}else try{for await(let r of t)e(new Uint8Array(r));e(new Uint8Array,!0)}catch(r){throw new Error(["Parsing event source stream failed.","Ensure your implementation of fetch returns a web or Node readable stream.",`Error: ${r.message}`].join(`
`))}}var Bu=(function(t){return t[t.NewLine=10]="NewLine",t[t.CarriageReturn=13]="CarriageReturn",t[t.Space=32]="Space",t[t.Colon=58]="Colon",t})(Bu||{});function wD(t){let e,r,n,i=!1;return function(a,s){if(s){t(a,0,!0);return}e===void 0?(e=a,r=0,n=-1):e=gK(e,a);let c=e.length,u=0;for(;r<c;){i&&(e[r]===Bu.NewLine&&(u=++r),i=!1);let l=-1;for(;r<c&&l===-1;++r)switch(e[r]){case Bu.Colon:n===-1&&(n=r-u);break;case Bu.CarriageReturn:i=!0;case Bu.NewLine:l=r;break}if(l===-1)break;t(e.subarray(u,l),n),u=r,n=-1}u===c?e=void 0:u!==0&&(e=e.subarray(u),r-=u)}}function xD(t,e,r){let n=zE(),i=new TextDecoder;return function(a,s,c){if(c){yK(n)||(t?.(n),n=zE());return}if(a.length===0)t?.(n),n=zE();else if(s>0){let u=i.decode(a.subarray(0,s)),l=s+(a[s+1]===Bu.Space?2:1),p=i.decode(a.subarray(l));switch(u){case"data":n.data=n.data?n.data+`
`+p:p;break;case"event":n.event=p;break;case"id":e?.(n.id=p);break;case"retry":{let f=parseInt(p,10);Number.isNaN(f)||r?.(n.retry=f);break}}}}}function gK(t,e){let r=new Uint8Array(t.length+e.length);return r.set(t),r.set(e,t.length),r}function zE(){return{data:"",event:"",id:"",retry:void 0}}function _K(t,e){let r=new ReadableStream({async start(n){let i=xD(a=>{if(a.event==="error")throw new Error(a.data??"Unspecified event streaming error.");a.event==="metadata"?e?.(a):a.data&&n.enqueue(a.data)});await bD(t,wD((a,s,c)=>{i(a,s,c),c&&n.close()}))}});return Ct.fromReadableStream(r)}function yK(t){return t.data===""&&t.event===""&&t.id===""&&t.retry===void 0}var SD={};var DE={};z(DE,{convertToOpenAIFunction:()=>ID,convertToOpenAITool:()=>LE,isLangChainTool:()=>Zs,isRunnableToolLike:()=>Ad,isStructuredTool:()=>Ed,isStructuredToolParams:()=>Td});function ID(t,e){let r=typeof e=="number"?void 0:e;return{name:t.name,description:t.description,parameters:it(t.schema),...r?.strict!==void 0?{strict:r.strict}:{}}}function LE(t,e){let r=typeof e=="number"?void 0:e,n;return Zs(t)?n={type:"function",function:ID(t)}:n=t,r?.strict!==void 0&&(n.function.strict=r.strict),n}function M_(t,e){let r=0,n=0,i=0;for(let o=0;o<t.length;o++)r+=t[o]*e[o],n+=t[o]*t[o],i+=e[o]*e[o];return r/(Math.sqrt(n)*Math.sqrt(i))}function kD(t,e){let r=0;for(let n=0;n<t.length;n++)r+=t[n]*e[n];return r}function vK(t,e){let r=0;for(let n=0;n<t.length;n++)r+=(t[n]-e[n])*(t[n]-e[n]);return r}function ED(t,e){return Math.sqrt(vK(t,e))}var FE={};z(FE,{cosineSimilarity:()=>UE,euclideanDistance:()=>xK,innerProduct:()=>wK,matrixFunc:()=>z_,maximalMarginalRelevance:()=>SK,normalize:()=>bK});function z_(t,e,r){if(t.length===0||t[0].length===0||e.length===0||e[0].length===0)return[[]];if(t[0].length!==e[0].length)throw new Error(`Number of columns in X and Y must be the same. X has shape ${[t.length,t[0].length]} and Y has shape ${[e.length,e[0].length]}.`);return t.map(n=>e.map(i=>r(n,i)).map(i=>Number.isNaN(i)?0:i))}function bK(t,e=!1){let r=IK(t);return t.map(n=>n.map(i=>e?1-i/r:i/r))}function UE(t,e){return z_(t,e,M_)}function wK(t,e){return z_(t,e,kD)}function xK(t,e){return z_(t,e,ED)}function SK(t,e,r=.5,n=4){if(Math.min(n,e.length)<=0)return[];let i=Array.isArray(t[0])?t:[t],o=UE(i,e)[0],a=AD(o).maxIndex,s=[e[a]],c=[a];for(;c.length<Math.min(n,e.length);){let u=-1/0,l=-1,p=UE(e,s);o.forEach((f,m)=>{if(c.includes(m))return;let h=Math.max(...p[m]),g=r*f-(1-r)*h;g>u&&(u=g,l=m)}),s.push(e[l]),c.push(l)}return c}function AD(t){if(t.length===0)return{maxIndex:-1,maxValue:NaN};let e=t[0],r=0;for(let n=1;n<t.length;n+=1)t[n]>e&&(r=n,e=t[n]);return{maxIndex:r,maxValue:e}}function IK(t){return t.reduce((e,r)=>Math.max(e,AD(r).maxValue),0)}var TD=class extends Ea{_combineLLMOutput(){return[]}_llmType(){return"fake"}async _generate(t,e,r){if(e?.stop?.length)return{generations:[{message:new Ue(e.stop[0]),text:e.stop[0]}]};let n=t.map(i=>typeof i.content=="string"?i.content:JSON.stringify(i.content,null,2)).join(`
`);return await r?.handleLLMNewToken(n),{generations:[{message:new Ue(n),text:n}],llmOutput:{}}}},$D=class OD extends Ea{constructor({sleep:r=50,responses:n=[],chunks:i=[],toolStyle:o="openai",thrownErrorString:a,...s}){super(s);d(this,"sleep",50);d(this,"responses",[]);d(this,"chunks",[]);d(this,"toolStyle","openai");d(this,"thrownErrorString");d(this,"tools",[]);this.sleep=r,this.responses=n,this.chunks=i,this.toolStyle=o,this.thrownErrorString=a}_llmType(){return"fake"}bindTools(r){let n=[...this.tools,...r],i=n.map(s=>{switch(this.toolStyle){case"openai":return{type:"function",function:{name:s.name,description:s.description,parameters:it(s.schema)}};case"anthropic":return{name:s.name,description:s.description,input_schema:it(s.schema)};case"bedrock":return{toolSpec:{name:s.name,description:s.description,inputSchema:it(s.schema)}};case"google":return{name:s.name,description:s.description,parameters:it(s.schema)};default:throw new Error(`Unsupported tool style: ${this.toolStyle}`)}}),o=this.toolStyle==="google"?[{functionDeclarations:i}]:i,a=new OD({sleep:this.sleep,responses:this.responses,chunks:this.chunks,toolStyle:this.toolStyle,thrownErrorString:this.thrownErrorString});return a.tools=n,a.withConfig({tools:o})}async _generate(r,n,i){if(this.thrownErrorString)throw new Error(this.thrownErrorString);let o=this.responses?.[0]?.content??r[0].content??"";return{generations:[{text:"",message:new Ue({content:o,tool_calls:this.chunks?.[0]?.tool_calls})}]}}async*_streamResponseChunks(r,n,i){if(this.thrownErrorString)throw new Error(this.thrownErrorString);if(this.chunks?.length){for(let s of this.chunks){let c=new tn({message:new st({content:s.content,tool_calls:s.tool_calls,additional_kwargs:s.additional_kwargs??{}}),text:s.content?.toString()??""});if(n.signal?.aborted)break;yield c,await i?.handleLLMNewToken(s.content,void 0,void 0,void 0,void 0,{chunk:c})}return}let o=this.responses?.[0]??new Ue(typeof r[0].content=="string"?r[0].content:""),a=typeof o.content=="string"?o.content:"";for(let s of a){await new Promise(u=>setTimeout(u,this.sleep));let c=new tn({message:new st({content:s}),text:s});if(n.signal?.aborted)break;yield c,await i?.handleLLMNewToken(s,void 0,void 0,void 0,void 0,{chunk:c})}}},CD=class PD extends Ea{constructor(r){super(r);d(this,"lc_serializable",!0);d(this,"responses");d(this,"i",0);d(this,"sleep");d(this,"emitCustomEvent",!1);d(this,"generationInfo");d(this,"tools",[]);d(this,"toolStyle","openai");let{responses:n,sleep:i,emitCustomEvent:o,generationInfo:a}=r;this.responses=n,this.sleep=i,this.emitCustomEvent=o??this.emitCustomEvent,this.generationInfo=a}static lc_name(){return"FakeListChatModel"}_combineLLMOutput(){return[]}_llmType(){return"fake-list"}async _generate(r,n,i){if(await this._sleepIfRequested(),n?.thrownErrorString)throw new Error(n.thrownErrorString);if(this.emitCustomEvent&&await i?.handleCustomEvent("some_test_event",{someval:!0}),n?.stop?.length)return{generations:[this._formatGeneration(n.stop[0])]};{let o=this._currentResponse();return this._incrementResponse(),{generations:[this._formatGeneration(o)],llmOutput:{}}}}_formatGeneration(r){return{message:new Ue(r),text:r}}async*_streamResponseChunks(r,n,i){let o=this._currentResponse();this._incrementResponse(),this.emitCustomEvent&&await i?.handleCustomEvent("some_test_event",{someval:!0});let a=[...o];for(let s=0;s<a.length;s++){let c=a[s],u=s===a.length-1;if(await this._sleepIfRequested(),n?.thrownErrorString)throw new Error(n.thrownErrorString);let l=this._createResponseChunk(c,u?this.generationInfo:void 0);if(n.signal?.aborted)break;yield l,i?.handleLLMNewToken(c)}}async _sleepIfRequested(){this.sleep!==void 0&&await this._sleep()}async _sleep(){return new Promise(r=>{setTimeout(()=>r(),this.sleep)})}_createResponseChunk(r,n){return new tn({message:new st({content:r}),text:r,generationInfo:n})}_currentResponse(){return this.responses[this.i]}_incrementResponse(){this.i<this.responses.length-1?this.i+=1:this.i=0}bindTools(r){let n=[...this.tools,...r],i=n.map(s=>{switch(this.toolStyle){case"openai":return{type:"function",function:{name:s.name,description:s.description,parameters:it(s.schema)}};case"anthropic":return{name:s.name,description:s.description,input_schema:it(s.schema)};case"bedrock":return{toolSpec:{name:s.name,description:s.description,inputSchema:it(s.schema)}};case"google":return{name:s.name,description:s.description,parameters:it(s.schema)};default:throw new Error(`Unsupported tool style: ${this.toolStyle}`)}}),o=this.toolStyle==="google"?[{functionDeclarations:i}]:i,a=new PD({responses:this.responses,sleep:this.sleep,emitCustomEvent:this.emitCustomEvent,generationInfo:this.generationInfo});return a.tools=n,a.toolStyle=this.toolStyle,a.i=this.i,a.withConfig({tools:o})}withStructuredOutput(r,n){return cr.from(async i=>{let o=await this.invoke(i);if(o.tool_calls?.[0]?.args)return o.tool_calls[0].args;if(typeof o.content=="string")return JSON.parse(o.content);throw new Error("No structured output found")})}};var ND=class extends cd{constructor(e){super(e??{});d(this,"vectorSize");this.vectorSize=e?.vectorSize??4}async embedDocuments(e){return Promise.all(e.map(r=>this.embedQuery(r)))}async embedQuery(e){let r=e;r=r.toLowerCase().replaceAll(/[^a-z ]/g,"");let n=r.length%this.vectorSize,i=n===0?0:this.vectorSize-n,o=r.length+i;r=r.padEnd(o," ");let a=r.length/this.vectorSize,s=[];for(let u=0;u<r.length;u+=a)s.push(r.slice(u,u+a));return s.map(u=>{let l=0;for(let f=0;f<u.length;f+=1)l+=u===" "?0:u.charCodeAt(f);return l%26/26})}},RD=class extends cd{constructor(t){super(t??{})}embedDocuments(t){return Promise.resolve(t.map(()=>[.1,.2,.3,.4]))}embedQuery(t){return Promise.resolve([.1,.2,.3,.4])}};var MD=class extends Zg{constructor(e){super(e);d(this,"response");d(this,"thrownErrorString");this.response=e.response,this.thrownErrorString=e.thrownErrorString}_llmType(){return"fake"}async _call(e,r,n){if(this.thrownErrorString)throw new Error(this.thrownErrorString);let i=this.response??e;return await n?.handleLLMNewToken(i),i}},zD=class extends Zg{constructor(e){super(e);d(this,"sleep",50);d(this,"responses");d(this,"thrownErrorString");this.sleep=e.sleep??this.sleep,this.responses=e.responses,this.thrownErrorString=e.thrownErrorString}_llmType(){return"fake"}async _call(e){if(this.thrownErrorString)throw new Error(this.thrownErrorString);let r=this.responses?.[0];return this.responses=this.responses?.slice(1),r??e}async*_streamResponseChunks(e,r,n){if(this.thrownErrorString)throw new Error(this.thrownErrorString);let i=this.responses?.[0];this.responses=this.responses?.slice(1);for(let o of i??e)await new Promise(a=>setTimeout(a,this.sleep)),yield{text:o,generationInfo:{}},await n?.handleLLMNewToken(o)}};var jD=class extends lI{constructor(){super();d(this,"lc_namespace",["langchain_core","message","fake"]);d(this,"messages",[])}async getMessages(){return this.messages}async addMessage(e){this.messages.push(e)}async addUserMessage(e){this.messages.push(new $t(e))}async addAIMessage(e){this.messages.push(new Ue(e))}async clear(){this.messages=[]}},DD=class extends Pg{constructor(){super();d(this,"lc_namespace",["langchain_core","message","fake"]);d(this,"messages",[])}async addMessage(e){this.messages.push(e)}async getMessages(){return this.messages}},LD=class extends Jt{constructor(){super();d(this,"name","fake_tracer");d(this,"runs",[])}persistRun(e){return this.runs.push(e),Promise.resolve()}};var UD=class extends So{constructor(){super(...arguments);d(this,"lc_namespace",["tests","fake"])}getFormatInstructions(){return""}async parse(e){return e.split(",").map(r=>r.trim())}};var FD=class extends pd{constructor(e){super();d(this,"lc_namespace",["test","fake"]);d(this,"output",[new an({pageContent:"foo"}),new an({pageContent:"bar"})]);this.output=e?.output??this.output}async _getRelevantDocuments(e){return this.output}};var BD=class extends pe{constructor(e){super(e);d(this,"lc_namespace",["tests","fake"]);d(this,"returnOptions");this.returnOptions=e.returnOptions}async invoke(e,r){return this.returnOptions?r??{}:{input:e}}};var VD=class extends Fd{constructor(e){super(e);d(this,"name");d(this,"description");d(this,"schema");this.name=e.name,this.description=e.description,this.schema=e.schema}async _call(e,r){return JSON.stringify(e)}};var ZD=class extends Jt{constructor(){super();d(this,"runPromiseResolver");d(this,"runPromise");d(this,"name","single_run_extractor");this.runPromise=new Promise(e=>{this.runPromiseResolver=e})}async persistRun(e){this.runPromiseResolver(e)}async extract(){return this.runPromise}};var GD=class HD extends Mg{constructor(r,{similarity:n,...i}={}){super(r,i);d(this,"memoryVectors",[]);d(this,"similarity");this.similarity=n??M_}_vectorstoreType(){return"memory"}async addDocuments(r){let n=r.map(({pageContent:i})=>i);return this.addVectors(await this.embeddings.embedDocuments(n),r)}async addVectors(r,n){let i=r.map((o,a)=>({content:n[a].pageContent,embedding:o,metadata:n[a].metadata}));this.memoryVectors=this.memoryVectors.concat(i)}async similaritySearchVectorWithScore(r,n,i){let o=u=>{if(!i)return!0;let l=new an({metadata:u.metadata,pageContent:u.content});return i(l)},a=this.memoryVectors.filter(o);return a.map((u,l)=>({similarity:this.similarity(r,u.embedding),index:l})).sort((u,l)=>u.similarity>l.similarity?-1:0).slice(0,n).map(u=>[new an({metadata:a[u.index].metadata,pageContent:a[u.index].content}),u.similarity])}static async fromTexts(r,n,i,o){let a=[];for(let s=0;s<r.length;s+=1){let c=Array.isArray(n)?n[s]:n,u=new an({pageContent:r[s],metadata:c});a.push(u)}return HD.fromDocuments(a,i,o)}static async fromDocuments(r,n,i){let o=new this(n,i);return await o.addDocuments(r),o}static async fromExistingIndex(r,n){return new this(r,n)}};var BE={};z(BE,{FakeChatMessageHistory:()=>jD,FakeChatModel:()=>TD,FakeEmbeddings:()=>RD,FakeLLM:()=>MD,FakeListChatMessageHistory:()=>DD,FakeListChatModel:()=>CD,FakeRetriever:()=>FD,FakeRunnable:()=>BD,FakeSplitIntoListParser:()=>UD,FakeStreamingChatModel:()=>$D,FakeStreamingLLM:()=>zD,FakeTool:()=>VD,FakeTracer:()=>LD,FakeVectorStore:()=>GD,SingleRunExtractor:()=>ZD,SyntheticEmbeddings:()=>ND});var VE={};z(VE,{extendInteropZodObject:()=>dg,getInteropZodDefaultGetter:()=>fg,getInteropZodObjectShape:()=>ws,getSchemaDescription:()=>Gn,interopParse:()=>du,interopParseAsync:()=>ba,interopSafeParse:()=>E1,interopSafeParseAsync:()=>lg,interopZodObjectMakeFieldsOptional:()=>T1,interopZodObjectPartial:()=>mu,interopZodObjectPassthrough:()=>ug,interopZodObjectStrict:()=>pu,interopZodTransformInputSchema:()=>mg,isInteropZodError:()=>hg,isInteropZodLiteral:()=>k1,isInteropZodObject:()=>Vr,isInteropZodSchema:()=>Er,isShapelessZodSchema:()=>A1,isSimpleStringZodSchema:()=>fu,isZodArrayV4:()=>ed,isZodLiteralV3:()=>US,isZodLiteralV4:()=>FS,isZodNullableV4:()=>VS,isZodObjectV3:()=>pg,isZodObjectV4:()=>En,isZodOptionalV4:()=>BS,isZodSchema:()=>I1,isZodSchemaV3:()=>lt,isZodSchemaV4:()=>rt});var ZE={};z(ZE,{agents:()=>BN,caches:()=>vI,callbacks__base:()=>xv,callbacks__manager:()=>jb,callbacks__promises:()=>Rb,chat_history:()=>uI,document_loaders__base:()=>wI,document_loaders__langsmith:()=>SI,documents:()=>kI,embeddings:()=>pI,example_selectors:()=>TI,index:()=>YM,indexing:()=>RI,language_models__base:()=>LI,language_models__chat_models:()=>FI,language_models__llms:()=>BI,language_models__profile:()=>Sz,load__serializable:()=>nv,memory:()=>dI,messages:()=>cI,messages__tool:()=>sv,output_parsers:()=>qI,output_parsers__openai_functions:()=>JI,output_parsers__openai_tools:()=>YI,outputs:()=>Qb,prompt_values:()=>fI,prompts:()=>dk,retrievers:()=>gI,retrievers__document_compressors:()=>fk,runnables:()=>ZI,runnables__graph:()=>eI,singletons:()=>Lb,stores:()=>hI,structured_query:()=>vk,tools:()=>$E,tracers__base:()=>Eb,tracers__console:()=>Tb,tracers__log_stream:()=>Xb,tracers__run_collector:()=>PE,tracers__tracer_langchain:()=>Nb,types__stream:()=>vD,utils__async_caller:()=>ew,utils__chunk_array:()=>NE,utils__context:()=>ME,utils__env:()=>fv,utils__event_source_parse:()=>jE,utils__format:()=>SD,utils__function_calling:()=>DE,utils__hash:()=>yI,utils__json_patch:()=>GI,utils__json_schema:()=>YS,utils__math:()=>FE,utils__stream:()=>Hb,utils__testing:()=>BE,utils__tiktoken:()=>DI,utils__types:()=>VE,vectorstores:()=>_I});var kK=50;function EK(t){let e={};for(let r=t;r&&r.prototype;r=Object.getPrototypeOf(r))Object.assign(e,Reflect.get(r.prototype,"lc_aliases"));return Object.entries(e).reduce((r,[n,i])=>(r[i]=n,r),{})}async function j_(t){let{optionalImportsMap:e,optionalImportEntrypoints:r,importMap:n,secretsMap:i,secretsFromEnv:o,path:a,depth:s,maxDepth:c}=this,u=a.join(".");if(s>c)throw new Error(`Maximum recursion depth (${c}) exceeded during deserialization. This may indicate a malicious payload or you may need to increase maxDepth.`);if(typeof t!="object"||t==null)return t;if(Array.isArray(t))return Promise.all(t.map((f,m)=>j_.call({...this,path:[...a,`${m}`],depth:s+1},f)));let l=t;if(rv(l))return jf(l);if("lc"in l&&"type"in l&&"id"in l&&l.lc===1&&l.type==="secret"){let f=l,[m]=f.id;if(m in i)return i[m];if(o){let h=ft(m);if(h)return h}throw new Error(`Missing secret "${m}" at ${u}`)}if("lc"in l&&"type"in l&&"id"in l&&l.lc===1&&l.type==="not_implemented"){let m=JSON.stringify(l);throw new Error(`Trying to load an object that doesn't implement serialization: ${u} -> ${m}`)}if("lc"in l&&"type"in l&&"id"in l&&"kwargs"in l&&l.lc===1&&l.type==="constructor"){let f=l,m=JSON.stringify(f),[h,...g]=f.id.slice().reverse(),x=g.reverse(),y={langchain_core:ZE,langchain:n},v=null,S=[x.join("/")];x[0]==="langchain_community"&&S.push(["langchain",...x.slice(1)].join("/"));let k=S.find(w=>w in e);if(FN.concat(r).includes(x.join("/"))||k)if(k!==void 0)v=await e[k];else throw new Error(`Missing key "${x.join("/")}" for ${u} in load(optionalImportsMap={})`);else{let w;if(x[0]==="langchain"||x[0]==="langchain_core")w=y[x[0]],x.shift();else throw new Error(`Invalid namespace: ${u} -> ${m}`);if(x.length===0)throw new Error(`Invalid namespace: ${u} -> ${m}`);let V;do{if(V=x.join("__"),V in w)break;x.pop()}while(x.length>0);V in w&&(v=w[V])}if(typeof v!="object"||v===null)throw new Error(`Invalid namespace: ${u} -> ${m}`);let T=v[h]??Object.values(v).find(w=>typeof w=="function"&&Oc(w)===h);if(typeof T!="function")throw new Error(`Invalid identifer: ${u} -> ${m}`);let N=await j_.call({...this,path:[...a,"kwargs"],depth:s+1},f.kwargs),U=new T(Mf(N,x$,EK(T)));return Object.defineProperty(U.constructor,"name",{value:h}),U}let p={};for(let[f,m]of Object.entries(l))p[f]=await j_.call({...this,path:[...a,f],depth:s+1},m);return p}async function qD(t,e){let r=JSON.parse(t),n={optionalImportsMap:e?.optionalImportsMap??{},optionalImportEntrypoints:e?.optionalImportEntrypoints??[],secretsMap:e?.secretsMap??{},secretsFromEnv:e?.secretsFromEnv??!1,importMap:e?.importMap??{},path:["$"],depth:0,maxDepth:e?.maxDepth??kK};return j_.call(n,r)}function AK(t){return t!==null&&t.lc===1&&t.type==="constructor"&&Array.isArray(t.id)}async function HE(t){if(t&&typeof t=="object"){if(Array.isArray(t))return await Promise.all(t.map(r=>HE(r)));{let e={};for(let[r,n]of Object.entries(t))e[r]=await HE(n);if(e.lc===2&&e.type==="undefined")return;if(e.lc===2&&e.type==="constructor"&&Array.isArray(e.id))try{let r=e.id[e.id.length-1],n;switch(r){case"Set":n=Set;break;case"Map":n=Map;break;case"RegExp":n=RegExp;break;case"Error":n=Error;break;default:return e}return e.method?n[e.method](...e.args||[]):new n(...e.args||[])}catch{return e}else if(AK(e))return qD(JSON.stringify(e));return e}}return t}function GE(t,e,r,n){return{lc:2,type:"constructor",id:[t.name],method:e??null,args:r??[],kwargs:n??{}}}function TK(t){return t===void 0?{lc:2,type:"undefined"}:t instanceof Set||t instanceof Map?GE(t.constructor,void 0,[Array.from(t)]):t instanceof RegExp?GE(RegExp,void 0,[t.source,t.flags]):t instanceof Error?GE(t.constructor,void 0,[t.message]):t?.lg_name==="Send"?{node:t.node,args:t.args}:t}var qE=class{_dumps(t){return new TextEncoder().encode(UN(t,(r,n)=>TK(n)))}async dumpsTyped(t){return t instanceof Uint8Array?["bytes",t]:["json",this._dumps(t)]}async _loads(t){let e=JSON.parse(t);return HE(e)}async loadsTyped(t,e){if(t==="bytes")return typeof e=="string"?new TextEncoder().encode(e):e;if(t==="json")return this._loads(typeof e=="string"?e:new TextDecoder().decode(e));throw new Error(`Unknown serialization type: ${t}`)}};function KE(t){if(typeof t!="object"||t===null)return t;let e=Array.isArray(t)?[]:{};for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=KE(t[r]));return e}function qs(){return{v:4,id:Ap(-2),ts:new Date().toISOString(),channel_values:{},channel_versions:{},versions_seen:{}}}function ei(t){return{v:t.v,id:t.id,ts:t.ts,channel_values:{...t.channel_values},channel_versions:{...t.channel_versions},versions_seen:KE(t.versions_seen)}}function D_(t,e){return typeof t=="number"&&typeof e=="number"?Math.sign(t-e):String(t).localeCompare(String(e))}function L_(...t){return t.reduce((e,r,n)=>n===0?r:D_(e,r)>=0?e:r)}var U_={[Ub]:-1,[us]:-2,[Fb]:-3,[Bb]:-4};var Vu=class extends Error{constructor(t){super(t),this.name="InvalidNamespaceError"}};function CK(t){if(t.length===0)throw new Vu("Namespace cannot be empty.");for(let e of t){if(typeof e!="string")throw new Vu(`Invalid namespace label '${e}' found in ${t}. Namespace labels must be strings, but got ${typeof e}.`);if(e.includes("."))throw new Vu(`Invalid namespace label '${e}' found in ${t}. Namespace labels cannot contain periods ('.').`);if(e==="")throw new Vu(`Namespace labels cannot be empty strings. Got ${e} in ${t}`)}if(t[0]==="langgraph")throw new Vu(`Root label for namespace cannot be "langgraph". Got: ${t}`)}var Zu=class{async get(t,e){return(await this.batch([{namespace:t,key:e}]))[0]}async search(t,e={}){let{filter:r,limit:n=10,offset:i=0,query:o}=e;return(await this.batch([{namespacePrefix:t,filter:r,limit:n,offset:i,query:o}]))[0]}async put(t,e,r,n){CK(t),await this.batch([{namespace:t,key:e,value:r,index:n}])}async delete(t,e){await this.batch([{namespace:t,key:e,value:null}])}async listNamespaces(t={}){let{prefix:e,suffix:r,maxDepth:n,limit:i=100,offset:o=0}=t,a=[];return e&&a.push({matchType:"prefix",path:e}),r&&a.push({matchType:"suffix",path:r}),(await this.batch([{matchConditions:a.length?a:void 0,maxDepth:n,limit:i,offset:o}]))[0]}start(){}stop(){}};var PK=t=>"lg_name"in t&&t.lg_name==="AsyncBatchedStore"?t.store:t,Vd=class extends Zu{constructor(e){super();d(this,"lg_name","AsyncBatchedStore");d(this,"store");d(this,"queue",new Map);d(this,"nextKey",0);d(this,"running",!1);d(this,"processingTask",null);this.store=PK(e)}get isRunning(){return this.running}async batch(e){throw new Error("The `batch` method is not implemented on `AsyncBatchedStore`.\n Instead, it calls the `batch` method on the wrapped store.\n If you are seeing this error, something is wrong.")}async get(e,r){return this.enqueueOperation({namespace:e,key:r})}async search(e,r){let{filter:n,limit:i=10,offset:o=0,query:a}=r||{};return this.enqueueOperation({namespacePrefix:e,filter:n,limit:i,offset:o,query:a})}async put(e,r,n){return this.enqueueOperation({namespace:e,key:r,value:n})}async delete(e,r){return this.enqueueOperation({namespace:e,key:r,value:null})}start(){this.running||(this.running=!0,this.processingTask=this.processBatchQueue())}async stop(){this.running=!1,this.processingTask&&await this.processingTask}enqueueOperation(e){return new Promise((r,n)=>{let i=this.nextKey;this.nextKey+=1,this.queue.set(i,{operation:e,resolve:r,reject:n})})}async processBatchQueue(){for(;this.running;){if(await new Promise(r=>{setTimeout(r,0)}),this.queue.size===0)continue;let e=new Map(this.queue);this.queue.clear();try{let r=Array.from(e.values()).map(({operation:i})=>i),n=await this.store.batch(r);e.forEach(({resolve:i},o)=>{let a=Array.from(e.keys()).indexOf(o);i(n[a])})}catch(r){e.forEach(({reject:n})=>{n(r)})}}}toJSON(){return{queue:this.queue,nextKey:this.nextKey,running:this.running,store:"[LangGraphStore]"}}};var F_=class{constructor(t){d(this,"serde",new qE);this.serde=t||this.serde}};function XE(t){return t!=null&&t.lg_is_channel===!0}var Mt=class{constructor(){d(this,"ValueType");d(this,"UpdateType");d(this,"lg_is_channel",!0)}consume(){return!1}finish(){return!1}isAvailable(){try{return this.get(),!0}catch(t){if(t.name===He.unminifiable_name)return!1;throw t}}equals(t){return this===t}},JE=Symbol.for("LG_IS_ONLY_BASE_CHANNEL");function Zd(t){if(t[JE]===!0)return t;let e={};for(let r in t){if(!Object.prototype.hasOwnProperty.call(t,r))continue;let n=t[r];XE(n)&&(e[r]=n)}return Object.assign(e,{[JE]:!0}),e}function Ta(t,e){let r=Zd(t),n={};for(let i in r){if(!Object.prototype.hasOwnProperty.call(r,i))continue;let o=e.channel_values[i];n[i]=r[i].fromCheckpoint(o)}return Object.assign(n,{[JE]:!0}),n}function ti(t,e,r,n){let i;if(e===void 0)i=t.channel_values;else{i={};for(let o in e)if(Object.prototype.hasOwnProperty.call(e,o))try{i[o]=e[o].checkpoint()}catch(a){if(a.name!==He.unminifiable_name)throw a}}return{v:4,id:n?.id??Ap(r),ts:new Date().toISOString(),channel_values:i,channel_versions:t.channel_versions,versions_seen:t.versions_seen}}var NK=t=>t!=null&&t.lc_graph_name==="BinaryOperatorAggregate",Di=class JD extends Mt{constructor(r,n){super();d(this,"lc_graph_name","BinaryOperatorAggregate");d(this,"value");d(this,"operator");d(this,"initialValueFactory");this.operator=r,this.initialValueFactory=n,this.value=n?.()}fromCheckpoint(r){let n=new JD(this.operator,this.initialValueFactory);return typeof r<"u"&&(n.value=r),n}update(r){let n=r;if(!n.length)return!1;this.value===void 0&&([this.value]=n,n=n.slice(1));for(let i of n)this.value!==void 0&&(this.value=this.operator(this.value,i));return!0}get(){if(this.value===void 0)throw new He;return this.value}checkpoint(){if(this.value===void 0)throw new He;return this.value}isAvailable(){return this.value!==void 0}equals(r){return this===r?!0:NK(r)?this.operator===r.operator:!1}};var ri=class XD extends Mt{constructor(r){super();d(this,"lc_graph_name","LastValue");d(this,"value",[]);this.initialValueFactory=r,r&&(this.value=[r()])}fromCheckpoint(r){let n=new XD(this.initialValueFactory);return typeof r<"u"&&(n.value=[r]),n}update(r){if(r.length===0)return!1;if(r.length!==1)throw new Me("LastValue can only receive one value per step.",{lc_error_code:"INVALID_CONCURRENT_GRAPH_UPDATE"});return this.value=[r[r.length-1]],!0}get(){if(this.value.length===0)throw new He;return this.value[0]}checkpoint(){if(this.value.length===0)throw new He;return this.value[0]}isAvailable(){return this.value.length!==0}},YE=class YD extends Mt{constructor(){super(...arguments);d(this,"lc_graph_name","LastValueAfterFinish");d(this,"value",[]);d(this,"finished",!1)}fromCheckpoint(r){let n=new YD;if(typeof r<"u"){let[i,o]=r;n.value=[i],n.finished=o}return n}update(r){return r.length===0?!1:(this.finished=!1,this.value=[r[r.length-1]],!0)}get(){if(this.value.length===0||!this.finished)throw new He;return this.value[0]}checkpoint(){if(this.value.length!==0)return[this.value[0],this.finished]}consume(){return this.finished?(this.finished=!1,this.value=[],!0):!1}finish(){return!this.finished&&this.value.length>0?(this.finished=!0,!0):!1}isAvailable(){return this.value.length!==0&&this.finished}};var RK=class{constructor(t){d(this,"lc_graph_name","AnnotationRoot");d(this,"spec");this.spec=t}},Gt=function(t){return t?B_(t):new ri};Gt.Root=t=>new RK(t);function B_(t){return typeof t=="object"&&t&&"reducer"in t&&t.reducer?new Di(t.reducer,t.default):typeof t=="object"&&t&&"value"in t&&t.value?new Di(t.value,t.default):new ri}var $e="__start__",Ie="__end__",ni="__input__",tL="__copy__",Nt="__error__",V_="__pregel_ns_writes",Rn="__pregel_send",Hd="__pregel_call",ii="__pregel_read",gt="__pregel_checkpointer",Li="__pregel_resuming",Ks="__pregel_task_id",Gu="__pregel_stream",MK="__pregel_resume_value",Hu="__pregel_resume_map",cn="__pregel_scratchpad",qu="__pregel_previous",eA="__pregel_durability",Z_="checkpoint_id",un="checkpoint_ns",rL="__pregel_node_finished",Cr="checkpoint_map",tA="__pregel_abort_signals",Te="__interrupt__",jt="__resume__",qd="__no_writes__",oi="__return__",Ws="__previous__",Ke="langsmith:hidden",nL="langsmith:nostream",rA="__self__",Ht="__pregel_tasks",pr="__pregel_push",Kd="__pregel_pull",dr="00000000-0000-0000-0000-000000000000",iL=[Ke,ni,Te,jt,Nt,qd,Rn,ii,gt,eA,Gu,Li,Ks,Hd,MK,cn,qu,Cr,un,Z_],ot="|",Pr=":",QD=Symbol.for("langgraph.command"),eL,zK=(eL=QD,class{constructor(t){d(this,eL);this[QD]=t}});function G_(t){let e=t;return e!=null&&typeof e.node=="string"&&e.args!==void 0}var $a=class{constructor(t,e){d(this,"lg_name","Send");d(this,"node");d(this,"args");this.node=t,this.args=Gd(e)}toJSON(){return{lg_name:this.lg_name,node:this.node,args:this.args}}};function Rt(t){return t instanceof $a}function Ku(t){return!t||typeof t!="object"||!(Te in t)?!1:Array.isArray(t[Te])}var QE,Or=(QE=class extends zK{constructor(e){super(e);d(this,"lg_name","Command");d(this,"lc_direct_tool_output",!0);d(this,"graph");d(this,"update");d(this,"resume");d(this,"goto",[]);this.resume=e.resume,this.graph=e.graph,this.update=e.update,e.goto&&(this.goto=Array.isArray(e.goto)?Gd(e.goto):[Gd(e.goto)])}_updateAsTuples(){return this.update&&typeof this.update=="object"&&!Array.isArray(this.update)?Object.entries(this.update):Array.isArray(this.update)&&this.update.every(e=>Array.isArray(e)&&e.length===2&&typeof e[0]=="string")?this.update:[["__root__",this.update]]}toJSON(){let e;return typeof this.goto=="string"?e=this.goto:Rt(this.goto)?e=this.goto.toJSON():e=this.goto?.map(r=>typeof r=="string"?r:r.toJSON()),{lg_name:this.lg_name,update:this.update,resume:this.resume,goto:e}}},d(QE,"PARENT","__parent__"),QE);function zt(t){return typeof t!="object"||t==null?!1:"lg_name"in t&&t.lg_name==="Command"}function Gd(t,e=new Map){if(t!=null&&typeof t=="object"){if(e.has(t))return e.get(t);let r;if(Array.isArray(t))r=[],e.set(t,r),t.forEach((n,i)=>{r[i]=Gd(n,e)});else if(zt(t)&&!(t instanceof Or))r=new Or(t),e.set(t,r);else if(G_(t)&&!(t instanceof $a))r=new $a(t.node,t.args),e.set(t,r);else if(zt(t)||Rt(t))r=t,e.set(t,r);else if("lc_serializable"in t&&t.lc_serializable)r=t,e.set(t,r);else{r={},e.set(t,r);for(let[n,i]of Object.entries(t))r[n]=Gd(i,e)}return r}return t}var jK=["tags","metadata","callbacks","configurable"],DK=["tags","metadata","callbacks","runName","maxConcurrency","recursionLimit","configurable","runId","outputKeys","streamMode","store","writer","interrupt","context","interruptBefore","interruptAfter","checkpointDuring","durability","signal"],LK=25;function Wd(...t){let e={tags:[],metadata:{},callbacks:void 0,recursionLimit:LK,configurable:{}},r=Ge.getRunnableConfig();if(r!==void 0){for(let[n,i]of Object.entries(r))if(i!==void 0)if(jK.includes(n)){let o;Array.isArray(i)?o=[...i]:typeof i=="object"?n==="callbacks"&&"copy"in i&&typeof i.copy=="function"?o=i.copy():o={...i}:o=i,e[n]=o}else e[n]=i}for(let n of t)if(n!==void 0)for(let[i,o]of Object.entries(n))o!==void 0&&DK.includes(i)&&(e[i]=o);for(let[n,i]of Object.entries(e.configurable))e.metadata=e.metadata??{},!n.startsWith("__")&&(typeof i=="string"||typeof i=="number"||typeof i=="boolean")&&!(n in e.metadata)&&(e.metadata[n]=i);return e}function nA(){return Ge.getRunnableConfig()}function H_(t){return t.split(ot).filter(e=>!e.match(/^\d+$/)).map(e=>e.split(Pr)[0]).join(ot)}function oL(t){let e=t.split(ot);for(;e.length>1&&e[e.length-1].match(/^\d+$/);)e.pop();return e.slice(0,-1).join(ot)}var G=t=>BigInt(t),Qe=(t,e=0)=>new DataView(t.buffer,t.byteOffset+e,t.byteLength-e),uL=G("0x9E3779B1"),lL=G("0x85EBCA77"),UK=G("0xC2B2AE3D"),Oa=G("0x9E3779B185EBCA87"),Js=G("0xC2B2AE3D27D4EB4F"),pL=G("0x165667B19E3779F9"),aA=G("0x85EBCA77C2B2AE63"),FK=G("0x27D4EB2F165667C5"),BK=G("0x165667919E3779F9"),VK=G("0x9FB21C651E98DF25"),ZK=t=>{let e=t.length;if(e%2!==0)throw new Error("String should have an even number of characters");let r=e/2,n=new Uint8Array(r),i=0,o=0;for(;o<r;){let a=t.slice(i,i+=2);n[o]=Number.parseInt(a,16),o+=1}return Qe(n)},Ui=ZK("b8fe6c3923a44bbe7c01812cf721ad1cded46de9839097db7240a4a4b7b3671fcb79e64eccc0e578825ad07dccff7221b8084674f743248ee03590e6813a264c3c2852bb91c300cb88d0658b1b532ea371644897a20df94e3819ef46a9deacd8a8fa763fe39c343ff9dcbbc7c70b4f1d8a51e04bcdb45931c89f7ec9d9787364eac5ac8334d3ebc3c581a0fffa1363eb170ddd51b7f0da49d316552629d4689e2b16be587d47a1fc8ff8b8d17ad031ce45cb3a8f95160428afd7fbcabb4b407e"),Wu=(G(1)<<G(128))-G(1),Ne=(G(1)<<G(64))-G(1),J_=(G(1)<<G(32))-G(1),Ao=64,dL=Ao/8,GK=8,q_=4;function Ju(t){if(!t)throw new Error("Assert failed")}function HK(t){let e=new DataView(new ArrayBuffer(8));return e.setBigUint64(0,t,!0),e.getBigUint64(0,!1)}function qK(t){let e=t;return e=(e&G(65535))<<G(16)|(e&G(4294901760))>>G(16),e=(e&G(16711935))<<G(8)|(e&G(4278255360))>>G(8),e}function KK(t,e){return(t&J_)*(e&J_)&Ne}function WK(t,e){return(t<<e|t>>G(32)-e)&J_}function fL(t,e,r){for(let n=0;n<dL;n+=1){let i=e.getBigUint64(n*8,!0),o=i^r.getBigUint64(n*8,!0);t[n^1]+=i,t[n]+=KK(o,o>>G(32))}return t}function aL(t,e,r,n){for(let i=0;i<n;i+=1)fL(t,Qe(e,i*Ao),Qe(r,i*8));return t}function JK(t,e){for(let r=0;r<dL;r+=1){let n=e.getBigUint64(r*8,!0),i=t[r];i=iA(i,G(47)),i^=n,i*=uL,t[r]=i&Ne}return t}function K_(t,e){return mL(t[0]^e.getBigUint64(0,!0),t[1]^e.getBigUint64(GK,!0))}function sL(t,e,r){let n=r;return n+=K_(t.slice(0),Qe(e,0*q_)),n+=K_(t.slice(2),Qe(e,4*q_)),n+=K_(t.slice(4),Qe(e,8*q_)),n+=K_(t.slice(6),Qe(e,12*q_)),Fi(n&Ne)}function XK(t,e,r,n,i){let o=t,a=Math.floor((r.byteLength-Ao)/8),s=Ao*a,c=Math.floor((e.byteLength-1)/s);for(let u=0;u<c;u+=1)o=aL(o,Qe(e,u*s),r,a),o=i(o,Qe(r,r.byteLength-Ao));{let u=Math.floor((e.byteLength-1-s*c)/Ao);o=aL(o,Qe(e,c*s),r,u),o=n(o,Qe(e,e.byteLength-Ao),Qe(r,r.byteLength-Ao-7))}return o}function YK(t,e){let r=new BigUint64Array([UK,Oa,Js,pL,aA,lL,FK,uL]);Ju(t.byteLength>128),r=XK(r,t,e,fL,JK),Ju(r.length*8===64);{let n=sL(r,Qe(e,11),G(t.byteLength)*Oa&Ne);return sL(r,Qe(e,e.byteLength-Ao-11),~(G(t.byteLength)*Js)&Ne)<<G(64)|n}}function mL(t,e){let r=t*e&Wu;return r&Ne^r>>G(64)}function cL(t,e,r){return mL((t.getBigUint64(0,!0)^e.getBigUint64(0,!0)+r)&Ne,(t.getBigUint64(8,!0)^e.getBigUint64(8,!0)-r)&Ne)}function W_(t,e,r,n,i){let o=t&Ne,a=t>>G(64)&Ne;return o+=cL(e,n,i),o^=r.getBigUint64(0,!0)+r.getBigUint64(8,!0),o&=Ne,a+=cL(r,Qe(n,16),i),a^=e.getBigUint64(0,!0)+e.getBigUint64(8,!0),a&=Ne,a<<G(64)|o}function Fi(t){let e=t;return e^=e>>G(37),e*=BK,e&=Ne,e^=e>>G(32),e}function X_(t){let e=t;return e^=e>>G(33),e*=Js,e&=Ne,e^=e>>G(29),e*=pL,e&=Ne,e^=e>>G(32),e}function QK(t,e,r){let n=t.byteLength;Ju(n>0&&n<=3);let i=G(t.getUint8(n-1))|G(n<<8)|G(t.getUint8(0)<<16)|G(t.getUint8(n>>1)<<24),o=(i^(G(e.getUint32(0,!0))^G(e.getUint32(4,!0)))+r)&Ne,a=(G(e.getUint32(8,!0))^G(e.getUint32(12,!0)))-r;return(X_((WK(qK(i),G(13))^a)&Ne)&Ne)<<G(64)|X_(o)}function iA(t,e){return t^t>>e}function e8(t,e,r){let n=t.byteLength;Ju(n>=4&&n<=8);{let i=t.getUint32(0,!0),o=t.getUint32(n-4,!0),a=((G(i)|G(o)<<G(32))^(e.getBigUint64(16,!0)^e.getBigUint64(24,!0))+r&Ne)*(Oa+(G(n)<<G(2)))&Wu;return a+=(a&Ne)<<G(65),a&=Wu,a^=a>>G(67),iA(iA(a&Ne,G(35))*VK&Ne,G(28))|Fi(a>>G(64))<<G(64)}}function t8(t,e,r){let n=t.byteLength;Ju(n>=9&&n<=16);{let i=(e.getBigUint64(32,!0)^e.getBigUint64(40,!0))+r&Ne,o=(e.getBigUint64(48,!0)^e.getBigUint64(56,!0))-r&Ne,a=t.getBigUint64(0,!0),s=t.getBigUint64(n-8,!0),c=(a^s^i)*Oa,u=(c&Ne)+(G(n-1)<<G(54));c=c&(Wu^Ne)|u,s^=o,c+=s+(s&J_)*(lL-G(1))<<G(64),c&=Wu,c^=HK(c>>G(64));let l=(c&Ne)*Js;return l+=(c>>G(64))*Js<<G(64),l&=Wu,Fi(l&Ne)|Fi(l>>G(64))<<G(64)}}function r8(t,e){let r=t.byteLength;return Ju(r<=16),r>8?t8(t,Ui,e):r>=4?e8(t,Ui,e):r>0?QK(t,Ui,e):X_(e^Ui.getBigUint64(64,!0)^Ui.getBigUint64(72,!0))|X_(e^Ui.getBigUint64(80,!0)^Ui.getBigUint64(88,!0))<<G(64)}function oA(t){return~t+G(1)&Ne}function n8(t,e,r){let n=G(t.byteLength)*Oa&Ne,i=G(t.byteLength-1)/G(32);for(;i>=0;){let s=Number(i);n=W_(n,Qe(t,16*s),Qe(t,t.byteLength-16*(s+1)),Qe(e,32*s),r),i-=G(1)}let o=n+(n>>G(64))&Ne;o=Fi(o);let a=(n&Ne)*Oa+(n>>G(64))*aA+(G(t.byteLength)-r&Ne)*Js;return a&=Ne,a=oA(Fi(a)),o|a<<G(64)}function i8(t,e,r){let n=G(t.byteLength)*Oa&Ne;for(let a=32;a<160;a+=32)n=W_(n,Qe(t,a-32),Qe(t,a-16),Qe(e,a-32),r);n=Fi(n&Ne)|Fi(n>>G(64))<<G(64);for(let a=160;a<=t.byteLength;a+=32)n=W_(n,Qe(t,a-32),Qe(t,a-16),Qe(e,3+a-160),r);n=W_(n,Qe(t,t.byteLength-16),Qe(t,t.byteLength-32),Qe(e,103),oA(r));let i=n+(n>>G(64))&Ne;i=Fi(i);let o=(n&Ne)*Oa+(n>>G(64))*aA+(G(t.byteLength)-r&Ne)*Js;return o&=Ne,o=oA(Fi(o)),i|o<<G(64)}function To(t,e=G(0)){let r=new TextEncoder,n=Qe(typeof t=="string"?r.encode(t):t),i=n.byteLength,o=a=>a.toString(16).padStart(32,"0");return i<=16?o(r8(n,e)):i<=128?o(n8(n,Ui,e)):i<=240?o(i8(n,Ui,e)):o(YK(n,Ui))}function Y_(t){return/^[0-9a-f]{32}$/.test(t)}function sA(t){let e=Ge.getRunnableConfig();if(!e)throw new Error("Called interrupt() outside the context of a graph.");let r=e.configurable;if(!r)throw new Error("No configurable found in config");if(!r[gt])throw new ia("No checkpointer set",{lc_error_code:"MISSING_CHECKPOINTER"});let n=r[cn];n.interruptCounter+=1;let i=n.interruptCounter;if(n.resume.length>0&&i<n.resume.length)return r[Rn]?.([[jt,n.resume]]),n.resume[i];if(n.nullResume!==void 0){if(n.resume.length!==i)throw new Error(`Resume length mismatch: ${n.resume.length} !== ${i}`);let a=n.consumeNullResume();return n.resume.push(a),r[Rn]?.([[jt,n.resume]]),a}let o=r[un]?.split(ot);throw new wi([{id:o?To(o.join(ot)):void 0,value:t}])}var fr=class extends pe{constructor(e){super();d(this,"lc_namespace",["langgraph"]);d(this,"func");d(this,"tags");d(this,"config");d(this,"trace",!0);d(this,"recurse",!0);this.name=e.name??e.func.name,this.func=e.func,this.config=e.tags?{tags:e.tags}:void 0,this.trace=e.trace??this.trace,this.recurse=e.recurse??this.recurse}async _tracedInvoke(e,r,n){return new Promise((i,o)=>{let a=ze(r,{callbacks:n?.getChild()});Ge.runWithConfig(a,async()=>{try{i(await this.func(e,a))}catch(s){o(s)}})})}async invoke(e,r){let n,i=Wd(r),o=Bt(this.config,i);return this.trace?n=await this._callWithConfig(this._tracedInvoke,e,o):n=await Ge.runWithConfig(o,async()=>this.func(e,o)),pe.isRunnable(n)&&this.recurse?await Ge.runWithConfig(o,async()=>n.invoke(e,o)):n}};function*$o(t,e){if(e===void 0)yield*t;else for(let r of t)yield[e,r]}async function ai(t){let e=[];for await(let r of await t)e.push(r);return e}function Xs(t){let e=[];for(let r of t)e.push(r);return e}function Ys(t,e){return t?"configurable"in t?{...t,configurable:{...t.configurable,...e}}:{...t,configurable:e}:{configurable:e}}function hL(t){return t!=null&&typeof t=="function"&&t instanceof Object.getPrototypeOf(async function*(){}).constructor}function gL(t){return t!=null&&typeof t=="function"&&t instanceof Object.getPrototypeOf(function*(){}).constructor}var kke={[Symbol.for("LG_SKIP_WRITE")]:!0};function o8(t){return typeof t=="object"&&t?.[Symbol.for("LG_SKIP_WRITE")]!==void 0}var Kr={[Symbol.for("LG_PASSTHROUGH")]:!0};function Q_(t){return typeof t=="object"&&t?.[Symbol.for("LG_PASSTHROUGH")]!==void 0}var cA=Symbol("IS_WRITER"),wt=class lA extends fr{constructor(r,n){let i=`ChannelWrite<${r.map(o=>Rt(o)?o.node:"channel"in o?o.channel:"...").join(",")}>`;super({writes:r,name:i,tags:n,func:async(o,a)=>this._write(o,a??{})});d(this,"writes");this.writes=r}async _write(r,n){let i=this.writes.map(o=>uA(o)&&Q_(o.value)?{mapper:o.mapper,value:r}:ey(o)&&Q_(o.value)?{channel:o.channel,value:r,skipNone:o.skipNone,mapper:o.mapper}:o);return await lA.doWrite(n,i),r}static async doWrite(r,n){for(let a of n){if(ey(a)){if(a.channel===Ht)throw new Me("Cannot write to the reserved channel TASKS");if(Q_(a.value))throw new Me("PASSTHROUGH value must be replaced")}if(uA(a)&&Q_(a.value))throw new Me("PASSTHROUGH value must be replaced")}let i=[];for(let a of n)if(Rt(a))i.push([Ht,a]);else if(uA(a)){let s=await a.mapper.invoke(a.value,r);s!=null&&s.length>0&&i.push(...s)}else if(ey(a)){let s=a.mapper!==void 0?await a.mapper.invoke(a.value,r):a.value;if(o8(s)||a.skipNone&&s===void 0)continue;i.push([a.channel,s])}else throw new Error(`Invalid write entry: ${JSON.stringify(a)}`);let o=r.configurable?.[Rn];o(i)}static isWriter(r){return r instanceof lA||cA in r&&!!r[cA]}static registerWriter(r){return Object.defineProperty(r,cA,{value:!0})}};function ey(t){return t!==void 0&&typeof t.channel=="string"}function uA(t){return t!==void 0&&!ey(t)&&pe.isRunnable(t.mapper)}var _L=class yL extends fr{constructor(r,n,i=!1){super({func:(o,a)=>yL.doRead(a,this.channel,this.fresh,this.mapper)});d(this,"lc_graph_name","ChannelRead");d(this,"channel");d(this,"fresh",!1);d(this,"mapper");this.fresh=i,this.mapper=n,this.channel=r,this.name=Array.isArray(r)?`ChannelRead<${r.join(",")}>`:`ChannelRead<${r}>`}static doRead(r,n,i,o){let a=r.configurable?.[ii];if(!a)throw new Error("Runnable is not configured with a read function. Make sure to call in the context of a Pregel process");return o?o(a(n,i)):a(n,i)}},Xu=new Pn,si=class Jd extends On{constructor(r){let{channels:n,triggers:i,mapper:o,writers:a,bound:s,kwargs:c,metadata:u,retryPolicy:l,cachePolicy:p,tags:f,subgraphs:m,ends:h}=r,g=[...r.config?.tags?r.config.tags:[],...f??[]];super({...r,bound:r.bound??Xu,config:{...r.config?r.config:{},tags:g}});d(this,"lc_graph_name","PregelNode");d(this,"channels");d(this,"triggers",[]);d(this,"mapper");d(this,"writers",[]);d(this,"bound",Xu);d(this,"kwargs",{});d(this,"metadata",{});d(this,"tags",[]);d(this,"retryPolicy");d(this,"cachePolicy");d(this,"subgraphs");d(this,"ends");this.channels=n,this.triggers=i,this.mapper=o,this.writers=a??this.writers,this.bound=s??this.bound,this.kwargs=c??this.kwargs,this.metadata=u??this.metadata,this.tags=g,this.retryPolicy=l,this.cachePolicy=p,this.subgraphs=m,this.ends=h}getWriters(){let r=[...this.writers];for(;r.length>1&&r[r.length-1]instanceof wt&&r[r.length-2]instanceof wt;){let n=r.slice(-2),i=n[0].writes.concat(n[1].writes);r[r.length-2]=new wt(i,n[0].config?.tags),r.pop()}return r}getNode(){let r=this.getWriters();if(!(this.bound===Xu&&r.length===0))return this.bound===Xu&&r.length===1?r[0]:this.bound===Xu?new Tr({first:r[0],middle:r.slice(1,r.length-1),last:r[r.length-1],omitSequenceTags:!0}):r.length>0?new Tr({first:this.bound,middle:r.slice(0,r.length-1),last:r[r.length-1],omitSequenceTags:!0}):this.bound}join(r){if(!Array.isArray(r))throw new Error("channels must be a list");if(typeof this.channels!="object")throw new Error("all channels must be named when using .join()");return new Jd({channels:{...this.channels,...Object.fromEntries(r.map(n=>[n,n]))},triggers:this.triggers,mapper:this.mapper,writers:this.writers,bound:this.bound,kwargs:this.kwargs,config:this.config,retryPolicy:this.retryPolicy,cachePolicy:this.cachePolicy})}pipe(r){return wt.isWriter(r)?new Jd({channels:this.channels,triggers:this.triggers,mapper:this.mapper,writers:[...this.writers,r],bound:this.bound,config:this.config,kwargs:this.kwargs,retryPolicy:this.retryPolicy,cachePolicy:this.cachePolicy}):this.bound===Xu?new Jd({channels:this.channels,triggers:this.triggers,mapper:this.mapper,writers:this.writers,bound:ht(r),config:this.config,kwargs:this.kwargs,retryPolicy:this.retryPolicy,cachePolicy:this.cachePolicy}):new Jd({channels:this.channels,triggers:this.triggers,mapper:this.mapper,writers:this.writers,bound:this.bound.pipe(r),config:this.config,kwargs:this.kwargs,retryPolicy:this.retryPolicy,cachePolicy:this.cachePolicy})}};function a8(t){return"steps"in t&&Array.isArray(t.steps)}function Xd(t){return"lg_is_pregel"in t&&t.lg_is_pregel===!0}function ty(t){let e=[t];for(let r of e){if(Xd(r))return r;a8(r)&&e.push(...r.steps)}}function Qs(t,e,r=!0,n=!1){try{return t[e].get()}catch(i){if(i.name===He.unminifiable_name){if(n)return i;if(r)return null}throw i}}function ci(t,e,r=!0){if(Array.isArray(e)){let n={};for(let i of e)try{n[i]=Qs(t,i,!r)}catch(o){if(o.name===He.unminifiable_name)continue}return n}else return Qs(t,e)}function*vL(t,e){if(t.graph===Or.PARENT)throw new Me("There is no parent graph.");if(t.goto){let r;Array.isArray(t.goto)?r=t.goto:r=[t.goto];for(let n of r)if(Rt(n))yield[dr,Ht,n];else if(typeof n=="string")yield[dr,`branch:to:${n}`,"__start__"];else throw new Error(`In Command.send, expected Send or string, got ${typeof n}`)}if(t.resume)if(typeof t.resume=="object"&&Object.keys(t.resume).length&&Object.keys(t.resume).every(Y_))for(let[r,n]of Object.entries(t.resume)){let i=e.filter(o=>o[0]===r&&o[1]===jt).map(o=>o[2]).slice(0,1)??[];i.push(n),yield[r,jt,i]}else yield[dr,jt,t.resume];if(t.update){if(typeof t.update!="object"||!t.update)throw new Error("Expected cmd.update to be a dict mapping channel names to update values");if(Array.isArray(t.update))for(let[r,n]of t.update)yield[dr,r,n];else for(let[r,n]of Object.entries(t.update))yield[dr,r,n]}}function*ry(t,e){if(e!=null)if(Array.isArray(t)&&typeof e=="object"&&!Array.isArray(e))for(let r in e)t.includes(r)&&(yield[r,e[r]]);else{if(Array.isArray(t))throw new Error('Input chunk must be an object when "inputChannels" is an array');yield[t,e]}}function*ny(t,e,r){Array.isArray(t)?(e===!0||e.find(([n,i])=>t.includes(n)))&&(yield ci(r,t)):(e===!0||e.some(([n,i])=>n===t))&&(yield Qs(r,t))}function*bL(t,e,r){let n=e.filter(([s,c])=>(s.config===void 0||!s.config.tags?.includes(Ke))&&c[0][0]!==Nt&&c[0][0]!==Te);if(!n.length)return;let i;n.some(([s])=>s.writes.some(([c,u])=>c===oi))?i=n.flatMap(([s])=>s.writes.filter(([c,u])=>c===oi).map(([c,u])=>[s.name,u])):Array.isArray(t)?i=n.flatMap(([s])=>{let{writes:c}=s,u={};for(let[l]of c)t.includes(l)&&(u[l]=(u[l]||0)+1);return Object.values(u).some(l=>l>1)?c.filter(([l])=>t.includes(l)).map(([l,p])=>[s.name,{[l]:p}]):[[s.name,Object.fromEntries(c.filter(([l])=>t.includes(l)))]]}):i=n.flatMap(([s])=>s.writes.filter(([c,u])=>c===t).map(([c,u])=>[s.name,u]));let o={};for(let[s,c]of i)s in o||(o[s]=[]),o[s].push(c);let a={};for(let s in o)if(o[s].length===1){let[c]=o[s];a[s]=c}else a[s]=o[s];r&&(a.__metadata__={cached:r}),yield a}function iy(t){let e=typeof t[$e];if(e==="number")return 0;if(e==="string")return"";for(let r in t){if(!Object.prototype.hasOwnProperty.call(t,r))continue;let n=typeof t[r];if(n==="number")return 0;if(n==="string")return"";break}}function Yu(t,e){if(Object.keys(t).length>0){let r=iy(e);return Object.fromEntries(Object.entries(e).filter(([n,i])=>i>(t[n]??r)))}else return e}function wL(t,e){return t&&!Array.isArray(t)&&!(t instanceof Date)&&typeof t=="object"?t:{[e]:t}}function Wr(t,e){return t===null?{configurable:e}:t?.configurable===void 0?{...t,configurable:e}:{...t,configurable:{...t.configurable,...e}}}function Ca(t,e){let r=e?.parents??{};return Object.keys(r).length>0?Wr(t,{[Cr]:{...r,[t.configurable?.checkpoint_ns??""]:t.configurable?.checkpoint_id}}):t}function Qu(...t){let e=[...new Set(t.filter(Boolean))];if(e.length===0)return{signal:void 0,dispose:void 0};if(e.length===1)return{signal:e[0],dispose:void 0};let r=new AbortController,n=()=>{let o=e.find(a=>a.aborted)?.reason;r.abort(o),e.forEach(a=>a.removeEventListener("abort",n))};e.forEach(o=>o.addEventListener("abort",n,{once:!0}));let i=e.find(o=>o.aborted);return i&&r.abort(i.reason),{signal:r.signal,dispose:()=>{e.forEach(o=>o.removeEventListener("abort",n))}}}var xL=(t,e)=>{if(!(!t&&!e))return t?e?Array.isArray(t)&&Array.isArray(e)?[...t,...e]:Array.isArray(t)?[...t,e]:Array.isArray(e)?[t,...e]:[t,e]:t:e};var SL=class{constructor({func:t,name:e,input:r,retry:n,cache:i,callbacks:o}){d(this,"func");d(this,"name");d(this,"input");d(this,"retry");d(this,"cache");d(this,"callbacks");d(this,"__lg_type","call");this.func=t,this.name=e,this.input=r,this.retry=n,this.cache=i,this.callbacks=o}};function IL(t){return typeof t=="object"&&t!==null&&"__lg_type"in t&&t.__lg_type==="call"}function kL(t,e){return new Tr({name:t,first:new fr({func:r=>e(...r),name:t,trace:!1,recurse:!1}),last:new wt([{channel:oi,value:Kr}],[Ke])})}function EL(t,e){return new fr({func:(r,n)=>e(r,n),name:t,trace:!1,recurse:!1})}var AL=t=>t!==void 0?t+1:1;function s8(t,e){if(e==null)return!1;for(let r of t)if(e[r])return!0;return!1}function c8(t){let e;for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e==null?e=t[r]:e=L_(e,t[r]));return e}function Qd(t,e,r){let n=iy(t.channel_versions),i=t.versions_seen[Te]??{},o=!1;if((t.channel_versions[$e]??n)>(i[$e]??n))o=!0;else for(let s in t.channel_versions)if(Object.prototype.hasOwnProperty.call(t.channel_versions,s)&&t.channel_versions[s]>(i[s]??n)){o=!0;break}let a=r.some(s=>e==="*"?!s.config?.tags?.includes(Ke):e.includes(s.name));return o&&a}function Yd(t,e,r,n,i=!1){let o=new Set;if(Array.isArray(n))o=new Set(n.filter(s=>r.writes.some(([c,u])=>c===s)));else{for(let[s]of r.writes)if(s===n){o=new Set([s]);break}o=o||new Set}let a;if(i&&o.size>0){let s=Object.fromEntries(Object.entries(e).filter(([l,p])=>o.has(l))),c=ti(t,s,-1),u=Ta(s,c);Nr(ei(c),u,[r],void 0,void 0),a=ci({...e,...u},n)}else a=ci(e,n);return a}function pA(t,e,r){for(let[n,i]of r)if([pr,Ht].includes(n)&&i!=null){if(!Rt(i))throw new Me(`Invalid packet type, expected SendProtocol, got ${JSON.stringify(i)}`);if(!(i.node in e))throw new Me(`Invalid node name "${i.node}" in Send packet`)}t(r)}var u8=new Set([qd,pr,jt,Te,oi,Nt]);function Nr(t,e,r,n,i){var f,m;r.sort((h,g)=>{let x=h.path?.slice(0,3)||[],y=g.path?.slice(0,3)||[];for(let v=0;v<Math.min(x.length,y.length);v+=1){if(x[v]<y[v])return-1;if(x[v]>y[v])return 1}return x.length-y.length});let o=r.some(h=>h.triggers.length>0),a=Zd(e);for(let h of r){(f=t.versions_seen)[m=h.name]??(f[m]={});for(let g of h.triggers)g in t.channel_versions&&(t.versions_seen[h.name][g]=t.channel_versions[g])}let s=c8(t.channel_versions),c=new Set(r.flatMap(h=>h.triggers).filter(h=>!iL.includes(h))),u=!1;for(let h of c)h in a&&a[h].consume()&&n!==void 0&&(t.channel_versions[h]=n(s),u=!0);let l={};for(let h of r)for(let[g,x]of h.writes)u8.has(g)||g in a&&(l[g]??(l[g]=[]),l[g].push(x));s!=null&&n!=null&&(s=u?n(s):s);let p=new Set;for(let[h,g]of Object.entries(l))if(h in a){let x=a[h],y;try{y=x.update(g)}catch(v){if(v.name===Me.unminifiable_name){let S=new Me(`Invalid update for channel "${h}" with values ${JSON.stringify(g)}: ${v.message}`);throw S.lc_error_code=v.lc_error_code,S}else throw v}y&&n!==void 0&&(t.channel_versions[h]=n(s),x.isAvailable()&&p.add(h))}if(o)for(let h in a){if(!Object.prototype.hasOwnProperty.call(a,h))continue;let g=a[h];g.isAvailable()&&!p.has(h)&&g.update([])&&n!==void 0&&(t.channel_versions[h]=n(s),g.isAvailable()&&p.add(h))}if(o&&!s8(p,i))for(let h in a){if(!Object.prototype.hasOwnProperty.call(a,h))continue;let g=a[h];g.finish()&&n!==void 0&&(t.channel_versions[h]=n(s),g.isAvailable()&&p.add(h))}return p}function*l8(t,e,r){if(r.updatedChannels!=null&&r.triggerToNodes!=null){let n=new Set;for(let i of r.updatedChannels){let o=r.triggerToNodes[i];for(let a of o??[])n.add(a)}yield*[...n].sort();return}if(!(()=>{for(let n in t.channel_versions)if(t.channel_versions[n]!==null)return!1;return!0})())for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&(yield n)}function Pa(t,e,r,n,i,o,a){let s={},c=n[Ht];if(c?.isAvailable()){let u=c.get().length;for(let l=0;l<u;l+=1){let p=oy([pr,l],t,e,r,n,i,o,a);p!==void 0&&(s[p.id]=p)}}for(let u of l8(t,r,a)){let l=oy([Kd,u],t,e,r,n,i,o,a);l!==void 0&&(s[l.id]=l)}return s}function oy(t,e,r,n,i,o,a,s){let{step:c,checkpointer:u,manager:l}=s,p=o.configurable??{},f=p.checkpoint_ns??"";if(t[0]===pr&&IL(t[t.length-1])){let m=t[t.length-1],h=kL(m.name,m.func),g=[pr],x=f===""?m.name:`${f}${ot}${m.name}`,y=po(JSON.stringify([x,c.toString(),m.name,pr,t[1],t[2]]),e.id),v=`${x}${Pr}${y}`,S=[...t.slice(0,3),!0],k={langgraph_step:c,langgraph_node:m.name,langgraph_triggers:g,langgraph_path:S,langgraph_checkpoint_ns:v};if(a){let T=[];return{name:m.name,input:m.input,proc:h,writes:T,config:ze(Bt(o,{metadata:k,store:s.store??o.store}),{runName:m.name,callbacks:l?.getChild(`graph:step:${c}`),configurable:{[Ks]:y,[Rn]:N=>pA(U=>T.push(...U),n,N),[ii]:(N,U=!1)=>Yd(e,i,{name:m.name,writes:T,triggers:g,path:S},N,U),[gt]:u??p[gt],[Cr]:{...p[Cr],[f]:e.id},[cn]:dA({pendingWrites:r??[],taskId:y,currentTaskInput:m.input,resumeMap:o.configurable?.[Hu],namespaceHash:To(v)}),[qu]:e.channel_values[Ws],checkpoint_id:void 0,checkpoint_ns:v}}),triggers:g,retry_policy:m.retry,cache_key:m.cache?{key:To((m.cache.keyFunc??JSON.stringify)([m.input])),ns:[V_,m.name??"__dynamic__"],ttl:m.cache.ttl}:void 0,id:y,path:S,writers:[]}}else return{id:y,name:m.name,interrupts:[],path:S}}else if(t[0]===pr){let m=typeof t[1]=="number"?t[1]:parseInt(t[1],10);if(!i[Ht]?.isAvailable())return;let h=i[Ht].get();if(m<0||m>=h.length)return;let g=G_(h[m])&&!Rt(h[m])?new $a(h[m].node,h[m].args):h[m];if(!G_(g)){console.warn(`Ignoring invalid packet ${JSON.stringify(g)} in pending sends.`);return}if(!(g.node in n)){console.warn(`Ignoring unknown node name ${g.node} in pending sends.`);return}let x=[pr],y=f===""?g.node:`${f}${ot}${g.node}`,v=po(JSON.stringify([y,c.toString(),g.node,pr,m.toString()]),e.id),S=`${y}${Pr}${v}`,k={langgraph_step:c,langgraph_node:g.node,langgraph_triggers:x,langgraph_path:t.slice(0,3),langgraph_checkpoint_ns:S};if(a){let T=n[g.node],N=T.getNode();if(N!==void 0){T.metadata!==void 0&&(k={...k,...T.metadata});let U=[];return{name:g.node,input:g.args,proc:N,subgraphs:T.subgraphs,writes:U,config:ze(Bt(o,{metadata:k,tags:T.tags,store:s.store??o.store}),{runName:g.node,callbacks:l?.getChild(`graph:step:${c}`),configurable:{[Ks]:v,[Rn]:w=>pA(V=>U.push(...V),n,w),[ii]:(w,V=!1)=>Yd(e,i,{name:g.node,writes:U,triggers:x,path:t},w,V),[gt]:u??p[gt],[Cr]:{...p[Cr],[f]:e.id},[cn]:dA({pendingWrites:r??[],taskId:v,currentTaskInput:g.args,resumeMap:o.configurable?.[Hu],namespaceHash:To(S)}),[qu]:e.channel_values[Ws],checkpoint_id:void 0,checkpoint_ns:S}}),triggers:x,retry_policy:T.retryPolicy,cache_key:T.cachePolicy?{key:To((T.cachePolicy.keyFunc??JSON.stringify)([g.args])),ns:[V_,T.name??"__dynamic__",g.node],ttl:T.cachePolicy.ttl}:void 0,id:v,path:t,writers:T.getWriters()}}}else return{id:v,name:g.node,interrupts:[],path:t}}else if(t[0]===Kd){let m=t[1].toString(),h=n[m];if(h===void 0)return;if(r?.length){let v=f===""?m:`${f}${ot}${m}`,S=po(JSON.stringify([v,c.toString(),m,Kd,m]),e.id);if(r.some(k=>k[0]===S&&k[1]!==Nt))return}let g=iy(e.channel_versions);if(g===void 0)return;let x=e.versions_seen[m]??{},y=h.triggers.find(v=>i[v].isAvailable()?(e.channel_versions[v]??g)>(x[v]??g):!1);if(y!==void 0){let v=p8(h,i,a);if(v===void 0)return;let S=f===""?m:`${f}${ot}${m}`,k=po(JSON.stringify([S,c.toString(),m,Kd,[y]]),e.id),T=`${S}${Pr}${k}`,N={langgraph_step:c,langgraph_node:m,langgraph_triggers:[y],langgraph_path:t,langgraph_checkpoint_ns:T};if(a){let U=h.getNode();if(U!==void 0){h.metadata!==void 0&&(N={...N,...h.metadata});let w=[];return{name:m,input:v,proc:U,subgraphs:h.subgraphs,writes:w,config:ze(Bt(o,{metadata:N,tags:h.tags,store:s.store??o.store}),{runName:m,callbacks:l?.getChild(`graph:step:${c}`),configurable:{[Ks]:k,[Rn]:V=>pA(F=>{w.push(...F)},n,V),[ii]:(V,F=!1)=>Yd(e,i,{name:m,writes:w,triggers:[y],path:t},V,F),[gt]:u??p[gt],[Cr]:{...p[Cr],[f]:e.id},[cn]:dA({pendingWrites:r??[],taskId:k,currentTaskInput:v,resumeMap:o.configurable?.[Hu],namespaceHash:To(T)}),[qu]:e.channel_values[Ws],checkpoint_id:void 0,checkpoint_ns:T}}),triggers:[y],retry_policy:h.retryPolicy,cache_key:h.cachePolicy?{key:To((h.cachePolicy.keyFunc??JSON.stringify)([v])),ns:[V_,h.name??"__dynamic__",m],ttl:h.cachePolicy.ttl}:void 0,id:k,path:t,writers:h.getWriters()}}}else return{id:k,name:m,interrupts:[],path:t}}}}function p8(t,e,r){let n;if(typeof t.channels=="object"&&!Array.isArray(t.channels)){n={};for(let[i,o]of Object.entries(t.channels))if(t.triggers.includes(o))try{n[i]=Qs(e,o,!1)}catch(a){if(a.name===He.unminifiable_name)return;throw a}else if(o in e)try{n[i]=Qs(e,o,!1)}catch(a){if(a.name===He.unminifiable_name)continue;throw a}}else if(Array.isArray(t.channels)){let i=!1;for(let o of t.channels)try{n=Qs(e,o,!1),i=!0;break}catch(a){if(a.name===He.unminifiable_name)continue;throw a}if(!i)return}else throw new Error(`Invalid channels type, expected list or dict, got ${t.channels}`);return r&&t.mapper!==void 0&&(n=t.mapper(n)),n}function TL(t,e){if(typeof t.args!="object"||t.args===null)return t;let r={};for(let[n,i]of Object.entries(t.args)){let o=e[n];(!o||o.lc_graph_name!=="UntrackedValue")&&(r[n]=i)}return new $a(t.node,r)}function dA({pendingWrites:t,taskId:e,currentTaskInput:r,resumeMap:n,namespaceHash:i}){let o=t.find(([s,c])=>s===dr&&c===jt)?.[2],a={callCounter:0,interruptCounter:-1,resume:(()=>{let s=t.filter(([c,u])=>c===e&&u===jt).flatMap(([c,u,l])=>l);if(n!=null&&i in n){let c=n[i];s.push(c)}return s})(),nullResume:o,subgraphCounter:0,currentTaskInput:r,consumeNullResume:()=>{if(a.nullResume)return delete a.nullResume,t.splice(t.findIndex(([s,c])=>s===dr&&c===jt),1),o}};return a}var ef={blue:{start:"\x1B[34m",end:"\x1B[0m"},green:{start:"\x1B[32m",end:"\x1B[0m"},yellow:{start:"\x1B[33;1m",end:"\x1B[0m"}},tf=(t,e)=>`${t.start}${e}${t.end}`;function*fA(t){for(let{id:e,name:r,input:n,config:i,triggers:o,writes:a}of t)i?.tags?.includes(Ke)||(yield{id:e,name:r,input:n,triggers:o,interrupts:a.filter(([s,c])=>s===e&&c===Te).map(([,s])=>s)})}function d8(t){return typeof t!="object"||t===null?!1:"$writes"in t&&Array.isArray(t.$writes)}function $L(t){let e={};for(let[r,n]of t){let i=String(r);if(i in e){let o=d8(e[i])?e[i].$writes:[e[i]];o.push(n),e[i]={$writes:o}}else e[i]=n}return e}function*OL(t,e){for(let[{id:r,name:n,config:i},o]of t)i?.tags?.includes(Ke)||(yield{id:r,name:n,result:$L(o.filter(([a])=>Array.isArray(e)?e.includes(a):a===e)),interrupts:o.filter(a=>a[0]===Te).map(a=>a[1])})}function*CL(t,e,r,n,i,o,a,s){function c(p){let f={};return p.callbacks!=null&&(f.callbacks=p.callbacks),p.configurable!=null&&(f.configurable=p.configurable),p.maxConcurrency!=null&&(f.max_concurrency=p.maxConcurrency),p.metadata!=null&&(f.metadata=p.metadata),p.recursionLimit!=null&&(f.recursion_limit=p.recursionLimit),p.runId!=null&&(f.run_id=p.runId),p.runName!=null&&(f.run_name=p.runName),p.tags!=null&&(f.tags=p.tags),f}let u=t.configurable?.checkpoint_ns,l={};for(let p of i){if(!(p.subgraphs?.length?p.subgraphs:[p.proc]).find(ty))continue;let f=`${p.name}:${p.id}`;u&&(f=`${u}|${f}`),l[p.id]={configurable:{thread_id:t.configurable?.thread_id,checkpoint_ns:f}}}yield{config:c(t),values:ci(e,r),metadata:n,next:i.map(p=>p.name),tasks:mA(i,o,l,s),parentConfig:a?c(a):void 0}}function mA(t,e,r,n){return t.map(i=>{let o=e.find(([u,l])=>u===i.id&&l===Nt)?.[2],a=e.filter(([u,l])=>u===i.id&&l===Te).map(([,,u])=>u),s=(()=>{if(o||a.length||!e.length)return;let u=e.findIndex(([l,p])=>l===i.id&&p===oi);if(u>=0)return e[u][2];if(typeof n=="string")return e.find(([l,p])=>l===i.id&&p===n)?.[2];if(Array.isArray(n)){let l=e.filter(([p,f])=>p===i.id&&n.includes(f)).map(([,p,f])=>[p,f]);return l.length?$L(l):void 0}})();if(o)return{id:i.id,name:i.name,path:i.path,error:o,interrupts:a,result:s};let c=r?.[i.id];return{id:i.id,name:i.name,path:i.path,interrupts:a,...c!==void 0?{state:c}:{},result:s}})}function PL(t,e,r){console.log([`${tf(ef.blue,`[${t}:checkpoint]`)}`,`\x1B[1m State at the end of step ${t}:\x1B[0m
`,JSON.stringify(ci(e,r),null,2)].join(""))}function ay(t,e){let r=e.length;console.log([`${tf(ef.blue,`[${t}:tasks]`)}`,`\x1B[1m Starting step ${t} with ${r} task${r===1?"":"s"}:\x1B[0m
`,e.map(n=>`- ${tf(ef.green,String(n.name))} -> ${JSON.stringify(n.input,null,2)}`).join(`
`)].join(""))}function NL(t,e,r){let n={};for(let[i,o]of e)r.includes(i)&&(n[i]||(n[i]=[]),n[i].push(o));console.log([`${tf(ef.blue,`[${t}:writes]`)}`,`\x1B[1m Finished step ${t} with writes to ${Object.keys(n).length} channel${Object.keys(n).length!==1?"s":""}:\x1B[0m
`,Object.entries(n).map(([i,o])=>`- ${tf(ef.yellow,i)} -> ${o.map(a=>JSON.stringify(a)).join(", ")}`).join(`
`)].join(""))}var gA=class extends Ct{constructor(e,r){let n=e.getReader(),i=r??new AbortController;super({start(o){return a();function a(){return n.read().then(({done:s,value:c})=>{if(s){o.close();return}return o.enqueue(c),a()})}}});d(this,"_abortController");d(this,"_innerReader");this._abortController=i,this._innerReader=n}async cancel(e){this._abortController.abort(e),this._innerReader.releaseLock()}get signal(){return this._abortController.signal}},sy=class extends Ct{constructor(e){let r,n=new Promise(i=>{r=i});super({start:i=>{r(i)}});d(this,"modes");d(this,"controller");d(this,"passthroughFn");d(this,"_closed",!1);n.then(i=>{this.controller=i}),this.passthroughFn=e.passthroughFn,this.modes=e.modes}get closed(){return this._closed}push(e){this.passthroughFn?.(e),this.controller.enqueue(e)}close(){try{this.controller.close()}catch{}finally{this._closed=!0}}error(e){this.controller.error(e)}};function f8(t){return JSON.stringify(t,function(e,r){let n=this[e];if(n!=null&&typeof n=="object"&&"toDict"in n&&typeof n.toDict=="function"){let{type:i,data:o}=n.toDict();return{...o,type:i}}return r})}function m8(t){return t instanceof Error?{error:t.name,message:t.message}:{error:"Error",message:JSON.stringify(t)}}function _A(t){return typeof t!="object"||t==null?!1:"configurable"in t&&typeof t.configurable=="object"&&t.configurable!=null}function hA(t){return!_A(t)||!t.configurable.thread_id?null:{thread_id:t.configurable.thread_id,checkpoint_ns:t.configurable.checkpoint_ns||"",checkpoint_id:t.configurable.checkpoint_id||null,checkpoint_map:t.configurable.checkpoint_map||null}}function RL(t){if(_A(t)){let e=Object.fromEntries(Object.entries(t.configurable).filter(([n])=>!n.startsWith("__"))),r={...t,configurable:e};return delete r.callbacks,r}return t}function ML(t){let e={...t,checkpoint:hA(t.config),parent_checkpoint:hA(t.parentConfig),config:RL(t.config),parent_config:RL(t.parentConfig),tasks:t.tasks.map(r=>{if(_A(r.state)){let n=hA(r.state);if(n!=null){let i={...r,checkpoint:n};return delete i.state,i}}return r})};return delete e.parentConfig,e}function zL(t){let e=new TextEncoder;return new ReadableStream({async start(r){let n=i=>{r.enqueue(e.encode(`event: ${i.event}
data: ${f8(i.data)}

`))};try{for await(let i of t){let[o,a,s]=i,c=s;if(a==="debug"){let u=s;u.type==="checkpoint"&&(c={...u,payload:ML(u.payload)})}a==="checkpoints"&&(c=ML(s)),n({event:o?.length?`${a}|${o.join("|")}`:a,data:c})}}catch(i){n({event:"error",data:m8(i)})}r.close()}})}var cy=Symbol.for("INPUT_DONE"),yA=Symbol.for("INPUT_RESUMING"),h8=25;function g8(...t){return new sy({passthroughFn:e=>{for(let r of t)r.modes.has(e[1])&&r.push(e)},modes:new Set(t.flatMap(e=>Array.from(e.modes)))})}var _8=class extends F_{constructor(e){super();d(this,"cache");d(this,"queue",Promise.resolve());this.cache=e}async get(e){return this.enqueueOperation("get",e)}async set(e){return this.enqueueOperation("set",e)}async clear(e){return this.enqueueOperation("clear",e)}async stop(){await this.queue}enqueueOperation(e,...r){let n=this.queue.then(()=>this.cache[e](...r));return this.queue=n.then(()=>{},()=>{}),n}},jL=class DL{constructor(e){d(this,"input");d(this,"output");d(this,"config");d(this,"checkpointer");d(this,"checkpointerGetNextVersion");d(this,"channels");d(this,"checkpoint");d(this,"checkpointIdSaved");d(this,"checkpointConfig");d(this,"checkpointMetadata");d(this,"checkpointNamespace");d(this,"checkpointPendingWrites",[]);d(this,"checkpointPreviousVersions");d(this,"step");d(this,"stop");d(this,"durability");d(this,"outputKeys");d(this,"streamKeys");d(this,"nodes");d(this,"skipDoneTasks");d(this,"prevCheckpointConfig");d(this,"updatedChannels");d(this,"status","pending");d(this,"tasks",{});d(this,"stream");d(this,"checkpointerPromises",[]);d(this,"isNested");d(this,"_checkpointerChainedPromise",Promise.resolve());d(this,"store");d(this,"cache");d(this,"manager");d(this,"interruptAfter");d(this,"interruptBefore");d(this,"toInterrupt",[]);d(this,"debug",!1);d(this,"triggerToNodes");this.input=e.input,this.checkpointer=e.checkpointer,this.checkpointer!==void 0?this.checkpointerGetNextVersion=this.checkpointer.getNextVersion.bind(this.checkpointer):this.checkpointerGetNextVersion=AL,this.checkpoint=e.checkpoint,this.checkpointMetadata=e.checkpointMetadata,this.checkpointPreviousVersions=e.checkpointPreviousVersions,this.channels=e.channels,this.checkpointPendingWrites=e.checkpointPendingWrites,this.step=e.step,this.stop=e.stop,this.config=e.config,this.checkpointConfig=e.checkpointConfig,this.isNested=e.isNested,this.manager=e.manager,this.outputKeys=e.outputKeys,this.streamKeys=e.streamKeys,this.nodes=e.nodes,this.skipDoneTasks=e.skipDoneTasks,this.store=e.store,this.cache=e.cache?new _8(e.cache):void 0,this.stream=e.stream,this.checkpointNamespace=e.checkpointNamespace,this.prevCheckpointConfig=e.prevCheckpointConfig,this.interruptAfter=e.interruptAfter,this.interruptBefore=e.interruptBefore,this.durability=e.durability,this.debug=e.debug,this.triggerToNodes=e.triggerToNodes}get isResuming(){let e=!1;if($e in this.checkpoint.channel_versions)e=!0;else for(let s in this.checkpoint.channel_versions)if(Object.prototype.hasOwnProperty.call(this.checkpoint.channel_versions,s)){e=!0;break}let r=this.config.configurable?.[Li]!==void 0&&this.config.configurable?.[Li],n=this.input===null||this.input===void 0,i=zt(this.input)&&this.input.resume!=null,o=this.input===yA,a=!this.isNested&&this.config.metadata?.run_id!==void 0&&this.checkpointMetadata?.run_id!==void 0&&this.config.metadata.run_id===this.checkpointMetadata?.run_id;return e&&(r||n||i||o||a)}static async initialize(e){let{config:r,stream:n}=e;n!==void 0&&r.configurable?.[Gu]!==void 0&&(n=g8(n,r.configurable[Gu]));let i=r.configurable?!("checkpoint_id"in r.configurable):!0,o=r.configurable?.[cn];r.configurable&&o&&(o.subgraphCounter>0&&(r=Wr(r,{[un]:[r.configurable[un],o.subgraphCounter.toString()].join(ot)})),o.subgraphCounter+=1);let a=ii in(r.configurable??{});!a&&r.configurable?.checkpoint_ns!==void 0&&r.configurable?.checkpoint_ns!==""&&(r=Wr(r,{checkpoint_ns:"",checkpoint_id:void 0}));let s=r;r.configurable?.[Cr]!==void 0&&r.configurable?.[Cr]?.[r.configurable?.checkpoint_ns]&&(s=Wr(r,{checkpoint_id:r.configurable[Cr][r.configurable?.checkpoint_ns]}));let c=r.configurable?.checkpoint_ns?.split(ot)??[],u=await e.checkpointer?.getTuple(s)??{config:r,checkpoint:qs(),metadata:{source:"input",step:-2,parents:{}},pendingWrites:[]};s={...r,...u.config,configurable:{checkpoint_ns:"",...r.configurable,...u.config.configurable}};let l=u.parentConfig,p=ei(u.checkpoint),f={...u.metadata},m=u.pendingWrites??[],h=Ta(e.channelSpecs,p),g=(f.step??0)+1,x=g+(r.recursionLimit??h8)+1,y={...p.channel_versions},v=e.store?new Vd(e.store):void 0;return v&&await v.start(),new DL({input:e.input,config:r,checkpointer:e.checkpointer,checkpoint:p,checkpointMetadata:f,checkpointConfig:s,prevCheckpointConfig:l,checkpointNamespace:c,channels:h,isNested:a,manager:e.manager,skipDoneTasks:i,step:g,stop:x,checkpointPreviousVersions:y,checkpointPendingWrites:m,outputKeys:e.outputKeys??[],streamKeys:e.streamKeys??[],nodes:e.nodes,stream:n,store:v,cache:e.cache,interruptAfter:e.interruptAfter,interruptBefore:e.interruptBefore,durability:e.durability,debug:e.debug,triggerToNodes:e.triggerToNodes})}_checkpointerPutAfterPrevious(e){this._checkpointerChainedPromise=this._checkpointerChainedPromise.then(()=>this.checkpointer?.put(e.config,e.checkpoint,e.metadata,e.newVersions)),this.checkpointerPromises.push(this._checkpointerChainedPromise)}putWrites(e,r){let n=r;if(n.length===0)return;n.every(([c])=>c in U_)&&(n=Array.from(new Map(n.map(c=>[c[0],c])).values()));let i=!1;for(let c in this.channels)if(Object.prototype.hasOwnProperty.call(this.channels,c)&&this.channels[c].lc_graph_name==="UntrackedValue"){i=!0;break}let o=n;i&&(o=n.filter(([c])=>{let u=this.channels[c];return!u||u.lc_graph_name!=="UntrackedValue"}).map(([c,u])=>c===Ht&&Rt(u)?[c,TL(u,this.channels)]:[c,u])),this.checkpointPendingWrites=this.checkpointPendingWrites.filter(c=>c[0]!==e);for(let[c,u]of o)this.checkpointPendingWrites.push([e,c,u]);let a=Wr(this.checkpointConfig,{[un]:this.config.configurable?.checkpoint_ns??"",[Z_]:this.checkpoint.id});if(this.durability!=="exit"&&this.checkpointer!=null&&this.checkpointerPromises.push(this.checkpointer.putWrites(a,o,e)),this.tasks&&this._outputWrites(e,n),!r.length||!this.cache||!this.tasks)return;let s=this.tasks[e];s==null||s.cache_key==null||r[0][0]===Nt||r[0][0]===Te||this.cache.set([{key:[s.cache_key.ns,s.cache_key.key],value:s.writes,ttl:s.cache_key.ttl}])}_outputWrites(e,r,n=!1){let i=this.tasks[e];if(i!==void 0){if(i.config!==void 0&&(i.config.tags??[]).includes(Ke))return;if(r.length>0)if(r[0][0]===Te){if(i.path?.[0]===pr&&i.path?.[i.path.length-1]===!0)return;let o=r.filter(a=>a[0]===Te).flatMap(a=>a[1]);this._emit([["updates",{[Te]:o}],["values",{[Te]:o}]])}else r[0][0]!==Nt&&this._emit(Xs($o(bL(this.outputKeys,[[i,r]],n),"updates")));n||this._emit(Xs($o(OL([[i,r]],this.streamKeys),"tasks")))}}async _matchCachedWrites(){if(!this.cache)return[];let e=[],r=([a,s])=>`ns:${a.join(",")}|key:${s}`,n=[],i={};for(let a of Object.values(this.tasks))a.cache_key!=null&&!a.writes.length&&(n.push([a.cache_key.ns,a.cache_key.key]),i[r([a.cache_key.ns,a.cache_key.key])]=a);if(n.length===0)return[];let o=await this.cache.get(n);for(let{key:a,value:s}of o){let c=i[r(a)];c!=null&&(c.writes.push(...s),e.push({task:c,result:s}))}return e}async tick(e){this.store&&!this.store.isRunning&&await this.store?.start();let{inputKeys:r=[]}=e;if(this.status!=="pending")throw new Error(`Cannot tick when status is no longer "pending". Current status: "${this.status}"`);if(![cy,yA].includes(this.input))await this._first(r);else{if(this.toInterrupt.length>0)throw this.status="interrupt_before",new wi;if(Object.values(this.tasks).every(i=>i.writes.length>0)){let i=Object.values(this.tasks).flatMap(a=>a.writes);this.updatedChannels=Nr(this.checkpoint,this.channels,Object.values(this.tasks),this.checkpointerGetNextVersion,this.triggerToNodes);let o=await ai($o(ny(this.outputKeys,i,this.channels),"values"));if(this._emit(o),this.checkpointPendingWrites=[],await this._putCheckpoint({source:"loop"}),Qd(this.checkpoint,this.interruptAfter,Object.values(this.tasks)))throw this.status="interrupt_after",new wi;this.config.configurable?.[Li]!==void 0&&delete this.config.configurable?.[Li]}else return!1}if(this.step>this.stop)return this.status="out_of_steps",!1;if(this.tasks=Pa(this.checkpoint,this.checkpointPendingWrites,this.nodes,this.channels,this.config,!0,{step:this.step,checkpointer:this.checkpointer,isResuming:this.isResuming,manager:this.manager,store:this.store,stream:this.stream,triggerToNodes:this.triggerToNodes,updatedChannels:this.updatedChannels}),this.checkpointer&&this._emit(await ai($o(CL(this.checkpointConfig,this.channels,this.streamKeys,this.checkpointMetadata,Object.values(this.tasks),this.checkpointPendingWrites,this.prevCheckpointConfig,this.outputKeys),"checkpoints"))),Object.values(this.tasks).length===0)return this.status="done",!1;if(this.skipDoneTasks&&this.checkpointPendingWrites.length>0){for(let[i,o,a]of this.checkpointPendingWrites){if(o===Nt||o===Te||o===jt)continue;let s=Object.values(this.tasks).find(c=>c.id===i);s&&s.writes.push([o,a])}for(let i of Object.values(this.tasks))i.writes.length>0&&this._outputWrites(i.id,i.writes,!0)}if(Object.values(this.tasks).every(i=>i.writes.length>0))return this.tick({inputKeys:r});if(Qd(this.checkpoint,this.interruptBefore,Object.values(this.tasks)))throw this.status="interrupt_before",new wi;let n=await ai($o(fA(Object.values(this.tasks)),"tasks"));return this._emit(n),!0}async finishAndHandleError(e){this.durability==="exit"&&(!this.isNested||typeof e<"u"||this.checkpointNamespace.every(n=>!n.includes(Pr)))&&(this._putCheckpoint(this.checkpointMetadata),this._flushPendingWrites());let r=this._suppressInterrupt(e);return(r||e===void 0)&&(this.output=ci(this.channels,this.outputKeys)),r&&(this.tasks!==void 0&&this.checkpointPendingWrites.length>0&&Object.values(this.tasks).some(n=>n.writes.length>0)&&(this.updatedChannels=Nr(this.checkpoint,this.channels,Object.values(this.tasks),this.checkpointerGetNextVersion,this.triggerToNodes),this._emit(Xs($o(ny(this.outputKeys,Object.values(this.tasks).flatMap(n=>n.writes),this.channels),"values")))),xi(e)&&!e.interrupts.length&&this._emit([["updates",{[Te]:[]}],["values",{[Te]:[]}]])),r}async acceptPush(e,r,n){if(this.interruptAfter?.length>0&&Qd(this.checkpoint,this.interruptAfter,[e])){this.toInterrupt.push(e);return}let i=oy([pr,e.path??[],r,e.id,n],this.checkpoint,this.checkpointPendingWrites,this.nodes,this.channels,e.config??{},!0,{step:this.step,checkpointer:this.checkpointer,manager:this.manager,store:this.store,stream:this.stream});if(!i)return;if(this.interruptBefore?.length>0&&Qd(this.checkpoint,this.interruptBefore,[i])){this.toInterrupt.push(i);return}this._emit(Xs($o(fA([i]),"tasks"))),this.debug&&ay(this.step,[i]),this.tasks[i.id]=i,this.skipDoneTasks&&this._matchWrites({[i.id]:i});let o=await this._matchCachedWrites();for(let{task:a}of o)this._outputWrites(a.id,a.writes,!0);return i}_suppressInterrupt(e){return xi(e)&&!this.isNested}async _first(e){var a;let{configurable:r}=this.config,n=r?.[cn];if(n&&n.nullResume!==void 0&&this.putWrites(dr,[[jt,n.nullResume]]),zt(this.input)){let s=this.input.resume!=null;if(this.input.resume!=null&&typeof this.input.resume=="object"&&Object.keys(this.input.resume).every(Y_)&&((a=this.config).configurable??(a.configurable={}),this.config.configurable[Hu]=this.input.resume),s&&this.checkpointer==null)throw new Error("Cannot use Command(resume=...) without checkpointer");let c={};for(let[u,l,p]of vL(this.input,this.checkpointPendingWrites))c[u]??(c[u]=[]),c[u].push([l,p]);if(Object.keys(c).length===0)throw new Ep("Received empty Command input");for(let[u,l]of Object.entries(c))this.putWrites(u,l)}let i=(this.checkpointPendingWrites??[]).filter(s=>s[0]===dr).map(s=>s.slice(1));i.length>0&&Nr(this.checkpoint,this.channels,[{name:ni,writes:i,triggers:[]}],this.checkpointerGetNextVersion,this.triggerToNodes);let o=zt(this.input)&&i.length>0;if(this.isResuming||o){for(let c in this.channels)if(Object.prototype.hasOwnProperty.call(this.channels,c)&&this.checkpoint.channel_versions[c]!==void 0){let u=this.checkpoint.channel_versions[c];this.checkpoint.versions_seen[Te]={...this.checkpoint.versions_seen[Te],[c]:u}}let s=await ai($o(ny(this.outputKeys,!0,this.channels),"values"));this._emit(s)}if(this.isResuming)this.input=yA;else if(o)await this._putCheckpoint({source:"input"}),this.input=cy;else{let s=await ai(ry(e,this.input));if(s.length>0){let c=Pa(this.checkpoint,this.checkpointPendingWrites,this.nodes,this.channels,this.config,!0,{step:this.step});this.updatedChannels=Nr(this.checkpoint,this.channels,Object.values(c).concat([{name:ni,writes:s,triggers:[]}]),this.checkpointerGetNextVersion,this.triggerToNodes),await this._putCheckpoint({source:"input"}),this.input=cy}else if(Li in(this.config.configurable??{}))this.input=cy;else throw new Ep(`Received no input writes for ${JSON.stringify(e,null,2)}`)}this.isNested||(this.config=Wr(this.config,{[Li]:this.isResuming}))}_emit(e){for(let[r,n]of e)if(this.stream.modes.has(r)&&this.stream.push([this.checkpointNamespace,r,n]),(r==="checkpoints"||r==="tasks")&&this.stream.modes.has("debug")){let i=r==="checkpoints"?this.step-1:this.step,o=new Date().toISOString(),a=r==="checkpoints"?"checkpoint":typeof n=="object"&&n!=null&&"result"in n?"task_result":"task";this.stream.push([this.checkpointNamespace,"debug",{step:i,type:a,timestamp:o,payload:n}])}}_putCheckpoint(e){let r=this.checkpointMetadata===e,n=this.checkpointer!=null&&(this.durability!=="exit"||r),i=o=>{this.prevCheckpointConfig=this.checkpointConfig?.configurable?.checkpoint_id?this.checkpointConfig:void 0,this.checkpointConfig=Wr(this.checkpointConfig,{[un]:this.config.configurable?.checkpoint_ns??""});let a={...this.checkpoint.channel_versions},s=Yu(this.checkpointPreviousVersions,a);this.checkpointPreviousVersions=a,this._checkpointerPutAfterPrevious({config:{...this.checkpointConfig},checkpoint:ei(o),metadata:{...this.checkpointMetadata},newVersions:s}),this.checkpointConfig={...this.checkpointConfig,configurable:{...this.checkpointConfig.configurable,checkpoint_id:this.checkpoint.id}}};r||(this.checkpointMetadata={...e,step:this.step,parents:this.config.configurable?.[Cr]??{}}),this.checkpoint=ti(this.checkpoint,n?this.channels:void 0,this.step,r?{id:this.checkpoint.id}:void 0),n&&i(this.checkpoint),r||(this.step+=1)}_flushPendingWrites(){if(this.checkpointer==null||this.checkpointPendingWrites.length===0)return;let e=Wr(this.checkpointConfig,{[un]:this.config.configurable?.checkpoint_ns??"",[Z_]:this.checkpoint.id}),r={};for(let[n,i,o]of this.checkpointPendingWrites)r[n]??(r[n]=[]),r[n].push([i,o]);for(let[n,i]of Object.entries(r))this.checkpointerPromises.push(this.checkpointer.putWrites(e,i,n))}_matchWrites(e){for(let[r,n,i]of this.checkpointPendingWrites){if(n===Nt||n===Te||n===jt)continue;let o=Object.values(e).find(a=>a.id===r);o&&o.writes.push([n,i])}for(let r of Object.values(e))r.writes.length>0&&this._outputWrites(r.id,r.writes,!0)}};function y8(t){return dt(t?.message)}var LL=class extends co{constructor(e){super();d(this,"name","StreamMessagesHandler");d(this,"streamFn");d(this,"metadatas",{});d(this,"seen",{});d(this,"emittedChatModelRunIds",{});d(this,"stableMessageIdMap",{});d(this,"lc_prefer_streaming",!0);this.streamFn=e}_emit(e,r,n,i=!1){var a;if(i&&r.id!==void 0&&this.seen[r.id]!==void 0)return;let o=r.id;n!=null&&(rp(r)?o??(o=`run-${n}-tool-${r.tool_call_id}`):((o==null||o===`run-${n}`)&&(o=this.stableMessageIdMap[n]??o??`run-${n}`),(a=this.stableMessageIdMap)[n]??(a[n]=o))),o!==r.id&&(r.id=o,r.lc_kwargs.id=o),r.id!=null&&(this.seen[r.id]=r),this.streamFn([e[0],"messages",[r,e[1]]])}handleChatModelStart(e,r,n,i,o,a,s,c){s&&(!a||!a.includes(nL)&&!a.includes("nostream"))&&(this.metadatas[n]=[s.langgraph_checkpoint_ns.split("|"),{tags:a,name:c,...s}])}handleLLMNewToken(e,r,n,i,o,a){let s=a?.chunk;this.emittedChatModelRunIds[n]=!0,this.metadatas[n]!==void 0&&(y8(s)?this._emit(this.metadatas[n],s.message,n):this._emit(this.metadatas[n],new st({content:e}),n))}handleLLMEnd(e,r){if(this.metadatas[r]!==void 0){if(!this.emittedChatModelRunIds[r]){let n=e.generations?.[0]?.[0];dt(n?.message)&&this._emit(this.metadatas[r],n?.message,r,!0),delete this.emittedChatModelRunIds[r]}delete this.metadatas[r],delete this.stableMessageIdMap[r]}}handleLLMError(e,r){delete this.metadatas[r]}handleChainStart(e,r,n,i,o,a,s,c){if(a!==void 0&&c===a.langgraph_node&&(o===void 0||!o.includes(Ke))&&(this.metadatas[n]=[a.langgraph_checkpoint_ns.split("|"),{tags:o,name:c,...a}],typeof r=="object")){for(let u of Object.values(r))if((dt(u)||io(u))&&u.id!==void 0)this.seen[u.id]=u;else if(Array.isArray(u))for(let l of u)(dt(l)||io(l))&&l.id!==void 0&&(this.seen[l.id]=l)}}handleChainEnd(e,r){let n=this.metadatas[r];if(delete this.metadatas[r],n!==void 0){if(dt(e))this._emit(n,e,r,!0);else if(Array.isArray(e))for(let i of e)dt(i)&&this._emit(n,i,r,!0);else if(e!=null&&typeof e=="object"){for(let i of Object.values(e))if(dt(i))this._emit(n,i,r,!0);else if(Array.isArray(i))for(let o of i)dt(o)&&this._emit(n,o,r,!0)}}}handleChainError(e,r){delete this.metadatas[r]}};var v8=500,b8=2,w8=128e3,x8=3,S8=[400,401,402,403,404,405,406,407,409],I8=t=>{if(t.message.startsWith("Cancel")||t.message.startsWith("AbortError")||t.name==="AbortError"||t.name==="GraphValueError"||t?.code==="ECONNABORTED")return!1;let e=t?.response?.status??t?.status;return!(e&&S8.includes(+e)||t?.error?.code==="insufficient_quota")};async function vA(t,e,r,n){let i=t.retry_policy??e,o=i!==void 0?i.initialInterval??v8:0,a=0,s,c,{config:u}=t;for(r&&(u=Wr(u,r)),u={...u,signal:n};!n?.aborted;){t.writes.splice(0,t.writes.length),s=void 0;try{c=await t.proc.invoke(t.input,u);break}catch(l){if(s=l,s.pregelTaskId=t.id,Bm(s)){let m=u?.configurable?.checkpoint_ns,h=s.command;if(h.graph===m){for(let g of t.writers)await g.invoke(h,u);s=void 0;break}else if(h.graph===Or.PARENT){let g=oL(m);s.command=new Or({...s.command,graph:g})}}if(oa(s)||i===void 0||(a+=1,a>=(i.maxAttempts??x8))||!(i.retryOn??I8)(s))break;o=Math.min(i.maxInterval??w8,o*(i.backoffFactor??b8));let p=i.jitter?Math.floor(o+Math.random()*1e3):o;await new Promise(m=>setTimeout(m,p));let f=s.name??s.constructor.unminifiable_name??s.constructor.name;(i?.logWarning??!0)&&console.log(`Retrying task "${String(t.name)}" after ${o.toFixed(2)}ms (attempt ${a}) after ${f}: ${s}`),u=Wr(u,{[Li]:!0})}}return{task:t,result:c,error:s,signalAborted:n?.aborted}}var bA=Symbol.for("promiseAdded");function k8(){let t={next:()=>{},wait:Promise.resolve(bA)};function e(r){t.next=()=>{t.wait=new Promise(e),r(bA)}}return t.wait=new Promise(e),t}var UL=class{constructor({loop:t,nodeFinished:e}){d(this,"nodeFinished");d(this,"loop");this.loop=t,this.nodeFinished=e}async tick(t={}){let{timeout:e,retryPolicy:r,onStepWrite:n,maxConcurrency:i}=t,o=new Set,a,s=new AbortController,c=s.signal,u=e?AbortSignal.timeout(e):void 0,l=Object.values(this.loop.tasks).filter(h=>h.writes.length===0),{signals:p,disposeCombinedSignal:f}=this._initializeAbortSignals({exceptionSignal:c,stepTimeoutSignal:u,signal:t.signal}),m=this._executeTasksWithRetry(l,{signals:p,retryPolicy:r,maxConcurrency:i});for await(let{task:h,error:g,signalAborted:x}of m)this._commit(h,g),xi(g)||oa(g)&&!xi(a)?a=g:g&&(o.size===0||!x)&&(s.abort(),o.add(g));if(f?.(),n?.(this.loop.step,Object.values(this.loop.tasks).map(h=>h.writes).flat()),o.size===1)throw Array.from(o)[0];if(o.size>1)throw new AggregateError(Array.from(o),`Multiple errors occurred during superstep ${this.loop.step}. See the "errors" field of this exception for more details.`);if(xi(a)||oa(a)&&this.loop.isNested)throw a}_initializeAbortSignals({exceptionSignal:t,stepTimeoutSignal:e,signal:r}){let n=this.loop.config.configurable?.[tA]??{},i=n.externalAbortSignal??r,o=e??n.timeoutAbortSignal,{signal:a,dispose:s}=Qu(i,o,t),c={externalAbortSignal:i,timeoutAbortSignal:o,composedAbortSignal:a};return this.loop.config=Wr(this.loop.config,{[tA]:c}),{signals:c,disposeCombinedSignal:s}}async*_executeTasksWithRetry(t,e){let{retryPolicy:r,maxConcurrency:n,signals:i}=e??{},o=k8(),a={},s={executingTasksMap:a,barrier:o,retryPolicy:r,scheduleTask:async(f,m,h)=>this.loop.acceptPush(f,m,h)};if(i?.composedAbortSignal?.aborted)throw new Error("Abort");let c=0,u,l=Qu(i?.externalAbortSignal,i?.timeoutAbortSignal),p=l.signal?new Promise((f,m)=>{u=()=>m(new Error("Abort")),l.signal?.addEventListener("abort",u,{once:!0})}):void 0;for(;(c===0||Object.keys(a).length>0)&&t.length;){for(;Object.values(a).length<(n??t.length)&&c<t.length;c+=1){let m=t[c];a[m.id]=vA(m,r,{[Hd]:FL?.bind(s,this,m)},i?.composedAbortSignal).catch(h=>({task:m,error:h,signalAborted:i?.composedAbortSignal?.aborted}))}let f=await Promise.race([...Object.values(a),...p?[p]:[],o.wait]);f!==bA&&(yield f,u!=null&&(l.signal?.removeEventListener("abort",u),l.dispose?.()),delete a[f.task.id])}}_commit(t,e){if(e!==void 0)if(xi(e)){if(e.interrupts.length){let r=e.interrupts.map(i=>[Te,i]),n=t.writes.filter(i=>i[0]===jt);n.length&&r.push(...n),this.loop.putWrites(t.id,r)}}else oa(e)&&t.writes.length?this.loop.putWrites(t.id,t.writes):this.loop.putWrites(t.id,[[Nt,{message:e.message,name:e.name}]]);else this.nodeFinished&&(t.config?.tags==null||!t.config.tags.includes(Ke))&&this.nodeFinished(String(t.name)),t.writes.length===0&&t.writes.push([qd,null]),this.loop.putWrites(t.id,t.writes)}};async function FL(t,e,r,n,i,o={}){let a=e.config?.configurable?.[cn];if(!a)throw new Error(`BUG: No scratchpad found on task ${e.name}__${e.id}`);let s=a.callCounter;a.callCounter+=1;let c=new SL({func:r,name:n,input:i,cache:o.cache,retry:o.retry,callbacks:o.callbacks}),u=await this.scheduleTask(e,s,c);if(!u)return;let l=this.executingTasksMap[u.id];if(l!==void 0)return l;if(u.writes.length>0){let p=u.writes.filter(([m])=>m===oi),f=u.writes.filter(([m])=>m===Nt);if(p.length>0){if(p.length===1)return Promise.resolve(p[0][1]);throw new Error(`BUG: multiple returns found for task ${u.name}__${u.id}`)}if(f.length>0){if(f.length===1){let m=f[0][1],h=m instanceof Error?m:new Error(String(m));return Promise.reject(h)}throw new Error(`BUG: multiple errors found for task ${u.name}__${u.id}`)}return}else{let p=vA(u,o.retry,{[Hd]:FL.bind(this,t,u)});return this.executingTasksMap[u.id]=p,this.barrier.next(),p.then(({result:f,error:m})=>m?Promise.reject(m):f)}}var Oo=class extends Error{constructor(t){super(t),this.name="GraphValidationError"}};function BL({nodes:t,channels:e,inputChannels:r,outputChannels:n,streamChannels:i,interruptAfterNodes:o,interruptBeforeNodes:a}){if(!e)throw new Oo("Channels not provided");let s=new Set,c=new Set;for(let[u,l]of Object.entries(t)){if(u===Te)throw new Oo(`"Node name ${Te} is reserved"`);if(l.constructor===si)l.triggers.forEach(p=>s.add(p));else throw new Oo(`Invalid node type ${typeof l}, expected PregelNode`)}for(let u of s)if(!(u in e))throw new Oo(`Subscribed channel '${String(u)}' not in channels`);if(Array.isArray(r)){if(r.every(u=>!s.has(u)))throw new Oo(`None of the input channels ${r} are subscribed to by any node`)}else if(!s.has(r))throw new Oo(`Input channel ${String(r)} is not subscribed to by any node`);Array.isArray(n)?n.forEach(u=>c.add(u)):c.add(n),i&&!Array.isArray(i)?c.add(i):Array.isArray(i)&&i.forEach(u=>c.add(u));for(let u of c)if(!(u in e))throw new Oo(`Output channel '${String(u)}' not in channels`);if(o&&o!=="*"){for(let u of o)if(!(u in t))throw new Oo(`Node ${String(u)} not in nodes`)}if(a&&a!=="*"){for(let u of a)if(!(u in t))throw new Oo(`Node ${String(u)} not in nodes`)}}function wA(t,e){if(Array.isArray(t)){for(let r of t)if(!(r in e))throw new Error(`Key ${String(r)} not found in channels`)}else if(!(t in e))throw new Error(`Key ${String(t)} not found in channels`)}var xA=class VL extends Mt{constructor(r){super();d(this,"lc_graph_name","Topic");d(this,"unique",!1);d(this,"accumulate",!1);d(this,"seen");d(this,"values");this.unique=r?.unique??this.unique,this.accumulate=r?.accumulate??this.accumulate,this.seen=new Set,this.values=[]}fromCheckpoint(r){let n=new VL({unique:this.unique,accumulate:this.accumulate});return typeof r<"u"&&(n.seen=new Set(r[0]),n.values=r[1]),n}update(r){let n=!1;this.accumulate||(n=this.values.length>0,this.values=[]);let i=r.flat();if(i.length>0)if(this.unique)for(let o of i)this.seen.has(o)||(n=!0,this.seen.add(o),this.values.push(o));else n=!0,this.values.push(...i);return n}get(){if(this.values.length===0)throw new He;return this.values}checkpoint(){return[[...this.seen],this.values]}isAvailable(){return this.values.length!==0}};var ZL=class{static subscribeTo(t,e){let{key:r,tags:n}={key:void 0,tags:void 0,...e??{}};if(Array.isArray(t)&&r!==void 0)throw new Error("Can't specify a key when subscribing to multiple channels");let i;return typeof t=="string"?r?i={[r]:t}:i=[t]:i=Object.fromEntries(t.map(o=>[o,o])),new si({channels:i,triggers:Array.isArray(t)?t:[t],tags:n})}static writeTo(t,e){let r=[];for(let n of t)r.push({channel:n,value:Kr,skipNone:!1});for(let[n,i]of Object.entries(e??{}))pe.isRunnable(i)||typeof i=="function"?r.push({channel:n,value:Kr,skipNone:!0,mapper:ht(i)}):r.push({channel:n,value:i,skipNone:!1});return new wt(r)}},E8=class extends pe{constructor(){super(...arguments);d(this,"lc_namespace",["langgraph","pregel"])}invoke(e,r){throw new Error("Not implemented")}withConfig(e){return super.withConfig(e)}stream(e,r){return super.stream(e,r)}},uy=class extends E8{constructor(e){super(e);d(this,"lc_namespace",["langgraph","pregel"]);d(this,"lg_is_pregel",!0);d(this,"nodes");d(this,"channels");d(this,"inputChannels");d(this,"outputChannels");d(this,"autoValidate",!0);d(this,"streamMode",["values"]);d(this,"streamChannels");d(this,"interruptAfter");d(this,"interruptBefore");d(this,"stepTimeout");d(this,"debug",!1);d(this,"checkpointer");d(this,"retryPolicy");d(this,"config");d(this,"store");d(this,"cache");d(this,"userInterrupt");d(this,"triggerToNodes",{});let{streamMode:r}=e;if(r!=null&&!Array.isArray(r)&&(r=[r]),this.nodes=e.nodes,this.channels=e.channels,Ht in this.channels&&"lc_graph_name"in this.channels[Ht]&&this.channels[Ht].lc_graph_name!=="Topic")throw new Error(`Channel '${Ht}' is reserved and cannot be used in the graph.`);this.channels[Ht]=new xA({accumulate:!1}),this.autoValidate=e.autoValidate??this.autoValidate,this.streamMode=r??this.streamMode,this.inputChannels=e.inputChannels,this.outputChannels=e.outputChannels,this.streamChannels=e.streamChannels??this.streamChannels,this.interruptAfter=e.interruptAfter,this.interruptBefore=e.interruptBefore,this.stepTimeout=e.stepTimeout??this.stepTimeout,this.debug=e.debug??this.debug,this.checkpointer=e.checkpointer,this.retryPolicy=e.retryPolicy,this.config=e.config,this.store=e.store,this.cache=e.cache,this.name=e.name,this.triggerToNodes=e.triggerToNodes??this.triggerToNodes,this.userInterrupt=e.userInterrupt,this.autoValidate&&this.validate()}static lc_name(){return"LangGraph"}withConfig(e){let r=Bt(this.config,e);return new this.constructor({...this,config:r})}validate(){var e;BL({nodes:this.nodes,channels:this.channels,outputChannels:this.outputChannels,inputChannels:this.inputChannels,streamChannels:this.streamChannels,interruptAfterNodes:this.interruptAfter,interruptBeforeNodes:this.interruptBefore});for(let[r,n]of Object.entries(this.nodes))for(let i of n.triggers)(e=this.triggerToNodes)[i]??(e[i]=[]),this.triggerToNodes[i].push(r);return this}get streamChannelsList(){return Array.isArray(this.streamChannels)?this.streamChannels:this.streamChannels?[this.streamChannels]:Object.keys(this.channels)}get streamChannelsAsIs(){return this.streamChannels?this.streamChannels:Object.keys(this.channels)}async getGraphAsync(e){return this.getGraph(e)}*getSubgraphs(e,r){for(let[n,i]of Object.entries(this.nodes)){if(e!==void 0&&!e.startsWith(n))continue;let o=i.subgraphs?.length?i.subgraphs:[i.bound];for(let a of o){let s=ty(a);if(s!==void 0){if(n===e){yield[n,s];return}if(e===void 0&&(yield[n,s]),r){let c=e;e!==void 0&&(c=e.slice(n.length+1));for(let[u,l]of s.getSubgraphs(c,r))yield[`${n}${ot}${u}`,l]}}}}}async*getSubgraphsAsync(e,r){yield*this.getSubgraphs(e,r)}async _prepareStateSnapshot({config:e,saved:r,subgraphCheckpointer:n,applyPendingWrites:i=!1}){if(r===void 0)return{values:{},next:[],config:e,tasks:[]};let o=Ta(this.channels,r.checkpoint);if(r.pendingWrites?.length){let f=r.pendingWrites.filter(([m,h])=>m===dr).map(([m,h,g])=>[String(h),g]);f.length>0&&Nr(r.checkpoint,o,[{name:ni,writes:f,triggers:[]}],void 0,this.triggerToNodes)}let a=Object.values(Pa(r.checkpoint,r.pendingWrites,this.nodes,o,r.config,!0,{step:(r.metadata?.step??-1)+1,store:this.store})),s=await ai(this.getSubgraphsAsync()),c=r.config.configurable?.checkpoint_ns??"",u={};for(let f of a){let m=s.find(([g])=>g===f.name);if(!m)continue;let h=`${String(f.name)}${Pr}${f.id}`;if(c&&(h=`${c}${ot}${h}`),n===void 0){let g={configurable:{thread_id:r.config.configurable?.thread_id,checkpoint_ns:h}};u[f.id]=g}else{let g={configurable:{[gt]:n,thread_id:r.config.configurable?.thread_id,checkpoint_ns:h}},x=m[1];u[f.id]=await x.getState(g,{subgraphs:!0})}}if(i&&r.pendingWrites?.length){let f=Object.fromEntries(a.map(h=>[h.id,h]));for(let[h,g,x]of r.pendingWrites)[Nt,Te,us].includes(g)||h in f&&f[h].writes.push([String(g),x]);let m=a.filter(h=>h.writes.length>0);m.length>0&&Nr(r.checkpoint,o,m,void 0,this.triggerToNodes)}let l=r?.metadata;l&&r?.config?.configurable?.thread_id&&(l={...l,thread_id:r.config.configurable.thread_id});let p=a.filter(f=>f.writes.length===0).map(f=>f.name);return{values:ci(o,this.streamChannelsAsIs),next:p,tasks:mA(a,r?.pendingWrites??[],u,this.streamChannelsAsIs),metadata:l,config:Ca(r.config,r.metadata),createdAt:r.checkpoint.ts,parentConfig:r.parentConfig}}async getState(e,r){let n=e.configurable?.[gt]??this.checkpointer;if(!n)throw new ia("No checkpointer set",{lc_error_code:"MISSING_CHECKPOINTER"});let i=e.configurable?.checkpoint_ns??"";if(i!==""&&e.configurable?.[gt]===void 0){let s=H_(i);for await(let[c,u]of this.getSubgraphsAsync(s,!0))if(c===s)return await u.getState(Ys(e,{[gt]:n}),{subgraphs:r?.subgraphs});throw new Error(`Subgraph with namespace "${s}" not found.`)}let o=Bt(this.config,e),a=await n.getTuple(e);return await this._prepareStateSnapshot({config:o,saved:a,subgraphCheckpointer:r?.subgraphs?n:void 0,applyPendingWrites:!e.configurable?.checkpoint_id})}async*getStateHistory(e,r){let n=e.configurable?.[gt]??this.checkpointer;if(!n)throw new ia("No checkpointer set",{lc_error_code:"MISSING_CHECKPOINTER"});let i=e.configurable?.checkpoint_ns??"";if(i!==""&&e.configurable?.[gt]===void 0){let a=H_(i);for await(let[s,c]of this.getSubgraphsAsync(a,!0))if(s===a){yield*c.getStateHistory(Ys(e,{[gt]:n}),r);return}throw new Error(`Subgraph with namespace "${a}" not found.`)}let o=Bt(this.config,e,{configurable:{checkpoint_ns:i}});for await(let a of n.list(o,r))yield this._prepareStateSnapshot({config:a.config,saved:a})}async bulkUpdateState(e,r){let n=e.configurable?.[gt]??this.checkpointer;if(!n)throw new ia("No checkpointer set",{lc_error_code:"MISSING_CHECKPOINTER"});if(r.length===0)throw new Error("No supersteps provided");if(r.some(s=>s.updates.length===0))throw new Error("No updates provided");let i=e.configurable?.checkpoint_ns??"";if(i!==""&&e.configurable?.[gt]===void 0){let s=H_(i);for await(let[,c]of this.getSubgraphsAsync(s,!0))return await c.bulkUpdateState(Ys(e,{[gt]:n}),r);throw new Error(`Subgraph "${s}" not found`)}let o=async(s,c)=>{let u=this.config?Bt(this.config,s):s,l=await n.getTuple(u),p=l!==void 0?ei(l.checkpoint):qs(),f={...l?.checkpoint.channel_versions},m=l?.metadata?.step??-1,h=Ys(u,{checkpoint_ns:u.configurable?.checkpoint_ns??""}),g=u.metadata??{};l?.config.configurable&&(h=Ys(u,l.config.configurable),g={...l.metadata,...g});let{values:x,asNode:y}=c[0];if(x==null&&y===void 0){if(c.length>1)throw new Me("Cannot create empty checkpoint with multiple updates");return Ca(await n.put(h,ti(p,void 0,m),{source:"update",step:m+1,parents:l?.metadata?.parents??{}},{}),l?l.metadata:void 0)}let v=Ta(this.channels,p);if(x===null&&y===Ie){if(c.length>1)throw new Me("Cannot apply multiple updates when clearing state");if(l){let w=Pa(p,l.pendingWrites||[],this.nodes,v,l.config,!0,{step:(l.metadata?.step??-1)+1,checkpointer:n,store:this.store}),V=(l.pendingWrites||[]).filter(F=>F[0]===dr).map(F=>F.slice(1));V.length>0&&Nr(p,v,[{name:ni,writes:V,triggers:[]}],n.getNextVersion.bind(n),this.triggerToNodes);for(let[F,R,ve]of l.pendingWrites||[])[Nt,Te,us].includes(R)||F in w&&w[F].writes.push([R,ve]);Nr(p,v,Object.values(w),n.getNextVersion.bind(n),this.triggerToNodes)}return Ca(await n.put(h,ti(p,v,m),{...g,source:"update",step:m+1,parents:l?.metadata?.parents??{}},Yu(f,p.channel_versions)),l?l.metadata:void 0)}if(y===tL){if(c.length>1)throw new Me("Cannot copy checkpoint with multiple updates");if(l==null)throw new Me("Cannot copy a non-existent checkpoint");let w=R=>!Array.isArray(R)||R.length===0?!1:R.every(ve=>Array.isArray(ve)&&ve.length===2),V=ti(p,void 0,m),F=await n.put(l.parentConfig??Ys(l.config,{checkpoint_id:void 0}),V,{source:"fork",step:m+1,parents:l.metadata?.parents??{}},{});if(w(x)){let R=Pa(V,l.pendingWrites,this.nodes,v,F,!1,{step:m+2}),ve=Object.values(R).reduce((Ze,{name:Qt,id:Fe})=>(Ze[Qt]??(Ze[Qt]=[]),Ze[Qt].push({id:Fe}),Ze),{}),We=x.reduce((Ze,Qt)=>{let[Fe,Jr]=Qt;Ze[Jr]??(Ze[Jr]=[]);let eo=Ze[Jr].length,to=ve[Jr]?.[eo]?.id;return Ze[Jr].push({values:Fe,asNode:Jr,taskId:to}),Ze},{});return o(Ca(F,l.metadata),Object.values(We).flat())}return Ca(F,l.metadata)}if(y===ni){if(c.length>1)throw new Me("Cannot apply multiple updates when updating as input");let w=await ai(ry(this.inputChannels,x));if(w.length===0)throw new Me(`Received no input writes for ${JSON.stringify(this.inputChannels,null,2)}`);Nr(p,v,[{name:ni,writes:w,triggers:[]}],n.getNextVersion.bind(this.checkpointer),this.triggerToNodes);let V=l?.metadata?.step!=null?l.metadata.step+1:-1,F=await n.put(h,ti(p,v,V),{source:"input",step:V,parents:l?.metadata?.parents??{}},Yu(f,p.channel_versions));return await n.putWrites(F,w,po(ni,p.id)),Ca(F,l?l.metadata:void 0)}if(u.configurable?.checkpoint_id===void 0&&l?.pendingWrites!==void 0&&l.pendingWrites.length>0){let w=Pa(p,l.pendingWrites,this.nodes,v,l.config,!0,{store:this.store,checkpointer:this.checkpointer,step:(l.metadata?.step??-1)+1}),V=(l.pendingWrites??[]).filter(R=>R[0]===dr).map(R=>R.slice(1));V.length>0&&Nr(l.checkpoint,v,[{name:ni,writes:V,triggers:[]}],void 0,this.triggerToNodes);for(let[R,ve,We]of l.pendingWrites)[Nt,Te,us].includes(ve)||w[R]===void 0||w[R].writes.push([ve,We]);let F=Object.values(w).filter(R=>R.writes.length>0);F.length>0&&Nr(p,v,F,void 0,this.triggerToNodes)}let S=Object.values(p.versions_seen).map(w=>Object.values(w)).flat().find(w=>!!w),k=[];if(c.length===1){let{values:w,asNode:V,taskId:F}=c[0];if(V===void 0&&Object.keys(this.nodes).length===1)[V]=Object.keys(this.nodes);else if(V===void 0&&S===void 0)typeof this.inputChannels=="string"&&this.nodes[this.inputChannels]!==void 0&&(V=this.inputChannels);else if(V===void 0){let R=Object.entries(p.versions_seen).map(([ve,We])=>Object.values(We).map(Ze=>[Ze,ve])).flat().filter(([ve,We])=>We!==Te).sort(([ve],[We])=>D_(ve,We));R&&(R.length===1?V=R[0][1]:R[R.length-1][0]!==R[R.length-2][0]&&(V=R[R.length-1][1]))}if(V===void 0)throw new Me('Ambiguous update, specify "asNode"');k.push({values:w,asNode:V,taskId:F})}else for(let{asNode:w,values:V,taskId:F}of c){if(w==null)throw new Me('"asNode" is required when applying multiple updates');k.push({values:V,asNode:w,taskId:F})}let T=[];for(let{asNode:w,values:V,taskId:F}of k){if(this.nodes[w]===void 0)throw new Me(`Node "${w.toString()}" does not exist`);let R=this.nodes[w].getWriters();if(!R.length)throw new Me(`No writers found for node "${w.toString()}"`);T.push({name:w,input:V,proc:R.length>1?Tr.from(R,{omitSequenceTags:!0}):R[0],writes:[],triggers:[Te],id:F??po(Te,p.id),writers:[]})}for(let w of T)await w.proc.invoke(w.input,ze({...u,store:u?.store??this.store},{runName:u.runName??`${this.getName()}UpdateState`,configurable:{[Rn]:V=>w.writes.push(...V),[ii]:(V,F=!1)=>Yd(p,v,w,V,F)}}));for(let w of T){let V=w.writes.filter(F=>F[0]!==pr);l!==void 0&&V.length>0&&await n.putWrites(h,V,w.id)}Nr(p,v,T,n.getNextVersion.bind(this.checkpointer),this.triggerToNodes);let N=Yu(f,p.channel_versions),U=await n.put(h,ti(p,v,m+1),{source:"update",step:m+1,parents:l?.metadata?.parents??{}},N);for(let w of T){let V=w.writes.filter(F=>F[0]===pr);V.length>0&&await n.putWrites(U,V,w.id)}return Ca(U,l?l.metadata:void 0)},a=e;for(let{updates:s}of r)a=await o(a,s);return a}async updateState(e,r,n){return this.bulkUpdateState(e,[{updates:[{values:r,asNode:n}]}])}_defaults(e){let{debug:r,streamMode:n,inputKeys:i,outputKeys:o,interruptAfter:a,interruptBefore:s,...c}=e,u=!0,l=r!==void 0?r:this.debug,p=o;p===void 0?p=this.streamChannelsAsIs:wA(p,this.channels);let f=i;f===void 0?f=this.inputChannels:wA(f,this.channels);let m=s??this.interruptBefore??[],h=a??this.interruptAfter??[],g;n!==void 0?(g=Array.isArray(n)?n:[n],u=typeof n=="string"):(e.configurable?.[Ks]!==void 0?g=["values"]:g=this.streamMode,u=!0);let x;if(this.checkpointer===!1)x=void 0;else if(e!==void 0&&e.configurable?.[gt]!==void 0)x=e.configurable[gt];else{if(this.checkpointer===!0)throw new Error("checkpointer: true cannot be used for root graphs.");x=this.checkpointer}let y=e.store??this.store,v=e.cache??this.cache;if(e.durability!=null&&e.checkpointDuring!=null)throw new Error("Cannot use both `durability` and `checkpointDuring` at the same time.");let S=(()=>{if(e.checkpointDuring!=null)return e.checkpointDuring===!1?"exit":"async"})(),k=e.durability??S??e?.configurable?.[eA]??"async";return[l,g,f,p,c,m,h,x,y,u,v,k]}async stream(e,r){let n=new AbortController,i={recursionLimit:this.config?.recursionLimit,...r,signal:Qu(r?.signal,n.signal).signal},o=await super.stream(e,i);return new gA(r?.encoding==="text/event-stream"?zL(o):o,n)}streamEvents(e,r,n){let i=new AbortController,o={recursionLimit:this.config?.recursionLimit,...r,callbacks:xL(this.config?.callbacks,r?.callbacks),signal:Qu(r?.signal,i.signal).signal};return new gA(super.streamEvents(e,o,n),i)}async _validateInput(e){return e}async _validateContext(e){return e}async*_streamIterator(e,r){let n="version"in(r??{})?void 0:r?.encoding??void 0,i=r?.subgraphs,o=Wd(this.config,r);if(o.recursionLimit===void 0||o.recursionLimit<1)throw new Error('Passed "recursionLimit" must be at least 1.');if(this.checkpointer!==void 0&&this.checkpointer!==!1&&o.configurable===void 0)throw new Error('Checkpointer requires one or more of the following "configurable" keys: "thread_id", "checkpoint_ns", "checkpoint_id"');let a=await this._validateInput(e),{runId:s,...c}=o,[u,l,,p,f,m,h,g,x,y,v,S]=this._defaults(c);typeof f.context<"u"?f.context=await this._validateContext(f.context):f.configurable=await this._validateContext(f.configurable);let k=new sy({modes:new Set(l)});if(this.checkpointer===!0){f.configurable??(f.configurable={});let R=f.configurable[un]??"";f.configurable[un]=R.split(ot).map(ve=>ve.split(Pr)[0]).join(ot)}if(l.includes("messages")){let R=new LL(We=>k.push(We)),{callbacks:ve}=f;if(ve===void 0)f.callbacks=[R];else if(Array.isArray(ve))f.callbacks=ve.concat(R);else{let We=ve.copy();We.addHandler(R,!0),f.callbacks=We}}f.writer??(f.writer=R=>{if(!l.includes("custom"))return;let ve=nA()?.configurable?.[un]?.split(ot).slice(0,-1);k.push([ve??[],"custom",R])}),f.interrupt??(f.interrupt=this.userInterrupt??sA);let T=await(await Ft(f))?.handleChainStart(this.toJSON(),wL(e,"input"),s,void 0,void 0,void 0,f?.runName??this.getName()),N=Zd(this.channels),U,w,F=(async()=>{try{U=await jL.initialize({input:a,config:f,checkpointer:g,nodes:this.nodes,channelSpecs:N,outputKeys:p,streamKeys:this.streamChannelsAsIs,store:x,cache:v,stream:k,interruptAfter:h,interruptBefore:m,manager:T,debug:this.debug,triggerToNodes:this.triggerToNodes,durability:S});let R=new UL({loop:U,nodeFinished:f.configurable?.[rL]});r?.subgraphs&&(U.config.configurable={...U.config.configurable,[Gu]:U.stream}),await this._runLoop({loop:U,runner:R,debug:u,config:f}),S==="sync"&&await Promise.all(U?.checkpointerPromises??[])}catch(R){w=R}finally{try{U&&(await U.store?.stop(),await U.cache?.stop()),await Promise.all(U?.checkpointerPromises??[])}catch(R){w=w??R}w?k.error(w):k.close()}})();try{for await(let R of k){if(R===void 0)throw new Error("Data structure error.");let[ve,We,Ze]=R;if(l.includes(We)){if(n==="text/event-stream"){i?yield[ve,We,Ze]:yield[null,We,Ze];continue}i&&!y?yield[ve,We,Ze]:y?i?yield[ve,Ze]:yield Ze:yield[We,Ze]}}}catch(R){throw await T?.handleChainError(w),R}finally{await F}await T?.handleChainEnd(U?.output??{},s,void 0,void 0,void 0)}async invoke(e,r){let n=r?.streamMode??"values",i={...r,outputKeys:r?.outputKeys??this.outputChannels,streamMode:n,encoding:void 0},o=[],a=await this.stream(e,i),s=[],c;for await(let u of a)n==="values"?Ku(u)?s.push(u[Te]):c=u:o.push(u);if(n==="values"){if(s.length>0){let u=s.flat(1);if(c==null)return{[Te]:u};if(typeof c=="object")return{...c,[Te]:u}}return c}return o}async _runLoop(e){let{loop:r,runner:n,debug:i,config:o}=e,a;try{for(;await r.tick({inputKeys:this.inputChannels});){for(let{task:s}of await r._matchCachedWrites())r._outputWrites(s.id,s.writes,!0);i&&PL(r.checkpointMetadata.step,r.channels,this.streamChannelsList),i&&ay(r.step,Object.values(r.tasks)),await n.tick({timeout:this.stepTimeout,retryPolicy:this.retryPolicy,onStepWrite:(s,c)=>{i&&NL(s,c,this.streamChannelsList)},maxConcurrency:o.maxConcurrency,signal:o.signal})}if(r.status==="out_of_steps")throw new Fm([`Recursion limit of ${o.recursionLimit} reached`,"without hitting a stop condition. You can increase the",'limit by setting the "recursionLimit" config key.'].join(" "),{lc_error_code:"GRAPH_RECURSION_LIMIT"})}catch(s){if(a=s,!await r.finishAndHandleError(a))throw s}finally{a===void 0&&await r.finishAndHandleError()}}async clearCache(){await this.cache?.clear([])}};var ui=class GL extends Mt{constructor(r=!0){super();d(this,"lc_graph_name","EphemeralValue");d(this,"guard");d(this,"value",[]);this.guard=r}fromCheckpoint(r){let n=new GL(this.guard);return typeof r<"u"&&(n.value=[r]),n}update(r){if(r.length===0){let n=this.value.length>0;return this.value=[],n}if(r.length!==1&&this.guard)throw new Me("EphemeralValue can only receive one value per step.");return this.value=[r[r.length-1]],!0}get(){if(this.value.length===0)throw new He;return this.value[0]}checkpoint(){if(this.value.length===0)throw new He;return this.value[0]}isAvailable(){return this.value.length!==0}};var SA=class{constructor(t){d(this,"path");d(this,"ends");pe.isRunnable(t.path)?this.path=t.path:this.path=ht(t.path).withConfig({runName:"Branch"}),this.ends=Array.isArray(t.pathMap)?t.pathMap.reduce((e,r)=>(e[r]=r,e),{}):t.pathMap}run(t,e){return wt.registerWriter(new fr({name:"<branch_run>",trace:!1,func:async(r,n)=>{try{return await this._route(r,n,t,e)}catch(i){throw i.name===Ip.unminifiable_name&&console.warn(`[WARN]: 'NodeInterrupt' thrown in conditional edge. This is likely a bug in your graph implementation.
NodeInterrupt should only be thrown inside a node, not in edge conditions.`),i}}}))}async _route(t,e,r,n){let i=await this.path.invoke(n?n(e):t,e);Array.isArray(i)||(i=[i]);let o;if(this.ends?o=i.map(a=>Rt(a)?a:this.ends[a]):o=i,o.some(a=>!a))throw new Error("Branch condition returned unknown or null destination");if(o.filter(Rt).some(a=>a.node===Ie))throw new Me("Cannot send a packet to the END node");return await r(o,e)??t}},ly=class{constructor(){d(this,"nodes");d(this,"edges");d(this,"branches");d(this,"entryPoint");d(this,"compiled",!1);this.nodes={},this.edges=new Set,this.branches={}}warnIfCompiled(t){this.compiled&&console.warn(t)}get allEdges(){return this.edges}addNode(...t){function e(n){return n.length>=1&&typeof n[0]!="string"}let r=e(t)?Array.isArray(t[0])?t[0]:Object.entries(t[0]):[[t[0],t[1],t[2]]];if(r.length===0)throw new Error("No nodes provided in `addNode`");for(let[n,i,o]of r){for(let s of[ot,Pr])if(n.includes(s))throw new Error(`"${s}" is a reserved character and is not allowed in node names.`);if(this.warnIfCompiled("Adding a node to a graph that has already been compiled. This will not be reflected in the compiled graph."),n in this.nodes)throw new Error(`Node \`${n}\` already present.`);if(n===Ie)throw new Error(`Node \`${n}\` is reserved.`);let a=ht(i);this.nodes[n]={runnable:a,metadata:o?.metadata,subgraphs:Xd(a)?[a]:o?.subgraphs,ends:o?.ends}}return this}addEdge(t,e){if(this.warnIfCompiled("Adding an edge to a graph that has already been compiled. This will not be reflected in the compiled graph."),t===Ie)throw new Error("END cannot be a start node");if(e===$e)throw new Error("START cannot be an end node");if(Array.from(this.edges).some(([r])=>r===t)&&!("channels"in this))throw new Error(`Already found path for ${t}. For multiple edges, use StateGraph.`);return this.edges.add([t,e]),this}addConditionalEdges(t,e,r){var o,a;let n=typeof t=="object"?t:{source:t,path:e,pathMap:r};if(this.warnIfCompiled("Adding an edge to a graph that has already been compiled. This will not be reflected in the compiled graph."),!pe.isRunnable(n.path)){let s=Array.isArray(n.pathMap)?n.pathMap.join(","):Object.keys(n.pathMap??{}).join(",");n.path=ht(n.path).withConfig({runName:`Branch<${n.source}${s!==""?`,${s}`:""}>`.slice(0,63)})}let i=n.path.getName()==="RunnableLambda"?"condition":n.path.getName();if(this.branches[n.source]&&this.branches[n.source][i])throw new Error(`Condition \`${i}\` already present for node \`${t}\``);return(o=this.branches)[a=n.source]??(o[a]={}),this.branches[n.source][i]=new SA(n),this}setEntryPoint(t){return this.warnIfCompiled("Setting the entry point of a graph that has already been compiled. This will not be reflected in the compiled graph."),this.addEdge($e,t)}setFinishPoint(t){return this.warnIfCompiled("Setting a finish point of a graph that has already been compiled. This will not be reflected in the compiled graph."),this.addEdge(t,Ie)}compile({checkpointer:t,interruptBefore:e,interruptAfter:r,name:n}={}){this.validate([...Array.isArray(e)?e:[],...Array.isArray(r)?r:[]]);let i=new IA({builder:this,checkpointer:t,interruptAfter:r,interruptBefore:e,autoValidate:!1,nodes:{},channels:{[$e]:new ui,[Ie]:new ui},inputChannels:$e,outputChannels:Ie,streamChannels:[],streamMode:"values",name:n});for(let[o,a]of Object.entries(this.nodes))i.attachNode(o,a);for(let[o,a]of this.edges)i.attachEdge(o,a);for(let[o,a]of Object.entries(this.branches))for(let[s,c]of Object.entries(a))i.attachBranch(o,s,c);return i.validate()}validate(t){let e=new Set([...this.allEdges].map(([n,i])=>n));for(let[n]of Object.entries(this.branches))e.add(n);for(let n of e)if(n!==$e&&!(n in this.nodes))throw new Error(`Found edge starting at unknown node \`${n}\``);let r=new Set([...this.allEdges].map(([n,i])=>i));for(let[n,i]of Object.entries(this.branches))for(let o of Object.values(i))if(o.ends!=null)for(let a of Object.values(o.ends))r.add(a);else{r.add(Ie);for(let a of Object.keys(this.nodes))a!==n&&r.add(a)}for(let n of Object.values(this.nodes))for(let i of n.ends??[])r.add(i);for(let n of Object.keys(this.nodes))if(!r.has(n))throw new Vm([`Node \`${n}\` is not reachable.`,"","If you are returning Command objects from your node,",'make sure you are passing names of potential destination nodes as an "ends" array','into ".addNode(..., { ends: ["node1", "node2"] })".'].join(`
`),{lc_error_code:"UNREACHABLE_NODE"});for(let n of r)if(n!==Ie&&!(n in this.nodes))throw new Error(`Found edge ending at unknown node \`${n}\``);if(t){for(let n of t)if(!(n in this.nodes))throw new Error(`Interrupt node \`${n}\` is not present`)}this.compiled=!0}},IA=class extends uy{constructor({builder:e,...r}){super(r);d(this,"builder");this.builder=e}attachNode(e,r){this.channels[e]=new ui,this.nodes[e]=new si({channels:[],triggers:[],metadata:r.metadata,subgraphs:r.subgraphs,ends:r.ends}).pipe(r.runnable).pipe(new wt([{channel:e,value:Kr}],[Ke])),this.streamChannels.push(e)}attachEdge(e,r){if(r===Ie){if(e===$e)throw new Error("Cannot have an edge from START to END");this.nodes[e].writers.push(new wt([{channel:Ie,value:Kr}],[Ke]))}else this.nodes[r].triggers.push(e),this.nodes[r].channels.push(e)}attachBranch(e,r,n){e===$e&&!this.nodes[$e]&&(this.nodes[$e]=ZL.subscribeTo($e,{tags:[Ke]})),this.nodes[e].pipe(n.run(o=>new wt(o.map(a=>Rt(a)?a:{channel:a===Ie?Ie:`branch:${e}:${r}:${a}`,value:Kr}),[Ke])));let i=n.ends?Object.values(n.ends):Object.keys(this.nodes);for(let o of i)if(o!==Ie){let a=`branch:${e}:${r}:${o}`;this.channels[a]=new ui,this.nodes[o].triggers.push(a),this.nodes[o].channels.push(a)}}async getGraphAsync(e){let r=e?.xray,n=new Ds,i={[$e]:n.addNode({schema:K.any()},$e)},o={},a={};r&&(a=Object.fromEntries((await ai(this.getSubgraphsAsync())).filter(u=>HL(u[1]))));function s(u,l,p,f=!1){if(l===Ie&&o[Ie]===void 0&&(o[Ie]=n.addNode({schema:K.any()},Ie)),i[u]!==void 0){if(o[l]===void 0)throw new Error(`End node ${l} not found!`);return n.addEdge(i[u],o[l],p!==l?p:void 0,f)}}for(let[u,l]of Object.entries(this.builder.nodes)){let p=mr(u),f=l.runnable,m=l.metadata??{};if(this.interruptBefore?.includes(u)&&this.interruptAfter?.includes(u)?m.__interrupt="before,after":this.interruptBefore?.includes(u)?m.__interrupt="before":this.interruptAfter?.includes(u)&&(m.__interrupt="after"),r){let h=typeof r=="number"?r-1:r,g=a[u]!==void 0?await a[u].getGraphAsync({...e,xray:h}):f.getGraph(e);if(g.trimFirstNode(),g.trimLastNode(),Object.keys(g.nodes).length>1){let v=function(k){return k?k.lc_runnable:!1},S=function(k,T){if(k!==void 0&&!Un(k))return k;if(v(T))try{let N=T.getName();return N=N.startsWith("Runnable")?N.slice(8):N,N}catch{return T.getName()}else return T.name??"UnknownSchema"},[x,y]=n.extend(g,p);if(x===void 0)throw new Error(`Could not extend subgraph "${u}" due to missing entrypoint.`);y!==void 0&&(i[p]={name:S(y.id,y.data),...y}),o[p]={name:S(x.id,x.data),...x}}else{let x=n.addNode(f,p,m);i[p]=x,o[p]=x}}else{let h=n.addNode(f,p,m);i[p]=h,o[p]=h}}let c=[...this.builder.allEdges].sort(([u],[l])=>u<l?-1:l>u?1:0);for(let[u,l]of c)s(mr(u),mr(l));for(let[u,l]of Object.entries(this.builder.branches)){let p={...Object.fromEntries(Object.keys(this.builder.nodes).filter(f=>f!==u).map(f=>[mr(f),mr(f)])),[Ie]:Ie};for(let f of Object.values(l)){let m;f.ends!==void 0?m=f.ends:m=p;for(let[h,g]of Object.entries(m))s(mr(u),mr(g),h,!0)}}for(let[u,l]of Object.entries(this.builder.nodes))if(l.ends!==void 0)for(let p of l.ends)s(mr(u),mr(p),void 0,!0);return n}getGraph(e){let r=e?.xray,n=new Ds,i={[$e]:n.addNode({schema:K.any()},$e)},o={},a={};r&&(a=Object.fromEntries(Xs(this.getSubgraphs()).filter(u=>HL(u[1]))));function s(u,l,p,f=!1){return l===Ie&&o[Ie]===void 0&&(o[Ie]=n.addNode({schema:K.any()},Ie)),n.addEdge(i[u],o[l],p!==l?p:void 0,f)}for(let[u,l]of Object.entries(this.builder.nodes)){let p=mr(u),f=l.runnable,m=l.metadata??{};if(this.interruptBefore?.includes(u)&&this.interruptAfter?.includes(u)?m.__interrupt="before,after":this.interruptBefore?.includes(u)?m.__interrupt="before":this.interruptAfter?.includes(u)&&(m.__interrupt="after"),r){let h=typeof r=="number"?r-1:r,g=a[u]!==void 0?a[u].getGraph({...e,xray:h}):f.getGraph(e);if(g.trimFirstNode(),g.trimLastNode(),Object.keys(g.nodes).length>1){let v=function(k){return k?k.lc_runnable:!1},S=function(k,T){if(k!==void 0&&!Un(k))return k;if(v(T))try{let N=T.getName();return N=N.startsWith("Runnable")?N.slice(8):N,N}catch{return T.getName()}else return T.name??"UnknownSchema"},[x,y]=n.extend(g,p);if(x===void 0)throw new Error(`Could not extend subgraph "${u}" due to missing entrypoint.`);y!==void 0&&(i[p]={name:S(y.id,y.data),...y}),o[p]={name:S(x.id,x.data),...x}}else{let x=n.addNode(f,p,m);i[p]=x,o[p]=x}}else{let h=n.addNode(f,p,m);i[p]=h,o[p]=h}}let c=[...this.builder.allEdges].sort(([u],[l])=>u<l?-1:l>u?1:0);for(let[u,l]of c)s(mr(u),mr(l));for(let[u,l]of Object.entries(this.builder.branches)){let p={...Object.fromEntries(Object.keys(this.builder.nodes).filter(f=>f!==u).map(f=>[mr(f),mr(f)])),[Ie]:Ie};for(let f of Object.values(l)){let m;f.ends!==void 0?m=f.ends:m=p;for(let[h,g]of Object.entries(m))s(mr(u),mr(g),h,!0)}}return n}};function HL(t){return typeof t.attachNode=="function"&&typeof t.attachEdge=="function"}function mr(t){return t==="subgraph"?`"${t}"`:t}function Co(t){return typeof t=="object"&&t!==null&&"~standard"in t&&typeof t["~standard"]=="object"&&t["~standard"]!==null&&"validate"in t["~standard"]}function qL(t){return typeof t=="object"&&t!==null&&"~standard"in t&&typeof t["~standard"]=="object"&&t["~standard"]!==null&&"jsonSchema"in t["~standard"]}function Po(t){if(qL(t))try{return t["~standard"].jsonSchema.input({target:"draft-07"})}catch{return}}function No(t){if(t!=null&&Co(t))try{let e=t["~standard"].validate(void 0);if(e&&typeof e=="object"&&!("then"in e&&typeof e.then=="function")){let r=e;if(!r.issues){let n=r.value;return()=>n}}}catch{}}var kA=Symbol.for("langgraph.channel.missing"),rf=class KL extends Mt{constructor(r){super();d(this,"lc_graph_name","UntrackedValue");d(this,"guard");d(this,"_value",kA);d(this,"initialValueFactory");this.guard=r?.guard??!0,this.initialValueFactory=r?.initialValueFactory,this.initialValueFactory&&(this._value=this.initialValueFactory())}fromCheckpoint(r){return new KL({guard:this.guard,initialValueFactory:this.initialValueFactory})}update(r){if(r.length===0)return!1;if(r.length!==1&&this.guard)throw new Me("UntrackedValue(guard=true) can receive only one value per step. Use guard=false if you want to store any one of multiple values.",{lc_error_code:"INVALID_CONCURRENT_GRAPH_UPDATE"});return this._value=r[r.length-1],!0}get(){if(this._value===kA)throw new He;return this._value}checkpoint(){}isAvailable(){return this._value!==kA}};var EA=Symbol.for("langgraph.state.reduced_value"),WL,Bi=(WL=EA,class{constructor(t,e){d(this,WL,!0);d(this,"valueSchema");d(this,"inputSchema");d(this,"reducer");d(this,"jsonSchemaExtra");this.reducer=e.reducer,this.jsonSchemaExtra=e.jsonSchemaExtra,this.valueSchema=t,this.inputSchema="inputSchema"in e?e.inputSchema:t,this.jsonSchemaExtra=e.jsonSchemaExtra}static isInstance(t){return typeof t=="object"&&t!==null&&EA in t&&t[EA]===!0}});var JL=Symbol.for("langgraph.state.untracked_value"),XL,Na=(XL=JL,class{constructor(t,e){d(this,XL,!0);d(this,"schema");d(this,"guard");this.schema=t,this.guard=e?.guard??!0}static isInstance(t){return typeof t=="object"&&t!==null&&JL in t}});var Ra=(t,e)=>t.size===e.size&&[...t].every(r=>e.has(r)),AA=class YL extends Mt{constructor(r){super();d(this,"lc_graph_name","NamedBarrierValue");d(this,"names");d(this,"seen");this.names=r,this.seen=new Set}fromCheckpoint(r){let n=new YL(this.names);return typeof r<"u"&&(n.seen=new Set(r)),n}update(r){let n=!1;for(let i of r)if(this.names.has(i))this.seen.has(i)||(this.seen.add(i),n=!0);else throw new Me(`Value ${JSON.stringify(i)} not in names ${JSON.stringify(this.names)}`);return n}get(){if(!Ra(this.names,this.seen))throw new He}checkpoint(){return[...this.seen]}consume(){return this.seen&&this.names&&Ra(this.seen,this.names)?(this.seen=new Set,!0):!1}isAvailable(){return!!this.names&&Ra(this.names,this.seen)}},TA=class QL extends Mt{constructor(r){super();d(this,"lc_graph_name","NamedBarrierValueAfterFinish");d(this,"names");d(this,"seen");d(this,"finished");this.names=r,this.seen=new Set,this.finished=!1}fromCheckpoint(r){let n=new QL(this.names);if(typeof r<"u"){let[i,o]=r;n.seen=new Set(i),n.finished=o}return n}update(r){let n=!1;for(let i of r)if(this.names.has(i)&&!this.seen.has(i))this.seen.add(i),n=!0;else if(!this.names.has(i))throw new Me(`Value ${JSON.stringify(i)} not in names ${JSON.stringify(this.names)}`);return n}get(){if(!this.finished||!Ra(this.names,this.seen))throw new He}checkpoint(){return[[...this.seen],this.finished]}consume(){return this.finished&&this.seen&&this.names&&Ra(this.seen,this.names)?(this.seen=new Set,this.finished=!1,!0):!1}finish(){return!this.finished&&this.names&&Ra(this.names,this.seen)?(this.finished=!0,!0):!1}isAvailable(){return this.finished&&!!this.names&&Ra(this.names,this.seen)}};var $A=Symbol.for("langgraph.state.state_schema"),e4,nf=(e4=$A,class{constructor(t){d(this,e4,!0);this.init=t,this.init=t}getChannels(){let t={};for(let[e,r]of Object.entries(this.init))if(Bi.isInstance(r)){let n=No(r.valueSchema);t[e]=new Di(r.reducer,n)}else if(Na.isInstance(r)){let n=r.schema?No(r.schema):void 0;t[e]=new rf({guard:r.guard,initialValueFactory:n})}else if(Co(r))t[e]=new ri(No(r));else throw new Error(`Invalid state field "${e}": must be a schema, ReducedValue, UntrackedValue, or ManagedValue`);return t}getJsonSchema(){let t={},e=[];for(let[r,n]of Object.entries(this.init)){let i;if(Bi.isInstance(n)?(i=Po(n.valueSchema),i&&n.jsonSchemaExtra&&(i={...i,...n.jsonSchemaExtra})):Na.isInstance(n)?i=n.schema?Po(n.schema):void 0:Co(n)&&(i=Po(n)),i){t[r]=i;let o=!1;Bi.isInstance(n)?o=No(n.valueSchema)!==void 0:Na.isInstance(n)?o=n.schema?No(n.schema)!==void 0:!1:o=No(n)!==void 0,o||e.push(r)}}return{type:"object",properties:t,required:e.length>0?e:void 0}}getInputJsonSchema(){let t={};for(let[e,r]of Object.entries(this.init)){let n;Bi.isInstance(r)?n=Po(r.inputSchema):Na.isInstance(r)?n=r.schema?Po(r.schema):void 0:Co(r)&&(n=Po(r)),n&&(t[e]=n)}return{type:"object",properties:t}}getChannelKeys(){return Object.entries(this.init).map(([t])=>t)}getAllKeys(){return Object.keys(this.init)}async validateInput(t){if(t==null||typeof t!="object")return t;let e={};for(let[r,n]of Object.entries(t)){let i=this.init[r];if(i===void 0){e[r]=n;continue}let o;if(Bi.isInstance(i)?o=i.inputSchema:Na.isInstance(i)?o=i.schema:Co(i)&&(o=i),o){let a=await o["~standard"].validate(n);if(a.issues)throw new Error(`Validation failed for field "${r}": ${JSON.stringify(a.issues)}`);e[r]=a.value}else e[r]=n}return e}static isInstance(t){return typeof t=="object"&&t!==null&&$A in t&&t[$A]===!0}});var OA="__remove_all__";function Ma(t,e){let r=Array.isArray(t)?t:[t],n=Array.isArray(e)?e:[e],i=r.map(nr),o=n.map(nr);for(let l of i)(l.id===null||l.id===void 0)&&(l.id=Dr(),l.lc_kwargs.id=l.id);let a;for(let l=0;l<o.length;l+=1){let p=o[l];(p.id===null||p.id===void 0)&&(p.id=Dr(),p.lc_kwargs.id=p.id),Ln.isInstance(p)&&p.id===OA&&(a=l)}if(a!=null)return o.slice(a+1);let s=[...i],c=new Map(s.map((l,p)=>[l.id,p])),u=new Set;for(let l of o){let p=c.get(l.id);if(p!==void 0)Ln.isInstance(l)?u.add(l.id):(u.delete(l.id),s[p]=l);else{if(Ln.isInstance(l))throw new Error(`Attempting to delete a message with an ID that doesn't exist ('${l.id}')`);c.set(l.id,s.length),s.push(l)}}return s.filter(l=>!u.has(l.id))}var A8=K.custom().default(()=>[]),T8=K.custom(),t4=new Bi(A8,{inputSchema:T8,reducer:Ma,jsonSchemaExtra:{langgraph_type:"messages",description:"A list of chat messages"}});var $8="lg:",O8=class{constructor(){d(this,"_map",new WeakMap);d(this,"_extensionCache",new Map)}get(t){return this._map.get(t)}extend(t,e){let r=this.get(t);this._map.set(t,e(r))}remove(t){return this._map.delete(t),this}has(t){return this._map.has(t)}getChannelsForSchema(t){let e={},r=ws(t);for(let[n,i]of Object.entries(r)){let o=this.get(i);o?.reducer?e[n]=new Di(o.reducer.fn,o.default):e[n]=new ri(o?.default)}return e}getExtendedChannelSchemas(t,e){if(Object.keys(e).length===0)return t;let r=Object.entries(e).filter(([,o])=>o===!0).sort(([o],[a])=>o.localeCompare(a)).map(([o,a])=>`${o}:${a}`).join("|"),n=this._extensionCache.get(r)??new WeakMap;if(n.has(t))return n.get(t);let i=t;if(e.withReducerSchema||e.withJsonSchemaExtrasAsDescription){let o=Object.entries(ws(t)).map(([a,s])=>{let c=this.get(s),u=e.withReducerSchema?c?.reducer?.schema??s:s;if(e.withJsonSchemaExtrasAsDescription&&c?.jsonSchemaExtra){let l=Gn(u)??Gn(s),p=JSON.stringify({...c.jsonSchemaExtra,description:l});u=u.describe(`${$8}${p}`)}return[a,u]});i=dg(t,Object.fromEntries(o)),lt(i)&&(i._def.unknownKeys="strip")}return e.asPartial&&(i=mu(i)),n.set(t,i),this._extensionCache.set(r,n),i}},of=new O8;function r4(t,e){if(e.reducer&&!e.default){let r=fg(t);r!=null&&(e.default=r)}if(e.reducer){let r=Object.assign(t,{lg_reducer_schema:e.reducer?.schema??t});return of.extend(r,()=>e),r}else return of.extend(t,()=>e),t}var Ro="__root__",py=Symbol.for("langgraph.state.partial"),af=class extends ly{constructor(e,r){super();d(this,"channels",{});d(this,"waitingEdges",new Set);d(this,"_schemaDefinition");d(this,"_schemaRuntimeDefinition");d(this,"_inputDefinition");d(this,"_inputRuntimeDefinition");d(this,"_outputDefinition");d(this,"_outputRuntimeDefinition");d(this,"_schemaDefinitions",new Map);d(this,"_metaRegistry",of);d(this,"_configSchema");d(this,"_configRuntimeSchema");d(this,"_interrupt");d(this,"_writer");if(nf.isInstance(e)){let i=e.getChannels();this._schemaDefinition=i,this.channels=i,this._schemaRuntimeDefinition=e,this._inputRuntimeDefinition=py,this._outputRuntimeDefinition=e}else if(z8(e)){let i=this._metaRegistry.getChannelsForSchema(e.state),o=e.input!=null?this._metaRegistry.getChannelsForSchema(e.input):i,a=e.output!=null?this._metaRegistry.getChannelsForSchema(e.output):i;this._schemaDefinition=i,this._schemaRuntimeDefinition=e.state,this._inputDefinition=o,this._inputRuntimeDefinition=e.input??py,this._outputDefinition=a,this._outputRuntimeDefinition=e.output??e.state}else if(Vr(e)){let i=this._metaRegistry.getChannelsForSchema(e);this._schemaDefinition=i,this._schemaRuntimeDefinition=e,this._inputDefinition=i,this._inputRuntimeDefinition=py,this._outputDefinition=i,this._outputRuntimeDefinition=e}else if(M8(e))this._schemaDefinition=e.input.spec,this._inputDefinition=e.input.spec,this._outputDefinition=e.output.spec;else if(R8(e))this._schemaDefinition=e.stateSchema.spec,this._inputDefinition=e.input?.spec??this._schemaDefinition,this._outputDefinition=e.output?.spec??this._schemaDefinition;else if(P8(e)||n4(e))this._schemaDefinition=n4(e)?e.spec:e;else if(N8(e))this._schemaDefinition=C8(e.channels);else throw new Zm;this._inputDefinition??(this._inputDefinition=this._schemaDefinition),this._outputDefinition??(this._outputDefinition=this._schemaDefinition),this._addSchema(this._schemaDefinition),this._addSchema(this._inputDefinition),this._addSchema(this._outputDefinition);function n(i){return typeof i=="object"&&i!=null&&!("spec"in i)&&!Vr(i)}n(r)?(Vr(r.context)&&(this._configRuntimeSchema=r.context),this._interrupt=r.interrupt,this._writer=r.writer):Vr(r)&&(this._configRuntimeSchema=r)}get allEdges(){return new Set([...this.edges,...Array.from(this.waitingEdges).flatMap(([e,r])=>e.map(n=>[n,r]))])}_addSchema(e){if(!this._schemaDefinitions.has(e)){this._schemaDefinitions.set(e,e);for(let[r,n]of Object.entries(e)){let i;if(typeof n=="function"?i=n():i=n,this.channels[r]!==void 0){if(!this.channels[r].equals(i)&&i.lc_graph_name!=="LastValue")throw new Error(`Channel "${r}" already exists with a different type.`)}else this.channels[r]=i}}}addNode(...e){function r(i){return i.length>=1&&typeof i[0]!="string"}let n=r(e)?Array.isArray(e[0])?e[0]:Object.entries(e[0]).map(([i,o])=>[i,o]):[[e[0],e[1],e[2]]];if(n.length===0)throw new Error("No nodes provided in `addNode`");for(let[i,o,a]of n){if(i in this.channels)throw new Error(`${i} is already being used as a state attribute (a.k.a. a channel), cannot also be used as a node name.`);for(let p of[ot,Pr])if(i.includes(p))throw new Error(`"${p}" is a reserved character and is not allowed in node names.`);if(this.warnIfCompiled("Adding a node to a graph that has already been compiled. This will not be reflected in the compiled graph."),i in this.nodes)throw new Error(`Node \`${i}\` already present.`);if(i===Ie||i===$e)throw new Error(`Node \`${i}\` is reserved.`);let s=this._schemaDefinition;a?.input!==void 0&&(Vr(a.input)?s=this._metaRegistry.getChannelsForSchema(a.input):a.input.spec!==void 0&&(s=a.input.spec)),s!==void 0&&this._addSchema(s);let c;pe.isRunnable(o)?c=o:typeof o=="function"?c=new fr({func:o,name:i,trace:!1}):c=ht(o);let u=a?.cachePolicy;typeof u=="boolean"&&(u=u?{}:void 0);let l={runnable:c,retryPolicy:a?.retryPolicy,cachePolicy:u,metadata:a?.metadata,input:s??this._schemaDefinition,subgraphs:Xd(c)?[c]:a?.subgraphs,ends:a?.ends,defer:a?.defer};this.nodes[i]=l}return this}addEdge(e,r){if(typeof e=="string")return super.addEdge(e,r);this.compiled&&console.warn("Adding an edge to a graph that has already been compiled. This will not be reflected in the compiled graph.");for(let n of e){if(n===Ie)throw new Error("END cannot be a start node");if(!Object.keys(this.nodes).some(i=>i===n))throw new Error(`Need to add a node named "${n}" first`)}if(r===Ie)throw new Error("END cannot be an end node");if(!Object.keys(this.nodes).some(n=>n===r))throw new Error(`Need to add a node named "${r}" first`);return this.waitingEdges.add([e,r]),this}addSequence(e){let r=Array.isArray(e)?e:Object.entries(e);if(r.length===0)throw new Error("Sequence requires at least one node.");let n;for(let[i,o,a]of r){if(i in this.nodes)throw new Error(`Node names must be unique: node with the name "${i}" already exists.`);let s=i;this.addNode(s,o,a),n!=null&&this.addEdge(n,s),n=s}return this}compile({checkpointer:e,store:r,cache:n,interruptBefore:i,interruptAfter:o,name:a,description:s}={}){this.validate([...Array.isArray(i)?i:[],...Array.isArray(o)?o:[]]);let c=Object.keys(this._schemaDefinitions.get(this._outputDefinition)),u=c.length===1&&c[0]===Ro?Ro:c,l=Object.keys(this.channels),p=l.length===1&&l[0]===Ro?Ro:l,f=this._interrupt,m=new CA({builder:this,checkpointer:e,interruptAfter:o,interruptBefore:i,autoValidate:!1,nodes:{},channels:{...this.channels,[$e]:new ui},inputChannels:$e,outputChannels:u,streamChannels:p,streamMode:"updates",store:r,cache:n,name:a,description:s,userInterrupt:f});m.attachNode($e);for(let[h,g]of Object.entries(this.nodes))m.attachNode(h,g);m.attachBranch($e,rA,i4(),{withReader:!1});for(let[h]of Object.entries(this.nodes))m.attachBranch(h,rA,i4(),{withReader:!1});for(let[h,g]of this.edges)m.attachEdge(h,g);for(let[h,g]of this.waitingEdges)m.attachEdge(h,g);for(let[h,g]of Object.entries(this.branches))for(let[x,y]of Object.entries(g))m.attachBranch(h,x,y);return m.validate()}};function C8(t){let e={};for(let[r,n]of Object.entries(t))r===Ro?e[r]=B_(n):e[r]=B_(n);return e}var CA=class extends IA{constructor({description:e,...r}){super(r);d(this,"description");d(this,"_metaRegistry",of);this.description=e}attachNode(e,r){let n;e===$e?n=Object.entries(this.builder._schemaDefinitions.get(this.builder._inputDefinition)).map(([c])=>c):n=Object.keys(this.builder.channels);function i(c){if(zt(c))return c.graph===Or.PARENT?null:c._updateAsTuples();if(Array.isArray(c)&&c.length>0&&c.some(u=>zt(u))){let u=[];for(let l of c)if(zt(l)){if(l.graph===Or.PARENT)continue;u.push(...l._updateAsTuples())}else u.push([Ro,l]);return u}else if(c!=null)return[[Ro,c]];return null}let o=e;function a(c){if(c){if(zt(c))return c.graph===Or.PARENT?null:c._updateAsTuples().filter(([u])=>n.includes(u));if(Array.isArray(c)&&c.length>0&&c.some(zt)){let u=[];for(let l of c)if(zt(l)){if(l.graph===Or.PARENT)continue;u.push(...l._updateAsTuples().filter(([p])=>n.includes(p)))}else{let p=a(l);p&&u.push(...p??[])}return u}else{if(typeof c=="object"&&!Array.isArray(c))return Object.entries(c).filter(([u])=>n.includes(u));{let u=Array.isArray(c)?"array":typeof c;throw new Me(`Expected node "${o.toString()}" to return an object or an array containing at least one Command object, received ${u}`,{lc_error_code:"INVALID_GRAPH_NODE_RETURN_VALUE"})}}}else return null}let s=[{value:Kr,mapper:new fr({func:n.length&&n[0]===Ro?i:a,trace:!1,recurse:!1})}];if(e===$e)this.nodes[e]=new si({tags:[Ke],triggers:[$e],channels:[$e],writers:[new wt(s,[Ke])]});else{let c=r?.input??this.builder._schemaDefinition,u=Object.fromEntries(Object.keys(this.builder._schemaDefinitions.get(c)).map(f=>[f,f])),l=Object.keys(u).length===1&&Ro in u,p=`branch:to:${e}`;this.channels[p]=r?.defer?new YE:new ui(!1),this.nodes[e]=new si({triggers:[p],channels:l?Object.keys(u):u,writers:[new wt(s,[Ke])],mapper:l?void 0:f=>Object.fromEntries(Object.entries(f).filter(([m])=>m in u)),bound:r?.runnable,metadata:r?.metadata,retryPolicy:r?.retryPolicy,cachePolicy:r?.cachePolicy,subgraphs:r?.subgraphs,ends:r?.ends})}}attachEdge(e,r){if(r!==Ie){if(typeof e=="string")this.nodes[e].writers.push(new wt([{channel:`branch:to:${r}`,value:null}],[Ke]));else if(Array.isArray(e)){let n=`join:${e.join("+")}:${r}`;this.channels[n]=this.builder.nodes[r].defer?new TA(new Set(e)):new AA(new Set(e)),this.nodes[r].triggers.push(n);for(let i of e)this.nodes[i].writers.push(new wt([{channel:n,value:i}],[Ke]))}}}attachBranch(e,r,n,i={withReader:!0}){let o=async(a,s)=>{let c=a.filter(l=>l!==Ie);if(!c.length)return;let u=c.map(l=>Rt(l)?l:{channel:l===Ie?l:`branch:to:${l}`,value:e});await wt.doWrite({...s,tags:(s.tags??[]).concat([Ke])},u)};this.nodes[e].writers.push(n.run(o,i.withReader?a=>_L.doRead(a,this.streamChannels??this.outputChannels,!0):void 0))}async _validateInput(e){if(e==null)return e;let r=this.builder._inputRuntimeDefinition,n=this.builder._schemaRuntimeDefinition;if(nf.isInstance(n)){if(zt(e)){let o=e;return e.update&&(o.update=await n.validateInput(Array.isArray(e.update)?Object.fromEntries(e.update):e.update)),o}return await n.validateInput(e)}let i=(()=>{let o=a=>{if(a!=null)return this._metaRegistry.getExtendedChannelSchemas(a,{withReducerSchema:!0})};if(Vr(r))return o(r);if(r===py)return Vr(n)?mu(o(n)):void 0})();if(zt(e)){let o=e;return e.update&&i!=null&&(o.update=du(i,e.update)),o}return i!=null?du(i,e):e}isInterrupted(e){return Ku(e)}async _validateContext(e){let r=this.builder._configRuntimeSchema;return Vr(r)&&du(r,e),e}};function P8(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)&&Object.keys(t).length>0&&Object.values(t).every(e=>typeof e=="function"||XE(e))}function n4(t){return typeof t=="object"&&t!==null&&"lc_graph_name"in t&&t.lc_graph_name==="AnnotationRoot"}function N8(t){return typeof t=="object"&&t!==null&&t.channels!==void 0}function R8(t){return typeof t=="object"&&t!==null&&t.stateSchema!==void 0}function M8(t){return typeof t=="object"&&t!==null&&t.stateSchema===void 0&&t.input!==void 0&&t.output!==void 0}function z8(t){return!(typeof t!="object"||t==null||!("state"in t)||!Vr(t.state)||"input"in t&&!Vr(t.input)||"output"in t&&!Vr(t.output))}function j8(t){if(Rt(t))return[t];let e=[];zt(t)?e.push(t):Array.isArray(t)&&e.push(...t.filter(zt));let r=[];for(let n of e){if(n.graph===Or.PARENT)throw new kp(n);Rt(n.goto)||typeof n.goto=="string"?r.push(n.goto):Array.isArray(n.goto)&&r.push(...n.goto)}return r}function i4(){return new SA({path:new fr({func:j8,tags:[Ke],trace:!1,recurse:!1,name:"<control_branch>"})})}var PA=function(e,r){let{name:n,checkpointer:i,store:o,cache:a}=typeof e=="string"?{name:e,checkpointer:void 0,store:void 0}:e;if(hL(r)||gL(r))throw new Error("Generators are disallowed as entrypoints. For streaming responses, use config.write.");let s="updates",c=EL(n,r);function u(m){return typeof m=="object"&&m!==null&&"__lg_type"in m&&m.__lg_type==="__pregel_final"}let l=new fr({name:"pluckReturnValue",func:m=>u(m)?m.value:m}),p=new fr({name:"pluckSaveValue",func:m=>u(m)?m.save:m}),f=new si({bound:c,triggers:[$e],channels:[$e],writers:[new wt([{channel:Ie,value:Kr,mapper:l},{channel:Ws,value:Kr,mapper:p}],[Ke])]});return new uy({name:n,checkpointer:i,nodes:{[n]:f},channels:{[$e]:new ui,[Ie]:new ri,[Ws]:new ri},inputChannels:$e,outputChannels:Ie,streamChannels:Ie,streamMode:s,store:o,cache:a})};PA.final=function({value:e,save:r}){return{value:e,save:r,__lg_type:"__pregel_final"}};var o4=Gt.Root({messages:Gt({reducer:Ma,default:()=>[]})}),NA={reducer:{fn:Ma},jsonSchemaExtra:{langgraph_type:"messages"},default:()=>[]},a4=Vt.object({messages:r4(Vt.custom(),NA)});DN();var dy=Gt.Root({rawMessages:Gt({reducer:(t,e)=>e,default:()=>[]}),parsedInput:Gt({reducer:(t,e)=>e,default:()=>null}),worldState:Gt({reducer:(t,e)=>e??t,default:()=>null}),activeCharacters:Gt({reducer:(t,e)=>e,default:()=>[]}),characterContexts:Gt({reducer:(t,e)=>e,default:()=>({})}),personaOutputs:Gt({reducer:(t,e)=>[...t,...e],default:()=>[]}),formatCheckPassed:Gt({reducer:(t,e)=>e,default:()=>!1}),retryCount:Gt({reducer:(t,e)=>e,default:()=>0}),finalOutput:Gt({reducer:(t,e)=>e,default:()=>""}),error:Gt({reducer:(t,e)=>e,default:()=>null})});var Z8=["core_features","fiction_style","Writing_style","additional_constraints","content_constraints","explicit_guidelines"],G8=["info_settings","char","user"],H8=["Interaction_history","chat_history"];function q8(t){let e={},r=/<(\w+)>([\s\S]*?)<\/\1>/g,n;for(;(n=r.exec(t))!==null;)e[n[1]]=n[2].trim();return e}function s4(t){return t.replace(/<\w+>[\s\S]*?<\/\w+>/g,"").replace(/<\w+>/g,"").trim()}async function RA(t){let e=t.rawMessages,r={},n={},i=[],o="";for(let s of e){let c=s.role||"",u=s.content||"",l=q8(u);for(let[p,f]of Object.entries(l))Z8.includes(p)?r[p]=f:G8.includes(p)?n[p]=f:H8.includes(p)&&i.push({role:"history",content:f});if(c==="assistant"||c==="user"){let p=s4(u);p&&i.push({role:c,content:p})}}for(let s=e.length-1;s>=0&&!(e[s].role==="user"&&(o=s4(e[s].content||""),o));s--);let a={presetInstructions:r,characterSettings:n,chatHistory:i,userInput:o};return console.log("[MultiAgent] Parser \u5B8C\u6210\u89E3\u6790:",{presetCount:Object.keys(r).length,characterCount:Object.keys(n).length,historyCount:i.length}),{parsedInput:a}}function sf(t,e){return t.lc_error_code=e,t.message=`${t.message}

Troubleshooting URL: https://docs.langchain.com/oss/javascript/langchain/errors/${e}/
`,t}function ce(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r}function A(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}var MA=function(){let{crypto:t}=globalThis;if(t?.randomUUID)return MA=t.randomUUID.bind(t),t.randomUUID();let e=new Uint8Array(1),r=t?()=>t.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^r()&15>>+n/4).toString(16))};function cf(t){return typeof t=="object"&&t!==null&&("name"in t&&t.name==="AbortError"||"message"in t&&String(t.message).includes("FetchRequestCanceledException"))}var uf=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null){try{if(Object.prototype.toString.call(t)==="[object Error]"){let e=new Error(t.message,t.cause?{cause:t.cause}:{});return t.stack&&(e.stack=t.stack),t.cause&&!e.cause&&(e.cause=t.cause),t.name&&(e.name=t.name),e}}catch{}try{return new Error(JSON.stringify(t))}catch{}}return new Error(t)};var Y=class extends Error{},Dt=class t extends Y{constructor(e,r,n,i){super(`${t.makeMessage(e,r,n)}`),this.status=e,this.headers=i,this.requestID=i?.get("x-request-id"),this.error=r;let o=r;this.code=o?.code,this.param=o?.param,this.type=o?.type}static makeMessage(e,r,n){let i=r?.message?typeof r.message=="string"?r.message:JSON.stringify(r.message):r?JSON.stringify(r):n;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,r,n,i){if(!e||!i)return new za({message:n,cause:uf(r)});let o=r?.error;return e===400?new el(e,o,n,i):e===401?new tl(e,o,n,i):e===403?new rl(e,o,n,i):e===404?new nl(e,o,n,i):e===409?new il(e,o,n,i):e===422?new ol(e,o,n,i):e===429?new al(e,o,n,i):e>=500?new sl(e,o,n,i):new t(e,o,n,i)}},xt=class extends Dt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},za=class extends Dt{constructor({message:e,cause:r}){super(void 0,void 0,e||"Connection error.",void 0),r&&(this.cause=r)}},Vi=class extends za{constructor({message:e}={}){super({message:e??"Request timed out."})}},el=class extends Dt{},tl=class extends Dt{},rl=class extends Dt{},nl=class extends Dt{},il=class extends Dt{},ol=class extends Dt{},al=class extends Dt{},sl=class extends Dt{},cl=class extends Y{constructor(){super("Could not parse response content as the length limit was reached")}},ul=class extends Y{constructor(){super("Could not parse response content as the request was rejected by the content filter")}},Zi=class extends Error{constructor(e){super(e)}};var W8=/^[a-z][a-z0-9+.-]*:/i,c4=t=>W8.test(t),hr=t=>(hr=Array.isArray,hr(t)),zA=hr;function jA(t){return typeof t!="object"?{}:t??{}}function u4(t){if(!t)return!0;for(let e in t)return!1;return!0}function l4(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function lf(t){return t!=null&&typeof t=="object"&&!Array.isArray(t)}var p4=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new Y(`${t} must be an integer`);if(e<0)throw new Y(`${t} must be a positive integer`);return e};var d4=t=>{try{return JSON.parse(t)}catch{return}};var Gi=t=>new Promise(e=>setTimeout(e,t));var ja="6.16.0";var g4=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function J8(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}var X8=()=>{let t=J8();if(t==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ja,"X-Stainless-OS":m4(Deno.build.os),"X-Stainless-Arch":f4(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ja,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(t==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ja,"X-Stainless-OS":m4(globalThis.process.platform??"unknown"),"X-Stainless-Arch":f4(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let e=Y8();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ja,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ja,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Y8(){if(typeof navigator>"u"||!navigator)return null;let t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:r}of t){let n=r.exec(navigator.userAgent);if(n){let i=n[1]||0,o=n[2]||0,a=n[3]||0;return{browser:e,version:`${i}.${o}.${a}`}}}return null}var f4=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",m4=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown"),h4,_4=()=>h4??(h4=X8());function y4(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function DA(...t){let e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...t)}function fy(t){let e=Symbol.asyncIterator in t?t[Symbol.asyncIterator]():t[Symbol.iterator]();return DA({start(){},async pull(r){let{done:n,value:i}=await e.next();n?r.close():r.enqueue(i)},async cancel(){await e.return?.()}})}function LA(t){if(t[Symbol.asyncIterator])return t;let e=t.getReader();return{async next(){try{let r=await e.read();return r?.done&&e.releaseLock(),r}catch(r){throw e.releaseLock(),r}},async return(){let r=e.cancel();return e.releaseLock(),await r,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function v4(t){if(t===null||typeof t!="object")return;if(t[Symbol.asyncIterator]){await t[Symbol.asyncIterator]().return?.();return}let e=t.getReader(),r=e.cancel();e.releaseLock(),await r}var b4=({headers:t,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});var my="RFC3986",UA=t=>String(t),hy={RFC1738:t=>String(t).replace(/%20/g,"+"),RFC3986:UA},FA="RFC1738";var gy=(t,e)=>(gy=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),gy(t,e)),Hi=(()=>{let t=[];for(let e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t})();var BA=1024,w4=(t,e,r,n,i)=>{if(t.length===0)return t;let o=t;if(typeof t=="symbol"?o=Symbol.prototype.toString.call(t):typeof t!="string"&&(o=String(t)),r==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(s){return"%26%23"+parseInt(s.slice(2),16)+"%3B"});let a="";for(let s=0;s<o.length;s+=BA){let c=o.length>=BA?o.slice(s,s+BA):o,u=[];for(let l=0;l<c.length;++l){let p=c.charCodeAt(l);if(p===45||p===46||p===95||p===126||p>=48&&p<=57||p>=65&&p<=90||p>=97&&p<=122||i===FA&&(p===40||p===41)){u[u.length]=c.charAt(l);continue}if(p<128){u[u.length]=Hi[p];continue}if(p<2048){u[u.length]=Hi[192|p>>6]+Hi[128|p&63];continue}if(p<55296||p>=57344){u[u.length]=Hi[224|p>>12]+Hi[128|p>>6&63]+Hi[128|p&63];continue}l+=1,p=65536+((p&1023)<<10|c.charCodeAt(l)&1023),u[u.length]=Hi[240|p>>18]+Hi[128|p>>12&63]+Hi[128|p>>6&63]+Hi[128|p&63]}a+=u.join("")}return a};function x4(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}function VA(t,e){if(hr(t)){let r=[];for(let n=0;n<t.length;n+=1)r.push(e(t[n]));return r}return e(t)}var I4={brackets(t){return String(t)+"[]"},comma:"comma",indices(t,e){return String(t)+"["+e+"]"},repeat(t){return String(t)}},k4=function(t,e){Array.prototype.push.apply(t,hr(e)?e:[e])},S4,Lt={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:w4,encodeValuesOnly:!1,format:my,formatter:UA,indices:!1,serializeDate(t){return(S4??(S4=Function.prototype.call.bind(Date.prototype.toISOString)))(t)},skipNulls:!1,strictNullHandling:!1};function tW(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"}var ZA={};function E4(t,e,r,n,i,o,a,s,c,u,l,p,f,m,h,g,x,y){let v=t,S=y,k=0,T=!1;for(;(S=S.get(ZA))!==void 0&&!T;){let F=S.get(t);if(k+=1,typeof F<"u"){if(F===k)throw new RangeError("Cyclic object value");T=!0}typeof S.get(ZA)>"u"&&(k=0)}if(typeof u=="function"?v=u(e,v):v instanceof Date?v=f?.(v):r==="comma"&&hr(v)&&(v=VA(v,function(F){return F instanceof Date?f?.(F):F})),v===null){if(o)return c&&!g?c(e,Lt.encoder,x,"key",m):e;v=""}if(tW(v)||x4(v)){if(c){let F=g?e:c(e,Lt.encoder,x,"key",m);return[h?.(F)+"="+h?.(c(v,Lt.encoder,x,"value",m))]}return[h?.(e)+"="+h?.(String(v))]}let N=[];if(typeof v>"u")return N;let U;if(r==="comma"&&hr(v))g&&c&&(v=VA(v,c)),U=[{value:v.length>0?v.join(",")||null:void 0}];else if(hr(u))U=u;else{let F=Object.keys(v);U=l?F.sort(l):F}let w=s?String(e).replace(/\./g,"%2E"):String(e),V=n&&hr(v)&&v.length===1?w+"[]":w;if(i&&hr(v)&&v.length===0)return V+"[]";for(let F=0;F<U.length;++F){let R=U[F],ve=typeof R=="object"&&typeof R.value<"u"?R.value:v[R];if(a&&ve===null)continue;let We=p&&s?R.replace(/\./g,"%2E"):R,Ze=hr(v)?typeof r=="function"?r(V,We):V:V+(p?"."+We:"["+We+"]");y.set(t,k);let Qt=new WeakMap;Qt.set(ZA,y),k4(N,E4(ve,Ze,r,n,i,o,a,s,r==="comma"&&g&&hr(v)?null:c,u,l,p,f,m,h,g,x,Qt))}return N}function rW(t=Lt){if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys<"u"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");let e=t.charset||Lt.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let r=my;if(typeof t.format<"u"){if(!gy(hy,t.format))throw new TypeError("Unknown format option provided.");r=t.format}let n=hy[r],i=Lt.filter;(typeof t.filter=="function"||hr(t.filter))&&(i=t.filter);let o;if(t.arrayFormat&&t.arrayFormat in I4?o=t.arrayFormat:"indices"in t?o=t.indices?"indices":"repeat":o=Lt.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");let a=typeof t.allowDots>"u"?t.encodeDotInKeys?!0:Lt.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:Lt.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:Lt.allowEmptyArrays,arrayFormat:o,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:Lt.charsetSentinel,commaRoundTrip:!!t.commaRoundTrip,delimiter:typeof t.delimiter>"u"?Lt.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:Lt.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:Lt.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:Lt.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:Lt.encodeValuesOnly,filter:i,format:r,formatter:n,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:Lt.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:Lt.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:Lt.strictNullHandling}}function GA(t,e={}){let r=t,n=rW(e),i,o;typeof n.filter=="function"?(o=n.filter,r=o("",r)):hr(n.filter)&&(o=n.filter,i=o);let a=[];if(typeof r!="object"||r===null)return"";let s=I4[n.arrayFormat],c=s==="comma"&&n.commaRoundTrip;i||(i=Object.keys(r)),n.sort&&i.sort(n.sort);let u=new WeakMap;for(let f=0;f<i.length;++f){let m=i[f];n.skipNulls&&r[m]===null||k4(a,E4(r[m],m,s,c,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,u))}let l=a.join(n.delimiter),p=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?p+="utf8=%26%2310003%3B&":p+="utf8=%E2%9C%93&"),l.length>0?p+l:""}function $4(t){let e=0;for(let i of t)e+=i.length;let r=new Uint8Array(e),n=0;for(let i of t)r.set(i,n),n+=i.length;return r}var A4;function ll(t){let e;return(A4??(e=new globalThis.TextEncoder,A4=e.encode.bind(e)))(t)}var T4;function HA(t){let e;return(T4??(e=new globalThis.TextDecoder,T4=e.decode.bind(e)))(t)}var ln,pn,ec=class{constructor(){ln.set(this,void 0),pn.set(this,void 0),ce(this,ln,new Uint8Array,"f"),ce(this,pn,null,"f")}decode(e){if(e==null)return[];let r=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?ll(e):e;ce(this,ln,$4([A(this,ln,"f"),r]),"f");let n=[],i;for(;(i=iW(A(this,ln,"f"),A(this,pn,"f")))!=null;){if(i.carriage&&A(this,pn,"f")==null){ce(this,pn,i.index,"f");continue}if(A(this,pn,"f")!=null&&(i.index!==A(this,pn,"f")+1||i.carriage)){n.push(HA(A(this,ln,"f").subarray(0,A(this,pn,"f")-1))),ce(this,ln,A(this,ln,"f").subarray(A(this,pn,"f")),"f"),ce(this,pn,null,"f");continue}let o=A(this,pn,"f")!==null?i.preceding-1:i.preceding,a=HA(A(this,ln,"f").subarray(0,o));n.push(a),ce(this,ln,A(this,ln,"f").subarray(i.index),"f"),ce(this,pn,null,"f")}return n}flush(){return A(this,ln,"f").length?this.decode(`
`):[]}};ln=new WeakMap,pn=new WeakMap;ec.NEWLINE_CHARS=new Set([`
`,"\r"]);ec.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function iW(t,e){for(let i=e??0;i<t.length;i++){if(t[i]===10)return{preceding:i,index:i+1,carriage:!1};if(t[i]===13)return{preceding:i,index:i+1,carriage:!0}}return null}function O4(t){for(let n=0;n<t.length-1;n++){if(t[n]===10&&t[n+1]===10||t[n]===13&&t[n+1]===13)return n+2;if(t[n]===13&&t[n+1]===10&&n+3<t.length&&t[n+2]===13&&t[n+3]===10)return n+4}return-1}var yy={off:0,error:200,warn:300,info:400,debug:500},qA=(t,e,r)=>{if(t){if(l4(yy,t))return t;At(r).warn(`${e} was set to ${JSON.stringify(t)}, expected one of ${JSON.stringify(Object.keys(yy))}`)}};function pf(){}function _y(t,e,r){return!e||yy[t]>yy[r]?pf:e[t].bind(e)}var oW={error:pf,warn:pf,info:pf,debug:pf},C4=new WeakMap;function At(t){let e=t.logger,r=t.logLevel??"off";if(!e)return oW;let n=C4.get(e);if(n&&n[0]===r)return n[1];let i={error:_y("error",e,r),warn:_y("warn",e,r),info:_y("info",e,r),debug:_y("debug",e,r)};return C4.set(e,[r,i]),i}var Mo=t=>(t.options&&(t.options={...t.options},delete t.options.headers),t.headers&&(t.headers=Object.fromEntries((t.headers instanceof Headers?[...t.headers]:Object.entries(t.headers)).map(([e,r])=>[e,e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":r]))),"retryOfRequestLogID"in t&&(t.retryOfRequestLogID&&(t.retryOf=t.retryOfRequestLogID),delete t.retryOfRequestLogID),t);var df,qi=class t{constructor(e,r,n){this.iterator=e,df.set(this,void 0),this.controller=r,ce(this,df,n,"f")}static fromSSEResponse(e,r,n){let i=!1,o=n?At(n):console;async function*a(){if(i)throw new Y("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let s=!1;try{for await(let c of aW(e,r))if(!s){if(c.data.startsWith("[DONE]")){s=!0;continue}if(c.event===null||!c.event.startsWith("thread.")){let u;try{u=JSON.parse(c.data)}catch(l){throw o.error("Could not parse message into JSON:",c.data),o.error("From chunk:",c.raw),l}if(u&&u.error)throw new Dt(void 0,u.error,void 0,e.headers);yield u}else{let u;try{u=JSON.parse(c.data)}catch(l){throw console.error("Could not parse message into JSON:",c.data),console.error("From chunk:",c.raw),l}if(c.event=="error")throw new Dt(void 0,u.error,u.message,void 0);yield{event:c.event,data:u}}}s=!0}catch(c){if(cf(c))return;throw c}finally{s||r.abort()}}return new t(a,r,n)}static fromReadableStream(e,r,n){let i=!1;async function*o(){let s=new ec,c=LA(e);for await(let u of c)for(let l of s.decode(u))yield l;for(let u of s.flush())yield u}async function*a(){if(i)throw new Y("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let s=!1;try{for await(let c of o())s||c&&(yield JSON.parse(c));s=!0}catch(c){if(cf(c))return;throw c}finally{s||r.abort()}}return new t(a,r,n)}[(df=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],r=[],n=this.iterator(),i=o=>({next:()=>{if(o.length===0){let a=n.next();e.push(a),r.push(a)}return o.shift()}});return[new t(()=>i(e),this.controller,A(this,df,"f")),new t(()=>i(r),this.controller,A(this,df,"f"))]}toReadableStream(){let e=this,r;return DA({async start(){r=e[Symbol.asyncIterator]()},async pull(n){try{let{value:i,done:o}=await r.next();if(o)return n.close();let a=ll(JSON.stringify(i)+`
`);n.enqueue(a)}catch(i){n.error(i)}},async cancel(){await r.return?.()}})}};async function*aW(t,e){if(!t.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new Y("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new Y("Attempted to iterate over a response with no body");let r=new KA,n=new ec,i=LA(t.body);for await(let o of sW(i))for(let a of n.decode(o)){let s=r.decode(a);s&&(yield s)}for(let o of n.flush()){let a=r.decode(o);a&&(yield a)}}async function*sW(t){let e=new Uint8Array;for await(let r of t){if(r==null)continue;let n=r instanceof ArrayBuffer?new Uint8Array(r):typeof r=="string"?ll(r):r,i=new Uint8Array(e.length+n.length);i.set(e),i.set(n,e.length),e=i;let o;for(;(o=O4(e))!==-1;)yield e.slice(0,o),e=e.slice(o)}e.length>0&&(yield e)}var KA=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let o={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],o}if(this.chunks.push(e),e.startsWith(":"))return null;let[r,n,i]=cW(e,":");return i.startsWith(" ")&&(i=i.substring(1)),r==="event"?this.event=i:r==="data"&&this.data.push(i),null}};function cW(t,e){let r=t.indexOf(e);return r!==-1?[t.substring(0,r),e,t.substring(r+e.length)]:[t,"",""]}async function vy(t,e){let{response:r,requestLogID:n,retryOfRequestLogID:i,startTime:o}=e,a=await(async()=>{if(e.options.stream)return At(t).debug("response",r.status,r.url,r.headers,r.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(r,e.controller,t):qi.fromSSEResponse(r,e.controller,t);if(r.status===204)return null;if(e.options.__binaryResponse)return r;let c=r.headers.get("content-type")?.split(";")[0]?.trim();if(c?.includes("application/json")||c?.endsWith("+json")){let p=await r.json();return WA(p,r)}return await r.text()})();return At(t).debug(`[${n}] response parsed`,Mo({retryOfRequestLogID:i,url:r.url,status:r.status,body:a,durationMs:Date.now()-o})),a}function WA(t,e){return!t||typeof t!="object"||Array.isArray(t)?t:Object.defineProperty(t,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var ff,tc=class t extends Promise{constructor(e,r,n=vy){super(i=>{i(null)}),this.responsePromise=r,this.parseResponse=n,ff.set(this,void 0),ce(this,ff,e,"f")}_thenUnwrap(e){return new t(A(this,ff,"f"),this.responsePromise,async(r,n)=>WA(e(await this.parseResponse(r,n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,r]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:r,request_id:r.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(A(this,ff,"f"),e))),this.parsedPromise}then(e,r){return this.parse().then(e,r)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};ff=new WeakMap;var by,mf=class{constructor(e,r,n,i){by.set(this,void 0),ce(this,by,e,"f"),this.options=i,this.response=r,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new Y("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await A(this,by,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(by=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let r of e.getPaginatedItems())yield r}},hf=class extends tc{constructor(e,r,n){super(e,r,async(i,o)=>new n(i,o.response,await vy(i,o),o.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let r of e)yield r}},Ki=class extends mf{constructor(e,r,n,i){super(e,r,n,i),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}},Oe=class extends mf{constructor(e,r,n,i){super(e,r,n,i),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){let e=this.getPaginatedItems(),r=e[e.length-1]?.id;return r?{...this.options,query:{...jA(this.options.query),after:r}}:null}},zo=class extends mf{constructor(e,r,n,i){super(e,r,n,i),this.data=n.data||[],this.has_more=n.has_more||!1,this.last_id=n.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){let e=this.last_id;return e?{...this.options,query:{...jA(this.options.query),after:e}}:null}};var YA=()=>{if(typeof File>"u"){let{process:t}=globalThis,e=typeof t?.versions?.node=="string"&&parseInt(t.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(e?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function pl(t,e,r){return YA(),new File(t,e??"unknown_file",r)}function gf(t){return(typeof t=="object"&&t!==null&&("name"in t&&t.name&&String(t.name)||"url"in t&&t.url&&String(t.url)||"filename"in t&&t.filename&&String(t.filename)||"path"in t&&t.path&&String(t.path))||"").split(/[\\/]/).pop()||void 0}var wy=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function",QA=async(t,e)=>JA(t.body)?{...t,body:await N4(t.body,e)}:t,dn=async(t,e)=>({...t,body:await N4(t.body,e)}),P4=new WeakMap;function lW(t){let e=typeof t=="function"?t:t.fetch,r=P4.get(e);if(r)return r;let n=(async()=>{try{let i="Response"in e?e.Response:(await e("data:,")).constructor,o=new FormData;return o.toString()!==await new i(o).text()}catch{return!0}})();return P4.set(e,n),n}var N4=async(t,e)=>{if(!await lW(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let r=new FormData;return await Promise.all(Object.entries(t||{}).map(([n,i])=>XA(r,n,i))),r},R4=t=>t instanceof Blob&&"name"in t,pW=t=>typeof t=="object"&&t!==null&&(t instanceof Response||wy(t)||R4(t)),JA=t=>{if(pW(t))return!0;if(Array.isArray(t))return t.some(JA);if(t&&typeof t=="object"){for(let e in t)if(JA(t[e]))return!0}return!1},XA=async(t,e,r)=>{if(r!==void 0){if(r==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")t.append(e,String(r));else if(r instanceof Response)t.append(e,pl([await r.blob()],gf(r)));else if(wy(r))t.append(e,pl([await new Response(fy(r)).blob()],gf(r)));else if(R4(r))t.append(e,r,gf(r));else if(Array.isArray(r))await Promise.all(r.map(n=>XA(t,e+"[]",n)));else if(typeof r=="object")await Promise.all(Object.entries(r).map(([n,i])=>XA(t,`${e}[${n}]`,i)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${r} instead`)}};var M4=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function",dW=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&M4(t),fW=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function";async function _f(t,e,r){if(YA(),t=await t,dW(t))return t instanceof File?t:pl([await t.arrayBuffer()],t.name);if(fW(t)){let i=await t.blob();return e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()),pl(await eT(i),e,r)}let n=await eT(t);if(e||(e=gf(t)),!r?.type){let i=n.find(o=>typeof o=="object"&&"type"in o&&o.type);typeof i=="string"&&(r={...r,type:i})}return pl(n,e,r)}async function eT(t){let e=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)e.push(t);else if(M4(t))e.push(t instanceof Blob?t:await t.arrayBuffer());else if(wy(t))for await(let r of t)e.push(...await eT(r));else{let r=t?.constructor?.name;throw new Error(`Unexpected data type: ${typeof t}${r?`; constructor: ${r}`:""}${mW(t)}`)}return e}function mW(t){return typeof t!="object"||t===null?"":`; props: [${Object.getOwnPropertyNames(t).map(r=>`"${r}"`).join(", ")}]`}var P=class{constructor(e){this._client=e}};function j4(t){return t.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var z4=Object.freeze(Object.create(null)),gW=(t=j4)=>function(r,...n){if(r.length===1)return r[0];let i=!1,o=[],a=r.reduce((l,p,f)=>{/[?#]/.test(p)&&(i=!0);let m=n[f],h=(i?encodeURIComponent:t)(""+m);return f!==n.length&&(m==null||typeof m=="object"&&m.toString===Object.getPrototypeOf(Object.getPrototypeOf(m.hasOwnProperty??z4)??z4)?.toString)&&(h=m+"",o.push({start:l.length+p.length,length:h.length,error:`Value of type ${Object.prototype.toString.call(m).slice(8,-1)} is not a valid path parameter`})),l+p+(f===n.length?"":h)},""),s=a.split(/[?#]/,1)[0],c=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,u;for(;(u=c.exec(s))!==null;)o.push({start:u.index,length:u[0].length,error:`Value "${u[0]}" can't be safely passed as a path parameter`});if(o.sort((l,p)=>l.start-p.start),o.length>0){let l=0,p=o.reduce((f,m)=>{let h=" ".repeat(m.start-l),g="^".repeat(m.length);return l=m.start+m.length,f+h+g},"");throw new Y(`Path parameters result in path with invalid segments:
${o.map(f=>f.error).join(`
`)}
${a}
${p}`)}return a},C=gW(j4);var rc=class extends P{list(e,r={},n){return this._client.getAPIList(C`/chat/completions/${e}/messages`,Oe,{query:r,...n})}};function yf(t){return t!==void 0&&"function"in t&&t.function!==void 0}function D4(t,e){let r={...t};return Object.defineProperties(r,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),r}function vf(t){return t?.$brand==="auto-parseable-response-format"}function nc(t){return t?.$brand==="auto-parseable-tool"}function L4(t,e){return!e||!tT(e)?{...t,choices:t.choices.map(r=>(F4(r.message.tool_calls),{...r,message:{...r.message,parsed:null,...r.message.tool_calls?{tool_calls:r.message.tool_calls}:void 0}}))}:bf(t,e)}function bf(t,e){let r=t.choices.map(n=>{if(n.finish_reason==="length")throw new cl;if(n.finish_reason==="content_filter")throw new ul;return F4(n.message.tool_calls),{...n,message:{...n.message,...n.message.tool_calls?{tool_calls:n.message.tool_calls?.map(i=>bW(e,i))??void 0}:void 0,parsed:n.message.content&&!n.message.refusal?vW(e,n.message.content):null}}});return{...t,choices:r}}function vW(t,e){return t.response_format?.type!=="json_schema"?null:t.response_format?.type==="json_schema"?"$parseRaw"in t.response_format?t.response_format.$parseRaw(e):JSON.parse(e):null}function bW(t,e){let r=t.tools?.find(n=>yf(n)&&n.function?.name===e.function.name);return{...e,function:{...e.function,parsed_arguments:nc(r)?r.$parseRaw(e.function.arguments):r?.function.strict?JSON.parse(e.function.arguments):null}}}function U4(t,e){if(!t||!("tools"in t)||!t.tools)return!1;let r=t.tools?.find(n=>yf(n)&&n.function?.name===e.function.name);return yf(r)&&(nc(r)||r?.function.strict||!1)}function tT(t){return vf(t.response_format)?!0:t.tools?.some(e=>nc(e)||e.type==="function"&&e.function.strict===!0)??!1}function F4(t){for(let e of t||[])if(e.type!=="function")throw new Y(`Currently only \`function\` tool calls are supported; Received \`${e.type}\``)}function B4(t){for(let e of t??[]){if(e.type!=="function")throw new Y(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new Y(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var dl=t=>t?.role==="assistant",rT=t=>t?.role==="tool";var nT,xy,Sy,wf,xf,Iy,Sf,jo,If,ky,Ey,fl,V4,Da=class{constructor(){nT.add(this),this.controller=new AbortController,xy.set(this,void 0),Sy.set(this,()=>{}),wf.set(this,()=>{}),xf.set(this,void 0),Iy.set(this,()=>{}),Sf.set(this,()=>{}),jo.set(this,{}),If.set(this,!1),ky.set(this,!1),Ey.set(this,!1),fl.set(this,!1),ce(this,xy,new Promise((e,r)=>{ce(this,Sy,e,"f"),ce(this,wf,r,"f")}),"f"),ce(this,xf,new Promise((e,r)=>{ce(this,Iy,e,"f"),ce(this,Sf,r,"f")}),"f"),A(this,xy,"f").catch(()=>{}),A(this,xf,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},A(this,nT,"m",V4).bind(this))},0)}_connected(){this.ended||(A(this,Sy,"f").call(this),this._emit("connect"))}get ended(){return A(this,If,"f")}get errored(){return A(this,ky,"f")}get aborted(){return A(this,Ey,"f")}abort(){this.controller.abort()}on(e,r){return(A(this,jo,"f")[e]||(A(this,jo,"f")[e]=[])).push({listener:r}),this}off(e,r){let n=A(this,jo,"f")[e];if(!n)return this;let i=n.findIndex(o=>o.listener===r);return i>=0&&n.splice(i,1),this}once(e,r){return(A(this,jo,"f")[e]||(A(this,jo,"f")[e]=[])).push({listener:r,once:!0}),this}emitted(e){return new Promise((r,n)=>{ce(this,fl,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,r)})}async done(){ce(this,fl,!0,"f"),await A(this,xf,"f")}_emit(e,...r){if(A(this,If,"f"))return;e==="end"&&(ce(this,If,!0,"f"),A(this,Iy,"f").call(this));let n=A(this,jo,"f")[e];if(n&&(A(this,jo,"f")[e]=n.filter(i=>!i.once),n.forEach(({listener:i})=>i(...r))),e==="abort"){let i=r[0];!A(this,fl,"f")&&!n?.length&&Promise.reject(i),A(this,wf,"f").call(this,i),A(this,Sf,"f").call(this,i),this._emit("end");return}if(e==="error"){let i=r[0];!A(this,fl,"f")&&!n?.length&&Promise.reject(i),A(this,wf,"f").call(this,i),A(this,Sf,"f").call(this,i),this._emit("end")}}_emitFinal(){}};xy=new WeakMap,Sy=new WeakMap,wf=new WeakMap,xf=new WeakMap,Iy=new WeakMap,Sf=new WeakMap,jo=new WeakMap,If=new WeakMap,ky=new WeakMap,Ey=new WeakMap,fl=new WeakMap,nT=new WeakSet,V4=function(e){if(ce(this,ky,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new xt),e instanceof xt)return ce(this,Ey,!0,"f"),this._emit("abort",e);if(e instanceof Y)return this._emit("error",e);if(e instanceof Error){let r=new Y(e.message);return r.cause=e,this._emit("error",r)}return this._emit("error",new Y(String(e)))};function Z4(t){return typeof t.parse=="function"}var Rr,iT,Ay,oT,aT,sT,G4,H4,wW=10,ml=class extends Da{constructor(){super(...arguments),Rr.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let r=e.choices[0]?.message;return r&&this._addMessage(r),e}_addMessage(e,r=!0){if("content"in e||(e.content=null),this.messages.push(e),r){if(this._emit("message",e),rT(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(dl(e)&&e.tool_calls)for(let n of e.tool_calls)n.type==="function"&&this._emit("functionToolCall",n.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new Y("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),A(this,Rr,"m",iT).call(this)}async finalMessage(){return await this.done(),A(this,Rr,"m",Ay).call(this)}async finalFunctionToolCall(){return await this.done(),A(this,Rr,"m",oT).call(this)}async finalFunctionToolCallResult(){return await this.done(),A(this,Rr,"m",aT).call(this)}async totalUsage(){return await this.done(),A(this,Rr,"m",sT).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let r=A(this,Rr,"m",Ay).call(this);r&&this._emit("finalMessage",r);let n=A(this,Rr,"m",iT).call(this);n&&this._emit("finalContent",n);let i=A(this,Rr,"m",oT).call(this);i&&this._emit("finalFunctionToolCall",i);let o=A(this,Rr,"m",aT).call(this);o!=null&&this._emit("finalFunctionToolCallResult",o),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",A(this,Rr,"m",sT).call(this))}async _createChatCompletion(e,r,n){let i=n?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),A(this,Rr,"m",G4).call(this,r);let o=await e.chat.completions.create({...r,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(bf(o,r))}async _runChatCompletion(e,r,n){for(let i of r.messages)this._addMessage(i,!1);return await this._createChatCompletion(e,r,n)}async _runTools(e,r,n){let i="tool",{tool_choice:o="auto",stream:a,...s}=r,c=typeof o!="string"&&o.type==="function"&&o?.function?.name,{maxChatCompletions:u=wW}=n||{},l=r.tools.map(m=>{if(nc(m)){if(!m.$callback)throw new Y("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:m.$callback,name:m.function.name,description:m.function.description||"",parameters:m.function.parameters,parse:m.$parseRaw,strict:!0}}}return m}),p={};for(let m of l)m.type==="function"&&(p[m.function.name||m.function.function.name]=m.function);let f="tools"in r?l.map(m=>m.type==="function"?{type:"function",function:{name:m.function.name||m.function.function.name,parameters:m.function.parameters,description:m.function.description,strict:m.function.strict}}:m):void 0;for(let m of r.messages)this._addMessage(m,!1);for(let m=0;m<u;++m){let g=(await this._createChatCompletion(e,{...s,tool_choice:o,tools:f,messages:[...this.messages]},n)).choices[0]?.message;if(!g)throw new Y("missing message in ChatCompletion response");if(!g.tool_calls?.length)return;for(let x of g.tool_calls){if(x.type!=="function")continue;let y=x.id,{name:v,arguments:S}=x.function,k=p[v];if(k){if(c&&c!==v){let w=`Invalid tool_call: ${JSON.stringify(v)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:i,tool_call_id:y,content:w});continue}}else{let w=`Invalid tool_call: ${JSON.stringify(v)}. Available options are: ${Object.keys(p).map(V=>JSON.stringify(V)).join(", ")}. Please try again`;this._addMessage({role:i,tool_call_id:y,content:w});continue}let T;try{T=Z4(k)?await k.parse(S):S}catch(w){let V=w instanceof Error?w.message:String(w);this._addMessage({role:i,tool_call_id:y,content:V});continue}let N=await k.function(T,this),U=A(this,Rr,"m",H4).call(this,N);if(this._addMessage({role:i,tool_call_id:y,content:U}),c)return}}}};Rr=new WeakSet,iT=function(){return A(this,Rr,"m",Ay).call(this).content??null},Ay=function(){let e=this.messages.length;for(;e-- >0;){let r=this.messages[e];if(dl(r))return{...r,content:r.content??null,refusal:r.refusal??null}}throw new Y("stream ended without producing a ChatCompletionMessage with role=assistant")},oT=function(){for(let e=this.messages.length-1;e>=0;e--){let r=this.messages[e];if(dl(r)&&r?.tool_calls?.length)return r.tool_calls.filter(n=>n.type==="function").at(-1)?.function}},aT=function(){for(let e=this.messages.length-1;e>=0;e--){let r=this.messages[e];if(rT(r)&&r.content!=null&&typeof r.content=="string"&&this.messages.some(n=>n.role==="assistant"&&n.tool_calls?.some(i=>i.type==="function"&&i.id===r.tool_call_id)))return r.content}},sT=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:r}of this._chatCompletions)r&&(e.completion_tokens+=r.completion_tokens,e.prompt_tokens+=r.prompt_tokens,e.total_tokens+=r.total_tokens);return e},G4=function(e){if(e.n!=null&&e.n>1)throw new Y("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},H4=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};var kf=class t extends ml{static runTools(e,r,n){let i=new t,o={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,r,o)),i}_addMessage(e,r=!0){super._addMessage(e,r),dl(e)&&e.content&&this._emit("content",e.content)}};var qt={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,SPECIAL:496,ATOM:499,COLLECTION:12,ALL:511},cT=class extends Error{},uT=class extends Error{};function xW(t,e=qt.ALL){if(typeof t!="string")throw new TypeError(`expecting str, got ${typeof t}`);if(!t.trim())throw new Error(`${t} is empty`);return SW(t.trim(),e)}var SW=(t,e)=>{let r=t.length,n=0,i=f=>{throw new cT(`${f} at position ${n}`)},o=f=>{throw new uT(`${f} at position ${n}`)},a=()=>(p(),n>=r&&i("Unexpected end of input"),t[n]==='"'?s():t[n]==="{"?c():t[n]==="["?u():t.substring(n,n+4)==="null"||qt.NULL&e&&r-n<4&&"null".startsWith(t.substring(n))?(n+=4,null):t.substring(n,n+4)==="true"||qt.BOOL&e&&r-n<4&&"true".startsWith(t.substring(n))?(n+=4,!0):t.substring(n,n+5)==="false"||qt.BOOL&e&&r-n<5&&"false".startsWith(t.substring(n))?(n+=5,!1):t.substring(n,n+8)==="Infinity"||qt.INFINITY&e&&r-n<8&&"Infinity".startsWith(t.substring(n))?(n+=8,1/0):t.substring(n,n+9)==="-Infinity"||qt.MINUS_INFINITY&e&&1<r-n&&r-n<9&&"-Infinity".startsWith(t.substring(n))?(n+=9,-1/0):t.substring(n,n+3)==="NaN"||qt.NAN&e&&r-n<3&&"NaN".startsWith(t.substring(n))?(n+=3,NaN):l()),s=()=>{let f=n,m=!1;for(n++;n<r&&(t[n]!=='"'||m&&t[n-1]==="\\");)m=t[n]==="\\"?!m:!1,n++;if(t.charAt(n)=='"')try{return JSON.parse(t.substring(f,++n-Number(m)))}catch(h){o(String(h))}else if(qt.STR&e)try{return JSON.parse(t.substring(f,n-Number(m))+'"')}catch{return JSON.parse(t.substring(f,t.lastIndexOf("\\"))+'"')}i("Unterminated string literal")},c=()=>{n++,p();let f={};try{for(;t[n]!=="}";){if(p(),n>=r&&qt.OBJ&e)return f;let m=s();p(),n++;try{let h=a();Object.defineProperty(f,m,{value:h,writable:!0,enumerable:!0,configurable:!0})}catch(h){if(qt.OBJ&e)return f;throw h}p(),t[n]===","&&n++}}catch{if(qt.OBJ&e)return f;i("Expected '}' at end of object")}return n++,f},u=()=>{n++;let f=[];try{for(;t[n]!=="]";)f.push(a()),p(),t[n]===","&&n++}catch{if(qt.ARR&e)return f;i("Expected ']' at end of array")}return n++,f},l=()=>{if(n===0){t==="-"&&qt.NUM&e&&i("Not sure what '-' is");try{return JSON.parse(t)}catch(m){if(qt.NUM&e)try{return t[t.length-1]==="."?JSON.parse(t.substring(0,t.lastIndexOf("."))):JSON.parse(t.substring(0,t.lastIndexOf("e")))}catch{}o(String(m))}}let f=n;for(t[n]==="-"&&n++;t[n]&&!",]}".includes(t[n]);)n++;n==r&&!(qt.NUM&e)&&i("Unterminated number literal");try{return JSON.parse(t.substring(f,n))}catch{t.substring(f,n)==="-"&&qt.NUM&e&&i("Not sure what '-' is");try{return JSON.parse(t.substring(f,t.lastIndexOf("e")))}catch(h){o(String(h))}}},p=()=>{for(;n<r&&` 
\r	`.includes(t[n]);)n++};return a()},lT=t=>xW(t,qt.ALL^qt.NUM);var Ut,Do,hl,La,pT,Ty,dT,fT,mT,$y,hT,q4,ic=class t extends ml{constructor(e){super(),Ut.add(this),Do.set(this,void 0),hl.set(this,void 0),La.set(this,void 0),ce(this,Do,e,"f"),ce(this,hl,[],"f")}get currentChatCompletionSnapshot(){return A(this,La,"f")}static fromReadableStream(e){let r=new t(null);return r._run(()=>r._fromReadableStream(e)),r}static createChatCompletion(e,r,n){let i=new t(r);return i._run(()=>i._runChatCompletion(e,{...r,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createChatCompletion(e,r,n){super._createChatCompletion;let i=n?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),A(this,Ut,"m",pT).call(this);let o=await e.chat.completions.create({...r,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(let a of o)A(this,Ut,"m",dT).call(this,a);if(o.controller.signal?.aborted)throw new xt;return this._addChatCompletion(A(this,Ut,"m",$y).call(this))}async _fromReadableStream(e,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),A(this,Ut,"m",pT).call(this),this._connected();let i=qi.fromReadableStream(e,this.controller),o;for await(let a of i)o&&o!==a.id&&this._addChatCompletion(A(this,Ut,"m",$y).call(this)),A(this,Ut,"m",dT).call(this,a),o=a.id;if(i.controller.signal?.aborted)throw new xt;return this._addChatCompletion(A(this,Ut,"m",$y).call(this))}[(Do=new WeakMap,hl=new WeakMap,La=new WeakMap,Ut=new WeakSet,pT=function(){this.ended||ce(this,La,void 0,"f")},Ty=function(r){let n=A(this,hl,"f")[r.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},A(this,hl,"f")[r.index]=n,n)},dT=function(r){if(this.ended)return;let n=A(this,Ut,"m",q4).call(this,r);this._emit("chunk",r,n);for(let i of r.choices){let o=n.choices[i.index];i.delta.content!=null&&o.message?.role==="assistant"&&o.message?.content&&(this._emit("content",i.delta.content,o.message.content),this._emit("content.delta",{delta:i.delta.content,snapshot:o.message.content,parsed:o.message.parsed})),i.delta.refusal!=null&&o.message?.role==="assistant"&&o.message?.refusal&&this._emit("refusal.delta",{delta:i.delta.refusal,snapshot:o.message.refusal}),i.logprobs?.content!=null&&o.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:i.logprobs?.content,snapshot:o.logprobs?.content??[]}),i.logprobs?.refusal!=null&&o.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:i.logprobs?.refusal,snapshot:o.logprobs?.refusal??[]});let a=A(this,Ut,"m",Ty).call(this,o);o.finish_reason&&(A(this,Ut,"m",mT).call(this,o),a.current_tool_call_index!=null&&A(this,Ut,"m",fT).call(this,o,a.current_tool_call_index));for(let s of i.delta.tool_calls??[])a.current_tool_call_index!==s.index&&(A(this,Ut,"m",mT).call(this,o),a.current_tool_call_index!=null&&A(this,Ut,"m",fT).call(this,o,a.current_tool_call_index)),a.current_tool_call_index=s.index;for(let s of i.delta.tool_calls??[]){let c=o.message.tool_calls?.[s.index];c?.type&&(c?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:c.function?.name,index:s.index,arguments:c.function.arguments,parsed_arguments:c.function.parsed_arguments,arguments_delta:s.function?.arguments??""}):(c?.type,void 0))}}},fT=function(r,n){if(A(this,Ut,"m",Ty).call(this,r).done_tool_calls.has(n))return;let o=r.message.tool_calls?.[n];if(!o)throw new Error("no tool call snapshot");if(!o.type)throw new Error("tool call snapshot missing `type`");if(o.type==="function"){let a=A(this,Do,"f")?.tools?.find(s=>yf(s)&&s.function.name===o.function.name);this._emit("tool_calls.function.arguments.done",{name:o.function.name,index:n,arguments:o.function.arguments,parsed_arguments:nc(a)?a.$parseRaw(o.function.arguments):a?.function.strict?JSON.parse(o.function.arguments):null})}else o.type},mT=function(r){let n=A(this,Ut,"m",Ty).call(this,r);if(r.message.content&&!n.content_done){n.content_done=!0;let i=A(this,Ut,"m",hT).call(this);this._emit("content.done",{content:r.message.content,parsed:i?i.$parseRaw(r.message.content):null})}r.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:r.message.refusal})),r.logprobs?.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:r.logprobs.content})),r.logprobs?.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:r.logprobs.refusal}))},$y=function(){if(this.ended)throw new Y("stream has ended, this shouldn't happen");let r=A(this,La,"f");if(!r)throw new Y("request ended without sending any chunks");return ce(this,La,void 0,"f"),ce(this,hl,[],"f"),IW(r,A(this,Do,"f"))},hT=function(){let r=A(this,Do,"f")?.response_format;return vf(r)?r:null},q4=function(r){var n,i,o,a;let s=A(this,La,"f"),{choices:c,...u}=r;s?Object.assign(s,u):s=ce(this,La,{...u,choices:[]},"f");for(let{delta:l,finish_reason:p,index:f,logprobs:m=null,...h}of r.choices){let g=s.choices[f];if(g||(g=s.choices[f]={finish_reason:p,index:f,message:{},logprobs:m,...h}),m)if(!g.logprobs)g.logprobs=Object.assign({},m);else{let{content:N,refusal:U,...w}=m;Object.assign(g.logprobs,w),N&&((n=g.logprobs).content??(n.content=[]),g.logprobs.content.push(...N)),U&&((i=g.logprobs).refusal??(i.refusal=[]),g.logprobs.refusal.push(...U))}if(p&&(g.finish_reason=p,A(this,Do,"f")&&tT(A(this,Do,"f")))){if(p==="length")throw new cl;if(p==="content_filter")throw new ul}if(Object.assign(g,h),!l)continue;let{content:x,refusal:y,function_call:v,role:S,tool_calls:k,...T}=l;if(Object.assign(g.message,T),y&&(g.message.refusal=(g.message.refusal||"")+y),S&&(g.message.role=S),v&&(g.message.function_call?(v.name&&(g.message.function_call.name=v.name),v.arguments&&((o=g.message.function_call).arguments??(o.arguments=""),g.message.function_call.arguments+=v.arguments)):g.message.function_call=v),x&&(g.message.content=(g.message.content||"")+x,!g.message.refusal&&A(this,Ut,"m",hT).call(this)&&(g.message.parsed=lT(g.message.content))),k){g.message.tool_calls||(g.message.tool_calls=[]);for(let{index:N,id:U,type:w,function:V,...F}of k){let R=(a=g.message.tool_calls)[N]??(a[N]={});Object.assign(R,F),U&&(R.id=U),w&&(R.type=w),V&&(R.function??(R.function={name:V.name??"",arguments:""})),V?.name&&(R.function.name=V.name),V?.arguments&&(R.function.arguments+=V.arguments,U4(A(this,Do,"f"),R)&&(R.function.parsed_arguments=lT(R.function.arguments)))}}}return s},Symbol.asyncIterator)](){let e=[],r=[],n=!1;return this.on("chunk",i=>{let o=r.shift();o?o.resolve(i):e.push(i)}),this.on("end",()=>{n=!0;for(let i of r)i.resolve(void 0);r.length=0}),this.on("abort",i=>{n=!0;for(let o of r)o.reject(i);r.length=0}),this.on("error",i=>{n=!0;for(let o of r)o.reject(i);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((o,a)=>r.push({resolve:o,reject:a})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new qi(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};function IW(t,e){let{id:r,choices:n,created:i,model:o,system_fingerprint:a,...s}=t,c={...s,id:r,choices:n.map(({message:u,finish_reason:l,index:p,logprobs:f,...m})=>{if(!l)throw new Y(`missing finish_reason for choice ${p}`);let{content:h=null,function_call:g,tool_calls:x,...y}=u,v=u.role;if(!v)throw new Y(`missing role for choice ${p}`);if(g){let{arguments:S,name:k}=g;if(S==null)throw new Y(`missing function_call.arguments for choice ${p}`);if(!k)throw new Y(`missing function_call.name for choice ${p}`);return{...m,message:{content:h,function_call:{arguments:S,name:k},role:v,refusal:u.refusal??null},finish_reason:l,index:p,logprobs:f}}return x?{...m,index:p,finish_reason:l,logprobs:f,message:{...y,role:v,content:h,refusal:u.refusal??null,tool_calls:x.map((S,k)=>{let{function:T,type:N,id:U,...w}=S,{arguments:V,name:F,...R}=T||{};if(U==null)throw new Y(`missing choices[${p}].tool_calls[${k}].id
${Oy(t)}`);if(N==null)throw new Y(`missing choices[${p}].tool_calls[${k}].type
${Oy(t)}`);if(F==null)throw new Y(`missing choices[${p}].tool_calls[${k}].function.name
${Oy(t)}`);if(V==null)throw new Y(`missing choices[${p}].tool_calls[${k}].function.arguments
${Oy(t)}`);return{...w,id:U,type:N,function:{...R,name:F,arguments:V}}})}}:{...m,message:{...y,content:h,role:v,refusal:u.refusal??null},finish_reason:l,index:p,logprobs:f}}),created:i,model:o,object:"chat.completion",...a?{system_fingerprint:a}:{}};return L4(c,e)}function Oy(t){return JSON.stringify(t)}var Ef=class t extends ic{static fromReadableStream(e){let r=new t(null);return r._run(()=>r._fromReadableStream(e)),r}static runTools(e,r,n){let i=new t(r),o={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,r,o)),i}};var Lo=class extends P{constructor(){super(...arguments),this.messages=new rc(this._client)}create(e,r){return this._client.post("/chat/completions",{body:e,...r,stream:e.stream??!1})}retrieve(e,r){return this._client.get(C`/chat/completions/${e}`,r)}update(e,r,n){return this._client.post(C`/chat/completions/${e}`,{body:r,...n})}list(e={},r){return this._client.getAPIList("/chat/completions",Oe,{query:e,...r})}delete(e,r){return this._client.delete(C`/chat/completions/${e}`,r)}parse(e,r){return B4(e.tools),this._client.chat.completions.create(e,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(n=>bf(n,e))}runTools(e,r){return e.stream?Ef.runTools(this._client,e,r):kf.runTools(this._client,e,r)}stream(e,r){return ic.createChatCompletion(this._client,e,r)}};Lo.Messages=rc;var Ua=class extends P{constructor(){super(...arguments),this.completions=new Lo(this._client)}};Ua.Completions=Lo;var K4=Symbol("brand.privateNullableHeaders");function*EW(t){if(!t)return;if(K4 in t){let{values:n,nulls:i}=t;yield*n.entries();for(let o of i)yield[o,null];return}let e=!1,r;t instanceof Headers?r=t.entries():zA(t)?r=t:(e=!0,r=Object.entries(t??{}));for(let n of r){let i=n[0];if(typeof i!="string")throw new TypeError("expected header name to be a string");let o=zA(n[1])?n[1]:[n[1]],a=!1;for(let s of o)s!==void 0&&(e&&!a&&(a=!0,yield[i,null]),yield[i,s])}}var H=t=>{let e=new Headers,r=new Set;for(let n of t){let i=new Set;for(let[o,a]of EW(n)){let s=o.toLowerCase();i.has(s)||(e.delete(o),i.add(s)),a===null?(e.delete(o),r.add(s)):(e.append(o,a),r.delete(s))}}return{[K4]:!0,values:e,nulls:r}};var gl=class extends P{create(e,r){return this._client.post("/audio/speech",{body:e,...r,headers:H([{Accept:"application/octet-stream"},r?.headers]),__binaryResponse:!0})}};var _l=class extends P{create(e,r){return this._client.post("/audio/transcriptions",dn({body:e,...r,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}};var yl=class extends P{create(e,r){return this._client.post("/audio/translations",dn({body:e,...r,__metadata:{model:e.model}},this._client))}};var Wi=class extends P{constructor(){super(...arguments),this.transcriptions=new _l(this._client),this.translations=new yl(this._client),this.speech=new gl(this._client)}};Wi.Transcriptions=_l;Wi.Translations=yl;Wi.Speech=gl;var oc=class extends P{create(e,r){return this._client.post("/batches",{body:e,...r})}retrieve(e,r){return this._client.get(C`/batches/${e}`,r)}list(e={},r){return this._client.getAPIList("/batches",Oe,{query:e,...r})}cancel(e,r){return this._client.post(C`/batches/${e}/cancel`,r)}};var vl=class extends P{create(e,r){return this._client.post("/assistants",{body:e,...r,headers:H([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,r){return this._client.get(C`/assistants/${e}`,{...r,headers:H([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,r,n){return this._client.post(C`/assistants/${e}`,{body:r,...n,headers:H([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e={},r){return this._client.getAPIList("/assistants",Oe,{query:e,...r,headers:H([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,r){return this._client.delete(C`/assistants/${e}`,{...r,headers:H([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}};var bl=class extends P{create(e,r){return this._client.post("/realtime/sessions",{body:e,...r,headers:H([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}};var wl=class extends P{create(e,r){return this._client.post("/realtime/transcription_sessions",{body:e,...r,headers:H([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}};var Fa=class extends P{constructor(){super(...arguments),this.sessions=new bl(this._client),this.transcriptionSessions=new wl(this._client)}};Fa.Sessions=bl;Fa.TranscriptionSessions=wl;var xl=class extends P{create(e,r){return this._client.post("/chatkit/sessions",{body:e,...r,headers:H([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}cancel(e,r){return this._client.post(C`/chatkit/sessions/${e}/cancel`,{...r,headers:H([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}};var Sl=class extends P{retrieve(e,r){return this._client.get(C`/chatkit/threads/${e}`,{...r,headers:H([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}list(e={},r){return this._client.getAPIList("/chatkit/threads",zo,{query:e,...r,headers:H([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}delete(e,r){return this._client.delete(C`/chatkit/threads/${e}`,{...r,headers:H([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}listItems(e,r={},n){return this._client.getAPIList(C`/chatkit/threads/${e}/items`,zo,{query:r,...n,headers:H([{"OpenAI-Beta":"chatkit_beta=v1"},n?.headers])})}};var Ba=class extends P{constructor(){super(...arguments),this.sessions=new xl(this._client),this.threads=new Sl(this._client)}};Ba.Sessions=xl;Ba.Threads=Sl;var Il=class extends P{create(e,r,n){return this._client.post(C`/threads/${e}/messages`,{body:r,...n,headers:H([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,r,n){let{thread_id:i}=r;return this._client.get(C`/threads/${i}/messages/${e}`,{...n,headers:H([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,r,n){let{thread_id:i,...o}=r;return this._client.post(C`/threads/${i}/messages/${e}`,{body:o,...n,headers:H([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,r={},n){return this._client.getAPIList(C`/threads/${e}/messages`,Oe,{query:r,...n,headers:H([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,r,n){let{thread_id:i}=r;return this._client.delete(C`/threads/${i}/messages/${e}`,{...n,headers:H([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};var kl=class extends P{retrieve(e,r,n){let{thread_id:i,run_id:o,...a}=r;return this._client.get(C`/threads/${i}/runs/${o}/steps/${e}`,{query:a,...n,headers:H([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,r,n){let{thread_id:i,...o}=r;return this._client.getAPIList(C`/threads/${i}/runs/${e}/steps`,Oe,{query:o,...n,headers:H([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};var W4=t=>{if(typeof Buffer<"u"){let e=Buffer.from(t,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{let e=atob(t),r=e.length,n=new Uint8Array(r);for(let i=0;i<r;i++)n[i]=e.charCodeAt(i);return Array.from(new Float32Array(n.buffer))}};var Va=t=>{if(typeof globalThis.process<"u")return globalThis.process.env?.[t]?.trim()??void 0;if(typeof globalThis.Deno<"u")return globalThis.Deno.env?.get?.(t)?.trim()};var Yt,sc,gT,Ji,Cy,li,cc,El,ac,Ry,fn,Py,Ny,$f,Af,Tf,J4,X4,Y4,Q4,eU,tU,rU,Uo=class extends Da{constructor(){super(...arguments),Yt.add(this),gT.set(this,[]),Ji.set(this,{}),Cy.set(this,{}),li.set(this,void 0),cc.set(this,void 0),El.set(this,void 0),ac.set(this,void 0),Ry.set(this,void 0),fn.set(this,void 0),Py.set(this,void 0),Ny.set(this,void 0),$f.set(this,void 0)}[(gT=new WeakMap,Ji=new WeakMap,Cy=new WeakMap,li=new WeakMap,cc=new WeakMap,El=new WeakMap,ac=new WeakMap,Ry=new WeakMap,fn=new WeakMap,Py=new WeakMap,Ny=new WeakMap,$f=new WeakMap,Yt=new WeakSet,Symbol.asyncIterator)](){let e=[],r=[],n=!1;return this.on("event",i=>{let o=r.shift();o?o.resolve(i):e.push(i)}),this.on("end",()=>{n=!0;for(let i of r)i.resolve(void 0);r.length=0}),this.on("abort",i=>{n=!0;for(let o of r)o.reject(i);r.length=0}),this.on("error",i=>{n=!0;for(let o of r)o.reject(i);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((o,a)=>r.push({resolve:o,reject:a})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let r=new sc;return r._run(()=>r._fromReadableStream(e)),r}async _fromReadableStream(e,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();let i=qi.fromReadableStream(e,this.controller);for await(let o of i)A(this,Yt,"m",Af).call(this,o);if(i.controller.signal?.aborted)throw new xt;return this._addRun(A(this,Yt,"m",Tf).call(this))}toReadableStream(){return new qi(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,r,n,i){let o=new sc;return o._run(()=>o._runToolAssistantStream(e,r,n,{...i,headers:{...i?.headers,"X-Stainless-Helper-Method":"stream"}})),o}async _createToolAssistantStream(e,r,n,i){let o=i?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));let a={...n,stream:!0},s=await e.submitToolOutputs(r,a,{...i,signal:this.controller.signal});this._connected();for await(let c of s)A(this,Yt,"m",Af).call(this,c);if(s.controller.signal?.aborted)throw new xt;return this._addRun(A(this,Yt,"m",Tf).call(this))}static createThreadAssistantStream(e,r,n){let i=new sc;return i._run(()=>i._threadAssistantStream(e,r,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),i}static createAssistantStream(e,r,n,i){let o=new sc;return o._run(()=>o._runAssistantStream(e,r,n,{...i,headers:{...i?.headers,"X-Stainless-Helper-Method":"stream"}})),o}currentEvent(){return A(this,Py,"f")}currentRun(){return A(this,Ny,"f")}currentMessageSnapshot(){return A(this,li,"f")}currentRunStepSnapshot(){return A(this,$f,"f")}async finalRunSteps(){return await this.done(),Object.values(A(this,Ji,"f"))}async finalMessages(){return await this.done(),Object.values(A(this,Cy,"f"))}async finalRun(){if(await this.done(),!A(this,cc,"f"))throw Error("Final run was not received.");return A(this,cc,"f")}async _createThreadAssistantStream(e,r,n){let i=n?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let o={...r,stream:!0},a=await e.createAndRun(o,{...n,signal:this.controller.signal});this._connected();for await(let s of a)A(this,Yt,"m",Af).call(this,s);if(a.controller.signal?.aborted)throw new xt;return this._addRun(A(this,Yt,"m",Tf).call(this))}async _createAssistantStream(e,r,n,i){let o=i?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));let a={...n,stream:!0},s=await e.create(r,a,{...i,signal:this.controller.signal});this._connected();for await(let c of s)A(this,Yt,"m",Af).call(this,c);if(s.controller.signal?.aborted)throw new xt;return this._addRun(A(this,Yt,"m",Tf).call(this))}static accumulateDelta(e,r){for(let[n,i]of Object.entries(r)){if(!e.hasOwnProperty(n)){e[n]=i;continue}let o=e[n];if(o==null){e[n]=i;continue}if(n==="index"||n==="type"){e[n]=i;continue}if(typeof o=="string"&&typeof i=="string")o+=i;else if(typeof o=="number"&&typeof i=="number")o+=i;else if(lf(o)&&lf(i))o=this.accumulateDelta(o,i);else if(Array.isArray(o)&&Array.isArray(i)){if(o.every(a=>typeof a=="string"||typeof a=="number")){o.push(...i);continue}for(let a of i){if(!lf(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);let s=a.index;if(s==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof s!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${s}`);let c=o[s];c==null?o.push(a):o[s]=this.accumulateDelta(c,a)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${i}, accValue: ${o}`);e[n]=o}return e}_addRun(e){return e}async _threadAssistantStream(e,r,n){return await this._createThreadAssistantStream(r,e,n)}async _runAssistantStream(e,r,n,i){return await this._createAssistantStream(r,e,n,i)}async _runToolAssistantStream(e,r,n,i){return await this._createToolAssistantStream(r,e,n,i)}};sc=Uo,Af=function(e){if(!this.ended)switch(ce(this,Py,e,"f"),A(this,Yt,"m",Y4).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":A(this,Yt,"m",rU).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":A(this,Yt,"m",X4).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":A(this,Yt,"m",J4).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier");default:}},Tf=function(){if(this.ended)throw new Y("stream has ended, this shouldn't happen");if(!A(this,cc,"f"))throw Error("Final run has not been received");return A(this,cc,"f")},J4=function(e){let[r,n]=A(this,Yt,"m",eU).call(this,e,A(this,li,"f"));ce(this,li,r,"f"),A(this,Cy,"f")[r.id]=r;for(let i of n){let o=r.content[i.index];o?.type=="text"&&this._emit("textCreated",o.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,r),e.data.delta.content)for(let i of e.data.delta.content){if(i.type=="text"&&i.text){let o=i.text,a=r.content[i.index];if(a&&a.type=="text")this._emit("textDelta",o,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(i.index!=A(this,El,"f")){if(A(this,ac,"f"))switch(A(this,ac,"f").type){case"text":this._emit("textDone",A(this,ac,"f").text,A(this,li,"f"));break;case"image_file":this._emit("imageFileDone",A(this,ac,"f").image_file,A(this,li,"f"));break}ce(this,El,i.index,"f")}ce(this,ac,r.content[i.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(A(this,El,"f")!==void 0){let i=e.data.content[A(this,El,"f")];if(i)switch(i.type){case"image_file":this._emit("imageFileDone",i.image_file,A(this,li,"f"));break;case"text":this._emit("textDone",i.text,A(this,li,"f"));break}}A(this,li,"f")&&this._emit("messageDone",e.data),ce(this,li,void 0,"f")}},X4=function(e){let r=A(this,Yt,"m",Q4).call(this,e);switch(ce(this,$f,r,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&r.step_details.type=="tool_calls")for(let o of n.step_details.tool_calls)o.index==A(this,Ry,"f")?this._emit("toolCallDelta",o,r.step_details.tool_calls[o.index]):(A(this,fn,"f")&&this._emit("toolCallDone",A(this,fn,"f")),ce(this,Ry,o.index,"f"),ce(this,fn,r.step_details.tool_calls[o.index],"f"),A(this,fn,"f")&&this._emit("toolCallCreated",A(this,fn,"f")));this._emit("runStepDelta",e.data.delta,r);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":ce(this,$f,void 0,"f"),e.data.step_details.type=="tool_calls"&&A(this,fn,"f")&&(this._emit("toolCallDone",A(this,fn,"f")),ce(this,fn,void 0,"f")),this._emit("runStepDone",e.data,r);break;case"thread.run.step.in_progress":break}},Y4=function(e){A(this,gT,"f").push(e),this._emit("event",e)},Q4=function(e){switch(e.event){case"thread.run.step.created":return A(this,Ji,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let r=A(this,Ji,"f")[e.data.id];if(!r)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){let i=sc.accumulateDelta(r,n.delta);A(this,Ji,"f")[e.data.id]=i}return A(this,Ji,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":A(this,Ji,"f")[e.data.id]=e.data;break}if(A(this,Ji,"f")[e.data.id])return A(this,Ji,"f")[e.data.id];throw new Error("No snapshot available")},eU=function(e,r){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!r)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let i=e.data;if(i.delta.content)for(let o of i.delta.content)if(o.index in r.content){let a=r.content[o.index];r.content[o.index]=A(this,Yt,"m",tU).call(this,o,a)}else r.content[o.index]=o,n.push(o);return[r,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(r)return[r,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},tU=function(e,r){return sc.accumulateDelta(r,e)},rU=function(e){switch(ce(this,Ny,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":ce(this,cc,e.data,"f"),A(this,fn,"f")&&(this._emit("toolCallDone",A(this,fn,"f")),ce(this,fn,void 0,"f"));break;case"thread.run.cancelling":break}};var uc=class extends P{constructor(){super(...arguments),this.steps=new kl(this._client)}create(e,r,n){let{include:i,...o}=r;return this._client.post(C`/threads/${e}/runs`,{query:{include:i},body:o,...n,headers:H([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:r.stream??!1})}retrieve(e,r,n){let{thread_id:i}=r;return this._client.get(C`/threads/${i}/runs/${e}`,{...n,headers:H([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,r,n){let{thread_id:i,...o}=r;return this._client.post(C`/threads/${i}/runs/${e}`,{body:o,...n,headers:H([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,r={},n){return this._client.getAPIList(C`/threads/${e}/runs`,Oe,{query:r,...n,headers:H([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,r,n){let{thread_id:i}=r;return this._client.post(C`/threads/${i}/runs/${e}/cancel`,{...n,headers:H([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,r,n){let i=await this.create(e,r,n);return await this.poll(i.id,{thread_id:e},n)}createAndStream(e,r,n){return Uo.createAssistantStream(e,this._client.beta.threads.runs,r,n)}async poll(e,r,n){let i=H([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:o,response:a}=await this.retrieve(e,r,{...n,headers:{...n?.headers,...i}}).withResponse();switch(o.status){case"queued":case"in_progress":case"cancelling":let s=5e3;if(n?.pollIntervalMs)s=n.pollIntervalMs;else{let c=a.headers.get("openai-poll-after-ms");if(c){let u=parseInt(c);isNaN(u)||(s=u)}}await Gi(s);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return o}}}stream(e,r,n){return Uo.createAssistantStream(e,this._client.beta.threads.runs,r,n)}submitToolOutputs(e,r,n){let{thread_id:i,...o}=r;return this._client.post(C`/threads/${i}/runs/${e}/submit_tool_outputs`,{body:o,...n,headers:H([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:r.stream??!1})}async submitToolOutputsAndPoll(e,r,n){let i=await this.submitToolOutputs(e,r,n);return await this.poll(i.id,r,n)}submitToolOutputsStream(e,r,n){return Uo.createToolAssistantStream(e,this._client.beta.threads.runs,r,n)}};uc.Steps=kl;var Za=class extends P{constructor(){super(...arguments),this.runs=new uc(this._client),this.messages=new Il(this._client)}create(e={},r){return this._client.post("/threads",{body:e,...r,headers:H([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,r){return this._client.get(C`/threads/${e}`,{...r,headers:H([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,r,n){return this._client.post(C`/threads/${e}`,{body:r,...n,headers:H([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,r){return this._client.delete(C`/threads/${e}`,{...r,headers:H([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}createAndRun(e,r){return this._client.post("/threads/runs",{body:e,...r,headers:H([{"OpenAI-Beta":"assistants=v2"},r?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,r){let n=await this.createAndRun(e,r);return await this.runs.poll(n.id,{thread_id:n.thread_id},r)}createAndRunStream(e,r){return Uo.createThreadAssistantStream(e,this._client.beta.threads,r)}};Za.Runs=uc;Za.Messages=Il;var pi=class extends P{constructor(){super(...arguments),this.realtime=new Fa(this._client),this.chatkit=new Ba(this._client),this.assistants=new vl(this._client),this.threads=new Za(this._client)}};pi.Realtime=Fa;pi.ChatKit=Ba;pi.Assistants=vl;pi.Threads=Za;var lc=class extends P{create(e,r){return this._client.post("/completions",{body:e,...r,stream:e.stream??!1})}};var Al=class extends P{retrieve(e,r,n){let{container_id:i}=r;return this._client.get(C`/containers/${i}/files/${e}/content`,{...n,headers:H([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}};var pc=class extends P{constructor(){super(...arguments),this.content=new Al(this._client)}create(e,r,n){return this._client.post(C`/containers/${e}/files`,dn({body:r,...n},this._client))}retrieve(e,r,n){let{container_id:i}=r;return this._client.get(C`/containers/${i}/files/${e}`,n)}list(e,r={},n){return this._client.getAPIList(C`/containers/${e}/files`,Oe,{query:r,...n})}delete(e,r,n){let{container_id:i}=r;return this._client.delete(C`/containers/${i}/files/${e}`,{...n,headers:H([{Accept:"*/*"},n?.headers])})}};pc.Content=Al;var Ga=class extends P{constructor(){super(...arguments),this.files=new pc(this._client)}create(e,r){return this._client.post("/containers",{body:e,...r})}retrieve(e,r){return this._client.get(C`/containers/${e}`,r)}list(e={},r){return this._client.getAPIList("/containers",Oe,{query:e,...r})}delete(e,r){return this._client.delete(C`/containers/${e}`,{...r,headers:H([{Accept:"*/*"},r?.headers])})}};Ga.Files=pc;var Tl=class extends P{create(e,r,n){let{include:i,...o}=r;return this._client.post(C`/conversations/${e}/items`,{query:{include:i},body:o,...n})}retrieve(e,r,n){let{conversation_id:i,...o}=r;return this._client.get(C`/conversations/${i}/items/${e}`,{query:o,...n})}list(e,r={},n){return this._client.getAPIList(C`/conversations/${e}/items`,zo,{query:r,...n})}delete(e,r,n){let{conversation_id:i}=r;return this._client.delete(C`/conversations/${i}/items/${e}`,n)}};var Ha=class extends P{constructor(){super(...arguments),this.items=new Tl(this._client)}create(e={},r){return this._client.post("/conversations",{body:e,...r})}retrieve(e,r){return this._client.get(C`/conversations/${e}`,r)}update(e,r,n){return this._client.post(C`/conversations/${e}`,{body:r,...n})}delete(e,r){return this._client.delete(C`/conversations/${e}`,r)}};Ha.Items=Tl;var dc=class extends P{create(e,r){let n=!!e.encoding_format,i=n?e.encoding_format:"base64";n&&At(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let o=this._client.post("/embeddings",{body:{...e,encoding_format:i},...r});return n?o:(At(this._client).debug("embeddings/decoding base64 embeddings from base64"),o._thenUnwrap(a=>(a&&a.data&&a.data.forEach(s=>{let c=s.embedding;s.embedding=W4(c)}),a)))}};var $l=class extends P{retrieve(e,r,n){let{eval_id:i,run_id:o}=r;return this._client.get(C`/evals/${i}/runs/${o}/output_items/${e}`,n)}list(e,r,n){let{eval_id:i,...o}=r;return this._client.getAPIList(C`/evals/${i}/runs/${e}/output_items`,Oe,{query:o,...n})}};var fc=class extends P{constructor(){super(...arguments),this.outputItems=new $l(this._client)}create(e,r,n){return this._client.post(C`/evals/${e}/runs`,{body:r,...n})}retrieve(e,r,n){let{eval_id:i}=r;return this._client.get(C`/evals/${i}/runs/${e}`,n)}list(e,r={},n){return this._client.getAPIList(C`/evals/${e}/runs`,Oe,{query:r,...n})}delete(e,r,n){let{eval_id:i}=r;return this._client.delete(C`/evals/${i}/runs/${e}`,n)}cancel(e,r,n){let{eval_id:i}=r;return this._client.post(C`/evals/${i}/runs/${e}`,n)}};fc.OutputItems=$l;var qa=class extends P{constructor(){super(...arguments),this.runs=new fc(this._client)}create(e,r){return this._client.post("/evals",{body:e,...r})}retrieve(e,r){return this._client.get(C`/evals/${e}`,r)}update(e,r,n){return this._client.post(C`/evals/${e}`,{body:r,...n})}list(e={},r){return this._client.getAPIList("/evals",Oe,{query:e,...r})}delete(e,r){return this._client.delete(C`/evals/${e}`,r)}};qa.Runs=fc;var mc=class extends P{create(e,r){return this._client.post("/files",dn({body:e,...r},this._client))}retrieve(e,r){return this._client.get(C`/files/${e}`,r)}list(e={},r){return this._client.getAPIList("/files",Oe,{query:e,...r})}delete(e,r){return this._client.delete(C`/files/${e}`,r)}content(e,r){return this._client.get(C`/files/${e}/content`,{...r,headers:H([{Accept:"application/binary"},r?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:r=5e3,maxWait:n=1800*1e3}={}){let i=new Set(["processed","error","deleted"]),o=Date.now(),a=await this.retrieve(e);for(;!a.status||!i.has(a.status);)if(await Gi(r),a=await this.retrieve(e),Date.now()-o>n)throw new Vi({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return a}};var Ol=class extends P{};var Cl=class extends P{run(e,r){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...r})}validate(e,r){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...r})}};var hc=class extends P{constructor(){super(...arguments),this.graders=new Cl(this._client)}};hc.Graders=Cl;var Pl=class extends P{create(e,r,n){return this._client.getAPIList(C`/fine_tuning/checkpoints/${e}/permissions`,Ki,{body:r,method:"post",...n})}retrieve(e,r={},n){return this._client.get(C`/fine_tuning/checkpoints/${e}/permissions`,{query:r,...n})}delete(e,r,n){let{fine_tuned_model_checkpoint:i}=r;return this._client.delete(C`/fine_tuning/checkpoints/${i}/permissions/${e}`,n)}};var gc=class extends P{constructor(){super(...arguments),this.permissions=new Pl(this._client)}};gc.Permissions=Pl;var Nl=class extends P{list(e,r={},n){return this._client.getAPIList(C`/fine_tuning/jobs/${e}/checkpoints`,Oe,{query:r,...n})}};var _c=class extends P{constructor(){super(...arguments),this.checkpoints=new Nl(this._client)}create(e,r){return this._client.post("/fine_tuning/jobs",{body:e,...r})}retrieve(e,r){return this._client.get(C`/fine_tuning/jobs/${e}`,r)}list(e={},r){return this._client.getAPIList("/fine_tuning/jobs",Oe,{query:e,...r})}cancel(e,r){return this._client.post(C`/fine_tuning/jobs/${e}/cancel`,r)}listEvents(e,r={},n){return this._client.getAPIList(C`/fine_tuning/jobs/${e}/events`,Oe,{query:r,...n})}pause(e,r){return this._client.post(C`/fine_tuning/jobs/${e}/pause`,r)}resume(e,r){return this._client.post(C`/fine_tuning/jobs/${e}/resume`,r)}};_c.Checkpoints=Nl;var di=class extends P{constructor(){super(...arguments),this.methods=new Ol(this._client),this.jobs=new _c(this._client),this.checkpoints=new gc(this._client),this.alpha=new hc(this._client)}};di.Methods=Ol;di.Jobs=_c;di.Checkpoints=gc;di.Alpha=hc;var Rl=class extends P{};var Ka=class extends P{constructor(){super(...arguments),this.graderModels=new Rl(this._client)}};Ka.GraderModels=Rl;var yc=class extends P{createVariation(e,r){return this._client.post("/images/variations",dn({body:e,...r},this._client))}edit(e,r){return this._client.post("/images/edits",dn({body:e,...r,stream:e.stream??!1},this._client))}generate(e,r){return this._client.post("/images/generations",{body:e,...r,stream:e.stream??!1})}};var vc=class extends P{retrieve(e,r){return this._client.get(C`/models/${e}`,r)}list(e){return this._client.getAPIList("/models",Ki,e)}delete(e,r){return this._client.delete(C`/models/${e}`,r)}};var bc=class extends P{create(e,r){return this._client.post("/moderations",{body:e,...r})}};var Ml=class extends P{accept(e,r,n){return this._client.post(C`/realtime/calls/${e}/accept`,{body:r,...n,headers:H([{Accept:"*/*"},n?.headers])})}hangup(e,r){return this._client.post(C`/realtime/calls/${e}/hangup`,{...r,headers:H([{Accept:"*/*"},r?.headers])})}refer(e,r,n){return this._client.post(C`/realtime/calls/${e}/refer`,{body:r,...n,headers:H([{Accept:"*/*"},n?.headers])})}reject(e,r={},n){return this._client.post(C`/realtime/calls/${e}/reject`,{body:r,...n,headers:H([{Accept:"*/*"},n?.headers])})}};var zl=class extends P{create(e,r){return this._client.post("/realtime/client_secrets",{body:e,...r})}};var Fo=class extends P{constructor(){super(...arguments),this.clientSecrets=new zl(this._client),this.calls=new Ml(this._client)}};Fo.ClientSecrets=zl;Fo.Calls=Ml;function nU(t,e){return!e||!nJ(e)?{...t,output_parsed:null,output:t.output.map(r=>r.type==="function_call"?{...r,parsed_arguments:null}:r.type==="message"?{...r,content:r.content.map(n=>({...n,parsed:null}))}:r)}:_T(t,e)}function _T(t,e){let r=t.output.map(i=>{if(i.type==="function_call")return{...i,parsed_arguments:aJ(e,i)};if(i.type==="message"){let o=i.content.map(a=>a.type==="output_text"?{...a,parsed:rJ(e,a.text)}:a);return{...i,content:o}}return i}),n=Object.assign({},t,{output:r});return Object.getOwnPropertyDescriptor(t,"output_text")||My(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(let i of n.output)if(i.type==="message"){for(let o of i.content)if(o.type==="output_text"&&o.parsed!==null)return o.parsed}return null}}),n}function rJ(t,e){return t.text?.format?.type!=="json_schema"?null:"$parseRaw"in t.text?.format?(t.text?.format).$parseRaw(e):JSON.parse(e)}function nJ(t){return!!vf(t.text?.format)}function iJ(t){return t?.$brand==="auto-parseable-tool"}function oJ(t,e){return t.find(r=>r.type==="function"&&r.name===e)}function aJ(t,e){let r=oJ(t.tools??[],e.name);return{...e,...e,parsed_arguments:iJ(r)?r.$parseRaw(e.arguments):r?.strict?JSON.parse(e.arguments):null}}function My(t){let e=[];for(let r of t.output)if(r.type==="message")for(let n of r.content)n.type==="output_text"&&e.push(n.text);t.output_text=e.join("")}var jl,zy,Wa,jy,iU,oU,aU,sU,Dy=class t extends Da{constructor(e){super(),jl.add(this),zy.set(this,void 0),Wa.set(this,void 0),jy.set(this,void 0),ce(this,zy,e,"f")}static createResponse(e,r,n){let i=new t(r);return i._run(()=>i._createOrRetrieveResponse(e,r,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createOrRetrieveResponse(e,r,n){let i=n?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),A(this,jl,"m",iU).call(this);let o,a=null;"response_id"in r?(o=await e.responses.retrieve(r.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),a=r.starting_after??null):o=await e.responses.create({...r,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(let s of o)A(this,jl,"m",oU).call(this,s,a);if(o.controller.signal?.aborted)throw new xt;return A(this,jl,"m",aU).call(this)}[(zy=new WeakMap,Wa=new WeakMap,jy=new WeakMap,jl=new WeakSet,iU=function(){this.ended||ce(this,Wa,void 0,"f")},oU=function(r,n){if(this.ended)return;let i=(a,s)=>{(n==null||s.sequence_number>n)&&this._emit(a,s)},o=A(this,jl,"m",sU).call(this,r);switch(i("event",r),r.type){case"response.output_text.delta":{let a=o.output[r.output_index];if(!a)throw new Y(`missing output at index ${r.output_index}`);if(a.type==="message"){let s=a.content[r.content_index];if(!s)throw new Y(`missing content at index ${r.content_index}`);if(s.type!=="output_text")throw new Y(`expected content to be 'output_text', got ${s.type}`);i("response.output_text.delta",{...r,snapshot:s.text})}break}case"response.function_call_arguments.delta":{let a=o.output[r.output_index];if(!a)throw new Y(`missing output at index ${r.output_index}`);a.type==="function_call"&&i("response.function_call_arguments.delta",{...r,snapshot:a.arguments});break}default:i(r.type,r);break}},aU=function(){if(this.ended)throw new Y("stream has ended, this shouldn't happen");let r=A(this,Wa,"f");if(!r)throw new Y("request ended without sending any events");ce(this,Wa,void 0,"f");let n=sJ(r,A(this,zy,"f"));return ce(this,jy,n,"f"),n},sU=function(r){let n=A(this,Wa,"f");if(!n){if(r.type!=="response.created")throw new Y(`When snapshot hasn't been set yet, expected 'response.created' event, got ${r.type}`);return n=ce(this,Wa,r.response,"f"),n}switch(r.type){case"response.output_item.added":{n.output.push(r.item);break}case"response.content_part.added":{let i=n.output[r.output_index];if(!i)throw new Y(`missing output at index ${r.output_index}`);let o=i.type,a=r.part;o==="message"&&a.type!=="reasoning_text"?i.content.push(a):o==="reasoning"&&a.type==="reasoning_text"&&(i.content||(i.content=[]),i.content.push(a));break}case"response.output_text.delta":{let i=n.output[r.output_index];if(!i)throw new Y(`missing output at index ${r.output_index}`);if(i.type==="message"){let o=i.content[r.content_index];if(!o)throw new Y(`missing content at index ${r.content_index}`);if(o.type!=="output_text")throw new Y(`expected content to be 'output_text', got ${o.type}`);o.text+=r.delta}break}case"response.function_call_arguments.delta":{let i=n.output[r.output_index];if(!i)throw new Y(`missing output at index ${r.output_index}`);i.type==="function_call"&&(i.arguments+=r.delta);break}case"response.reasoning_text.delta":{let i=n.output[r.output_index];if(!i)throw new Y(`missing output at index ${r.output_index}`);if(i.type==="reasoning"){let o=i.content?.[r.content_index];if(!o)throw new Y(`missing content at index ${r.content_index}`);if(o.type!=="reasoning_text")throw new Y(`expected content to be 'reasoning_text', got ${o.type}`);o.text+=r.delta}break}case"response.completed":{ce(this,Wa,r.response,"f");break}}return n},Symbol.asyncIterator)](){let e=[],r=[],n=!1;return this.on("event",i=>{let o=r.shift();o?o.resolve(i):e.push(i)}),this.on("end",()=>{n=!0;for(let i of r)i.resolve(void 0);r.length=0}),this.on("abort",i=>{n=!0;for(let o of r)o.reject(i);r.length=0}),this.on("error",i=>{n=!0;for(let o of r)o.reject(i);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((o,a)=>r.push({resolve:o,reject:a})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=A(this,jy,"f");if(!e)throw new Y("stream ended without producing a ChatCompletion");return e}};function sJ(t,e){return nU(t,e)}var Dl=class extends P{list(e,r={},n){return this._client.getAPIList(C`/responses/${e}/input_items`,Oe,{query:r,...n})}};var Ll=class extends P{count(e={},r){return this._client.post("/responses/input_tokens",{body:e,...r})}};var Bo=class extends P{constructor(){super(...arguments),this.inputItems=new Dl(this._client),this.inputTokens=new Ll(this._client)}create(e,r){return this._client.post("/responses",{body:e,...r,stream:e.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&My(n),n))}retrieve(e,r={},n){return this._client.get(C`/responses/${e}`,{query:r,...n,stream:r?.stream??!1})._thenUnwrap(i=>("object"in i&&i.object==="response"&&My(i),i))}delete(e,r){return this._client.delete(C`/responses/${e}`,{...r,headers:H([{Accept:"*/*"},r?.headers])})}parse(e,r){return this._client.responses.create(e,r)._thenUnwrap(n=>_T(n,e))}stream(e,r){return Dy.createResponse(this._client,e,r)}cancel(e,r){return this._client.post(C`/responses/${e}/cancel`,r)}compact(e,r){return this._client.post("/responses/compact",{body:e,...r})}};Bo.InputItems=Dl;Bo.InputTokens=Ll;var Ul=class extends P{create(e,r,n){return this._client.post(C`/uploads/${e}/parts`,dn({body:r,...n},this._client))}};var Ja=class extends P{constructor(){super(...arguments),this.parts=new Ul(this._client)}create(e,r){return this._client.post("/uploads",{body:e,...r})}cancel(e,r){return this._client.post(C`/uploads/${e}/cancel`,r)}complete(e,r,n){return this._client.post(C`/uploads/${e}/complete`,{body:r,...n})}};Ja.Parts=Ul;var cU=async t=>{let e=await Promise.allSettled(t),r=e.filter(i=>i.status==="rejected");if(r.length){for(let i of r)console.error(i.reason);throw new Error(`${r.length} promise(s) failed - see the above errors`)}let n=[];for(let i of e)i.status==="fulfilled"&&n.push(i.value);return n};var Fl=class extends P{create(e,r,n){return this._client.post(C`/vector_stores/${e}/file_batches`,{body:r,...n,headers:H([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,r,n){let{vector_store_id:i}=r;return this._client.get(C`/vector_stores/${i}/file_batches/${e}`,{...n,headers:H([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,r,n){let{vector_store_id:i}=r;return this._client.post(C`/vector_stores/${i}/file_batches/${e}/cancel`,{...n,headers:H([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,r,n){let i=await this.create(e,r);return await this.poll(e,i.id,n)}listFiles(e,r,n){let{vector_store_id:i,...o}=r;return this._client.getAPIList(C`/vector_stores/${i}/file_batches/${e}/files`,Oe,{query:o,...n,headers:H([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async poll(e,r,n){let i=H([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:o,response:a}=await this.retrieve(r,{vector_store_id:e},{...n,headers:i}).withResponse();switch(o.status){case"in_progress":let s=5e3;if(n?.pollIntervalMs)s=n.pollIntervalMs;else{let c=a.headers.get("openai-poll-after-ms");if(c){let u=parseInt(c);isNaN(u)||(s=u)}}await Gi(s);break;case"failed":case"cancelled":case"completed":return o}}}async uploadAndPoll(e,{files:r,fileIds:n=[]},i){if(r==null||r.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let o=i?.maxConcurrency??5,a=Math.min(o,r.length),s=this._client,c=r.values(),u=[...n];async function l(f){for(let m of f){let h=await s.files.create({file:m,purpose:"assistants"},i);u.push(h.id)}}let p=Array(a).fill(c).map(l);return await cU(p),await this.createAndPoll(e,{file_ids:u})}};var Bl=class extends P{create(e,r,n){return this._client.post(C`/vector_stores/${e}/files`,{body:r,...n,headers:H([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,r,n){let{vector_store_id:i}=r;return this._client.get(C`/vector_stores/${i}/files/${e}`,{...n,headers:H([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,r,n){let{vector_store_id:i,...o}=r;return this._client.post(C`/vector_stores/${i}/files/${e}`,{body:o,...n,headers:H([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,r={},n){return this._client.getAPIList(C`/vector_stores/${e}/files`,Oe,{query:r,...n,headers:H([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,r,n){let{vector_store_id:i}=r;return this._client.delete(C`/vector_stores/${i}/files/${e}`,{...n,headers:H([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,r,n){let i=await this.create(e,r,n);return await this.poll(e,i.id,n)}async poll(e,r,n){let i=H([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let o=await this.retrieve(r,{vector_store_id:e},{...n,headers:i}).withResponse(),a=o.data;switch(a.status){case"in_progress":let s=5e3;if(n?.pollIntervalMs)s=n.pollIntervalMs;else{let c=o.response.headers.get("openai-poll-after-ms");if(c){let u=parseInt(c);isNaN(u)||(s=u)}}await Gi(s);break;case"failed":case"completed":return a}}}async upload(e,r,n){let i=await this._client.files.create({file:r,purpose:"assistants"},n);return this.create(e,{file_id:i.id},n)}async uploadAndPoll(e,r,n){let i=await this.upload(e,r,n);return await this.poll(e,i.id,n)}content(e,r,n){let{vector_store_id:i}=r;return this._client.getAPIList(C`/vector_stores/${i}/files/${e}/content`,Ki,{...n,headers:H([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};var Vo=class extends P{constructor(){super(...arguments),this.files=new Bl(this._client),this.fileBatches=new Fl(this._client)}create(e,r){return this._client.post("/vector_stores",{body:e,...r,headers:H([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,r){return this._client.get(C`/vector_stores/${e}`,{...r,headers:H([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,r,n){return this._client.post(C`/vector_stores/${e}`,{body:r,...n,headers:H([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e={},r){return this._client.getAPIList("/vector_stores",Oe,{query:e,...r,headers:H([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,r){return this._client.delete(C`/vector_stores/${e}`,{...r,headers:H([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}search(e,r,n){return this._client.getAPIList(C`/vector_stores/${e}/search`,Ki,{body:r,method:"post",...n,headers:H([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};Vo.Files=Bl;Vo.FileBatches=Fl;var wc=class extends P{create(e,r){return this._client.post("/videos",QA({body:e,...r},this._client))}retrieve(e,r){return this._client.get(C`/videos/${e}`,r)}list(e={},r){return this._client.getAPIList("/videos",zo,{query:e,...r})}delete(e,r){return this._client.delete(C`/videos/${e}`,r)}downloadContent(e,r={},n){return this._client.get(C`/videos/${e}/content`,{query:r,...n,headers:H([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}remix(e,r,n){return this._client.post(C`/videos/${e}/remix`,QA({body:r,...n},this._client))}};var Vl,uU,Ly,xc=class extends P{constructor(){super(...arguments),Vl.add(this)}async unwrap(e,r,n=this._client.webhookSecret,i=300){return await this.verifySignature(e,r,n,i),JSON.parse(e)}async verifySignature(e,r,n=this._client.webhookSecret,i=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");A(this,Vl,"m",uU).call(this,n);let o=H([r]).values,a=A(this,Vl,"m",Ly).call(this,o,"webhook-signature"),s=A(this,Vl,"m",Ly).call(this,o,"webhook-timestamp"),c=A(this,Vl,"m",Ly).call(this,o,"webhook-id"),u=parseInt(s,10);if(isNaN(u))throw new Zi("Invalid webhook timestamp format");let l=Math.floor(Date.now()/1e3);if(l-u>i)throw new Zi("Webhook timestamp is too old");if(u>l+i)throw new Zi("Webhook timestamp is too new");let p=a.split(" ").map(g=>g.startsWith("v1,")?g.substring(3):g),f=n.startsWith("whsec_")?Buffer.from(n.replace("whsec_",""),"base64"):Buffer.from(n,"utf-8"),m=c?`${c}.${s}.${e}`:`${s}.${e}`,h=await crypto.subtle.importKey("raw",f,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let g of p)try{let x=Buffer.from(g,"base64");if(await crypto.subtle.verify("HMAC",h,x,new TextEncoder().encode(m)))return}catch{continue}throw new Zi("The given webhook signature does not match the expected signature")}};Vl=new WeakSet,uU=function(e){if(typeof e!="string"||e.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},Ly=function(e,r){if(!e)throw new Error("Headers are required");let n=e.get(r);if(n==null)throw new Error(`Missing required header: ${r}`);return n};var yT,vT,Uy,lU,me=class{constructor({baseURL:e=Va("OPENAI_BASE_URL"),apiKey:r=Va("OPENAI_API_KEY"),organization:n=Va("OPENAI_ORG_ID")??null,project:i=Va("OPENAI_PROJECT_ID")??null,webhookSecret:o=Va("OPENAI_WEBHOOK_SECRET")??null,...a}={}){if(yT.add(this),Uy.set(this,void 0),this.completions=new lc(this),this.chat=new Ua(this),this.embeddings=new dc(this),this.files=new mc(this),this.images=new yc(this),this.audio=new Wi(this),this.moderations=new bc(this),this.models=new vc(this),this.fineTuning=new di(this),this.graders=new Ka(this),this.vectorStores=new Vo(this),this.webhooks=new xc(this),this.beta=new pi(this),this.batches=new oc(this),this.uploads=new Ja(this),this.responses=new Bo(this),this.realtime=new Fo(this),this.conversations=new Ha(this),this.evals=new qa(this),this.containers=new Ga(this),this.videos=new wc(this),r===void 0)throw new Y("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");let s={apiKey:r,organization:n,project:i,webhookSecret:o,...a,baseURL:e||"https://api.openai.com/v1"};if(!s.dangerouslyAllowBrowser&&g4())throw new Y(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=s.baseURL,this.timeout=s.timeout??vT.DEFAULT_TIMEOUT,this.logger=s.logger??console;let c="warn";this.logLevel=c,this.logLevel=qA(s.logLevel,"ClientOptions.logLevel",this)??qA(Va("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??c,this.fetchOptions=s.fetchOptions,this.maxRetries=s.maxRetries??2,this.fetch=s.fetch??y4(),ce(this,Uy,b4,"f"),this._options=s,this.apiKey=typeof r=="string"?r:"Missing Key",this.organization=n,this.project=i,this.webhookSecret=o}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:r}){}async authHeaders(e){return H([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return GA(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${ja}`}defaultIdempotencyKey(){return`stainless-node-retry-${MA()}`}makeStatusError(e,r,n,i){return Dt.generate(e,r,n,i)}async _callApiKey(){let e=this._options.apiKey;if(typeof e!="function")return!1;let r;try{r=await e()}catch(n){throw n instanceof Y?n:new Y(`Failed to get token from 'apiKey' function: ${n.message}`,{cause:n})}if(typeof r!="string"||!r)throw new Y(`Expected 'apiKey' function argument to return a string but it returned ${r}`);return this.apiKey=r,!0}buildURL(e,r,n){let i=!A(this,yT,"m",lU).call(this)&&n||this.baseURL,o=c4(e)?new URL(e):new URL(i+(i.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return u4(a)||(r={...a,...r}),typeof r=="object"&&r&&!Array.isArray(r)&&(o.search=this.stringifyQuery(r)),o.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,{url:r,options:n}){}get(e,r){return this.methodRequest("get",e,r)}post(e,r){return this.methodRequest("post",e,r)}patch(e,r){return this.methodRequest("patch",e,r)}put(e,r){return this.methodRequest("put",e,r)}delete(e,r){return this.methodRequest("delete",e,r)}methodRequest(e,r,n){return this.request(Promise.resolve(n).then(i=>({method:e,path:r,...i})))}request(e,r=null){return new tc(this,this.makeRequest(e,r,void 0))}async makeRequest(e,r,n){let i=await e,o=i.maxRetries??this.maxRetries;r==null&&(r=o),await this.prepareOptions(i);let{req:a,url:s,timeout:c}=await this.buildRequest(i,{retryCount:o-r});await this.prepareRequest(a,{url:s,options:i});let u="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),l=n===void 0?"":`, retryOf: ${n}`,p=Date.now();if(At(this).debug(`[${u}] sending request`,Mo({retryOfRequestLogID:n,method:i.method,url:s,options:i,headers:a.headers})),i.signal?.aborted)throw new xt;let f=new AbortController,m=await this.fetchWithTimeout(s,a,c,f).catch(uf),h=Date.now();if(m instanceof globalThis.Error){let y=`retrying, ${r} attempts remaining`;if(i.signal?.aborted)throw new xt;let v=cf(m)||/timed? ?out/i.test(String(m)+("cause"in m?String(m.cause):""));if(r)return At(this).info(`[${u}] connection ${v?"timed out":"failed"} - ${y}`),At(this).debug(`[${u}] connection ${v?"timed out":"failed"} (${y})`,Mo({retryOfRequestLogID:n,url:s,durationMs:h-p,message:m.message})),this.retryRequest(i,r,n??u);throw At(this).info(`[${u}] connection ${v?"timed out":"failed"} - error; no more retries left`),At(this).debug(`[${u}] connection ${v?"timed out":"failed"} (error; no more retries left)`,Mo({retryOfRequestLogID:n,url:s,durationMs:h-p,message:m.message})),v?new Vi:new za({cause:m})}let g=[...m.headers.entries()].filter(([y])=>y==="x-request-id").map(([y,v])=>", "+y+": "+JSON.stringify(v)).join(""),x=`[${u}${l}${g}] ${a.method} ${s} ${m.ok?"succeeded":"failed"} with status ${m.status} in ${h-p}ms`;if(!m.ok){let y=await this.shouldRetry(m);if(r&&y){let U=`retrying, ${r} attempts remaining`;return await v4(m.body),At(this).info(`${x} - ${U}`),At(this).debug(`[${u}] response error (${U})`,Mo({retryOfRequestLogID:n,url:m.url,status:m.status,headers:m.headers,durationMs:h-p})),this.retryRequest(i,r,n??u,m.headers)}let v=y?"error; no more retries left":"error; not retryable";At(this).info(`${x} - ${v}`);let S=await m.text().catch(U=>uf(U).message),k=d4(S),T=k?void 0:S;throw At(this).debug(`[${u}] response error (${v})`,Mo({retryOfRequestLogID:n,url:m.url,status:m.status,headers:m.headers,message:T,durationMs:Date.now()-p})),this.makeStatusError(m.status,k,T,m.headers)}return At(this).info(x),At(this).debug(`[${u}] response start`,Mo({retryOfRequestLogID:n,url:m.url,status:m.status,headers:m.headers,durationMs:h-p})),{response:m,options:i,controller:f,requestLogID:u,retryOfRequestLogID:n,startTime:p}}getAPIList(e,r,n){return this.requestAPIList(r,{method:"get",path:e,...n})}requestAPIList(e,r){let n=this.makeRequest(r,null,void 0);return new hf(this,n,e)}async fetchWithTimeout(e,r,n,i){let{signal:o,method:a,...s}=r||{};o&&o.addEventListener("abort",()=>i.abort());let c=setTimeout(()=>i.abort(),n),u=globalThis.ReadableStream&&s.body instanceof globalThis.ReadableStream||typeof s.body=="object"&&s.body!==null&&Symbol.asyncIterator in s.body,l={signal:i.signal,...u?{duplex:"half"}:{},method:"GET",...s};a&&(l.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,l)}finally{clearTimeout(c)}}async shouldRetry(e){let r=e.headers.get("x-should-retry");return r==="true"?!0:r==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,r,n,i){let o,a=i?.get("retry-after-ms");if(a){let c=parseFloat(a);Number.isNaN(c)||(o=c)}let s=i?.get("retry-after");if(s&&!o){let c=parseFloat(s);Number.isNaN(c)?o=Date.parse(s)-Date.now():o=c*1e3}if(!(o&&0<=o&&o<60*1e3)){let c=e.maxRetries??this.maxRetries;o=this.calculateDefaultRetryTimeoutMillis(r,c)}return await Gi(o),this.makeRequest(e,r-1,n)}calculateDefaultRetryTimeoutMillis(e,r){let o=r-e,a=Math.min(.5*Math.pow(2,o),8),s=1-Math.random()*.25;return a*s*1e3}async buildRequest(e,{retryCount:r=0}={}){let n={...e},{method:i,path:o,query:a,defaultBaseURL:s}=n,c=this.buildURL(o,a,s);"timeout"in n&&p4("timeout",n.timeout),n.timeout=n.timeout??this.timeout;let{bodyHeaders:u,body:l}=this.buildBody({options:n}),p=await this.buildHeaders({options:e,method:i,bodyHeaders:u,retryCount:r});return{req:{method:i,headers:p,...n.signal&&{signal:n.signal},...globalThis.ReadableStream&&l instanceof globalThis.ReadableStream&&{duplex:"half"},...l&&{body:l},...this.fetchOptions??{},...n.fetchOptions??{}},url:c,timeout:n.timeout}}async buildHeaders({options:e,method:r,bodyHeaders:n,retryCount:i}){let o={};this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);let a=H([o,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(i),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},..._4(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,n,e.headers]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:r}}){if(!e)return{bodyHeaders:void 0,body:void 0};let n=H([r]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&n.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:fy(e)}:A(this,Uy,"f").call(this,{body:e,headers:n})}};vT=me,Uy=new WeakMap,yT=new WeakSet,lU=function(){return this.baseURL!=="https://api.openai.com/v1"};me.OpenAI=vT;me.DEFAULT_TIMEOUT=6e5;me.OpenAIError=Y;me.APIError=Dt;me.APIConnectionError=za;me.APIConnectionTimeoutError=Vi;me.APIUserAbortError=xt;me.NotFoundError=nl;me.ConflictError=il;me.RateLimitError=al;me.BadRequestError=el;me.AuthenticationError=tl;me.InternalServerError=sl;me.PermissionDeniedError=rl;me.UnprocessableEntityError=ol;me.InvalidWebhookSignatureError=Zi;me.toFile=_f;me.Completions=lc;me.Chat=Ua;me.Embeddings=dc;me.Files=mc;me.Images=yc;me.Audio=Wi;me.Moderations=bc;me.Models=vc;me.FineTuning=di;me.Graders=Ka;me.VectorStores=Vo;me.Webhooks=xc;me.Beta=pi;me.Batches=oc;me.Uploads=Ja;me.Responses=Bo;me.Realtime=Fo;me.Conversations=Ha;me.Evals=qa;me.Containers=Ga;me.Videos=wc;function Xi(t){if(!t||typeof t!="object")return t;let e;return t.constructor.name===Vi.name&&"message"in t&&typeof t.message=="string"?(e=new Error(t.message),e.name="TimeoutError"):t.constructor.name===xt.name&&"message"in t&&typeof t.message=="string"?(e=new Error(t.message),e.name="AbortError"):"status"in t&&t.status===400&&"message"in t&&typeof t.message=="string"&&t.message.includes("tool_calls")?e=sf(t,"INVALID_TOOL_RESULTS"):"status"in t&&t.status===401?e=sf(t,"MODEL_AUTHENTICATION"):"status"in t&&t.status===429?e=sf(t,"MODEL_RATE_LIMIT"):"status"in t&&t.status===404?e=sf(t,"MODEL_NOT_FOUND"):e=t,e}var Zo=t=>t();function Go(t){return t?!!(/^o\d/.test(t??"")||t.startsWith("gpt-5")&&!t.startsWith("gpt-5-chat")):!1}function mJ(t){return t.role!=="system"&&t.role!=="developer"&&t.role!=="assistant"&&t.role!=="user"&&t.role!=="function"&&t.role!=="tool"&&console.warn(`Unknown message role: ${t.role}`),t.role}function Zl(t){let e=t.metadata?.filename??t.metadata?.name??t.metadata?.title;if(!e)throw new Error("a filename or name or title is needed via meta-data for OpenAI when working with multimodal blocks");return e}function Ho(t){let e=t._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":if(!_r.isInstance(t))throw new Error("Invalid generic chat message");return mJ(t);default:throw new Error(`Unknown message type: ${e}`)}}function pU(t){return t.includes("gpt-5.2-pro")}function Xa(t){let{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:r,azureOpenAIApiKey:n,azureOpenAIBasePath:i,baseURL:o,azureADTokenProvider:a,azureOpenAIEndpoint:s}=t;if((n||a)&&i&&e)return`${i}/${e}`;if((n||a)&&s&&e)return`${s}/openai/deployments/${e}`;if(n||a){if(!r)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${r}.openai.azure.com/openai/deployments/${e}`}return o}function wT(t){return typeof Headers<"u"&&t!==null&&typeof t=="object"&&Object.prototype.toString.call(t)==="[object Headers]"}function dU(t){let e=Zo(()=>{if(wT(t))return t;if(Array.isArray(t))return new Headers(t);if(typeof t=="object"&&t!==null&&"values"in t&&wT(t.values))return t.values;if(typeof t=="object"&&t!==null){let r=Object.entries(t).filter(([,n])=>typeof n=="string").map(([n,i])=>[n,i]);return new Headers(r)}return new Headers});return Object.fromEntries(e.entries())}function fU(){let t=Yf();return(t==="node"||t==="deno")&&(t=`(${t}/${process.version}; ${process.platform}; ${process.arch})`),t}function Ya(t,e=!1,r="1.0.0"){let n=dU(t),i=fU(),o=`langchainjs${e?"-azure":""}-openai`;return{...n,"User-Agent":n["User-Agent"]?`${o}/${r} (${i})${n["User-Agent"]}`:`${o}/${r} (${i})`}}function mU(t,e){let r;return Zs(t)?r=LE(t):r=t,e?.strict!==void 0&&(r.function.strict=e.strict),r}function hJ(t){return t.anyOf!==void 0&&Array.isArray(t.anyOf)}function hU(t){let e=["namespace functions {",""];for(let r of t)r.description&&e.push(`// ${r.description}`),Object.keys(r.parameters.properties??{}).length>0?(e.push(`type ${r.name} = (_: {`),e.push(gU(r.parameters,0)),e.push("}) => any;")):e.push(`type ${r.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function gU(t,e){let r=[];for(let[n,i]of Object.entries(t.properties??{}))i.description&&e<2&&r.push(`// ${i.description}`),t.required?.includes(n)?r.push(`${n}: ${Fy(i,e)},`):r.push(`${n}?: ${Fy(i,e)},`);return r.map(n=>" ".repeat(e)+n).join(`
`)}function Fy(t,e){if(hJ(t))return t.anyOf.map(r=>Fy(r,e)).join(" | ");switch(t.type){case"string":return t.enum?t.enum.map(r=>`"${r}"`).join(" | "):"string";case"number":return t.enum?t.enum.map(r=>`${r}`).join(" | "):"number";case"integer":return t.enum?t.enum.map(r=>`${r}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",gU(t,e+2),"}"].join(`
`);case"array":return t.items?`${Fy(t.items,e)}[]`:"any[]";default:return""}}function By(t){if(t)return t==="any"||t==="required"?"required":t==="auto"?"auto":t==="none"?"none":typeof t=="string"?{type:"function",function:{name:t}}:t}function Gl(t){return"type"in t&&t.type!=="function"}function _U(t){return typeof t=="object"&&t!==null&&"extras"in t&&typeof t.extras=="object"&&t.extras!==null&&"providerToolDefinition"in t.extras&&typeof t.extras.providerToolDefinition=="object"&&t.extras.providerToolDefinition!==null}function yU(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type!=="function"}function Sc(t){return typeof t=="object"&&t!==null&&"metadata"in t&&typeof t.metadata=="object"&&t.metadata!==null&&"customTool"in t.metadata&&typeof t.metadata.customTool=="object"&&t.metadata.customTool!==null}function Vy(t){return"type"in t&&t.type==="custom"&&"custom"in t&&typeof t.custom=="object"&&t.custom!==null}function vU(t){if(t.type==="custom_tool_call")return{...t,type:"tool_call",call_id:t.id,id:t.call_id,name:t.name,isCustomTool:!0,args:{input:t.input}}}function bU(t){if(t.type==="computer_call")return{...t,type:"tool_call",call_id:t.id,id:t.call_id,name:"computer_use",isComputerTool:!0,args:{action:t.action}}}function wU(t){return typeof t=="object"&&t!==null&&"type"in t&&t.type==="tool_call"&&"isComputerTool"in t&&t.isComputerTool===!0}function xU(t){return typeof t=="object"&&t!==null&&"type"in t&&t.type==="tool_call"&&"isCustomTool"in t&&t.isCustomTool===!0}function SU(t){let e=()=>{if(t.custom.format){if(t.custom.format.type==="grammar")return{type:"grammar",definition:t.custom.format.grammar.definition,syntax:t.custom.format.grammar.syntax};if(t.custom.format.type==="text")return{type:"text"}}};return{type:"custom",name:t.custom.name,description:t.custom.description,format:e()}}function IU(t){let e=()=>{if(t.format){if(t.format.type==="grammar")return{type:"grammar",grammar:{definition:t.format.definition,syntax:t.format.syntax}};if(t.format.type==="text")return{type:"text"}}};return{type:"custom",custom:{name:t.name,description:t.description,format:e()}}}var EU=Symbol("Let zodToJsonSchema decide on which parser to use"),kU={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},AU=t=>typeof t=="string"?{...kU,basePath:["#"],definitions:{},name:t}:{...kU,basePath:["#"],definitions:{},...t};var Of=t=>"_def"in t?t._def:t;function TU(t){if(!t)return!0;for(let e in t)return!1;return!0}var $U=t=>{let e=AU(t),r=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:r,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(e.definitions).map(([n,i])=>[Of(i),{def:Of(i),path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function xT(t,e,r,n){n?.errorMessages&&r&&(t.errorMessage={...t.errorMessage,[e]:r})}function Ve(t,e,r,n,i){t[e]=r,xT(t,e,n,i)}function OU(){return{}}function CU(t,e){let r={type:"array"};return t.type?._def?.typeName!==O.ZodAny&&(r.items=he(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&Ve(r,"minItems",t.minLength.value,t.minLength.message,e),t.maxLength&&Ve(r,"maxItems",t.maxLength.value,t.maxLength.message,e),t.exactLength&&(Ve(r,"minItems",t.exactLength.value,t.exactLength.message,e),Ve(r,"maxItems",t.exactLength.value,t.exactLength.message,e)),r}function PU(t,e){let r={type:"integer",format:"int64"};if(!t.checks)return r;for(let n of t.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?Ve(r,"minimum",n.value,n.message,e):Ve(r,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(r.exclusiveMinimum=!0),Ve(r,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Ve(r,"maximum",n.value,n.message,e):Ve(r,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(r.exclusiveMaximum=!0),Ve(r,"maximum",n.value,n.message,e));break;case"multipleOf":Ve(r,"multipleOf",n.value,n.message,e);break}return r}function NU(){return{type:"boolean"}}function RU(t,e){return he(t.type._def,e)}var MU=(t,e)=>he(t.innerType._def,e);function ST(t,e,r){let n=r??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((i,o)=>ST(t,e,i))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return gJ(t,e)}}var gJ=(t,e)=>{let r={type:"integer",format:"unix-time"};if(e.target==="openApi3")return r;for(let n of t.checks)switch(n.kind){case"min":Ve(r,"minimum",n.value,n.message,e);break;case"max":Ve(r,"maximum",n.value,n.message,e);break}return r};function zU(t,e){return{...he(t.innerType._def,e),default:t.defaultValue()}}function jU(t,e,r){return e.effectStrategy==="input"?he(t.schema._def,e,r):{}}function DU(t){return{type:"string",enum:[...t.values]}}var _J=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function LU(t,e){let r=[he(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),he(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(o=>!!o),n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,i=[];return r.forEach(o=>{if(_J(o))i.push(...o.allOf),o.unevaluatedProperties===void 0&&(n=void 0);else{let a=o;if("additionalProperties"in o&&o.additionalProperties===!1){let{additionalProperties:s,...c}=o;a=c}else n=void 0;i.push(a)}}),i.length?{allOf:i,...n}:void 0}function UU(t,e){let r=typeof t.value;return r!=="bigint"&&r!=="number"&&r!=="boolean"&&r!=="string"?{type:Array.isArray(t.value)?"array":"object"}:e.target==="openApi3"?{type:r==="bigint"?"integer":r,enum:[t.value]}:{type:r==="bigint"?"integer":r,const:t.value}}var IT,Ic={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(IT===void 0&&(IT=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),IT),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function Zy(t,e){let r={type:"string"};function n(i){return e.patternStrategy==="escape"?yJ(i):i}if(t.checks)for(let i of t.checks)switch(i.kind){case"min":Ve(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,i.value):i.value,i.message,e);break;case"max":Ve(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,i.value):i.value,i.message,e);break;case"email":switch(e.emailStrategy){case"format:email":fi(r,"email",i.message,e);break;case"format:idn-email":fi(r,"idn-email",i.message,e);break;case"pattern:zod":mi(r,Ic.email,i.message,e);break}break;case"url":fi(r,"uri",i.message,e);break;case"uuid":fi(r,"uuid",i.message,e);break;case"regex":mi(r,i.regex,i.message,e);break;case"cuid":mi(r,Ic.cuid,i.message,e);break;case"cuid2":mi(r,Ic.cuid2,i.message,e);break;case"startsWith":mi(r,RegExp(`^${n(i.value)}`),i.message,e);break;case"endsWith":mi(r,RegExp(`${n(i.value)}$`),i.message,e);break;case"datetime":fi(r,"date-time",i.message,e);break;case"date":fi(r,"date",i.message,e);break;case"time":fi(r,"time",i.message,e);break;case"duration":fi(r,"duration",i.message,e);break;case"length":Ve(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,i.value):i.value,i.message,e),Ve(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,i.value):i.value,i.message,e);break;case"includes":{mi(r,RegExp(n(i.value)),i.message,e);break}case"ip":{i.version!=="v6"&&fi(r,"ipv4",i.message,e),i.version!=="v4"&&fi(r,"ipv6",i.message,e);break}case"emoji":mi(r,Ic.emoji,i.message,e);break;case"ulid":{mi(r,Ic.ulid,i.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{fi(r,"binary",i.message,e);break}case"contentEncoding:base64":{Ve(r,"contentEncoding","base64",i.message,e);break}case"pattern:zod":{mi(r,Ic.base64,i.message,e);break}}break}case"nanoid":mi(r,Ic.nanoid,i.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return r}var yJ=t=>Array.from(t).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),fi=(t,e,r,n)=>{t.format||t.anyOf?.some(i=>i.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format,...t.errorMessage&&n.errorMessages&&{errorMessage:{format:t.errorMessage.format}}}),delete t.format,t.errorMessage&&(delete t.errorMessage.format,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.anyOf.push({format:e,...r&&n.errorMessages&&{errorMessage:{format:r}}})):Ve(t,"format",e,r,n)},mi=(t,e,r,n)=>{t.pattern||t.allOf?.some(i=>i.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern,...t.errorMessage&&n.errorMessages&&{errorMessage:{pattern:t.errorMessage.pattern}}}),delete t.pattern,t.errorMessage&&(delete t.errorMessage.pattern,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.allOf.push({pattern:FU(e,n),...r&&n.errorMessages&&{errorMessage:{pattern:r}}})):Ve(t,"pattern",FU(e,n),r,n)},FU=(t,e)=>{let r=typeof t=="function"?t():t;if(!e.applyRegexFlags||!r.flags)return r.source;let n={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},i=n.i?r.source.toLowerCase():r.source,o="",a=!1,s=!1,c=!1;for(let u=0;u<i.length;u++){if(a){o+=i[u],a=!1;continue}if(n.i){if(s){if(i[u].match(/[a-z]/)){c?(o+=i[u],o+=`${i[u-2]}-${i[u]}`.toUpperCase(),c=!1):i[u+1]==="-"&&i[u+2]?.match(/[a-z]/)?(o+=i[u],c=!0):o+=`${i[u]}${i[u].toUpperCase()}`;continue}}else if(i[u].match(/[a-z]/)){o+=`[${i[u]}${i[u].toUpperCase()}]`;continue}}if(n.m){if(i[u]==="^"){o+=`(^|(?<=[\r
]))`;continue}else if(i[u]==="$"){o+=`($|(?=[\r
]))`;continue}}if(n.s&&i[u]==="."){o+=s?`${i[u]}\r
`:`[${i[u]}\r
]`;continue}o+=i[u],i[u]==="\\"?a=!0:s&&i[u]==="]"?s=!1:!s&&i[u]==="["&&(s=!0)}try{let u=new RegExp(o)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return o};function Gy(t,e){if(e.target==="openApi3"&&t.keyType?._def.typeName===O.ZodEnum)return{type:"object",required:t.keyType._def.values,properties:t.keyType._def.values.reduce((n,i)=>({...n,[i]:he(t.valueType._def,{...e,currentPath:[...e.currentPath,"properties",i]})??{}}),{}),additionalProperties:!1};let r={type:"object",additionalProperties:he(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return r;if(t.keyType?._def.typeName===O.ZodString&&t.keyType._def.checks?.length){let n=Object.entries(Zy(t.keyType._def,e)).reduce((i,[o,a])=>o==="type"?i:{...i,[o]:a},{});return{...r,propertyNames:n}}else if(t.keyType?._def.typeName===O.ZodEnum)return{...r,propertyNames:{enum:t.keyType._def.values}};return r}function BU(t,e){if(e.mapStrategy==="record")return Gy(t,e);let r=he(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=he(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[r,n],minItems:2,maxItems:2}}}function VU(t){let e=t.values,n=Object.keys(t.values).filter(o=>typeof e[e[o]]!="number").map(o=>e[o]),i=Array.from(new Set(n.map(o=>typeof o)));return{type:i.length===1?i[0]==="string"?"string":"number":["string","number"],enum:n}}function ZU(){return{not:{}}}function GU(t){return t.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var Cf={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function qU(t,e){if(e.target==="openApi3")return HU(t,e);let r=t.options instanceof Map?Array.from(t.options.values()):t.options;if(r.every(n=>n._def.typeName in Cf&&(!n._def.checks||!n._def.checks.length))){let n=r.reduce((i,o)=>{let a=Cf[o._def.typeName];return a&&!i.includes(a)?[...i,a]:i},[]);return{type:n.length>1?n:n[0]}}else if(r.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){let n=r.reduce((i,o)=>{let a=typeof o._def.value;switch(a){case"string":case"number":case"boolean":return[...i,a];case"bigint":return[...i,"integer"];case"object":if(o._def.value===null)return[...i,"null"];default:return i}},[]);if(n.length===r.length){let i=n.filter((o,a,s)=>s.indexOf(o)===a);return{type:i.length>1?i:i[0],enum:r.reduce((o,a)=>o.includes(a._def.value)?o:[...o,a._def.value],[])}}}else if(r.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:r.reduce((n,i)=>[...n,...i._def.values.filter(o=>!n.includes(o))],[])};return HU(t,e)}var HU=(t,e)=>{let r=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((n,i)=>he(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${i}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return r.length?{anyOf:r}:void 0};function KU(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return e.target==="openApi3"||e.nullableStrategy==="property"?{type:Cf[t.innerType._def.typeName],nullable:!0}:{type:[Cf[t.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let n=he(t.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}let r=he(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}function WU(t,e){let r={type:"number"};if(!t.checks)return r;for(let n of t.checks)switch(n.kind){case"int":r.type="integer",xT(r,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?Ve(r,"minimum",n.value,n.message,e):Ve(r,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(r.exclusiveMinimum=!0),Ve(r,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Ve(r,"maximum",n.value,n.message,e):Ve(r,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(r.exclusiveMaximum=!0),Ve(r,"maximum",n.value,n.message,e));break;case"multipleOf":Ve(r,"multipleOf",n.value,n.message,e);break}return r}function vJ(t,e){return e.removeAdditionalStrategy==="strict"?t.catchall._def.typeName==="ZodNever"?t.unknownKeys!=="strict":he(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:t.catchall._def.typeName==="ZodNever"?t.unknownKeys==="passthrough":he(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function JU(t,e){let r={type:"object",...Object.entries(t.shape()).reduce((n,[i,o])=>{if(o===void 0||o._def===void 0)return n;let a=[...e.currentPath,"properties",i],s=he(o._def,{...e,currentPath:a,propertyPath:a});if(s===void 0)return n;if(e.openaiStrictMode&&o.isOptional()&&!o.isNullable()&&typeof o._def?.defaultValue>"u")throw new Error(`Zod field at \`${a.join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required`);return{properties:{...n.properties,[i]:s},required:o.isOptional()&&!e.openaiStrictMode?n.required:[...n.required,i]}},{properties:{},required:[]}),additionalProperties:vJ(t,e)};return r.required.length||delete r.required,r}var XU=(t,e)=>{if(e.propertyPath&&e.currentPath.slice(0,e.propertyPath.length).toString()===e.propertyPath.toString())return he(t.innerType._def,{...e,currentPath:e.currentPath});let r=he(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return r?{anyOf:[{not:{}},r]}:{}};var YU=(t,e)=>{if(e.pipeStrategy==="input")return he(t.in._def,e);if(e.pipeStrategy==="output")return he(t.out._def,e);let r=he(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=he(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,n].filter(i=>i!==void 0)}};function QU(t,e){return he(t.type._def,e)}function e2(t,e){let n={type:"array",uniqueItems:!0,items:he(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&Ve(n,"minItems",t.minSize.value,t.minSize.message,e),t.maxSize&&Ve(n,"maxItems",t.maxSize.value,t.maxSize.message,e),n}function t2(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((r,n)=>he(r._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[]),additionalItems:he(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((r,n)=>he(r._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[])}}function r2(){return{not:{}}}function n2(){return{}}var i2=(t,e)=>he(t.innerType._def,e);function he(t,e,r=!1){let n=e.seen.get(t);if(e.override){let a=e.override?.(t,e,n,r);if(a!==EU)return a}if(n&&!r){let a=bJ(n,e);if(a!==void 0)return"$ref"in a&&e.seenRefs.add(a.$ref),a}let i={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,i);let o=xJ(t,t.typeName,e,r);return o&&SJ(t,e,o),i.jsonSchema=o,o}var bJ=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"extract-to-root":let r=t.path.slice(e.basePath.length+1).join("_");return r!==e.name&&e.nameStrategy==="duplicate-ref"&&(e.definitions[r]=t.def),{$ref:[...e.basePath,e.definitionPath,r].join("/")};case"relative":return{$ref:wJ(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((n,i)=>e.currentPath[i]===n)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},wJ=(t,e)=>{let r=0;for(;r<t.length&&r<e.length&&t[r]===e[r];r++);return[(t.length-r).toString(),...e.slice(r)].join("/")},xJ=(t,e,r,n)=>{switch(e){case O.ZodString:return Zy(t,r);case O.ZodNumber:return WU(t,r);case O.ZodObject:return JU(t,r);case O.ZodBigInt:return PU(t,r);case O.ZodBoolean:return NU();case O.ZodDate:return ST(t,r);case O.ZodUndefined:return r2();case O.ZodNull:return GU(r);case O.ZodArray:return CU(t,r);case O.ZodUnion:case O.ZodDiscriminatedUnion:return qU(t,r);case O.ZodIntersection:return LU(t,r);case O.ZodTuple:return t2(t,r);case O.ZodRecord:return Gy(t,r);case O.ZodLiteral:return UU(t,r);case O.ZodEnum:return DU(t);case O.ZodNativeEnum:return VU(t);case O.ZodNullable:return KU(t,r);case O.ZodOptional:return XU(t,r);case O.ZodMap:return BU(t,r);case O.ZodSet:return e2(t,r);case O.ZodLazy:return he(t.getter()._def,r);case O.ZodPromise:return QU(t,r);case O.ZodNaN:case O.ZodNever:return ZU();case O.ZodEffects:return jU(t,r,n);case O.ZodAny:return OU();case O.ZodUnknown:return n2();case O.ZodDefault:return zU(t,r);case O.ZodBranded:return RU(t,r);case O.ZodReadonly:return i2(t,r);case O.ZodCatch:return MU(t,r);case O.ZodPipeline:return YU(t,r);case O.ZodFunction:case O.ZodVoid:case O.ZodSymbol:return;default:return(i=>{})(e)}},SJ=(t,e,r)=>(t.description&&(r.description=t.description,e.markdownDescription&&(r.markdownDescription=t.description)),r);var kT=(t,e)=>{let r=$U(e),n=typeof e=="string"?e:e?.nameStrategy==="title"?void 0:e?.name,i=he(t._def,n===void 0?r:{...r,currentPath:[...r.basePath,r.definitionPath,n]},!1)??{},o=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;o!==void 0&&(i.title=o);let a=(()=>{if(TU(r.definitions))return;let c={},u=new Set;for(let l=0;l<500;l++){let p=Object.entries(r.definitions).filter(([f])=>!u.has(f));if(p.length===0)break;for(let[f,m]of p)c[f]=he(Of(m),{...r,currentPath:[...r.basePath,r.definitionPath,f]},!0)??{},u.add(f)}return c})(),s=n===void 0?a?{...i,[r.definitionPath]:a}:i:r.nameStrategy==="duplicate-ref"?{...i,...a||r.seenRefs.size?{[r.definitionPath]:{...a,...r.seenRefs.size?{[n]:i}:void 0}}:void 0}:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,n].join("/"),[r.definitionPath]:{...a,[n]:i}};return r.target==="jsonSchema7"?s.$schema="http://json-schema.org/draft-07/schema#":r.target==="jsonSchema2019-09"&&(s.$schema="https://json-schema.org/draft/2019-09/schema#"),s};function o2(t){if(t.type!=="object")throw new Error(`Root schema must have type: 'object' but got type: ${t.type?`'${t.type}'`:"undefined"}`);let e=structuredClone(t);return qo(e,[],e)}function ET(t){if(typeof t=="boolean")return!1;if(t.type==="null")return!0;for(let e of t.oneOf??[])if(ET(e))return!0;for(let e of t.anyOf??[])if(ET(e))return!0;return!1}function qo(t,e,r){if(typeof t=="boolean")throw new TypeError(`Expected object schema but got boolean; path=${e.join("/")}`);if(!kc(t))throw new TypeError(`Expected ${JSON.stringify(t)} to be an object; path=${e.join("/")}`);let n=t.$defs;if(kc(n))for(let[f,m]of Object.entries(n))qo(m,[...e,"$defs",f],r);let i=t.definitions;if(kc(i))for(let[f,m]of Object.entries(i))qo(m,[...e,"definitions",f],r);t.type==="object"&&!("additionalProperties"in t)&&(t.additionalProperties=!1);let a=t.required??[],s=t.properties;if(kc(s)){for(let[f,m]of Object.entries(s))if(!ET(m)&&!a.includes(f))throw new Error(`Zod field at \`${[...e,"properties",f].join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required`);t.required=Object.keys(s),t.properties=Object.fromEntries(Object.entries(s).map(([f,m])=>[f,qo(m,[...e,"properties",f],r)]))}let c=t.items;kc(c)&&(t.items=qo(c,[...e,"items"],r));let u=t.anyOf;Array.isArray(u)&&(t.anyOf=u.map((f,m)=>qo(f,[...e,"anyOf",String(m)],r)));let l=t.allOf;if(Array.isArray(l))if(l.length===1){let f=qo(l[0],[...e,"allOf","0"],r);Object.assign(t,f),delete t.allOf}else t.allOf=l.map((f,m)=>qo(f,[...e,"allOf",String(m)],r));t.default===null&&delete t.default;let p=t.$ref;if(p&&kJ(t,1)){if(typeof p!="string")throw new TypeError(`Received non-string $ref - ${p}; path=${e.join("/")}`);let f=IJ(r,p);if(typeof f=="boolean")throw new Error(`Expected \`$ref: ${p}\` to resolve to an object schema but got boolean`);if(!kc(f))throw new Error(`Expected \`$ref: ${p}\` to resolve to an object but got ${JSON.stringify(f)}`);return Object.assign(t,{...f,...t}),delete t.$ref,qo(t,e,r)}return t}function IJ(t,e){if(!e.startsWith("#/"))throw new Error(`Unexpected $ref format ${JSON.stringify(e)}; Does not start with #/`);let r=e.slice(2).split("/"),n=t;for(let i of r){if(!kc(n))throw new Error(`encountered non-object entry while resolving ${e} - ${JSON.stringify(n)}`);let o=n[i];if(o===void 0)throw new Error(`Key ${i} not found while resolving ${e}`);n=o}return n}function kc(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function kJ(t,e){let r=0;for(let n in t)if(r++,r>e)return!0;return!1}function EJ(t,e){return kT(t,{openaiStrictMode:!0,name:e.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function AJ(t){return o2(_o(t,{target:"draft-7"}))}function TJ(t){return"_zod"in t}function a2(t,e,r){return D4({type:"json_schema",json_schema:{...r,name:e,strict:!0,schema:TJ(t)?AJ(t):EJ(t,{name:e})}},n=>t.parse(JSON.parse(n)))}var s2=["jsonSchema","functionCalling","jsonMode"];function c2(t,e){if(typeof e<"u"&&!s2.includes(e))throw new Error(`Invalid method: ${e}. Supported methods are: ${s2.join(", ")}`);let r=!t.startsWith("gpt-3")&&!t.startsWith("gpt-4-")&&t!=="gpt-4";if(r&&!e)return"jsonSchema";if(!r&&e==="jsonSchema")throw new Error(`JSON Schema is not supported for model "${t}". Please use a different method, e.g. "functionCalling" or "jsonMode".`);return e??"functionCalling"}function $J(t,e){let r={...t};return Object.defineProperties(r,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),r}function u2(t,e,r){if(lt(t))return a2(t,e,r);if(rt(t))return $J({type:"json_schema",json_schema:{...r,name:e,strict:!0,schema:it(t,{cycles:"ref",reused:"ref",override(n){n.jsonSchema.title=e}})}},n=>ki(t,JSON.parse(n)));throw new Error("Unsupported schema response format")}function l2(t,e){if(e&&typeof e=="object"&&"images"in e&&Array.isArray(e.images)){let r=e.images.filter(n=>typeof n?.image_url?.url=="string").map(n=>({type:"image",url:n.image_url.url}));return[{type:"text",text:t},...r]}return t}var OJ={"gpt-4.1-nano":{maxInputTokens:1047576,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:32768,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"text-embedding-3-small":{maxInputTokens:8191,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1536,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4":{maxInputTokens:8192,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:8192,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o1-pro":{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4o-2024-05-13":{maxInputTokens:128e3,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:4096,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4o-2024-08-06":{maxInputTokens:128e3,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:16384,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4.1-mini":{maxInputTokens:1047576,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:32768,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o3-deep-research":{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-3.5-turbo":{maxInputTokens:16385,imageInputs:!1,audioInputs:!1,pdfInputs:!1,videoInputs:!1,maxOutputTokens:4096,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!1,imageUrlInputs:!1,pdfToolMessage:!1,imageToolMessage:!1,toolChoice:!0},"text-embedding-3-large":{maxInputTokens:8191,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:3072,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4-turbo":{maxInputTokens:128e3,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:4096,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o1-preview":{maxInputTokens:128e3,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:32768,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o3-mini":{maxInputTokens:2e5,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"codex-mini-latest":{maxInputTokens:2e5,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-5-nano":{maxInputTokens:4e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:128e3,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-5-codex":{maxInputTokens:4e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:128e3,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4o":{maxInputTokens:128e3,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:16384,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4.1":{maxInputTokens:1047576,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:32768,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o4-mini":{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},o1:{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-5-mini":{maxInputTokens:4e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:128e3,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o1-mini":{maxInputTokens:128e3,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:65536,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"text-embedding-ada-002":{maxInputTokens:8192,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1536,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o3-pro":{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4o-2024-11-20":{maxInputTokens:128e3,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:16384,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},o3:{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o4-mini-deep-research":{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-5-chat-latest":{maxInputTokens:4e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:128e3,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4o-mini":{maxInputTokens:128e3,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:16384,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-5":{maxInputTokens:4e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:128e3,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-5-pro":{maxInputTokens:4e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:272e3,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0}},p2=OJ;var Ec=class extends Ea{constructor(e){super(e??{});d(this,"temperature");d(this,"topP");d(this,"frequencyPenalty");d(this,"presencePenalty");d(this,"n");d(this,"logitBias");d(this,"model","gpt-3.5-turbo");d(this,"modelKwargs");d(this,"stop");d(this,"stopSequences");d(this,"user");d(this,"timeout");d(this,"streaming",!1);d(this,"streamUsage",!0);d(this,"maxTokens");d(this,"logprobs");d(this,"topLogprobs");d(this,"apiKey");d(this,"organization");d(this,"__includeRawResponse");d(this,"client");d(this,"clientConfig");d(this,"supportsStrictToolCalling");d(this,"audio");d(this,"modalities");d(this,"reasoning");d(this,"zdrEnabled");d(this,"service_tier");d(this,"promptCacheKey");d(this,"promptCacheRetention");d(this,"verbosity");d(this,"defaultOptions");d(this,"lc_serializable",!0);let r=typeof e?.configuration?.apiKey=="string"||typeof e?.configuration?.apiKey=="function"?e?.configuration?.apiKey:void 0;this.apiKey=e?.apiKey??r??ft("OPENAI_API_KEY"),this.organization=e?.configuration?.organization??ft("OPENAI_ORGANIZATION"),this.model=e?.model??e?.modelName??this.model,this.modelKwargs=e?.modelKwargs??{},this.timeout=e?.timeout,this.temperature=e?.temperature??this.temperature,this.topP=e?.topP??this.topP,this.frequencyPenalty=e?.frequencyPenalty??this.frequencyPenalty,this.presencePenalty=e?.presencePenalty??this.presencePenalty,this.logprobs=e?.logprobs,this.topLogprobs=e?.topLogprobs,this.n=e?.n??this.n,this.logitBias=e?.logitBias,this.stop=e?.stopSequences??e?.stop,this.stopSequences=this.stop,this.user=e?.user,this.__includeRawResponse=e?.__includeRawResponse,this.audio=e?.audio,this.modalities=e?.modalities,this.reasoning=e?.reasoning,this.maxTokens=e?.maxCompletionTokens??e?.maxTokens,this.promptCacheKey=e?.promptCacheKey??this.promptCacheKey,this.promptCacheRetention=e?.promptCacheRetention??this.promptCacheRetention,this.verbosity=e?.verbosity??this.verbosity,this.disableStreaming=e?.disableStreaming===!0,this.streaming=e?.streaming===!0,this.disableStreaming&&(this.streaming=!1),e?.streaming===!1&&(this.disableStreaming=!0),this.streamUsage=e?.streamUsage??this.streamUsage,this.disableStreaming&&(this.streamUsage=!1),this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...e?.configuration},e?.supportsStrictToolCalling!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling),e?.service_tier!==void 0&&(this.service_tier=e.service_tier),this.zdrEnabled=e?.zdrEnabled??!1}_llmType(){return"openai"}static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning","service_tier"]}get lc_secrets(){return{apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{apiKey:"openai_api_key",modelName:"model"}}get lc_serializable_keys(){return["configuration","logprobs","topLogprobs","prefixMessages","supportsStrictToolCalling","modalities","audio","temperature","maxTokens","topP","frequencyPenalty","presencePenalty","n","logitBias","user","streaming","streamUsage","model","modelName","modelKwargs","stop","stopSequences","timeout","apiKey","cache","maxConcurrency","maxRetries","verbose","callbacks","tags","metadata","disableStreaming","zdrEnabled","reasoning","promptCacheKey","promptCacheRetention","verbosity"]}getLsParams(e){let r=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:r.temperature??void 0,ls_max_tokens:r.max_tokens??void 0,ls_stop:e.stop}}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}identifyingParams(){return this._identifyingParams()}_getReasoningParams(e){if(!Go(this.model))return;let r;return this.reasoning!==void 0&&(r={...r,...this.reasoning}),e?.reasoning!==void 0&&(r={...r,...e.reasoning}),r}_getResponseFormat(e){return e&&e.type==="json_schema"&&e.json_schema.schema&&Er(e.json_schema.schema)?u2(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}_combineCallOptions(e){return{...this.defaultOptions,...e??{}}}_getClientOptions(e){if(!this.client){let n={baseURL:this.clientConfig.baseURL},i=Xa(n),o={...this.clientConfig,baseURL:i,timeout:this.timeout,maxRetries:0};o.baseURL||delete o.baseURL,o.defaultHeaders=Ya(o.defaultHeaders),this.client=new me(o)}return{...this.clientConfig,...e}}_convertChatOpenAIToolToCompletionsTool(e,r){return Sc(e)?IU(e.metadata.customTool):fd(e)?r?.strict!==void 0?{...e,function:{...e.function,strict:r.strict}}:e:mU(e,r)}bindTools(e,r){let n;return r?.strict!==void 0?n=r.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling),this.withConfig({tools:e.map(i=>Gl(i)||Sc(i)?i:_U(i)?i.extras.providerToolDefinition:this._convertChatOpenAIToolToCompletionsTool(i,{strict:n})),...r})}async stream(e,r){return super.stream(e,this._combineCallOptions(r))}async invoke(e,r){return super.invoke(e,this._combineCallOptions(r))}_combineLLMOutput(...e){return e.reduce((r,n)=>(n&&n.tokenUsage&&(r.tokenUsage.completionTokens+=n.tokenUsage.completionTokens??0,r.tokenUsage.promptTokens+=n.tokenUsage.promptTokens??0,r.tokenUsage.totalTokens+=n.tokenUsage.totalTokens??0),r),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}async getNumTokensFromMessages(e){let r=0,n=0,i=0;this.model==="gpt-3.5-turbo-0301"?(n=4,i=-1):(n=3,i=1);let o=await Promise.all(e.map(async a=>{let s=await this.getNumTokens(a.content),c=await this.getNumTokens(Ho(a)),u=a.name!==void 0?i+await this.getNumTokens(a.name):0,l=s+n+c+u,p=a;if(p._getType()==="function"&&(l-=2),p.additional_kwargs?.function_call&&(l+=3),p?.additional_kwargs.function_call?.name&&(l+=await this.getNumTokens(p.additional_kwargs.function_call?.name)),p.additional_kwargs.function_call?.arguments)try{l+=await this.getNumTokens(JSON.stringify(JSON.parse(p.additional_kwargs.function_call?.arguments)))}catch(f){console.error("Error parsing function arguments",f,JSON.stringify(p.additional_kwargs.function_call)),l+=await this.getNumTokens(p.additional_kwargs.function_call?.arguments)}return r+=l,l}));return r+=3,{totalCount:r,countPerMessage:o}}async _getNumTokensFromGenerations(e){return(await Promise.all(e.map(async n=>n.message.additional_kwargs?.function_call?(await this.getNumTokensFromMessages([n.message])).countPerMessage[0]:await this.getNumTokens(n.message.content)))).reduce((n,i)=>n+i,0)}async _getEstimatedTokenCountFromPrompt(e,r,n){let i=(await this.getNumTokensFromMessages(e)).totalCount;if(r&&n!=="auto"){let o=hU(r);i+=await this.getNumTokens(o),i+=9}return r&&e.find(o=>o._getType()==="system")&&(i-=4),n==="none"?i+=1:typeof n=="object"&&(i+=await this.getNumTokens(n.name)+4),i}async moderateContent(e,r){let n=this._getClientOptions(r?.options),i=r?.model??"omni-moderation-latest",o={input:e,model:i};return this.caller.call(async()=>{try{return await this.client.moderations.create(o,n)}catch(a){throw Xi(a)}})}get profile(){return p2[this.model]??{}}_getStructuredOutputMethod(e){let r={...e};if(!this.model.startsWith("gpt-3")&&!this.model.startsWith("gpt-4-")&&this.model!=="gpt-4"){if(r?.method===void 0)return"jsonSchema"}else r.method==="jsonSchema"&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`);return r.method}withStructuredOutput(e,r){let n,i,{schema:o,name:a,includeRaw:s}={...r,schema:e};if(r?.strict!==void 0&&r.method==="jsonMode")throw new Error("Argument `strict` is only supported for `method` = 'function_calling'");let c=c2(this.model,r?.method);if(c==="jsonMode"){Er(o)?i=Tu.fromZodSchema(o):i=new gd;let f=it(o);n=this.withConfig({outputVersion:"v0",response_format:{type:"json_object"},ls_structured_output_format:{kwargs:{method:"json_mode"},schema:{title:a??"extract",...f}}})}else if(c==="jsonSchema"){let f={name:a??"extract",description:Gn(o),schema:o,strict:r?.strict},m=it(f.schema);if(n=this.withConfig({outputVersion:"v0",response_format:{type:"json_schema",json_schema:f},ls_structured_output_format:{kwargs:{method:"json_schema"},schema:{title:f.name,description:f.description,...m}}}),Er(o)){let h=Tu.fromZodSchema(o);i=cr.from(g=>"parsed"in g.additional_kwargs?g.additional_kwargs.parsed:h)}else i=new gd}else{let f=a??"extract";if(Er(o)){let m=it(o);n=this.withConfig({outputVersion:"v0",tools:[{type:"function",function:{name:f,description:m.description,parameters:m}}],tool_choice:{type:"function",function:{name:f}},ls_structured_output_format:{kwargs:{method:"function_calling"},schema:{title:f,...m}},...r?.strict!==void 0?{strict:r.strict}:{}}),i=new _d({returnSingle:!0,keyName:f,zodSchema:o})}else{let m;typeof o.name=="string"&&typeof o.parameters=="object"&&o.parameters!=null?(m=o,f=o.name):(f=o.title??f,m={name:f,description:o.description??"",parameters:o});let h=it(o);n=this.withConfig({outputVersion:"v0",tools:[{type:"function",function:m}],tool_choice:{type:"function",function:{name:f}},ls_structured_output_format:{kwargs:{method:"function_calling"},schema:{title:f,...h}},...r?.strict!==void 0?{strict:r.strict}:{}}),i=new _d({returnSingle:!0,keyName:f})}}if(!s)return n.pipe(i);let u=Pn.assign({parsed:(f,m)=>i.invoke(f.raw,m)}),l=Pn.assign({parsed:()=>null}),p=u.withFallbacks({fallbacks:[l]});return Tr.from([{raw:n},p])}};var Hy={providerName:"ChatOpenAI",fromStandardTextBlock(t){return{type:"text",text:t.text}},fromStandardImageBlock(t){if(t.source_type==="url")return{type:"image_url",image_url:{url:t.url,...t.metadata?.detail?{detail:t.metadata.detail}:{}}};if(t.source_type==="base64")return{type:"image_url",image_url:{url:`data:${t.mime_type??""};base64,${t.data}`,...t.metadata?.detail?{detail:t.metadata.detail}:{}}};throw new Error(`Image content blocks with source_type ${t.source_type} are not supported for ChatOpenAI`)},fromStandardAudioBlock(t){if(t.source_type==="url"){let e=Yo({dataUrl:t.url});if(!e)throw new Error(`URL audio blocks with source_type ${t.source_type} must be formatted as a data URL for ChatOpenAI`);let r=e.mime_type||t.mime_type||"",n;try{n=Ql(r)}catch{throw new Error(`Audio blocks with source_type ${t.source_type} must have mime type of audio/wav or audio/mp3`)}if(n.type!=="audio"||n.subtype!=="wav"&&n.subtype!=="mp3")throw new Error(`Audio blocks with source_type ${t.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:n.subtype,data:e.data}}}if(t.source_type==="base64"){let e;try{e=Ql(t.mime_type??"")}catch{throw new Error(`Audio blocks with source_type ${t.source_type} must have mime type of audio/wav or audio/mp3`)}if(e.type!=="audio"||e.subtype!=="wav"&&e.subtype!=="mp3")throw new Error(`Audio blocks with source_type ${t.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:e.subtype,data:t.data}}}throw new Error(`Audio content blocks with source_type ${t.source_type} are not supported for ChatOpenAI`)},fromStandardFileBlock(t){if(t.source_type==="url"){let e=Yo({dataUrl:t.url}),r=Zl(t);if(!e)throw new Error(`URL file blocks with source_type ${t.source_type} must be formatted as a data URL for ChatOpenAI`);return{type:"file",file:{file_data:t.url,...t.metadata?.filename||t.metadata?.name?{filename:r}:{}}}}if(t.source_type==="base64"){let e=Zl(t);return{type:"file",file:{file_data:`data:${t.mime_type??""};base64,${t.data}`,...t.metadata?.filename||t.metadata?.name||t.metadata?.title?{filename:e}:{}}}}if(t.source_type==="id")return{type:"file",file:{file_id:t.id}};throw new Error(`File content blocks with source_type ${t.source_type} are not supported for ChatOpenAI`)}},AT=({message:t,rawResponse:e,includeRawResponse:r})=>{let n=t.tool_calls;switch(t.role){case"assistant":{let i=[],o=[];for(let u of n??[])try{i.push(Fs(u,{returnId:!0}))}catch(l){o.push(Aa(u,l.message))}let a={function_call:t.function_call,tool_calls:n};r!==void 0&&(a.__raw_response=e);let s={model_provider:"openai",model_name:e.model,...e.system_fingerprint?{usage:{...e.usage},system_fingerprint:e.system_fingerprint}:{}};t.audio&&(a.audio=t.audio);let c=l2(t.content||"",e.choices?.[0]?.message);return new Ue({content:c,tool_calls:i,invalid_tool_calls:o,additional_kwargs:a,response_metadata:s,id:e.id})}default:return new _r(t.content||"",t.role??"unknown")}},TT=({delta:t,rawResponse:e,includeRawResponse:r,defaultRole:n})=>{let i=t.role??n,o=t.content??"",a;t.function_call?a={function_call:t.function_call}:t.tool_calls?a={tool_calls:t.tool_calls}:a={},r&&(a.__raw_response=e),t.audio&&(a.audio={...t.audio,index:e.choices[0].index});let s={model_provider:"openai",usage:{...e.usage}};if(i==="user")return new so({content:o,response_metadata:s});if(i==="assistant"){let c=[];if(Array.isArray(t.tool_calls))for(let u of t.tool_calls)c.push({name:u.function?.name,args:u.function?.arguments,id:u.id,index:u.index,type:"tool_call_chunk"});return new st({content:o,tool_call_chunks:c,additional_kwargs:a,id:e.id,response_metadata:s})}else return i==="system"?new gn({content:o,response_metadata:s}):i==="developer"?new gn({content:o,response_metadata:s,additional_kwargs:{__openai_role__:"developer"}}):i==="function"?new ao({content:o,additional_kwargs:a,name:t.name,response_metadata:s}):i==="tool"?new Qo({content:o,additional_kwargs:a,tool_call_id:t.tool_call_id,response_metadata:s}):new oo({content:o,role:i,response_metadata:s})},d2=t=>{if(t.type==="image"){if(t.url)return{type:"image_url",image_url:{url:t.url}};if(t.data)return{type:"image_url",image_url:{url:`data:${t.mimeType};base64,${t.data}`}}}if(t.type==="audio"&&t.data){let e=Jf(()=>{let[,r]=t.mimeType.split("/");return r==="wav"||r==="mp3"?r:"wav"});return{type:"input_audio",input_audio:{data:t.data.toString(),format:e}}}if(t.type==="file"){if(t.data){let e=Zl(t);return{type:"file",file:{file_data:`data:${t.mimeType};base64,${t.data}`,filename:e}}}if(t.fileId)return{type:"file",file:{file_id:t.fileId}}}},f2=({message:t,model:e})=>{let r=Ho(t);if(r==="system"&&Go(e)&&(r="developer"),r==="developer")return{role:"developer",content:t.contentBlocks.filter(i=>i.type==="text")};if(r==="system")return{role:"system",content:t.contentBlocks.filter(i=>i.type==="text")};if(r==="assistant")return{role:"assistant",content:t.contentBlocks.filter(i=>i.type==="text")};if(r==="tool"&&rr.isInstance(t))return{role:"tool",tool_call_id:t.tool_call_id,content:t.contentBlocks.filter(i=>i.type==="text")};if(r==="function")return{role:"function",name:t.name??"",content:t.contentBlocks.filter(i=>i.type==="text").join("")};function*n(i){for(let o of i){o.type==="text"&&(yield{type:"text",text:o.text});let a=d2(o);a&&(yield a)}}return{role:"user",content:Array.from(n(t.contentBlocks))}},Pf=({messages:t,model:e})=>t.flatMap(r=>{if("output_version"in r.response_metadata&&r.response_metadata?.output_version==="v1")return f2({message:r});let n=Ho(r);n==="system"&&Go(e)&&(n="developer");let i=typeof r.content=="string"?r.content:r.content.map(a=>jr(a)?Nc(a,Hy):a),o={role:n,content:i};if(r.name!=null&&(o.name=r.name),r.additional_kwargs.function_call!=null&&(o.function_call=r.additional_kwargs.function_call),Ue.isInstance(r)&&r.tool_calls?.length?o.tool_calls=r.tool_calls.map(qg):(r.additional_kwargs.tool_calls!=null&&(o.tool_calls=r.additional_kwargs.tool_calls),rr.isInstance(r)&&r.tool_call_id!=null&&(o.tool_call_id=r.tool_call_id)),r.additional_kwargs.audio&&typeof r.additional_kwargs.audio=="object"&&"id"in r.additional_kwargs.audio){let a={role:"assistant",audio:{id:r.additional_kwargs.audio.id}};return[o,a]}return o});var qy=class extends Ec{invocationParams(t,e){let r;t?.strict!==void 0?r=t.strict:this.supportsStrictToolCalling!==void 0&&(r=this.supportsStrictToolCalling);let n={};t?.stream_options!==void 0?n={stream_options:t.stream_options}:this.streamUsage&&(this.streaming||e?.streaming)&&(n={stream_options:{include_usage:!0}});let i={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:t?.stop??this.stopSequences,user:this.user,stream:this.streaming,functions:t?.functions,function_call:t?.function_call,tools:t?.tools?.length?t.tools.map(a=>this._convertChatOpenAIToolToCompletionsTool(a,{strict:r})):void 0,tool_choice:By(t?.tool_choice),response_format:this._getResponseFormat(t?.response_format),seed:t?.seed,...n,parallel_tool_calls:t?.parallel_tool_calls,...this.audio||t?.audio?{audio:this.audio||t?.audio}:{},...this.modalities||t?.modalities?{modalities:this.modalities||t?.modalities}:{},...this.modelKwargs,prompt_cache_key:t?.promptCacheKey??this.promptCacheKey,prompt_cache_retention:t?.promptCacheRetention??this.promptCacheRetention,verbosity:t?.verbosity??this.verbosity};t?.prediction!==void 0&&(i.prediction=t.prediction),this.service_tier!==void 0&&(i.service_tier=this.service_tier),t?.service_tier!==void 0&&(i.service_tier=t.service_tier);let o=this._getReasoningParams(t);return o!==void 0&&o.effort!==void 0&&(i.reasoning_effort=o.effort),Go(i.model)?i.max_completion_tokens=this.maxTokens===-1?void 0:this.maxTokens:i.max_tokens=this.maxTokens===-1?void 0:this.maxTokens,i}async _generate(t,e,r){let n={},i=this.invocationParams(e),o=Pf({messages:t,model:this.model});if(i.stream){let a=this._streamResponseChunks(t,e,r),s={};for await(let m of a){m.message.response_metadata={...m.generationInfo,...m.message.response_metadata};let h=m.generationInfo?.completion??0;s[h]===void 0?s[h]=m:s[h]=s[h].concat(m)}let c=Object.entries(s).sort(([m],[h])=>parseInt(m,10)-parseInt(h,10)).map(([m,h])=>h),{functions:u,function_call:l}=this.invocationParams(e),p=await this._getEstimatedTokenCountFromPrompt(t,u,l),f=await this._getNumTokensFromGenerations(c);return n.input_tokens=p,n.output_tokens=f,n.total_tokens=p+f,{generations:c,llmOutput:{estimatedTokenUsage:{promptTokens:n.input_tokens,completionTokens:n.output_tokens,totalTokens:n.total_tokens}}}}else{let a=await this.completionWithRetry({...i,stream:!1,messages:o},{signal:e?.signal,...e?.options}),{completion_tokens:s,prompt_tokens:c,total_tokens:u,prompt_tokens_details:l,completion_tokens_details:p}=a?.usage??{};s&&(n.output_tokens=(n.output_tokens??0)+s),c&&(n.input_tokens=(n.input_tokens??0)+c),u&&(n.total_tokens=(n.total_tokens??0)+u),(l?.audio_tokens!==null||l?.cached_tokens!==null)&&(n.input_token_details={...l?.audio_tokens!==null&&{audio:l?.audio_tokens},...l?.cached_tokens!==null&&{cache_read:l?.cached_tokens}}),(p?.audio_tokens!==null||p?.reasoning_tokens!==null)&&(n.output_token_details={...p?.audio_tokens!==null&&{audio:p?.audio_tokens},...p?.reasoning_tokens!==null&&{reasoning:p?.reasoning_tokens}});let f=[];for(let m of a?.choices??[]){let g={text:m.message?.content??"",message:this._convertCompletionsMessageToBaseMessage(m.message??{role:"assistant"},a)};g.generationInfo={...m.finish_reason?{finish_reason:m.finish_reason}:{},...m.logprobs?{logprobs:m.logprobs}:{}},ra(g.message)&&(g.message.usage_metadata=n),g.message=new Ue(Object.fromEntries(Object.entries(g.message).filter(([x])=>!x.startsWith("lc_")))),f.push(g)}return{generations:f,llmOutput:{tokenUsage:{promptTokens:n.input_tokens,completionTokens:n.output_tokens,totalTokens:n.total_tokens}}}}}async*_streamResponseChunks(t,e,r){let n=Pf({messages:t,model:this.model}),i={...this.invocationParams(e,{streaming:!0}),messages:n,stream:!0},o,a=await this.completionWithRetry(i,e),s;for await(let c of a){let u=c?.choices?.[0];if(c.usage&&(s=c.usage),!u)continue;let{delta:l}=u;if(!l)continue;let p=this._convertCompletionsDeltaToBaseMessageChunk(l,c,o);o=l.role??o;let f={prompt:e.promptIndex??0,completion:u.index??0};if(typeof p.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}let m={...f};u.finish_reason!=null&&(m.finish_reason=u.finish_reason,m.system_fingerprint=c.system_fingerprint,m.model_name=c.model,m.service_tier=c.service_tier),this.logprobs&&(m.logprobs=u.logprobs);let h=new tn({message:p,text:p.content,generationInfo:m});yield h,await r?.handleLLMNewToken(h.text??"",f,void 0,void 0,void 0,{chunk:h})}if(s){let c={...s.prompt_tokens_details?.audio_tokens!==null&&{audio:s.prompt_tokens_details?.audio_tokens},...s.prompt_tokens_details?.cached_tokens!==null&&{cache_read:s.prompt_tokens_details?.cached_tokens}},u={...s.completion_tokens_details?.audio_tokens!==null&&{audio:s.completion_tokens_details?.audio_tokens},...s.completion_tokens_details?.reasoning_tokens!==null&&{reasoning:s.completion_tokens_details?.reasoning_tokens}};yield new tn({message:new st({content:"",response_metadata:{usage:{...s}},usage_metadata:{input_tokens:s.prompt_tokens,output_tokens:s.completion_tokens,total_tokens:s.total_tokens,...Object.keys(c).length>0&&{input_token_details:c},...Object.keys(u).length>0&&{output_token_details:u}}}),text:""})}if(e.signal?.aborted)throw new Error("AbortError")}async completionWithRetry(t,e){let r=this._getClientOptions(e),n=t.response_format&&t.response_format.type==="json_schema";return this.caller.call(async()=>{try{return n&&!t.stream?await this.client.chat.completions.parse(t,r):await this.client.chat.completions.create(t,r)}catch(i){throw Xi(i)}})}_convertCompletionsDeltaToBaseMessageChunk(t,e,r){return TT({delta:t,rawResponse:e,includeRawResponse:this.__includeRawResponse,defaultRole:r})}_convertCompletionsMessageToBaseMessage(t,e){return AT({message:t,rawResponse:e,includeRawResponse:this.__includeRawResponse})}};var Hl="__openai_function_call_ids__",$T=t=>{let e={...t?.input_tokens_details?.cached_tokens!=null&&{cache_read:t?.input_tokens_details?.cached_tokens}},r={...t?.output_tokens_details?.reasoning_tokens!=null&&{reasoning:t?.output_tokens_details?.reasoning_tokens}};return{input_tokens:t?.input_tokens??0,output_tokens:t?.output_tokens??0,total_tokens:t?.total_tokens??0,input_token_details:e,output_token_details:r}},Ky=t=>{if(t.error){let s=new Error(t.error.message);throw s.name=t.error.code,s}let e,r=[],n=[],i=[],o={model_provider:"openai",model:t.model,created_at:t.created_at,id:t.id,incomplete_details:t.incomplete_details,metadata:t.metadata,object:t.object,status:t.status,user:t.user,service_tier:t.service_tier,model_name:t.model},a={};for(let s of t.output)if(s.type==="message")e=s.id,r.push(...s.content.flatMap(c=>c.type==="output_text"?("parsed"in c&&c.parsed!=null&&(a.parsed=c.parsed),{type:"text",text:c.text,annotations:c.annotations}):c.type==="refusal"?(a.refusal=c.refusal,[]):c));else if(s.type==="function_call"){let c={function:{name:s.name,arguments:s.arguments},id:s.call_id};try{n.push(Fs(c,{returnId:!0}))}catch(u){let l;typeof u=="object"&&u!=null&&"message"in u&&typeof u.message=="string"&&(l=u.message),i.push(Aa(c,l))}a[Hl]??(a[Hl]={}),s.id&&(a[Hl][s.call_id]=s.id)}else if(s.type==="reasoning")a.reasoning=s;else if(s.type==="custom_tool_call"){let c=vU(s);c?n.push(c):i.push(Aa(s,"Malformed custom tool call"))}else if(s.type==="computer_call"){let c=bU(s);c?n.push(c):i.push(Aa(s,"Malformed computer call"))}else a.tool_outputs??(a.tool_outputs=[]),a.tool_outputs.push(s);return new Ue({id:e,content:r,tool_calls:n,invalid_tool_calls:i,usage_metadata:$T(t.usage),additional_kwargs:a,response_metadata:o})},v2=t=>{let e=(t.summary.length>1?t.summary.reduce((r,n)=>{let i=r[r.length-1];return i.index===n.index?i.text+=n.text:r.push(n),r},[{...t.summary[0]}]):t.summary).map(r=>Object.fromEntries(Object.entries(r).filter(([n])=>n!=="index")));return{...t,summary:e}},OT=t=>{let e=[],r={},n,i=[],o={model_provider:"openai"},a={},s;if(t.type==="response.output_text.delta")e.push({type:"text",text:t.delta,index:t.content_index});else if(t.type==="response.output_text.annotation.added")e.push({type:"text",text:"",annotations:[t.annotation],index:t.content_index});else if(t.type==="response.output_item.added"&&t.item.type==="message")s=t.item.id;else if(t.type==="response.output_item.added"&&t.item.type==="function_call")i.push({type:"tool_call_chunk",name:t.item.name,args:t.item.arguments,id:t.item.call_id,index:t.output_index}),a[Hl]={[t.item.call_id]:t.item.id};else if(t.type==="response.output_item.done"&&t.item.type==="computer_call")i.push({type:"tool_call_chunk",name:"computer_use",args:JSON.stringify({action:t.item.action}),id:t.item.call_id,index:t.output_index}),a.tool_outputs=[t.item];else if(t.type==="response.output_item.done"&&["web_search_call","file_search_call","code_interpreter_call","mcp_call","mcp_list_tools","mcp_approval_request","image_generation_call","custom_tool_call"].includes(t.item.type))a.tool_outputs=[t.item];else if(t.type==="response.created")o.id=t.response.id,o.model_name=t.response.model,o.model=t.response.model;else if(t.type==="response.completed"){let c=Ky(t.response);n=$T(t.response.usage),t.response.text?.format?.type==="json_schema"&&(a.parsed??(a.parsed=JSON.parse(c.text)));for(let[u,l]of Object.entries(t.response))u!=="id"&&(o[u]=l)}else if(t.type==="response.function_call_arguments.delta"||t.type==="response.custom_tool_call_input.delta")i.push({type:"tool_call_chunk",args:t.delta,index:t.output_index});else if(t.type==="response.web_search_call.completed"||t.type==="response.file_search_call.completed")r={tool_outputs:{id:t.item_id,type:t.type.replace("response.","").replace(".completed",""),status:"completed"}};else if(t.type==="response.refusal.done")a.refusal=t.refusal;else if(t.type==="response.output_item.added"&&"item"in t&&t.item.type==="reasoning"){let c=t.item.summary?t.item.summary.map((u,l)=>({...u,index:l})):void 0;a.reasoning={id:t.item.id,type:t.item.type,...c?{summary:c}:{}}}else if(t.type==="response.reasoning_summary_part.added")a.reasoning={type:"reasoning",summary:[{...t.part,index:t.summary_index}]};else if(t.type==="response.reasoning_summary_text.delta")a.reasoning={type:"reasoning",summary:[{text:t.delta,type:"summary_text",index:t.summary_index}]};else return t.type==="response.image_generation_call.partial_image",null;return new tn({text:e.map(c=>c.text).join(""),message:new st({id:s,content:e,tool_call_chunks:i,usage_metadata:n,additional_kwargs:a,response_metadata:o}),generationInfo:r})},b2=t=>{let e=Ue.isInstance(t)&&t.response_metadata?.model_provider==="openai";function*r(){let n=Zo(()=>{try{let y=Ho(t);return y==="system"||y==="developer"||y==="assistant"||y==="user"?y:"assistant"}catch{return"assistant"}}),i,o=new Set,a=new Set,s=new Map,c=new Map;function*u(){if(!i)return;let y=i.content;(typeof y=="string"&&y.length>0||Array.isArray(y)&&y.length>0)&&(yield i),i=void 0}let l=y=>{i||(i={type:"message",role:n,content:[]}),typeof i.content=="string"?i.content=i.content.length>0?[{type:"input_text",text:i.content},...y]:[...y]:i.content.push(...y)},p=y=>{if(typeof y=="string")return y;try{return JSON.stringify(y??{})}catch{return"{}"}},f=y=>{let v=Zo(()=>{let S=y.metadata?.detail;return S==="low"||S==="high"||S==="auto"?S:"auto"});if(y.fileId)return{type:"input_image",detail:v,file_id:y.fileId};if(y.url)return{type:"input_image",detail:v,image_url:y.url};if(y.data){let S=typeof y.data=="string"?y.data:Buffer.from(y.data).toString("base64"),k=y.mimeType??"image/png";return{type:"input_image",detail:v,image_url:`data:${k};base64,${S}`}}},m=y=>{let v=Zl(y);if(y.fileId&&typeof v=="string")return{type:"input_file",file_id:y.fileId,...v?{filename:v}:{}};if(y.url&&typeof v=="string")return{type:"input_file",file_url:y.url,...v?{filename:v}:{}};if(y.data&&typeof v=="string"){let S=typeof y.data=="string"?y.data:Buffer.from(y.data).toString("base64");return{type:"input_file",file_data:`data:${y.mimeType??"application/octet-stream"};base64,${S}`,...v?{filename:v}:{}}}},h=y=>{let v=Zo(()=>{if(Array.isArray(y.summary)){let N=y.summary?.map(U=>U?.text).filter(U=>typeof U=="string")??[];if(N.length>0)return N}return y.reasoning?[y.reasoning]:[]}),S=v.length>0?v.map(T=>({type:"summary_text",text:T})):[{type:"summary_text",text:""}],k={type:"reasoning",id:y.id??"",summary:S};return y.reasoning&&(k.content=[{type:"reasoning_text",text:y.reasoning}]),k},g=y=>({type:"function_call",name:y.name??"",call_id:y.id??"",arguments:p(y.args)}),x=y=>{let v=p(y.output),S=y.status==="success"?"completed":y.status==="error"?"incomplete":void 0;return{type:"function_call_output",call_id:y.toolCallId??"",output:v,...S?{status:S}:{}}};for(let y of t.contentBlocks)if(y.type==="text")l([{type:"input_text",text:y.text}]);else if(y.type!=="invalid_tool_call"){if(y.type==="reasoning")yield*u(),yield h(y);else if(y.type==="tool_call"){yield*u();let v=y.id??"";v&&(o.add(v),s.delete(v)),yield g(y)}else if(y.type==="tool_call_chunk"){if(y.id){let v=s.get(y.id)??{name:y.name,args:[]};y.name&&(v.name=y.name),y.args&&v.args.push(y.args),s.set(y.id,v)}}else if(y.type==="server_tool_call"){yield*u();let v=y.id??"";v&&(a.add(v),c.delete(v)),yield g(y)}else if(y.type==="server_tool_call_chunk"){if(y.id){let v=c.get(y.id)??{name:y.name,args:[]};y.name&&(v.name=y.name),y.args&&v.args.push(y.args),c.set(y.id,v)}}else if(y.type==="server_tool_call_result")yield*u(),yield x(y);else if(y.type!=="audio")if(y.type==="file"){let v=m(y);v&&l([v])}else if(y.type==="image"){let v=f(y);v&&l([v])}else if(y.type==="video"){let v=m(y);v&&l([v])}else y.type==="text-plain"?y.text&&l([{type:"input_text",text:y.text}]):y.type==="non_standard"&&e&&(yield*u(),yield y.value)}yield*u();for(let[y,v]of s){if(!y||o.has(y))continue;let S=v.args.join("");!v.name&&!S||(yield{type:"function_call",call_id:y,name:v.name??"",arguments:S})}for(let[y,v]of c){if(!y||a.has(y))continue;let S=v.args.join("");!v.name&&!S||(yield{type:"function_call",call_id:y,name:v.name??"",arguments:S})}}return Array.from(r())},Wy=({messages:t,zdrEnabled:e,model:r})=>t.flatMap(n=>{let i=n.response_metadata;if(i?.output_version==="v1")return b2(n);let o=n.additional_kwargs,a=Ho(n);if(a==="system"&&Go(r)&&(a="developer"),a==="function")throw new Error("Function messages are not supported in Responses API");if(a==="tool"){let s=n;if(o?.type==="computer_call_output")return{type:"computer_call_output",output:(()=>{if(typeof s.content=="string")return{type:"input_image",image_url:s.content};if(Array.isArray(s.content)){let l=s.content.find(m=>m.type==="input_image");if(l)return l;let p=s.content.find(m=>m.type==="computer_screenshot");if(p)return p;let f=s.content.find(m=>m.type==="image_url");if(f)return{type:"input_image",image_url:typeof f.image_url=="string"?f.image_url:f.image_url.url}}throw new Error("Invalid computer call output")})(),call_id:s.tool_call_id};if(s.additional_kwargs?.customTool)return{type:"custom_tool_call_output",call_id:s.tool_call_id,output:s.content};let c=Array.isArray(s.content)&&s.content.every(u=>typeof u=="object"&&u!==null&&"type"in u&&(u.type==="input_file"||u.type==="input_image"||u.type==="input_text"));return{type:"function_call_output",call_id:s.tool_call_id,id:s.id?.startsWith("fc_")?s.id:void 0,output:c?s.content:typeof s.content!="string"?JSON.stringify(s.content):s.content}}if(a==="assistant"){if(!e&&i?.output!=null&&Array.isArray(i?.output)&&i?.output.length>0&&i?.output.every(f=>"type"in f))return i?.output;let s=[];if(o?.reasoning&&!e){let f=v2(o.reasoning);s.push(f)}let{content:c}=n;o?.refusal&&(typeof c=="string"&&(c=[{type:"output_text",text:c,annotations:[]}]),c=[...c,{type:"refusal",refusal:o.refusal}]),(typeof c=="string"||c.length>0)&&s.push({type:"message",role:"assistant",...n.id&&!e&&n.id.startsWith("msg_")?{id:n.id}:{},content:Zo(()=>typeof c=="string"?c:c.flatMap(f=>f.type==="text"?{type:"output_text",text:f.text,annotations:f.annotations??[]}:f.type==="output_text"||f.type==="refusal"?f:[]))});let u=o?.[Hl];Ue.isInstance(n)&&n.tool_calls?.length?s.push(...n.tool_calls.map(f=>xU(f)?{type:"custom_tool_call",id:f.call_id,call_id:f.id??"",input:f.args.input,name:f.name}:wU(f)?{type:"computer_call",id:f.call_id,call_id:f.id??"",action:f.args.action}:{type:"function_call",name:f.name,arguments:JSON.stringify(f.args),call_id:f.id,...e?{}:{id:u?.[f.id]}})):o?.tool_calls&&s.push(...o.tool_calls.map(f=>({type:"function_call",name:f.function.name,call_id:f.id,arguments:f.function.arguments,...e?{}:{id:u?.[f.id]}})));let l=i?.output?.length?i?.output:o.tool_outputs,p=["computer_call","mcp_call","code_interpreter_call","image_generation_call"];if(l!=null){let m=l?.filter(h=>p.includes(h.type));m.length>0&&s.push(...m)}return s}if(a==="user"||a==="system"||a==="developer"){if(typeof n.content=="string")return{type:"message",role:a,content:n.content};let s=[],c=n.content.flatMap(u=>{if(u.type==="mcp_approval_response"&&s.push({type:"mcp_approval_response",approval_request_id:u.approval_request_id,approve:u.approve}),jr(u))return Nc(u,Hy);if(u.type==="text")return{type:"input_text",text:u.text};if(u.type==="image_url"){let l=Zo(()=>{if(typeof u.image_url=="string")return u.image_url;if(typeof u.image_url=="object"&&u.image_url!==null&&"url"in u.image_url)return u.image_url.url}),p=Zo(()=>{if(typeof u.image_url=="string")return"auto";if(typeof u.image_url=="object"&&u.image_url!==null&&"detail"in u.image_url)return u.image_url.detail});return{type:"input_image",image_url:l,detail:p}}return u.type==="input_text"||u.type==="input_image"||u.type==="input_file"?u:[]});return c.length>0&&s.push({type:"message",role:a,content:c}),s}return console.warn(`Unsupported role found when converting to OpenAI Responses API: ${a}`),[]});var Jy=class extends Ec{invocationParams(t){let e;t?.strict!==void 0&&(e=t.strict),e===void 0&&this.supportsStrictToolCalling!==void 0&&(e=this.supportsStrictToolCalling);let r={model:this.model,temperature:this.temperature,top_p:this.topP,user:this.user,stream:this.streaming,previous_response_id:t?.previous_response_id,truncation:t?.truncation,include:t?.include,tools:t?.tools?.length?this._reduceChatOpenAITools(t.tools,{stream:this.streaming,strict:e}):void 0,tool_choice:yU(t?.tool_choice)?t?.tool_choice:(()=>{let i=By(t?.tool_choice);if(typeof i=="object"&&"type"in i){if(i.type==="function")return{type:"function",name:i.function.name};if(i.type==="allowed_tools")return{type:"allowed_tools",mode:i.allowed_tools.mode,tools:i.allowed_tools.tools};if(i.type==="custom")return{type:"custom",name:i.custom.name}}})(),text:(()=>{if(t?.text)return t.text;let i=this._getResponseFormat(t?.response_format);return i?.type==="json_schema"?i.json_schema.schema!=null?{format:{type:"json_schema",schema:i.json_schema.schema,description:i.json_schema.description,name:i.json_schema.name,strict:i.json_schema.strict},verbosity:t?.verbosity}:void 0:{format:i,verbosity:t?.verbosity}})(),parallel_tool_calls:t?.parallel_tool_calls,max_output_tokens:this.maxTokens===-1?void 0:this.maxTokens,prompt_cache_key:t?.promptCacheKey??this.promptCacheKey,prompt_cache_retention:t?.promptCacheRetention??this.promptCacheRetention,...this.zdrEnabled?{store:!1}:{},...this.modelKwargs},n=this._getReasoningParams(t);return n!==void 0&&(r.reasoning=n),r}async _generate(t,e,r){let n=this.invocationParams(e);if(n.stream){let i=this._streamResponseChunks(t,e,r),o;for await(let a of i)a.message.response_metadata={...a.generationInfo,...a.message.response_metadata},o=o?.concat(a)??a;return{generations:o?[o]:[],llmOutput:{estimatedTokenUsage:o?.message?.usage_metadata}}}else{let i=await this.completionWithRetry({input:Wy({messages:t,zdrEnabled:this.zdrEnabled??!1,model:this.model}),...n,stream:!1},{signal:e?.signal,...e?.options});return{generations:[{text:i.output_text,message:Ky(i)}],llmOutput:{id:i.id,estimatedTokenUsage:i.usage?{promptTokens:i.usage.input_tokens,completionTokens:i.usage.output_tokens,totalTokens:i.usage.total_tokens}:void 0}}}}async*_streamResponseChunks(t,e,r){let n=await this.completionWithRetry({...this.invocationParams(e),input:Wy({messages:t,zdrEnabled:this.zdrEnabled??!1,model:this.model}),stream:!0},e);for await(let i of n){let o=OT(i);o!=null&&(yield o,await r?.handleLLMNewToken(o.text||"",{prompt:e.promptIndex??0,completion:0},void 0,void 0,void 0,{chunk:o}))}}async completionWithRetry(t,e){return this.caller.call(async()=>{let r=this._getClientOptions(e);try{return t.text?.format?.type==="json_schema"&&!t.stream?await this.client.responses.parse(t,r):await this.client.responses.create(t,r)}catch(n){throw Xi(n)}})}_reduceChatOpenAITools(t,e){let r=[];for(let n of t)if(Gl(n))n.type==="image_generation"&&e?.stream&&(n.partial_images=1),r.push(n);else if(Sc(n)){let i=n.metadata.customTool;r.push({type:"custom",name:i.name,description:i.description,format:i.format})}else fd(n)?r.push({type:"function",name:n.function.name,parameters:n.function.parameters,description:n.function.description,strict:e?.strict??null}):Vy(n)&&r.push(SU(n));return r}};var Yi=class w2 extends Ec{constructor(r){super(r);d(this,"useResponsesApi",!1);d(this,"responses");d(this,"completions");this.fields=r,this.useResponsesApi=r?.useResponsesApi??!1,this.responses=r?.responses??new Jy(r),this.completions=r?.completions??new qy(r)}get lc_serializable_keys(){return[...super.lc_serializable_keys,"useResponsesApi"]}get callKeys(){return[...super.callKeys,"useResponsesApi"]}_useResponsesApi(r){let n=r?.tools?.some(Gl),i=r?.previous_response_id!=null||r?.text!=null||r?.truncation!=null||r?.include!=null||r?.reasoning?.summary!=null||this.reasoning?.summary!=null,o=r?.tools?.some(Vy)||r?.tools?.some(Sc);return this.useResponsesApi||n||i||o||pU(this.model)}getLsParams(r){let n=this._combineCallOptions(r);return this._useResponsesApi(r)?this.responses.getLsParams(n):this.completions.getLsParams(n)}invocationParams(r){let n=this._combineCallOptions(r);return this._useResponsesApi(r)?this.responses.invocationParams(n):this.completions.invocationParams(n)}async _generate(r,n,i){return this._useResponsesApi(n)?this.responses._generate(r,n):this.completions._generate(r,n,i)}async*_streamResponseChunks(r,n,i){if(this._useResponsesApi(n)){yield*this.responses._streamResponseChunks(r,this._combineCallOptions(n),i);return}yield*this.completions._streamResponseChunks(r,this._combineCallOptions(n),i)}withConfig(r){let n=new w2(this.fields);return n.defaultOptions={...this.defaultOptions,...r},n}};var zJ=K.object({type:K.literal("screenshot")}),jJ=K.object({type:K.literal("click"),x:K.number(),y:K.number(),button:K.enum(["left","right","wheel","back","forward"]).default("left")}),DJ=K.object({type:K.literal("double_click"),x:K.number(),y:K.number(),button:K.enum(["left","right","wheel","back","forward"]).default("left")}),LJ=K.object({type:K.literal("drag"),path:K.array(K.object({x:K.number(),y:K.number()}))}),UJ=K.object({type:K.literal("keypress"),keys:K.array(K.string())}),FJ=K.object({type:K.literal("move"),x:K.number(),y:K.number()}),BJ=K.object({type:K.literal("scroll"),x:K.number(),y:K.number(),scroll_x:K.number(),scroll_y:K.number()}),VJ=K.object({type:K.literal("type"),text:K.string()}),ZJ=K.object({type:K.literal("wait"),duration:K.number().optional()}),GJ=K.discriminatedUnion("type",[zJ,jJ,DJ,LJ,UJ,FJ,BJ,VJ,ZJ]),EFe=K.object({action:GJ});var HJ=K.object({type:K.literal("exec"),command:K.array(K.string()),env:K.record(K.string(),K.string()).optional(),working_directory:K.string().optional(),timeout_ms:K.number().optional(),user:K.string().optional()}),OFe=K.discriminatedUnion("type",[HJ]);var RFe=K.object({commands:K.array(K.string()).describe("Array of shell commands to execute"),timeout_ms:K.number().optional().describe("Optional timeout in milliseconds for the commands"),max_output_length:K.number().optional().describe("Optional maximum number of characters to return from each command")});var qJ=K.object({type:K.literal("create_file"),path:K.string(),diff:K.string()}),KJ=K.object({type:K.literal("update_file"),path:K.string(),diff:K.string()}),WJ=K.object({type:K.literal("delete_file"),path:K.string()}),DFe=K.discriminatedUnion("type",[qJ,KJ,WJ]);var JJ={systemPrompt:`\u4F60\u662F\u4E00\u4E2A\u53D9\u4E8B\u5206\u6790\u5E08\u3002\u6839\u636E\u4EE5\u4E0B\u4FE1\u606F\uFF0C\u5206\u6790\u5F53\u524D\u573A\u666F\u72B6\u6001\u3002

## \u89D2\u8272\u8BBE\u5B9A
{{characterSettings}}

## \u6700\u8FD1\u5BF9\u8BDD
{{chatHistory}}

## \u7528\u6237\u5F53\u524D\u8F93\u5165
{{userInput}}

## \u5F53\u524D\u4E16\u754C\u72B6\u6001
{{worldState}}

\u8BF7\u4EE5 JSON \u683C\u5F0F\u8FD4\u56DE\u66F4\u65B0\u540E\u7684\u4E16\u754C\u72B6\u6001:
{
  "scene": "\u573A\u666F\u63CF\u8FF0",
  "time": "\u65F6\u95F4",
  "characters": {
    "\u89D2\u8272\u540D": { "name": "\u540D\u5B57", "present": true/false, "lastPosition": "\u4F4D\u7F6E" }
  },
  "recentEvents": ["\u4E8B\u4EF61", "\u4E8B\u4EF62"]
}

\u53EA\u8FD4\u56DE JSON\uFF0C\u4E0D\u8981\u5176\u4ED6\u5185\u5BB9\u3002`,temperature:.3,variables:[{name:"characterSettings",description:"\u89D2\u8272\u8BBE\u5B9A JSON",example:'{"char": "Alice\u662F\u4E00\u4E2A\u53CB\u5584\u7684AI\u52A9\u624B"}'},{name:"chatHistory",description:"\u6700\u8FD1\u5BF9\u8BDD\u5386\u53F2",example:`user: \u4F60\u597D
assistant: \u4F60\u597D\uFF01\u6709\u4EC0\u4E48\u53EF\u4EE5\u5E2E\u52A9\u4F60\u7684\uFF1F`},{name:"userInput",description:"\u7528\u6237\u5F53\u524D\u8F93\u5165",example:"\u6211\u60F3\u4E86\u89E3\u66F4\u591A\u5173\u4E8E\u8FD9\u4E2A\u4E16\u754C\u7684\u4FE1\u606F"},{name:"worldState",description:"\u5F53\u524D\u4E16\u754C\u72B6\u6001 JSON",example:'{"scene": "\u5496\u5561\u5385", "time": "\u4E0B\u5348"}'}]},XJ={systemPrompt:`\u4F60\u662F\u4E00\u4E2A\u89D2\u8272\u626E\u6F14\u5BFC\u6F14\u3002\u6839\u636E\u5F53\u524D\u573A\u666F\uFF0C\u51B3\u5B9A\u54EA\u4E9B\u89D2\u8272\u5E94\u8BE5\u53D1\u8A00\u3002

## \u4E16\u754C\u72B6\u6001
{{worldState}}

## \u7528\u6237\u8F93\u5165
{{userInput}}

## \u5728\u573A\u89D2\u8272
{{presentCharacters}}

\u8BF7\u51B3\u5B9A\u53D1\u8A00\u89D2\u8272\u53CA\u987A\u5E8F\uFF0C\u4EE5 JSON \u6570\u7EC4\u8FD4\u56DE\u89D2\u8272\u540D:
["\u89D2\u82721", "\u89D2\u82722"]

\u89C4\u5219:
- \u53EA\u6709\u5728\u573A\u89D2\u8272\u53EF\u4EE5\u53D1\u8A00
- \u6839\u636E\u60C5\u5883\u51B3\u5B9A\u8C01\u5E94\u8BE5\u56DE\u5E94
- \u901A\u5E381-3\u4E2A\u89D2\u8272\u53D1\u8A00

\u53EA\u8FD4\u56DE JSON \u6570\u7EC4\uFF0C\u4E0D\u8981\u5176\u4ED6\u5185\u5BB9\u3002`,temperature:.2,variables:[{name:"worldState",description:"\u4E16\u754C\u72B6\u6001 JSON",example:'{"scene": "\u5496\u5561\u5385", "characters": {"Alice": {"present": true}}}'},{name:"userInput",description:"\u7528\u6237\u8F93\u5165\u5185\u5BB9",example:"\u5927\u5BB6\u597D\uFF0C\u4ECA\u5929\u5929\u6C14\u771F\u4E0D\u9519"},{name:"presentCharacters",description:"\u5728\u573A\u89D2\u8272\u540D\u5217\u8868",example:"Alice, Bob, Charlie"}]},YJ={systemPrompt:`\u4F60\u6B63\u5728\u626E\u6F14\u89D2\u8272: {{characterName}}

{{fictionStyle}}

{{writingStyle}}

{{contentConstraints}}

## \u91CD\u8981\u89C4\u5219
1. \u53EA\u626E\u6F14\u4F60\u88AB\u5206\u914D\u7684\u89D2\u8272\uFF0C\u4E0D\u8981\u626E\u6F14\u5176\u4ED6\u89D2\u8272
2. \u4FDD\u6301\u89D2\u8272\u6027\u683C\u4E00\u81F4
3. \u6839\u636E\u573A\u666F\u81EA\u7136\u5730\u56DE\u5E94
4. \u4E0D\u8981\u6253\u7834\u7B2C\u56DB\u9762\u5899`,userPromptTemplate:"{{characterContext}}",temperature:.8,variables:[{name:"characterName",description:"\u5F53\u524D\u626E\u6F14\u7684\u89D2\u8272\u540D",example:"Alice"},{name:"fictionStyle",description:"\u5199\u4F5C\u98CE\u683C\u8BBE\u5B9A",example:`## \u5199\u4F5C\u98CE\u683C
\u4F7F\u7528\u7EC6\u817B\u7684\u63CF\u5199\uFF0C\u6CE8\u91CD\u60C5\u611F\u8868\u8FBE`},{name:"writingStyle",description:"\u5199\u4F5C\u89C4\u8303",example:`## \u5199\u4F5C\u89C4\u8303
\u4F7F\u7528\u7B2C\u4E00\u4EBA\u79F0\u89C6\u89D2`},{name:"contentConstraints",description:"\u5185\u5BB9\u7EA6\u675F",example:`## \u5185\u5BB9\u7EA6\u675F
\u4FDD\u6301\u5185\u5BB9\u79EF\u6781\u5411\u4E0A`},{name:"characterContext",description:"Director \u4E3A\u89D2\u8272\u51C6\u5907\u7684\u4E0A\u4E0B\u6587",example:`## \u4F60\u662F Alice
## \u5F53\u524D\u573A\u666F: \u5496\u5561\u5385
## \u7528\u6237\u8BF4: \u4F60\u597D`}]},QJ={systemPrompt:`\u4F60\u662F\u4E00\u4E2A\u53D9\u4E8B\u6574\u5408\u8005\u3002\u5C06\u591A\u4E2A\u89D2\u8272\u7684\u56DE\u590D\u6574\u5408\u6210\u4E00\u6BB5\u8FDE\u8D2F\u7684\u53D9\u4E8B\u3002

## \u4E16\u754C\u72B6\u6001
\u573A\u666F: {{scene}}
\u65F6\u95F4: {{time}}

## \u5404\u89D2\u8272\u56DE\u590D
{{personaOutputs}}

## \u4EFB\u52A1
\u5C06\u4EE5\u4E0A\u89D2\u8272\u56DE\u590D\u6574\u5408\u6210\u4E00\u6BB5\u6D41\u7545\u3001\u8FDE\u8D2F\u7684\u53D9\u4E8B\u6587\u672C\u3002
- \u4FDD\u6301\u6BCF\u4E2A\u89D2\u8272\u7684\u72EC\u7279\u58F0\u97F3\u548C\u98CE\u683C
- \u6DFB\u52A0\u5FC5\u8981\u7684\u573A\u666F\u63CF\u5199\u548C\u8FC7\u6E21
- \u4F7F\u7528\u7B2C\u4E09\u4EBA\u79F0\u53D9\u4E8B\uFF08\u5982\u679C\u5408\u9002\uFF09
- \u4FDD\u7559\u5BF9\u8BDD\u548C\u52A8\u4F5C\u7684\u751F\u52A8\u6027

\u76F4\u63A5\u8F93\u51FA\u6574\u5408\u540E\u7684\u6587\u672C\uFF0C\u4E0D\u8981\u6DFB\u52A0\u4EFB\u4F55\u89E3\u91CA\u3002`,temperature:.5,variables:[{name:"scene",description:"\u5F53\u524D\u573A\u666F",example:"\u5496\u5561\u5385\u7684\u89D2\u843D"},{name:"time",description:"\u5F53\u524D\u65F6\u95F4",example:"\u4E0B\u5348\u4E09\u70B9"},{name:"personaOutputs",description:"\u5404\u89D2\u8272\u7684\u56DE\u590D\u5185\u5BB9",example:`### Alice
"\u4F60\u597D\uFF01"

### Bob
*\u70B9\u4E86\u70B9\u5934*`}]},e7={version:"1.0.0",narrator:JJ,director:XJ,persona:YJ,composer:QJ};function Ac(){return JSON.parse(JSON.stringify(e7))}var x2="multi_agent_prompt_config",t7="MultiAgentConfigDB",ql="config",r7=1;function S2(){let t=typeof window<"u"?window:null;if(!t)return null;let e=t.SillyTavern?.getContext?.();return e?.extensionSettings!==void 0?e:null}var PT=class{constructor(){this.db=null;this.initPromise=null}async init(){if(!this.db)return this.initPromise?this.initPromise:(this.initPromise=new Promise((e,r)=>{let n=indexedDB.open(t7,r7);n.onerror=()=>{console.error("[MultiAgent] IndexedDB open failed:",n.error),r(n.error)},n.onsuccess=()=>{this.db=n.result,e()},n.onupgradeneeded=i=>{let o=i.target.result;o.objectStoreNames.contains(ql)||o.createObjectStore(ql,{keyPath:"id"})}}),this.initPromise)}async save(e){if(await this.init(),!this.db)throw new Error("IndexedDB not initialized");return new Promise((r,n)=>{let a=this.db.transaction(ql,"readwrite").objectStore(ql).put({id:x2,config:e});a.onsuccess=()=>r(),a.onerror=()=>n(a.error)})}async load(){return await this.init(),this.db?new Promise((e,r)=>{let o=this.db.transaction(ql,"readonly").objectStore(ql).get(x2);o.onsuccess=()=>{let a=o.result;e(a?.config||null)},o.onerror=()=>r(o.error)}):null}},NT=class{constructor(){this.cachedConfig=null;this.indexedDB=new PT}async save(e){this.cachedConfig=e;let r=S2();r?.extensionSettings&&(r.extensionSettings.multiAgent=e,r.saveSettingsDebounced?.(),console.log("[MultiAgent] Config saved to SillyTavern settings"));try{await this.indexedDB.save(e),console.log("[MultiAgent] Config backed up to IndexedDB")}catch(n){console.warn("[MultiAgent] IndexedDB backup failed:",n)}}async load(){if(this.cachedConfig)return this.cachedConfig;let e=S2();if(e?.extensionSettings?.multiAgent){let r=e.extensionSettings.multiAgent;return this.cachedConfig=r,console.log("[MultiAgent] Config loaded from SillyTavern settings"),r}try{let r=await this.indexedDB.load();if(r)return this.cachedConfig=r,console.log("[MultiAgent] Config loaded from IndexedDB"),r}catch(r){console.warn("[MultiAgent] IndexedDB load failed:",r)}return null}async export(){let e=await this.load()||Ac();return JSON.stringify(e,null,2)}async import(e){try{let r=JSON.parse(e);if(!r.version||!r.narrator||!r.director||!r.persona||!r.composer)throw new Error("Invalid configuration structure");await this.save(r),console.log("[MultiAgent] Config imported successfully")}catch(r){throw console.error("[MultiAgent] Config import failed:",r),r}}clearCache(){this.cachedConfig=null}},CT=null;function RT(){return CT||(CT=new NT),CT}var zT=class{constructor(){this.initialized=!1;this.listeners=new Set;this.config=Ac()}async init(){if(this.initialized)return;let r=await RT().load();r&&(this.config=this.mergeWithDefaults(r)),this.initialized=!0,console.log("[MultiAgent] ConfigManager initialized")}mergeWithDefaults(e){let r=Ac();return{version:e.version||r.version,narrator:{...r.narrator,...e.narrator},director:{...r.director,...e.director},persona:{...r.persona,...e.persona},composer:{...r.composer,...e.composer}}}getPrompt(e){return this.config[e]}async setPrompt(e,r){this.config[e]={...this.config[e],...r},await this.save(),this.notifyListeners(e)}getConfig(){return{...this.config}}async setConfig(e){this.config=this.mergeWithDefaults(e),await this.save(),this.notifyListeners(null)}async resetAgent(e){let r=Ac();this.config[e]={...r[e]},await this.save(),this.notifyListeners(e)}async resetAll(){this.config=Ac(),await this.save(),this.notifyListeners(null)}renderPrompt(e,r){let n=this.config[e];return this.replaceVariables(n.systemPrompt,r)}renderUserPrompt(e,r){let n=this.config[e];return n.userPromptTemplate?this.replaceVariables(n.userPromptTemplate,r):null}replaceVariables(e,r){return e.replace(/\{\{(\w+)\}\}/g,(n,i)=>r[i]!==void 0?r[i]:n)}getPreview(e){let r=this.config[e],n={};for(let i of r.variables)n[i.name]=i.example||`[${i.name}]`;return this.renderPrompt(e,n)}async save(){await RT().save(this.config)}async exportConfig(){return JSON.stringify(this.config,null,2)}async importConfig(e){let r=JSON.parse(e);await this.setConfig(r)}addListener(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notifyListeners(e){for(let r of this.listeners)try{r(e,this.config)}catch(n){console.error("[MultiAgent] Listener error:",n)}}getTemperature(e){return this.config[e].temperature}getModelName(e){return this.config[e].modelName}},MT=null;function St(){return MT||(MT=new zT),MT}var jT=null;function DT(t){jT=new Yi({openAIApiKey:t.apiKey,configuration:{baseURL:t.baseURL},modelName:t.modelName||"gpt-4o-mini",temperature:.3})}function n7(t){let e={},n=(t.char||t.info_settings||"").match(/name[:\s]*["']?(\w+)["']?/i);return n&&(e[n[1]]={name:n[1],present:!0,lastPosition:"\u5F53\u524D\u573A\u666F"}),e}async function LT(t){let{parsedInput:e,worldState:r}=t;if(!e)return{error:"Parser \u672A\u5B8C\u6210\uFF0C\u65E0\u6CD5\u6267\u884C Narrator"};if(!jT){console.log("[MultiAgent] Narrator \u6A21\u578B\u672A\u914D\u7F6E\uFF0C\u4F7F\u7528\u89C4\u5219\u63A8\u65AD");let n=n7(e.characterSettings);return{worldState:{scene:r?.scene||"\u672A\u77E5\u573A\u666F",time:r?.time||"\u672A\u77E5\u65F6\u95F4",characters:{...r?.characters,...n},recentEvents:[...r?.recentEvents||[],`\u7528\u6237\u8F93\u5165: ${e.userInput.slice(0,50)}...`].slice(-10)}}}try{let i=St().renderPrompt("narrator",{characterSettings:JSON.stringify(e.characterSettings,null,2),chatHistory:e.chatHistory.slice(-5).map(c=>`${c.role}: ${c.content}`).join(`
`),userInput:e.userInput,worldState:JSON.stringify(r,null,2)}),o=await jT.invoke(i),s=(typeof o.content=="string"?o.content:"").match(/\{[\s\S]*\}/);if(s){let c=JSON.parse(s[0]);return console.log("[MultiAgent] Narrator \u66F4\u65B0\u4E16\u754C\u72B6\u6001:",c),{worldState:c}}}catch(n){console.error("[MultiAgent] Narrator \u5206\u6790\u5931\u8D25:",n)}return{worldState:r}}var FT=null;function BT(t){FT=new Yi({openAIApiKey:t.apiKey,configuration:{baseURL:t.baseURL},modelName:t.modelName||"claude-3-opus-20240229",temperature:.2})}async function VT(t){let{parsedInput:e,worldState:r}=t;if(!e||!r)return{error:"\u7F3A\u5C11\u5FC5\u8981\u72B6\u6001\uFF0C\u65E0\u6CD5\u6267\u884C Director"};let n=Object.values(r.characters).filter(o=>o.present).map(o=>o.name);if(n.length===0)return console.warn("[MultiAgent] \u6CA1\u6709\u5728\u573A\u89D2\u8272"),{activeCharacters:[],characterContexts:{}};if(!FT){console.log("[MultiAgent] Director \u6A21\u578B\u672A\u914D\u7F6E\uFF0C\u6240\u6709\u5728\u573A\u89D2\u8272\u53D1\u8A00");let o={};for(let a of n)o[a]=UT(a,e,r);return{activeCharacters:n,characterContexts:o}}try{let a=St().renderPrompt("director",{worldState:JSON.stringify(r,null,2),userInput:e.userInput,presentCharacters:n.join(", ")}),s=await FT.invoke(a),u=(typeof s.content=="string"?s.content:"").match(/\[[\s\S]*\]/);if(u){let p=JSON.parse(u[0]).filter(m=>n.includes(m)),f={};for(let m of p)f[m]=UT(m,e,r);return console.log("[MultiAgent] Director \u51B3\u5B9A\u53D1\u8A00\u89D2\u8272:",p),{activeCharacters:p,characterContexts:f}}}catch(o){console.error("[MultiAgent] Director \u51B3\u7B56\u5931\u8D25:",o)}let i={};for(let o of n)i[o]=UT(o,e,r);return{activeCharacters:n,characterContexts:i}}function UT(t,e,r){let n=[];n.push(`## \u4F60\u662F ${t}`),n.push(`## \u5F53\u524D\u573A\u666F: ${r.scene}`),n.push(`## \u65F6\u95F4: ${r.time}`);let i=Object.values(r.characters).filter(o=>o.present&&o.name!==t).map(o=>o.name);return i.length>0&&n.push(`## \u5728\u573A\u7684\u5176\u4ED6\u4EBA: ${i.join(", ")}`),r.recentEvents.length>0&&(n.push("## \u6700\u8FD1\u53D1\u751F\u7684\u4E8B:"),n.push(r.recentEvents.slice(-5).join(`
`))),n.push("## \u7528\u6237\u8BF4/\u505A:"),n.push(e.userInput),n.join(`

`)}async function ZT(t){let{personaOutputs:e,retryCount:r}=t;if(e.every(o=>!(!o.content||o.content.trim().length===0)))return console.log("[MultiAgent] Director Evaluate: \u683C\u5F0F\u68C0\u67E5\u901A\u8FC7"),{formatCheckPassed:!0};let i=3;return r>=i?(console.warn("[MultiAgent] Director Evaluate: \u8FBE\u5230\u6700\u5927\u91CD\u8BD5\u6B21\u6570"),{formatCheckPassed:!0}):(console.log(`[MultiAgent] Director Evaluate: \u683C\u5F0F\u68C0\u67E5\u5931\u8D25\uFF0C\u91CD\u8BD5 ${r+1}/${i}`),{formatCheckPassed:!1,retryCount:r+1,personaOutputs:[]})}var Kl=null;function GT(t){Kl=t}function i7(t){return Kl?new Yi({openAIApiKey:Kl.apiKey,configuration:{baseURL:Kl.baseURL},modelName:Kl.modelName||"gpt-4o",temperature:Kl.temperature??.8}):(console.warn("[MultiAgent] Persona \u6A21\u578B\u672A\u914D\u7F6E"),null)}async function o7(t,e,r){let n=i7(t);if(!n)return{characterName:t,content:`[${t} \u65E0\u6CD5\u56DE\u590D - \u6A21\u578B\u672A\u914D\u7F6E]`,formatValid:!1};try{let i=a7(t,r),o=await n.invoke([{role:"system",content:i},{role:"user",content:e}]),a=typeof o.content=="string"?o.content:"";return{characterName:t,content:a,formatValid:a.length>0}}catch(i){return console.error(`[MultiAgent] Persona ${t} \u751F\u6210\u5931\u8D25:`,i),{characterName:t,content:`[${t} \u751F\u6210\u51FA\u9519]`,formatValid:!1}}}function a7(t,e){let r=St(),n="";e.fiction_style&&(n=`## \u5199\u4F5C\u98CE\u683C
${e.fiction_style}`);let i="";e.Writing_style&&(i=`## \u5199\u4F5C\u89C4\u8303
${e.Writing_style}`);let o="";return e.content_constraints&&(o=`## \u5185\u5BB9\u7EA6\u675F
${e.content_constraints}`),r.renderPrompt("persona",{characterName:t,fictionStyle:n,writingStyle:i,contentConstraints:o})}async function HT(t){let{activeCharacters:e,characterContexts:r,parsedInput:n}=t;if(!n||e.length===0)return{personaOutputs:[]};console.log("[MultiAgent] Persona \u5F00\u59CB\u4E3A\u89D2\u8272\u751F\u6210\u56DE\u590D:",e);let i=e.map(a=>{let s=r[a]||"";return o7(a,s,n.presetInstructions)}),o=await Promise.all(i);return console.log("[MultiAgent] Persona \u5B8C\u6210\u751F\u6210:",o.length,"\u4E2A\u56DE\u590D"),{personaOutputs:o}}var qT=null;function KT(t){qT=new Yi({openAIApiKey:t.apiKey,configuration:{baseURL:t.baseURL},modelName:t.modelName||"gpt-4o",temperature:.5})}function I2(t){return t.filter(e=>e.formatValid&&e.content).map(e=>e.content.includes(e.characterName)?e.content:`\u3010${e.characterName}\u3011
${e.content}`).join(`

---

`)}async function WT(t){let{personaOutputs:e,parsedInput:r,worldState:n}=t;if(e.length===0)return{finalOutput:"[\u6CA1\u6709\u89D2\u8272\u56DE\u590D]"};if(!qT)return console.log("[MultiAgent] Composer \u6A21\u578B\u672A\u914D\u7F6E\uFF0C\u4F7F\u7528\u7B80\u5355\u62FC\u63A5"),{finalOutput:I2(e)};try{let o=St(),a=e.map(l=>`### ${l.characterName}
${l.content}`).join(`

`),s=o.renderPrompt("composer",{scene:n?.scene||"\u672A\u77E5",time:n?.time||"\u672A\u77E5",personaOutputs:a}),c=await qT.invoke(s),u=typeof c.content=="string"?c.content:"";if(u)return console.log("[MultiAgent] Composer \u5B8C\u6210\u6574\u5408"),{finalOutput:u}}catch(o){console.error("[MultiAgent] Composer \u6574\u5408\u5931\u8D25:",o)}return{finalOutput:I2(e)}}function s7(t){return t.formatCheckPassed?"composer":"persona"}function c7(){return new af(dy).addNode("parser",RA).addNode("narrator",LT).addNode("director",VT).addNode("persona",HT).addNode("evaluate",ZT).addNode("composer",WT).addEdge($e,"parser").addEdge("parser","narrator").addEdge("narrator","director").addEdge("director","persona").addEdge("persona","evaluate").addConditionalEdges("evaluate",s7,{composer:"composer",persona:"persona"}).addEdge("composer",Ie).compile()}var JT=null;function Xy(){return JT||(JT=c7(),console.log("[MultiAgent] LangGraph \u56FE\u5DF2\u521B\u5EFA")),JT}async function k2(t){let e=Xy(),r={rawMessages:t,personaOutputs:[],retryCount:0};console.log("[MultiAgent] \u5F00\u59CB\u6267\u884C\u56FE...");try{let n=await e.invoke(r);return console.log("[MultiAgent] \u56FE\u6267\u884C\u5B8C\u6210"),n.finalOutput||"[\u65E0\u8F93\u51FA]"}catch(n){throw console.error("[MultiAgent] \u56FE\u6267\u884C\u5931\u8D25:",n),n}}async function*E2(t){let e=Xy(),r={rawMessages:t,personaOutputs:[],retryCount:0};console.log("[MultiAgent] \u5F00\u59CB\u6D41\u5F0F\u6267\u884C\u56FE...");for await(let n of await e.stream(r))for(let[i,o]of Object.entries(n))yield{node:i,state:o}}var u7=`
/* \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
   Multi-Agent Configurator Window System
   \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550 */

/* Overlay backdrop */
.ma-config-overlay {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0, 0, 0, 0.55);
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  z-index: 9999;
  animation: maOverlayFadeIn 0.2s ease-out;
}

@keyframes maOverlayFadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* Main window container */
.ma-config-window {
  position: fixed;
  display: flex;
  flex-direction: column;
  background:
    radial-gradient(1200px 600px at 10% -10%, rgba(100, 180, 255, 0.10), transparent 60%),
    radial-gradient(900px 500px at 100% 0%, rgba(140, 100, 255, 0.08), transparent 55%),
    linear-gradient(180deg, rgba(255, 255, 255, 0.02), transparent 22%),
    #0a0e14;
  border: 1px solid rgba(255, 255, 255, 0.12);
  border-radius: 16px;
  box-shadow: 0 25px 80px rgba(0, 0, 0, 0.65), 0 0 1px rgba(255,255,255,0.1);
  overflow: hidden;
  min-width: 800px;
  min-height: 500px;
  animation: maWindowSlideIn 0.25s ease-out;
  color-scheme: dark;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC",
               "Hiragino Sans GB", "Microsoft YaHei", Roboto, sans-serif;
  color: rgba(255, 255, 255, 0.92);
}

@keyframes maWindowSlideIn {
  from { opacity: 0; transform: scale(0.95) translateY(-20px); }
  to { opacity: 1; transform: scale(1) translateY(0); }
}

.ma-config-window.maximized {
  top: 10px !important;
  left: 10px !important;
  width: calc(100vw - 20px) !important;
  height: calc(100vh - 20px) !important;
  border-radius: 12px;
}

/* Window header / title bar */
.ma-config-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  background: rgba(255, 255, 255, 0.04);
  border-bottom: 1px solid rgba(255, 255, 255, 0.08);
  cursor: move;
  user-select: none;
  flex-shrink: 0;
}

.ma-config-title {
  font-size: 14px;
  font-weight: 700;
  color: rgba(255, 255, 255, 0.95);
  display: flex;
  align-items: center;
  gap: 10px;
  flex: 1;
  min-width: 0;
  overflow: hidden;
}

.ma-config-title-icon {
  color: rgba(100, 180, 255, 0.85);
  font-size: 16px;
  flex-shrink: 0;
}

.ma-config-title span {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* Window control buttons */
.ma-config-controls {
  display: flex;
  gap: 8px;
  flex-shrink: 0;
  margin-left: 8px;
}

.ma-config-btn {
  width: 28px;
  height: 28px;
  border: none;
  border-radius: 8px;
  background: rgba(255, 255, 255, 0.06);
  color: rgba(255, 255, 255, 0.7);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.15s ease;
  font-size: 12px;
}

.ma-config-btn:hover {
  background: rgba(255, 255, 255, 0.12);
  color: rgba(255, 255, 255, 0.95);
}

.ma-config-btn.close:hover {
  background: rgba(255, 107, 107, 0.25);
  color: #ff6b6b;
}

/* Main body container */
.ma-config-body {
  display: flex;
  flex: 1;
  min-height: 0;
  overflow: hidden;
}

/* Sidebar */
.ma-config-sidebar {
  width: 200px;
  flex-shrink: 0;
  background: rgba(0, 0, 0, 0.2);
  border-right: 1px solid rgba(255, 255, 255, 0.08);
  display: flex;
  flex-direction: column;
  overflow-y: auto;
}

.ma-config-sidebar-title {
  padding: 12px 16px;
  font-size: 12px;
  font-weight: 600;
  color: rgba(255, 255, 255, 0.5);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.ma-config-agent-list {
  flex: 1;
  padding: 8px;
}

.ma-config-agent-item {
  padding: 12px 14px;
  margin-bottom: 4px;
  border-radius: 8px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 10px;
  transition: all 0.15s ease;
  color: rgba(255, 255, 255, 0.7);
}

.ma-config-agent-item:hover {
  background: rgba(255, 255, 255, 0.06);
  color: rgba(255, 255, 255, 0.9);
}

.ma-config-agent-item.active {
  background: rgba(100, 180, 255, 0.15);
  color: rgba(255, 255, 255, 0.95);
  border-left: 3px solid rgba(100, 180, 255, 0.8);
}

.ma-config-agent-icon {
  font-size: 16px;
  width: 20px;
  text-align: center;
}

.ma-config-agent-name {
  flex: 1;
  font-size: 13px;
  font-weight: 500;
}

.ma-config-agent-status {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.2);
}

.ma-config-agent-status.modified {
  background: rgba(255, 200, 100, 0.8);
}

/* Content area */
.ma-config-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* Toolbar */
.ma-config-toolbar {
  display: flex;
  align-items: center;
  padding: 10px 16px;
  gap: 8px;
  background: rgba(0, 0, 0, 0.15);
  border-bottom: 1px solid rgba(255, 255, 255, 0.06);
  flex-shrink: 0;
}

.ma-config-toolbar-btn {
  padding: 6px 12px;
  border: none;
  border-radius: 6px;
  background: rgba(255, 255, 255, 0.08);
  color: rgba(255, 255, 255, 0.8);
  cursor: pointer;
  font-size: 12px;
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 6px;
  transition: all 0.15s ease;
}

.ma-config-toolbar-btn:hover {
  background: rgba(255, 255, 255, 0.14);
  color: rgba(255, 255, 255, 0.95);
}

.ma-config-toolbar-btn.primary {
  background: rgba(100, 180, 255, 0.2);
  color: rgba(100, 180, 255, 0.95);
}

.ma-config-toolbar-btn.primary:hover {
  background: rgba(100, 180, 255, 0.3);
}

.ma-config-toolbar-btn.danger {
  background: rgba(255, 100, 100, 0.15);
  color: rgba(255, 150, 150, 0.9);
}

.ma-config-toolbar-btn.danger:hover {
  background: rgba(255, 100, 100, 0.25);
}

.ma-config-toolbar-separator {
  width: 1px;
  height: 20px;
  background: rgba(255, 255, 255, 0.1);
  margin: 0 4px;
}

.ma-config-toolbar-spacer {
  flex: 1;
}

/* Editor area */
.ma-config-editor {
  flex: 1;
  display: flex;
  flex-direction: column;
  padding: 16px;
  overflow: hidden;
  gap: 16px;
}

.ma-config-editor-section {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.ma-config-editor-section.flex-1 {
  flex: 1;
  min-height: 0;
}

.ma-config-editor-label {
  font-size: 12px;
  font-weight: 600;
  color: rgba(255, 255, 255, 0.6);
  display: flex;
  align-items: center;
  gap: 8px;
}

.ma-config-editor-textarea {
  flex: 1;
  min-height: 150px;
  padding: 12px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 8px;
  background: rgba(0, 0, 0, 0.25);
  color: rgba(255, 255, 255, 0.9);
  font-family: 'Consolas', 'Monaco', 'Menlo', monospace;
  font-size: 13px;
  line-height: 1.5;
  resize: none;
  outline: none;
  transition: border-color 0.15s ease;
}

.ma-config-editor-textarea:focus {
  border-color: rgba(100, 180, 255, 0.4);
}

.ma-config-editor-textarea::placeholder {
  color: rgba(255, 255, 255, 0.3);
}

/* Variables section */
.ma-config-variables {
  background: rgba(0, 0, 0, 0.2);
  border-radius: 8px;
  padding: 12px;
}

.ma-config-variables-title {
  font-size: 12px;
  font-weight: 600;
  color: rgba(255, 255, 255, 0.5);
  margin-bottom: 10px;
}

.ma-config-variable-list {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.ma-config-variable-tag {
  padding: 4px 10px;
  border-radius: 4px;
  background: rgba(100, 180, 255, 0.15);
  color: rgba(100, 180, 255, 0.9);
  font-size: 12px;
  font-family: 'Consolas', monospace;
  cursor: pointer;
  transition: all 0.15s ease;
}

.ma-config-variable-tag:hover {
  background: rgba(100, 180, 255, 0.25);
}

.ma-config-variable-tag::before {
  content: '{{';
  opacity: 0.6;
}

.ma-config-variable-tag::after {
  content: '}}';
  opacity: 0.6;
}

/* Parameters row */
.ma-config-params {
  display: flex;
  gap: 16px;
  flex-wrap: wrap;
}

.ma-config-param {
  display: flex;
  align-items: center;
  gap: 8px;
}

.ma-config-param-label {
  font-size: 12px;
  color: rgba(255, 255, 255, 0.6);
}

.ma-config-param-input {
  width: 80px;
  padding: 6px 10px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 6px;
  background: rgba(0, 0, 0, 0.25);
  color: rgba(255, 255, 255, 0.9);
  font-size: 12px;
  outline: none;
  transition: border-color 0.15s ease;
}

.ma-config-param-input:focus {
  border-color: rgba(100, 180, 255, 0.4);
}

/* Preview panel */
.ma-config-preview {
  max-height: 200px;
  padding: 12px;
  border: 1px solid rgba(255, 255, 255, 0.08);
  border-radius: 8px;
  background: rgba(0, 0, 0, 0.15);
  overflow-y: auto;
  font-family: 'Consolas', monospace;
  font-size: 12px;
  line-height: 1.5;
  color: rgba(255, 255, 255, 0.7);
  white-space: pre-wrap;
  word-break: break-word;
}

.ma-config-preview-highlight {
  color: rgba(100, 180, 255, 0.9);
  background: rgba(100, 180, 255, 0.1);
  padding: 0 2px;
  border-radius: 2px;
}

/* Resize handles */
.ma-config-resize-handle {
  position: absolute;
  background: transparent;
}

.ma-config-resize-handle.se {
  right: 0; bottom: 0;
  width: 20px; height: 20px;
  cursor: se-resize;
}

.ma-config-resize-handle.se::after {
  content: '';
  position: absolute;
  right: 4px; bottom: 4px;
  width: 10px; height: 10px;
  border-right: 2px solid rgba(255,255,255,0.2);
  border-bottom: 2px solid rgba(255,255,255,0.2);
}

.ma-config-resize-handle.e {
  right: 0; top: 40px; bottom: 20px;
  width: 6px;
  cursor: e-resize;
}

.ma-config-resize-handle.s {
  left: 20px; right: 20px; bottom: 0;
  height: 6px;
  cursor: s-resize;
}

.ma-config-resize-handle.w {
  left: 0; top: 40px; bottom: 20px;
  width: 6px;
  cursor: w-resize;
}

.ma-config-resize-handle.n {
  left: 20px; right: 20px; top: 0;
  height: 6px;
  cursor: n-resize;
}

.ma-config-resize-handle.nw {
  left: 0; top: 0;
  width: 20px; height: 20px;
  cursor: nw-resize;
}

.ma-config-resize-handle.ne {
  right: 0; top: 0;
  width: 20px; height: 20px;
  cursor: ne-resize;
}

.ma-config-resize-handle.sw {
  left: 0; bottom: 0;
  width: 20px; height: 20px;
  cursor: sw-resize;
}

/* Toast notifications */
.ma-config-toast {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  padding: 12px 20px;
  border-radius: 8px;
  background: rgba(0, 0, 0, 0.85);
  color: rgba(255, 255, 255, 0.9);
  font-size: 13px;
  z-index: 10001;
  animation: maToastSlideIn 0.25s ease-out;
}

.ma-config-toast.success {
  border-left: 3px solid rgba(100, 200, 100, 0.8);
}

.ma-config-toast.error {
  border-left: 3px solid rgba(255, 100, 100, 0.8);
}

@keyframes maToastSlideIn {
  from { opacity: 0; transform: translateX(-50%) translateY(10px); }
  to { opacity: 1; transform: translateX(-50%) translateY(0); }
}

/* Responsive adjustments */
@media screen and (max-width: 900px) {
  .ma-config-window {
    min-width: 100vw;
    min-height: 100vh;
    border-radius: 0;
  }

  .ma-config-sidebar {
    width: 160px;
  }
}

@media screen and (max-width: 600px) {
  .ma-config-sidebar {
    width: 50px;
  }

  .ma-config-agent-name,
  .ma-config-sidebar-title {
    display: none;
  }

  .ma-config-agent-item {
    justify-content: center;
    padding: 12px 8px;
  }
}
`,A2="ma-configurator-styles";function T2(){if(typeof document>"u"||document.getElementById(A2))return;let t=document.createElement("style");t.id=A2,t.textContent=u7,document.head.appendChild(t)}var Qa={windows:new Map,baseZIndex:1e4,topZIndex:1e4,register(t,e){this.topZIndex++,this.windows.set(t,e),e.style.zIndex=String(this.topZIndex)},unregister(t){this.windows.delete(t)},bringToFront(t){let e=this.windows.get(t);e&&(this.topZIndex++,e.style.zIndex=String(this.topZIndex))},isOpen(t){return this.windows.has(t)},getWindow(t){return this.windows.get(t)||null}},$2="ma_config_window_state";function XT(t){try{localStorage.setItem($2,JSON.stringify(t))}catch(e){console.warn("[MultiAgent] Failed to save window state:",e)}}function l7(){try{let t=localStorage.getItem($2);if(t)return JSON.parse(t)}catch(t){console.warn("[MultiAgent] Failed to load window state:",t)}return null}function O2(t){let{id:e,title:r="Window",content:n="",width:i=1e3,height:o=700,modal:a=!0,resizable:s=!0,maximizable:c=!0,rememberState:u=!0,onClose:l,onReady:p}=t;if(T2(),Qa.isOpen(e)){let N=Qa.getWindow(e);if(N)return Qa.bringToFront(e),N}let f=u?l7():null,m=f?.width||i,h=f?.height||o,g=f?.isMaximized||!1,x=null;a&&(x=document.createElement("div"),x.className="ma-config-overlay",x.setAttribute("data-window-id",e),document.body.appendChild(x));let y=document.createElement("div");y.className="ma-config-window",y.id=e,g?y.classList.add("maximized"):(y.style.width=`${m}px`,y.style.height=`${h}px`,y.style.left=`${Math.max(10,(window.innerWidth-m)/2)}px`,y.style.top=`${Math.max(10,(window.innerHeight-h)/2)}px`),y.innerHTML=`
    <div class="ma-config-header">
      <div class="ma-config-title">
        <span class="ma-config-title-icon">&#9881;</span>
        <span>${r}</span>
      </div>
      <div class="ma-config-controls">
        ${c?`
          <button class="ma-config-btn maximize" title="Maximize">
            ${g?"&#9744;":"&#9723;"}
          </button>
        `:""}
        <button class="ma-config-btn close" title="Close">&#10005;</button>
      </div>
    </div>
    <div class="ma-config-body">
      ${n}
    </div>
    ${s?`
      <div class="ma-config-resize-handle n"></div>
      <div class="ma-config-resize-handle s"></div>
      <div class="ma-config-resize-handle e"></div>
      <div class="ma-config-resize-handle w"></div>
      <div class="ma-config-resize-handle nw"></div>
      <div class="ma-config-resize-handle ne"></div>
      <div class="ma-config-resize-handle sw"></div>
      <div class="ma-config-resize-handle se"></div>
    `:""}
  `,document.body.appendChild(y),Qa.register(e,y);let v=g,S=()=>{u&&!v&&XT({width:y.offsetWidth,height:y.offsetHeight,isMaximized:v}),Qa.unregister(e),y.remove(),x?.remove(),l?.()};y.querySelector(".ma-config-btn.close")?.addEventListener("click",S);let T=y.querySelector(".ma-config-btn.maximize");return T&&T.addEventListener("click",()=>{v=!v,y.classList.toggle("maximized",v),T.innerHTML=v?"&#9744;":"&#9723;",u&&XT({width:y.offsetWidth,height:y.offsetHeight,isMaximized:v})}),x?.addEventListener("click",N=>{N.target===x&&S()}),p7(y,y.querySelector(".ma-config-header")),s&&d7(y,u),y.addEventListener("mousedown",()=>{Qa.bringToFront(e)}),p?.(y),y}function p7(t,e){let r=!1,n=0,i=0,o=0,a=0,s=l=>{l.target.closest(".ma-config-controls")||t.classList.contains("maximized")||(r=!0,n=l.clientX,i=l.clientY,o=t.offsetLeft,a=t.offsetTop,document.addEventListener("mousemove",c),document.addEventListener("mouseup",u),l.preventDefault())},c=l=>{if(!r)return;let p=l.clientX-n,f=l.clientY-i,m=Math.max(0,Math.min(window.innerWidth-100,o+p)),h=Math.max(0,Math.min(window.innerHeight-50,a+f));t.style.left=`${m}px`,t.style.top=`${h}px`},u=()=>{r=!1,document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",u)};e.addEventListener("mousedown",s)}function d7(t,e){t.querySelectorAll(".ma-config-resize-handle").forEach(n=>{let i=n,o=!1,a=0,s=0,c=0,u=0,l=0,p=0,f=Array.from(i.classList).find(x=>x!=="ma-config-resize-handle")||"",m=x=>{t.classList.contains("maximized")||(o=!0,a=x.clientX,s=x.clientY,c=t.offsetWidth,u=t.offsetHeight,l=t.offsetLeft,p=t.offsetTop,document.addEventListener("mousemove",h),document.addEventListener("mouseup",g),x.preventDefault(),x.stopPropagation())},h=x=>{if(!o)return;let y=x.clientX-a,v=x.clientY-s,S=400,k=300;if(f.includes("e")&&(t.style.width=`${Math.max(S,c+y)}px`),f.includes("w")){let T=Math.max(S,c-y);T>S&&(t.style.width=`${T}px`,t.style.left=`${l+y}px`)}if(f.includes("s")&&(t.style.height=`${Math.max(k,u+v)}px`),f.includes("n")){let T=Math.max(k,u-v);T>k&&(t.style.height=`${T}px`,t.style.top=`${p+v}px`)}},g=()=>{o=!1,document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",g),e&&XT({width:t.offsetWidth,height:t.offsetHeight,isMaximized:t.classList.contains("maximized")})};i.addEventListener("mousedown",m)})}function C2(t){let e=Qa.getWindow(t);e&&e.querySelector(".ma-config-btn.close")?.click()}function P2(t){return Qa.isOpen(t)}function mn(t,e="info",r=3e3){let n=document.createElement("div");n.className=`ma-config-toast ${e}`,n.textContent=t,document.body.appendChild(n),setTimeout(()=>{n.style.opacity="0",n.style.transform="translateX(-50%) translateY(10px)",setTimeout(()=>n.remove(),200)},r)}var N2=[{type:"narrator",name:"Narrator",icon:"&#128214;",description:"\u53D9\u4E8B\u8005 - \u5206\u6790\u573A\u666F\u548C\u66F4\u65B0\u4E16\u754C\u72B6\u6001"},{type:"director",name:"Director",icon:"&#127916;",description:"\u5BFC\u6F14 - \u51B3\u5B9A\u53D1\u8A00\u89D2\u8272\u548C\u4E0A\u4E0B\u6587"},{type:"persona",name:"Persona",icon:"&#128100;",description:"\u89D2\u8272\u4EE3\u7406 - \u626E\u6F14\u6307\u5B9A\u89D2\u8272\u751F\u6210\u56DE\u590D"},{type:"composer",name:"Composer",icon:"&#9997;",description:"\u6574\u5408\u8005 - \u5408\u5E76\u89D2\u8272\u56DE\u590D\u4E3A\u8FDE\u8D2F\u53D9\u4E8B"}];function R2(t){let{selectedAgent:e,modifiedAgents:r}=t;return`
    <div class="ma-config-sidebar">
      <div class="ma-config-sidebar-title">Agents</div>
      <div class="ma-config-agent-list">
        ${N2.map(i=>{let o=i.type===e,a=r.has(i.type);return`
      <div class="ma-config-agent-item ${o?"active":""}"
           data-agent="${i.type}"
           title="${i.description}">
        <span class="ma-config-agent-icon">${i.icon}</span>
        <span class="ma-config-agent-name">${i.name}</span>
        <span class="ma-config-agent-status ${a?"modified":""}"></span>
      </div>
    `}).join("")}
      </div>
    </div>
  `}function M2(t,e){t.querySelectorAll(".ma-config-agent-item").forEach(n=>{n.addEventListener("click",()=>{let i=n.getAttribute("data-agent");i&&e(i)})})}function z2(t,e){t.querySelectorAll(".ma-config-agent-item").forEach(n=>{let i=n.getAttribute("data-agent");n.classList.toggle("active",i===e)})}function Wl(t,e){t.querySelectorAll(".ma-config-agent-item").forEach(n=>{let i=n.getAttribute("data-agent"),o=n.querySelector(".ma-config-agent-status");o&&o.classList.toggle("modified",e.has(i))})}function j2(t){return N2.find(e=>e.type===t)}function QT(t){let{agent:e,config:r}=t,n=j2(e),i=r.variables.map(o=>`
      <span class="ma-config-variable-tag"
            data-variable="${o.name}"
            title="${o.description}${o.example?`
\u793A\u4F8B: `+o.example:""}">
        ${o.name}
      </span>
    `).join("");return`
    <div class="ma-config-content">
      <div class="ma-config-toolbar" id="ma-toolbar"></div>
      <div class="ma-config-editor">
        <!-- Agent Header -->
        <div class="ma-config-editor-section">
          <div class="ma-config-editor-label">
            <span>${n?.icon||""}</span>
            <span>${n?.name||e} - ${n?.description||""}</span>
          </div>
        </div>

        <!-- Parameters -->
        <div class="ma-config-editor-section">
          <div class="ma-config-params">
            <div class="ma-config-param">
              <label class="ma-config-param-label">Temperature:</label>
              <input type="number"
                     class="ma-config-param-input"
                     id="ma-temp-input"
                     min="0" max="2" step="0.1"
                     value="${r.temperature??.7}">
            </div>
            <div class="ma-config-param">
              <label class="ma-config-param-label">Model:</label>
              <input type="text"
                     class="ma-config-param-input"
                     id="ma-model-input"
                     style="width: 160px;"
                     placeholder="Default"
                     value="${r.modelName||""}">
            </div>
          </div>
        </div>

        <!-- Variables -->
        <div class="ma-config-editor-section">
          <div class="ma-config-variables">
            <div class="ma-config-variables-title">
              Available Variables (click to insert)
            </div>
            <div class="ma-config-variable-list">
              ${i}
            </div>
          </div>
        </div>

        <!-- System Prompt Editor -->
        <div class="ma-config-editor-section flex-1">
          <div class="ma-config-editor-label">
            System Prompt Template
          </div>
          <textarea class="ma-config-editor-textarea"
                    id="ma-system-prompt"
                    placeholder="Enter system prompt template...">${YT(r.systemPrompt)}</textarea>
        </div>

        ${r.userPromptTemplate!==void 0?`
        <!-- User Prompt Template -->
        <div class="ma-config-editor-section">
          <div class="ma-config-editor-label">
            User Prompt Template (optional)
          </div>
          <textarea class="ma-config-editor-textarea"
                    id="ma-user-prompt"
                    style="min-height: 80px;"
                    placeholder="Enter user prompt template...">${YT(r.userPromptTemplate||"")}</textarea>
        </div>
        `:""}

        <!-- Preview -->
        <div class="ma-config-editor-section">
          <div class="ma-config-editor-label">
            Preview (with example values)
          </div>
          <div class="ma-config-preview" id="ma-preview">
            ${D2(r)}
          </div>
        </div>
      </div>
    </div>
  `}function YT(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function D2(t){let e=t.systemPrompt;for(let r of t.variables){let n=new RegExp(`\\{\\{${r.name}\\}\\}`,"g"),i=`<span class="ma-config-preview-highlight">${YT(r.example||`[${r.name}]`)}</span>`;e=e.replace(n,i)}return e.replace(/\n/g,"<br>")}function e$(t,e){let{config:r,onConfigChange:n}=e,i=t.querySelector("#ma-system-prompt");i&&i.addEventListener("input",()=>{n({systemPrompt:i.value}),f7(t,{...r,systemPrompt:i.value})});let o=t.querySelector("#ma-user-prompt");o&&o.addEventListener("input",()=>{n({userPromptTemplate:o.value})});let a=t.querySelector("#ma-temp-input");a&&a.addEventListener("change",()=>{let u=parseFloat(a.value);!isNaN(u)&&u>=0&&u<=2&&n({temperature:u})});let s=t.querySelector("#ma-model-input");s&&s.addEventListener("change",()=>{n({modelName:s.value||void 0})}),t.querySelectorAll(".ma-config-variable-tag").forEach(u=>{u.addEventListener("click",()=>{let l=u.getAttribute("data-variable");if(l&&i){let p=`{{${l}}}`,f=i.selectionStart,m=i.selectionEnd,h=i.value;i.value=h.substring(0,f)+p+h.substring(m),i.selectionStart=i.selectionEnd=f+p.length,i.dispatchEvent(new Event("input")),i.focus()}})})}function f7(t,e){let r=t.querySelector("#ma-preview");r&&(r.innerHTML=D2(e))}function t$(){return`
    <button class="ma-config-toolbar-btn primary" id="ma-btn-save" title="Save changes">
      <span>&#128190;</span>
      <span>Save</span>
    </button>
    <div class="ma-config-toolbar-separator"></div>
    <button class="ma-config-toolbar-btn" id="ma-btn-reset-agent" title="Reset current agent to defaults">
      <span>&#8635;</span>
      <span>Reset Agent</span>
    </button>
    <button class="ma-config-toolbar-btn danger" id="ma-btn-reset-all" title="Reset all agents to defaults">
      <span>&#9888;</span>
      <span>Reset All</span>
    </button>
    <div class="ma-config-toolbar-separator"></div>
    <button class="ma-config-toolbar-btn" id="ma-btn-export" title="Export configuration to JSON">
      <span>&#128229;</span>
      <span>Export</span>
    </button>
    <button class="ma-config-toolbar-btn" id="ma-btn-import" title="Import configuration from JSON">
      <span>&#128228;</span>
      <span>Import</span>
    </button>
    <div class="ma-config-toolbar-spacer"></div>
    <button class="ma-config-toolbar-btn" id="ma-btn-copy" title="Copy current prompt to clipboard">
      <span>&#128203;</span>
      <span>Copy</span>
    </button>
  `}function r$(t,e){t.querySelector("#ma-btn-save")?.addEventListener("click",e.onSave),t.querySelector("#ma-btn-reset-agent")?.addEventListener("click",e.onResetAgent),t.querySelector("#ma-btn-reset-all")?.addEventListener("click",()=>{confirm("Reset all agents to default configuration? This cannot be undone.")&&e.onResetAll()}),t.querySelector("#ma-btn-export")?.addEventListener("click",e.onExport),t.querySelector("#ma-btn-import")?.addEventListener("click",e.onImport),t.querySelector("#ma-btn-copy")?.addEventListener("click",e.onCopyToClipboard)}function L2(t,e){let r=new Blob([t],{type:"application/json"}),n=URL.createObjectURL(r),i=document.createElement("a");i.href=n,i.download=e,document.body.appendChild(i),i.click(),setTimeout(()=>{document.body.removeChild(i),URL.revokeObjectURL(n)},100)}function U2(){return new Promise((t,e)=>{let r=document.createElement("input");r.type="file",r.accept=".json,application/json",r.addEventListener("change",()=>{let n=r.files?.[0];if(!n){e(new Error("No file selected"));return}let i=new FileReader;i.onload=()=>{t(i.result)},i.onerror=()=>{e(new Error("Failed to read file"))},i.readAsText(n)}),r.click()})}async function F2(t){try{await navigator.clipboard.writeText(t)}catch{let r=document.createElement("textarea");r.value=t,r.style.position="fixed",r.style.opacity="0",document.body.appendChild(r),r.select(),document.execCommand("copy"),document.body.removeChild(r)}}function Tc(t,e){let r=t.querySelector("#ma-btn-save");r&&(r.classList.toggle("primary",e),e?r.innerHTML="<span>&#128190;</span><span>Save *</span>":r.innerHTML="<span>&#128190;</span><span>Save</span>")}var Ko="ma-configurator-window",Mr={selectedAgent:"narrator",isDirty:!1,previewVariables:{}},Mn=new Set,Qi=new Map;function Qy(t){let r=St().getPrompt(t),n=Qi.get(t);return n?{...r,...n}:r}function Yy(t,e){let r=Qi.get(t)||{};Qi.set(t,{...r,...e}),Mn.add(t),Mr.isDirty=!0;let n=document.getElementById(Ko);n&&(Wl(n,Mn),Tc(n,Mr.isDirty))}async function B2(){let t=St();try{for(let[r,n]of Qi)await t.setPrompt(r,n);Qi.clear(),Mn.clear(),Mr.isDirty=!1;let e=document.getElementById(Ko);e&&(Wl(e,Mn),Tc(e,!1)),mn("Configuration saved successfully","success")}catch(e){console.error("[MultiAgent] Failed to save config:",e),mn("Failed to save configuration","error")}}async function V2(){let t=St(),e=Mr.selectedAgent;try{await t.resetAgent(e),Qi.delete(e),Mn.delete(e);let r=document.getElementById(Ko);r&&(ev(r),Wl(r,Mn),Tc(r,Qi.size>0)),mn(`${e} reset to defaults`,"success")}catch(r){console.error("[MultiAgent] Failed to reset agent:",r),mn("Failed to reset agent","error")}}async function Z2(){let t=St();try{await t.resetAll(),Qi.clear(),Mn.clear(),Mr.isDirty=!1;let e=document.getElementById(Ko);e&&(ev(e),Wl(e,Mn),Tc(e,!1)),mn("All agents reset to defaults","success")}catch(e){console.error("[MultiAgent] Failed to reset all:",e),mn("Failed to reset configuration","error")}}async function G2(){let t=St();try{let e=await t.exportConfig(),r=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);L2(e,`multi-agent-config-${r}.json`),mn("Configuration exported","success")}catch(e){console.error("[MultiAgent] Export failed:",e),mn("Failed to export configuration","error")}}async function H2(){try{let t=await U2();await St().importConfig(t),Qi.clear(),Mn.clear(),Mr.isDirty=!1;let r=document.getElementById(Ko);r&&(ev(r),Wl(r,Mn),Tc(r,!1)),mn("Configuration imported","success")}catch(t){console.error("[MultiAgent] Import failed:",t),mn("Failed to import configuration","error")}}async function q2(){let t=Qy(Mr.selectedAgent);try{await F2(t.systemPrompt),mn("Prompt copied to clipboard","success")}catch(e){console.error("[MultiAgent] Copy failed:",e),mn("Failed to copy to clipboard","error")}}function K2(t){if(t===Mr.selectedAgent)return;Mr.selectedAgent=t;let e=document.getElementById(Ko);e&&(z2(e,t),ev(e))}function ev(t){if(!t.querySelector(".ma-config-content"))return;let r=Mr.selectedAgent,n=Qy(r),i=QT({agent:r,config:n,onConfigChange:a=>Yy(r,a)}),o=t.querySelector(".ma-config-body");if(o){let a=o.querySelector(".ma-config-content");a&&a.remove(),o.insertAdjacentHTML("beforeend",i);let s=o.querySelector(".ma-config-content");if(s){e$(s,{agent:r,config:n,onConfigChange:u=>Yy(r,u)});let c=s.querySelector("#ma-toolbar");c&&(c.innerHTML=t$(),r$(s,{onSave:B2,onResetAgent:V2,onResetAll:Z2,onExport:G2,onImport:H2,onCopyToClipboard:q2}),Tc(s,Mr.isDirty))}}}function m7(){let t=Mr.selectedAgent,e=Qy(t),r=R2({selectedAgent:t,modifiedAgents:Mn,onAgentSelect:K2}),n=QT({agent:t,config:e,onConfigChange:i=>Yy(t,i)});return r+n}async function n$(){await St().init(),Mr={selectedAgent:"narrator",isDirty:!1,previewVariables:{}},Qi.clear(),Mn.clear();let e=O2({id:Ko,title:"Multi-Agent Prompt Configurator",content:m7(),width:1100,height:750,modal:!0,resizable:!0,maximizable:!0,rememberState:!0,onClose:()=>{Mr.isDirty&&console.log("[MultiAgent] Configurator closed with unsaved changes")},onReady:r=>{M2(r,K2);let n=r.querySelector(".ma-config-content");if(n){let i=Mr.selectedAgent,o=Qy(i);e$(n,{agent:i,config:o,onConfigChange:s=>Yy(i,s)});let a=n.querySelector("#ma-toolbar");a&&(a.innerHTML=t$(),r$(n,{onSave:B2,onResetAgent:V2,onResetAll:Z2,onExport:G2,onImport:H2,onCopyToClipboard:q2}))}console.log("[MultiAgent] Configurator window opened")}})}function i$(){C2(Ko)}function o$(){return P2(Ko)}async function W2(){o$()?i$():await n$()}var J2={version:"1.0.0",init(t){console.log("[MultiAgent] \u521D\u59CB\u5316\u914D\u7F6E...");let e=t.default,r=e?.apiKey;if(t.narrator||r){let n={...e,...t.narrator};DT(n)}if(t.director||r){let n={...e,...t.director};BT(n)}if(t.persona||r){let n={...e,...t.persona};GT(n)}if(t.composer||r){let n={...e,...t.composer};KT(n)}console.log("[MultiAgent] \u914D\u7F6E\u5B8C\u6210")},async run(t){return k2(t)},stream:E2,getGraph:Xy,StateAnnotation:dy,openConfigurator:n$,closeConfigurator:i$,isConfiguratorOpen:o$,toggleConfigurator:W2,getPrompts(){return St().getConfig()},async setPrompts(t){let e=St(),r=e.getConfig();await e.setConfig({...r,...t})},async exportConfig(){return St().exportConfig()},async importConfig(t){await St().importConfig(t)},async resetToDefaults(){await St().resetAll()}};typeof window<"u"&&(window.MultiAgentAPI=J2,console.log("[MultiAgent] API \u5DF2\u6302\u8F7D\u5230 window.MultiAgentAPI"));var e5e=J2;export{J2 as MultiAgentAPI,e5e as default};
/*! Bundled license information:

@langchain/core/dist/utils/fast-json-patch/src/helpers.js:
  (*!
  * https://github.com/Starcounter-Jack/JSON-Patch
  * (c) 2017-2022 Joachim Wester
  * MIT licensed
  *)

@langchain/core/dist/utils/sax-js/sax.js:
  (*! http://mths.be/fromcodepoint v0.1.0 by @mathias *)

mustache/mustache.mjs:
  (*!
   * mustache.js - Logic-less {{mustache}} templates with JavaScript
   * http://github.com/janl/mustache.js
   *)
*/
//# sourceMappingURL=index.js.map
